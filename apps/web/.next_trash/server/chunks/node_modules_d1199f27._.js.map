{"version":3,"sources":["../../../node_modules/buffer-crc32/dist/index.cjs","../../../node_modules/yazl/index.js","../../../node_modules/next/dist/esm/build/templates/app-route.js","../../../src/app/api/trades/%5Bid%5D/proof-pack/route.ts","../../../src/lib/proofpack/zip.ts","../../../src/lib/proofpack/hash.ts","../../../src/lib/evidence/completeness.ts"],"sourcesContent":["'use strict';\n\nfunction getDefaultExportFromCjs (x) {\n\treturn x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;\n}\n\nconst CRC_TABLE = new Int32Array([\n  0,\n  1996959894,\n  3993919788,\n  2567524794,\n  124634137,\n  1886057615,\n  3915621685,\n  2657392035,\n  249268274,\n  2044508324,\n  3772115230,\n  2547177864,\n  162941995,\n  2125561021,\n  3887607047,\n  2428444049,\n  498536548,\n  1789927666,\n  4089016648,\n  2227061214,\n  450548861,\n  1843258603,\n  4107580753,\n  2211677639,\n  325883990,\n  1684777152,\n  4251122042,\n  2321926636,\n  335633487,\n  1661365465,\n  4195302755,\n  2366115317,\n  997073096,\n  1281953886,\n  3579855332,\n  2724688242,\n  1006888145,\n  1258607687,\n  3524101629,\n  2768942443,\n  901097722,\n  1119000684,\n  3686517206,\n  2898065728,\n  853044451,\n  1172266101,\n  3705015759,\n  2882616665,\n  651767980,\n  1373503546,\n  3369554304,\n  3218104598,\n  565507253,\n  1454621731,\n  3485111705,\n  3099436303,\n  671266974,\n  1594198024,\n  3322730930,\n  2970347812,\n  795835527,\n  1483230225,\n  3244367275,\n  3060149565,\n  1994146192,\n  31158534,\n  2563907772,\n  4023717930,\n  1907459465,\n  112637215,\n  2680153253,\n  3904427059,\n  2013776290,\n  251722036,\n  2517215374,\n  3775830040,\n  2137656763,\n  141376813,\n  2439277719,\n  3865271297,\n  1802195444,\n  476864866,\n  2238001368,\n  4066508878,\n  1812370925,\n  453092731,\n  2181625025,\n  4111451223,\n  1706088902,\n  314042704,\n  2344532202,\n  4240017532,\n  1658658271,\n  366619977,\n  2362670323,\n  4224994405,\n  1303535960,\n  984961486,\n  2747007092,\n  3569037538,\n  1256170817,\n  1037604311,\n  2765210733,\n  3554079995,\n  1131014506,\n  879679996,\n  2909243462,\n  3663771856,\n  1141124467,\n  855842277,\n  2852801631,\n  3708648649,\n  1342533948,\n  654459306,\n  3188396048,\n  3373015174,\n  1466479909,\n  544179635,\n  3110523913,\n  3462522015,\n  1591671054,\n  702138776,\n  2966460450,\n  3352799412,\n  1504918807,\n  783551873,\n  3082640443,\n  3233442989,\n  3988292384,\n  2596254646,\n  62317068,\n  1957810842,\n  3939845945,\n  2647816111,\n  81470997,\n  1943803523,\n  3814918930,\n  2489596804,\n  225274430,\n  2053790376,\n  3826175755,\n  2466906013,\n  167816743,\n  2097651377,\n  4027552580,\n  2265490386,\n  503444072,\n  1762050814,\n  4150417245,\n  2154129355,\n  426522225,\n  1852507879,\n  4275313526,\n  2312317920,\n  282753626,\n  1742555852,\n  4189708143,\n  2394877945,\n  397917763,\n  1622183637,\n  3604390888,\n  2714866558,\n  953729732,\n  1340076626,\n  3518719985,\n  2797360999,\n  1068828381,\n  1219638859,\n  3624741850,\n  2936675148,\n  906185462,\n  1090812512,\n  3747672003,\n  2825379669,\n  829329135,\n  1181335161,\n  3412177804,\n  3160834842,\n  628085408,\n  1382605366,\n  3423369109,\n  3138078467,\n  570562233,\n  1426400815,\n  3317316542,\n  2998733608,\n  733239954,\n  1555261956,\n  3268935591,\n  3050360625,\n  752459403,\n  1541320221,\n  2607071920,\n  3965973030,\n  1969922972,\n  40735498,\n  2617837225,\n  3943577151,\n  1913087877,\n  83908371,\n  2512341634,\n  3803740692,\n  2075208622,\n  213261112,\n  2463272603,\n  3855990285,\n  2094854071,\n  198958881,\n  2262029012,\n  4057260610,\n  1759359992,\n  534414190,\n  2176718541,\n  4139329115,\n  1873836001,\n  414664567,\n  2282248934,\n  4279200368,\n  1711684554,\n  285281116,\n  2405801727,\n  4167216745,\n  1634467795,\n  376229701,\n  2685067896,\n  3608007406,\n  1308918612,\n  956543938,\n  2808555105,\n  3495958263,\n  1231636301,\n  1047427035,\n  2932959818,\n  3654703836,\n  1088359270,\n  936918e3,\n  2847714899,\n  3736837829,\n  1202900863,\n  817233897,\n  3183342108,\n  3401237130,\n  1404277552,\n  615818150,\n  3134207493,\n  3453421203,\n  1423857449,\n  601450431,\n  3009837614,\n  3294710456,\n  1567103746,\n  711928724,\n  3020668471,\n  3272380065,\n  1510334235,\n  755167117\n]);\nfunction ensureBuffer(input) {\n  if (Buffer.isBuffer(input)) {\n    return input;\n  }\n  if (typeof input === \"number\") {\n    return Buffer.alloc(input);\n  } else if (typeof input === \"string\") {\n    return Buffer.from(input);\n  } else {\n    throw new Error(\"input must be buffer, number, or string, received \" + typeof input);\n  }\n}\nfunction bufferizeInt(num) {\n  const tmp = ensureBuffer(4);\n  tmp.writeInt32BE(num, 0);\n  return tmp;\n}\nfunction _crc32(buf, previous) {\n  buf = ensureBuffer(buf);\n  if (Buffer.isBuffer(previous)) {\n    previous = previous.readUInt32BE(0);\n  }\n  let crc = ~~previous ^ -1;\n  for (var n = 0; n < buf.length; n++) {\n    crc = CRC_TABLE[(crc ^ buf[n]) & 255] ^ crc >>> 8;\n  }\n  return crc ^ -1;\n}\nfunction crc32() {\n  return bufferizeInt(_crc32.apply(null, arguments));\n}\ncrc32.signed = function() {\n  return _crc32.apply(null, arguments);\n};\ncrc32.unsigned = function() {\n  return _crc32.apply(null, arguments) >>> 0;\n};\nvar bufferCrc32 = crc32;\n\nconst index = /*@__PURE__*/getDefaultExportFromCjs(bufferCrc32);\n\nmodule.exports = index;\n","var fs = require(\"fs\");\nvar Transform = require(\"stream\").Transform;\nvar PassThrough = require(\"stream\").PassThrough;\nvar zlib = require(\"zlib\");\nvar util = require(\"util\");\nvar EventEmitter = require(\"events\").EventEmitter;\nvar errorMonitor = require(\"events\").errorMonitor;\nvar crc32 = require(\"buffer-crc32\");\n\nexports.ZipFile = ZipFile;\nexports.dateToDosDateTime = dateToDosDateTime;\n\nutil.inherits(ZipFile, EventEmitter);\nfunction ZipFile() {\n  this.outputStream = new PassThrough();\n  this.entries = [];\n  this.outputStreamCursor = 0;\n  this.ended = false; // .end() sets this\n  this.allDone = false; // set when we've written the last bytes\n  this.forceZip64Eocd = false; // configurable in .end()\n  this.errored = false;\n  this.on(errorMonitor, function() {\n    this.errored = true;\n  });\n}\n\nZipFile.prototype.addFile = function(realPath, metadataPath, options) {\n  var self = this;\n  metadataPath = validateMetadataPath(metadataPath, false);\n  if (options == null) options = {};\n\n  if (shouldIgnoreAdding(self)) return;\n  var entry = new Entry(metadataPath, false, options);\n  self.entries.push(entry);\n  fs.stat(realPath, function(err, stats) {\n    if (err) return self.emit(\"error\", err);\n    if (!stats.isFile()) return self.emit(\"error\", new Error(\"not a file: \" + realPath));\n    entry.uncompressedSize = stats.size;\n    if (options.mtime == null) entry.setLastModDate(stats.mtime);\n    if (options.mode == null) entry.setFileAttributesMode(stats.mode);\n    entry.setFileDataPumpFunction(function() {\n      var readStream = fs.createReadStream(realPath);\n      entry.state = Entry.FILE_DATA_IN_PROGRESS;\n      readStream.on(\"error\", function(err) {\n        self.emit(\"error\", err);\n      });\n      pumpFileDataReadStream(self, entry, readStream);\n    });\n    pumpEntries(self);\n  });\n};\n\nZipFile.prototype.addReadStream = function(readStream, metadataPath, options) {\n  this.addReadStreamLazy(metadataPath, options, function(cb) {\n    cb(null, readStream);\n  });\n};\n\nZipFile.prototype.addReadStreamLazy = function(metadataPath, options, getReadStreamFunction) {\n  var self = this;\n  if (typeof options === \"function\") {\n    getReadStreamFunction = options;\n    options = null;\n  }\n  if (options == null) options = {};\n  metadataPath = validateMetadataPath(metadataPath, false);\n\n  if (shouldIgnoreAdding(self)) return;\n  var entry = new Entry(metadataPath, false, options);\n  self.entries.push(entry);\n  entry.setFileDataPumpFunction(function() {\n    entry.state = Entry.FILE_DATA_IN_PROGRESS;\n    getReadStreamFunction(function(err, readStream) {\n      if (err) return self.emit(\"error\", err);\n      pumpFileDataReadStream(self, entry, readStream);\n    });\n  });\n  pumpEntries(self);\n};\n\nZipFile.prototype.addBuffer = function(buffer, metadataPath, options) {\n  var self = this;\n  metadataPath = validateMetadataPath(metadataPath, false);\n  if (buffer.length > 0x3fffffff) throw new Error(\"buffer too large: \" + buffer.length + \" > \" + 0x3fffffff);\n  if (options == null) options = {};\n  if (options.size != null) throw new Error(\"options.size not allowed\");\n\n  if (shouldIgnoreAdding(self)) return;\n  var entry = new Entry(metadataPath, false, options);\n  entry.uncompressedSize = buffer.length;\n  entry.crc32 = crc32.unsigned(buffer);\n  entry.crcAndFileSizeKnown = true;\n  self.entries.push(entry);\n  if (entry.compressionLevel === 0) {\n    setCompressedBuffer(buffer);\n  } else {\n    zlib.deflateRaw(buffer, {level:entry.compressionLevel}, function(err, compressedBuffer) {\n      setCompressedBuffer(compressedBuffer);\n    });\n  }\n  function setCompressedBuffer(compressedBuffer) {\n    entry.compressedSize = compressedBuffer.length;\n    entry.setFileDataPumpFunction(function() {\n      writeToOutputStream(self, compressedBuffer);\n      writeToOutputStream(self, entry.getDataDescriptor());\n      entry.state = Entry.FILE_DATA_DONE;\n\n      // don't call pumpEntries() recursively.\n      // (also, don't call process.nextTick recursively.)\n      setImmediate(function() {\n        pumpEntries(self);\n      });\n    });\n    pumpEntries(self);\n  }\n};\n\nZipFile.prototype.addEmptyDirectory = function(metadataPath, options) {\n  var self = this;\n  metadataPath = validateMetadataPath(metadataPath, true);\n  if (options == null) options = {};\n  if (options.size != null) throw new Error(\"options.size not allowed\");\n  if (options.compress != null) throw new Error(\"options.compress not allowed\");\n  if (options.compressionLevel != null) throw new Error(\"options.compressionLevel not allowed\");\n\n  if (shouldIgnoreAdding(self)) return;\n  var entry = new Entry(metadataPath, true, options);\n  self.entries.push(entry);\n  entry.setFileDataPumpFunction(function() {\n    writeToOutputStream(self, entry.getDataDescriptor());\n    entry.state = Entry.FILE_DATA_DONE;\n    pumpEntries(self);\n  });\n  pumpEntries(self);\n};\n\nvar eocdrSignatureBuffer = bufferFrom([0x50, 0x4b, 0x05, 0x06]);\n\nZipFile.prototype.end = function(options, calculatedTotalSizeCallback) {\n  if (typeof options === \"function\") {\n    calculatedTotalSizeCallback = options;\n    options = null;\n  }\n  if (options == null) options = {};\n  if (this.ended) return;\n  this.ended = true;\n  if (this.errored) return;\n  this.calculatedTotalSizeCallback = calculatedTotalSizeCallback;\n  this.forceZip64Eocd = !!options.forceZip64Format;\n  if (options.comment) {\n    if (typeof options.comment === \"string\") {\n      this.comment = encodeCp437(options.comment);\n    } else {\n      // It should be a Buffer\n      this.comment = options.comment;\n    }\n    if (this.comment.length > 0xffff) throw new Error(\"comment is too large\");\n    // gotta check for this, because the zipfile format is actually ambiguous.\n    if (bufferIncludes(this.comment, eocdrSignatureBuffer)) throw new Error(\"comment contains end of central directory record signature\");\n  } else {\n    // no comment.\n    this.comment = EMPTY_BUFFER;\n  }\n  pumpEntries(this);\n};\n\nfunction writeToOutputStream(self, buffer) {\n  self.outputStream.write(buffer);\n  self.outputStreamCursor += buffer.length;\n}\n\nfunction pumpFileDataReadStream(self, entry, readStream) {\n  var crc32Watcher = new Crc32Watcher();\n  var uncompressedSizeCounter = new ByteCounter();\n  var compressor = entry.compressionLevel !== 0 ? new zlib.DeflateRaw({level:entry.compressionLevel}) : new PassThrough();\n  var compressedSizeCounter = new ByteCounter();\n  readStream.pipe(crc32Watcher)\n            .pipe(uncompressedSizeCounter)\n            .pipe(compressor)\n            .pipe(compressedSizeCounter)\n            .pipe(self.outputStream, {end: false});\n  compressedSizeCounter.on(\"end\", function() {\n    entry.crc32 = crc32Watcher.crc32;\n    if (entry.uncompressedSize == null) {\n      entry.uncompressedSize = uncompressedSizeCounter.byteCount;\n    } else {\n      if (entry.uncompressedSize !== uncompressedSizeCounter.byteCount) return self.emit(\"error\", new Error(\"file data stream has unexpected number of bytes\"));\n    }\n    entry.compressedSize = compressedSizeCounter.byteCount;\n    self.outputStreamCursor += entry.compressedSize;\n    writeToOutputStream(self, entry.getDataDescriptor());\n    entry.state = Entry.FILE_DATA_DONE;\n    pumpEntries(self);\n  });\n}\n\nfunction determineCompressionLevel(options) {\n  if (options.compress != null && options.compressionLevel != null) {\n    if (!!options.compress !== !!options.compressionLevel) throw new Error(\"conflicting settings for compress and compressionLevel\");\n  }\n  if (options.compressionLevel != null) return options.compressionLevel;\n  if (options.compress === false) return 0;\n  return 6;\n}\n\nfunction pumpEntries(self) {\n  if (self.allDone || self.errored) return;\n  // first check if calculatedTotalSize is finally known\n  if (self.ended && self.calculatedTotalSizeCallback != null) {\n    var calculatedTotalSize = calculateTotalSize(self);\n    if (calculatedTotalSize != null) {\n      // we have an answer\n      self.calculatedTotalSizeCallback(calculatedTotalSize);\n      self.calculatedTotalSizeCallback = null;\n    }\n  }\n\n  // pump entries\n  var entry = getFirstNotDoneEntry();\n  function getFirstNotDoneEntry() {\n    for (var i = 0; i < self.entries.length; i++) {\n      var entry = self.entries[i];\n      if (entry.state < Entry.FILE_DATA_DONE) return entry;\n    }\n    return null;\n  }\n  if (entry != null) {\n    // this entry is not done yet\n    if (entry.state < Entry.READY_TO_PUMP_FILE_DATA) return; // input file not open yet\n    if (entry.state === Entry.FILE_DATA_IN_PROGRESS) return; // we'll get there\n    // start with local file header\n    entry.relativeOffsetOfLocalHeader = self.outputStreamCursor;\n    var localFileHeader = entry.getLocalFileHeader();\n    writeToOutputStream(self, localFileHeader);\n    entry.doFileDataPump();\n  } else {\n    // all cought up on writing entries\n    if (self.ended) {\n      // head for the exit\n      self.offsetOfStartOfCentralDirectory = self.outputStreamCursor;\n      self.entries.forEach(function(entry) {\n        var centralDirectoryRecord = entry.getCentralDirectoryRecord();\n        writeToOutputStream(self, centralDirectoryRecord);\n      });\n      writeToOutputStream(self, getEndOfCentralDirectoryRecord(self));\n      self.outputStream.end();\n      self.allDone = true;\n    }\n  }\n}\n\nfunction calculateTotalSize(self) {\n  var pretendOutputCursor = 0;\n  var centralDirectorySize = 0;\n  for (var i = 0; i < self.entries.length; i++) {\n    var entry = self.entries[i];\n    // compression is too hard to predict\n    if (entry.compressionLevel !== 0) return -1;\n    if (entry.state >= Entry.READY_TO_PUMP_FILE_DATA) {\n      // if addReadStream was called without providing the size, we can't predict the total size\n      if (entry.uncompressedSize == null) return -1;\n    } else {\n      // if we're still waiting for fs.stat, we might learn the size someday\n      if (entry.uncompressedSize == null) return null;\n    }\n    // we know this for sure, and this is important to know if we need ZIP64 format.\n    entry.relativeOffsetOfLocalHeader = pretendOutputCursor;\n    var useZip64Format = entry.useZip64Format();\n\n    pretendOutputCursor += LOCAL_FILE_HEADER_FIXED_SIZE + entry.utf8FileName.length;\n    pretendOutputCursor += entry.uncompressedSize;\n    if (!entry.crcAndFileSizeKnown) {\n      // use a data descriptor\n      if (useZip64Format) {\n        pretendOutputCursor += ZIP64_DATA_DESCRIPTOR_SIZE;\n      } else {\n        pretendOutputCursor += DATA_DESCRIPTOR_SIZE;\n      }\n    }\n\n    centralDirectorySize += CENTRAL_DIRECTORY_RECORD_FIXED_SIZE + entry.utf8FileName.length + entry.fileComment.length;\n    if (!entry.forceDosTimestamp) {\n      centralDirectorySize += INFO_ZIP_UNIVERSAL_TIMESTAMP_EXTRA_FIELD_SIZE;\n    }\n    if (useZip64Format) {\n      centralDirectorySize += ZIP64_EXTENDED_INFORMATION_EXTRA_FIELD_SIZE;\n    }\n  }\n\n  var endOfCentralDirectorySize = 0;\n  if (self.forceZip64Eocd ||\n      self.entries.length >= 0xffff ||\n      centralDirectorySize >= 0xffff ||\n      pretendOutputCursor >= 0xffffffff) {\n    // use zip64 end of central directory stuff\n    endOfCentralDirectorySize += ZIP64_END_OF_CENTRAL_DIRECTORY_RECORD_SIZE + ZIP64_END_OF_CENTRAL_DIRECTORY_LOCATOR_SIZE;\n  }\n  endOfCentralDirectorySize += END_OF_CENTRAL_DIRECTORY_RECORD_SIZE + self.comment.length;\n  return pretendOutputCursor + centralDirectorySize + endOfCentralDirectorySize;\n}\n\nfunction shouldIgnoreAdding(self) {\n  if (self.ended) throw new Error(\"cannot add entries after calling end()\");\n  if (self.errored) return true;\n  return false;\n}\n\nvar ZIP64_END_OF_CENTRAL_DIRECTORY_RECORD_SIZE = 56;\nvar ZIP64_END_OF_CENTRAL_DIRECTORY_LOCATOR_SIZE = 20;\nvar END_OF_CENTRAL_DIRECTORY_RECORD_SIZE = 22;\nfunction getEndOfCentralDirectoryRecord(self, actuallyJustTellMeHowLongItWouldBe) {\n  var needZip64Format = false;\n  var normalEntriesLength = self.entries.length;\n  if (self.forceZip64Eocd || self.entries.length >= 0xffff) {\n    normalEntriesLength = 0xffff;\n    needZip64Format = true;\n  }\n  var sizeOfCentralDirectory = self.outputStreamCursor - self.offsetOfStartOfCentralDirectory;\n  var normalSizeOfCentralDirectory = sizeOfCentralDirectory;\n  if (self.forceZip64Eocd || sizeOfCentralDirectory >= 0xffffffff) {\n    normalSizeOfCentralDirectory = 0xffffffff;\n    needZip64Format = true;\n  }\n  var normalOffsetOfStartOfCentralDirectory = self.offsetOfStartOfCentralDirectory;\n  if (self.forceZip64Eocd || self.offsetOfStartOfCentralDirectory >= 0xffffffff) {\n    normalOffsetOfStartOfCentralDirectory = 0xffffffff;\n    needZip64Format = true;\n  }\n  if (actuallyJustTellMeHowLongItWouldBe) {\n    if (needZip64Format) {\n      return (\n        ZIP64_END_OF_CENTRAL_DIRECTORY_RECORD_SIZE +\n        ZIP64_END_OF_CENTRAL_DIRECTORY_LOCATOR_SIZE +\n        END_OF_CENTRAL_DIRECTORY_RECORD_SIZE\n      );\n    } else {\n      return END_OF_CENTRAL_DIRECTORY_RECORD_SIZE;\n    }\n  }\n\n  var eocdrBuffer = bufferAlloc(END_OF_CENTRAL_DIRECTORY_RECORD_SIZE + self.comment.length);\n  // end of central dir signature                       4 bytes  (0x06054b50)\n  eocdrBuffer.writeUInt32LE(0x06054b50, 0);\n  // number of this disk                                2 bytes\n  eocdrBuffer.writeUInt16LE(0, 4);\n  // number of the disk with the start of the central directory  2 bytes\n  eocdrBuffer.writeUInt16LE(0, 6);\n  // total number of entries in the central directory on this disk  2 bytes\n  eocdrBuffer.writeUInt16LE(normalEntriesLength, 8);\n  // total number of entries in the central directory   2 bytes\n  eocdrBuffer.writeUInt16LE(normalEntriesLength, 10);\n  // size of the central directory                      4 bytes\n  eocdrBuffer.writeUInt32LE(normalSizeOfCentralDirectory, 12);\n  // offset of start of central directory with respect to the starting disk number  4 bytes\n  eocdrBuffer.writeUInt32LE(normalOffsetOfStartOfCentralDirectory, 16);\n  // .ZIP file comment length                           2 bytes\n  eocdrBuffer.writeUInt16LE(self.comment.length, 20);\n  // .ZIP file comment                                  (variable size)\n  self.comment.copy(eocdrBuffer, 22);\n\n  if (!needZip64Format) return eocdrBuffer;\n\n  // ZIP64 format\n  // ZIP64 End of Central Directory Record\n  var zip64EocdrBuffer = bufferAlloc(ZIP64_END_OF_CENTRAL_DIRECTORY_RECORD_SIZE);\n  // zip64 end of central dir signature                                             4 bytes  (0x06064b50)\n  zip64EocdrBuffer.writeUInt32LE(0x06064b50, 0);\n  // size of zip64 end of central directory record                                  8 bytes\n  writeUInt64LE(zip64EocdrBuffer, ZIP64_END_OF_CENTRAL_DIRECTORY_RECORD_SIZE - 12, 4);\n  // version made by                                                                2 bytes\n  zip64EocdrBuffer.writeUInt16LE(VERSION_MADE_BY, 12);\n  // version needed to extract                                                      2 bytes\n  zip64EocdrBuffer.writeUInt16LE(VERSION_NEEDED_TO_EXTRACT_ZIP64, 14);\n  // number of this disk                                                            4 bytes\n  zip64EocdrBuffer.writeUInt32LE(0, 16);\n  // number of the disk with the start of the central directory                     4 bytes\n  zip64EocdrBuffer.writeUInt32LE(0, 20);\n  // total number of entries in the central directory on this disk                  8 bytes\n  writeUInt64LE(zip64EocdrBuffer, self.entries.length, 24);\n  // total number of entries in the central directory                               8 bytes\n  writeUInt64LE(zip64EocdrBuffer, self.entries.length, 32);\n  // size of the central directory                                                  8 bytes\n  writeUInt64LE(zip64EocdrBuffer, sizeOfCentralDirectory, 40);\n  // offset of start of central directory with respect to the starting disk number  8 bytes\n  writeUInt64LE(zip64EocdrBuffer, self.offsetOfStartOfCentralDirectory, 48);\n  // zip64 extensible data sector                                                   (variable size)\n  // nothing in the zip64 extensible data sector\n\n\n  // ZIP64 End of Central Directory Locator\n  var zip64EocdlBuffer = bufferAlloc(ZIP64_END_OF_CENTRAL_DIRECTORY_LOCATOR_SIZE);\n  // zip64 end of central dir locator signature                               4 bytes  (0x07064b50)\n  zip64EocdlBuffer.writeUInt32LE(0x07064b50, 0);\n  // number of the disk with the start of the zip64 end of central directory  4 bytes\n  zip64EocdlBuffer.writeUInt32LE(0, 4);\n  // relative offset of the zip64 end of central directory record             8 bytes\n  writeUInt64LE(zip64EocdlBuffer, self.outputStreamCursor, 8);\n  // total number of disks                                                    4 bytes\n  zip64EocdlBuffer.writeUInt32LE(1, 16);\n\n\n  return Buffer.concat([\n    zip64EocdrBuffer,\n    zip64EocdlBuffer,\n    eocdrBuffer,\n  ]);\n}\n\nfunction validateMetadataPath(metadataPath, isDirectory) {\n  if (metadataPath === \"\") throw new Error(\"empty metadataPath\");\n  metadataPath = metadataPath.replace(/\\\\/g, \"/\");\n  if (/^[a-zA-Z]:/.test(metadataPath) || /^\\//.test(metadataPath)) throw new Error(\"absolute path: \" + metadataPath);\n  if (metadataPath.split(\"/\").indexOf(\"..\") !== -1) throw new Error(\"invalid relative path: \" + metadataPath);\n  var looksLikeDirectory = /\\/$/.test(metadataPath);\n  if (isDirectory) {\n    // append a trailing '/' if necessary.\n    if (!looksLikeDirectory) metadataPath += \"/\";\n  } else {\n    if (looksLikeDirectory) throw new Error(\"file path cannot end with '/': \" + metadataPath);\n  }\n  return metadataPath;\n}\n\nvar EMPTY_BUFFER = bufferAlloc(0);\n\n// this class is not part of the public API\nfunction Entry(metadataPath, isDirectory, options) {\n  this.utf8FileName = bufferFrom(metadataPath);\n  if (this.utf8FileName.length > 0xffff) throw new Error(\"utf8 file name too long. \" + utf8FileName.length + \" > \" + 0xffff);\n  this.isDirectory = isDirectory;\n  this.state = Entry.WAITING_FOR_METADATA;\n  this.setLastModDate(options.mtime != null ? options.mtime : new Date());\n  this.forceDosTimestamp = !!options.forceDosTimestamp;\n  if (options.mode != null) {\n    this.setFileAttributesMode(options.mode);\n  } else {\n    this.setFileAttributesMode(isDirectory ? 0o40775 : 0o100664);\n  }\n  if (isDirectory) {\n    this.crcAndFileSizeKnown = true;\n    this.crc32 = 0;\n    this.uncompressedSize = 0;\n    this.compressedSize = 0;\n  } else {\n    // unknown so far\n    this.crcAndFileSizeKnown = false;\n    this.crc32 = null;\n    this.uncompressedSize = null;\n    this.compressedSize = null;\n    if (options.size != null) this.uncompressedSize = options.size;\n  }\n  if (isDirectory) {\n    this.compressionLevel = 0;\n  } else {\n    this.compressionLevel = determineCompressionLevel(options);\n  }\n  this.forceZip64Format = !!options.forceZip64Format;\n  if (options.fileComment) {\n    if (typeof options.fileComment === \"string\") {\n      this.fileComment = bufferFrom(options.fileComment, \"utf-8\");\n    } else {\n      // It should be a Buffer\n      this.fileComment = options.fileComment;\n    }\n    if (this.fileComment.length > 0xffff) throw new Error(\"fileComment is too large\");\n  } else {\n    // no comment.\n    this.fileComment = EMPTY_BUFFER;\n  }\n}\nEntry.WAITING_FOR_METADATA = 0;\nEntry.READY_TO_PUMP_FILE_DATA = 1;\nEntry.FILE_DATA_IN_PROGRESS = 2;\nEntry.FILE_DATA_DONE = 3;\nEntry.prototype.setLastModDate = function(date) {\n  this.mtime = date;\n  var dosDateTime = dateToDosDateTime(date);\n  this.lastModFileTime = dosDateTime.time;\n  this.lastModFileDate = dosDateTime.date;\n};\nEntry.prototype.setFileAttributesMode = function(mode) {\n  if ((mode & 0xffff) !== mode) throw new Error(\"invalid mode. expected: 0 <= \" + mode + \" <= \" + 0xffff);\n  // http://unix.stackexchange.com/questions/14705/the-zip-formats-external-file-attribute/14727#14727\n  this.externalFileAttributes = (mode << 16) >>> 0;\n};\n// doFileDataPump() should not call pumpEntries() directly. see issue #9.\nEntry.prototype.setFileDataPumpFunction = function(doFileDataPump) {\n  this.doFileDataPump = doFileDataPump;\n  this.state = Entry.READY_TO_PUMP_FILE_DATA;\n};\nEntry.prototype.useZip64Format = function() {\n  return (\n    (this.forceZip64Format) ||\n    (this.uncompressedSize != null && this.uncompressedSize > 0xfffffffe) ||\n    (this.compressedSize != null && this.compressedSize > 0xfffffffe) ||\n    (this.relativeOffsetOfLocalHeader != null && this.relativeOffsetOfLocalHeader > 0xfffffffe)\n  );\n}\nvar LOCAL_FILE_HEADER_FIXED_SIZE = 30;\nvar VERSION_NEEDED_TO_EXTRACT_UTF8 = 20;\nvar VERSION_NEEDED_TO_EXTRACT_ZIP64 = 45;\n// 3 = unix. 63 = spec version 6.3\nvar VERSION_MADE_BY = (3 << 8) | 63;\nvar FILE_NAME_IS_UTF8 = 1 << 11;\nvar UNKNOWN_CRC32_AND_FILE_SIZES = 1 << 3;\nEntry.prototype.getLocalFileHeader = function() {\n  var crc32 = 0;\n  var compressedSize = 0;\n  var uncompressedSize = 0;\n  if (this.crcAndFileSizeKnown) {\n    crc32 = this.crc32;\n    compressedSize = this.compressedSize;\n    uncompressedSize = this.uncompressedSize;\n  }\n\n  var fixedSizeStuff = bufferAlloc(LOCAL_FILE_HEADER_FIXED_SIZE);\n  var generalPurposeBitFlag = FILE_NAME_IS_UTF8;\n  if (!this.crcAndFileSizeKnown) generalPurposeBitFlag |= UNKNOWN_CRC32_AND_FILE_SIZES;\n\n  // local file header signature     4 bytes  (0x04034b50)\n  fixedSizeStuff.writeUInt32LE(0x04034b50, 0);\n  // version needed to extract       2 bytes\n  fixedSizeStuff.writeUInt16LE(VERSION_NEEDED_TO_EXTRACT_UTF8, 4);\n  // general purpose bit flag        2 bytes\n  fixedSizeStuff.writeUInt16LE(generalPurposeBitFlag, 6);\n  // compression method              2 bytes\n  fixedSizeStuff.writeUInt16LE(this.getCompressionMethod(), 8);\n  // last mod file time              2 bytes\n  fixedSizeStuff.writeUInt16LE(this.lastModFileTime, 10);\n  // last mod file date              2 bytes\n  fixedSizeStuff.writeUInt16LE(this.lastModFileDate, 12);\n  // crc-32                          4 bytes\n  fixedSizeStuff.writeUInt32LE(crc32, 14);\n  // compressed size                 4 bytes\n  fixedSizeStuff.writeUInt32LE(compressedSize, 18);\n  // uncompressed size               4 bytes\n  fixedSizeStuff.writeUInt32LE(uncompressedSize, 22);\n  // file name length                2 bytes\n  fixedSizeStuff.writeUInt16LE(this.utf8FileName.length, 26);\n  // extra field length              2 bytes\n  fixedSizeStuff.writeUInt16LE(0, 28);\n  return Buffer.concat([\n    fixedSizeStuff,\n    // file name (variable size)\n    this.utf8FileName,\n    // extra field (variable size)\n    // no extra fields\n  ]);\n};\nvar DATA_DESCRIPTOR_SIZE = 16;\nvar ZIP64_DATA_DESCRIPTOR_SIZE = 24;\nEntry.prototype.getDataDescriptor = function() {\n  if (this.crcAndFileSizeKnown) {\n    // the Mac Archive Utility requires this not be present unless we set general purpose bit 3\n    return EMPTY_BUFFER;\n  }\n  if (!this.useZip64Format()) {\n    var buffer = bufferAlloc(DATA_DESCRIPTOR_SIZE);\n    // optional signature (required according to Archive Utility)\n    buffer.writeUInt32LE(0x08074b50, 0);\n    // crc-32                          4 bytes\n    buffer.writeUInt32LE(this.crc32, 4);\n    // compressed size                 4 bytes\n    buffer.writeUInt32LE(this.compressedSize, 8);\n    // uncompressed size               4 bytes\n    buffer.writeUInt32LE(this.uncompressedSize, 12);\n    return buffer;\n  } else {\n    // ZIP64 format\n    var buffer = bufferAlloc(ZIP64_DATA_DESCRIPTOR_SIZE);\n    // optional signature (unknown if anyone cares about this)\n    buffer.writeUInt32LE(0x08074b50, 0);\n    // crc-32                          4 bytes\n    buffer.writeUInt32LE(this.crc32, 4);\n    // compressed size                 8 bytes\n    writeUInt64LE(buffer, this.compressedSize, 8);\n    // uncompressed size               8 bytes\n    writeUInt64LE(buffer, this.uncompressedSize, 16);\n    return buffer;\n  }\n};\nvar CENTRAL_DIRECTORY_RECORD_FIXED_SIZE = 46;\nvar INFO_ZIP_UNIVERSAL_TIMESTAMP_EXTRA_FIELD_SIZE = 9;\nvar ZIP64_EXTENDED_INFORMATION_EXTRA_FIELD_SIZE = 28;\nEntry.prototype.getCentralDirectoryRecord = function() {\n  var fixedSizeStuff = bufferAlloc(CENTRAL_DIRECTORY_RECORD_FIXED_SIZE);\n  var generalPurposeBitFlag = FILE_NAME_IS_UTF8;\n  if (!this.crcAndFileSizeKnown) generalPurposeBitFlag |= UNKNOWN_CRC32_AND_FILE_SIZES;\n\n  var izutefBuffer = EMPTY_BUFFER;\n  if (!this.forceDosTimestamp) {\n    // Here is one specification for this: https://commons.apache.org/proper/commons-compress/apidocs/org/apache/commons/compress/archivers/zip/X5455_ExtendedTimestamp.html\n    // See also the Info-ZIP source code unix/unix.c:set_extra_field() and zipfile.c:ef_scan_ut_time().\n    izutefBuffer = bufferAlloc(INFO_ZIP_UNIVERSAL_TIMESTAMP_EXTRA_FIELD_SIZE);\n    // 0x5455        Short       tag for this extra block type (\"UT\")\n    izutefBuffer.writeUInt16LE(0x5455, 0);\n    // TSize         Short       total data size for this block\n    izutefBuffer.writeUInt16LE(INFO_ZIP_UNIVERSAL_TIMESTAMP_EXTRA_FIELD_SIZE - 4, 2);\n    // See Info-ZIP source code zip.h for these constant values:\n    var EB_UT_FL_MTIME = (1 << 0);\n    var EB_UT_FL_ATIME = (1 << 1);\n    // Note that we set the atime flag despite not providing the atime field.\n    // The central directory version of this extra field is specified to never contain the atime field even when the flag is set.\n    // We set it to match the Info-ZIP behavior in order to minimize incompatibility with zip file readers that may have rigid input expectations.\n    // Flags         Byte        info bits\n    izutefBuffer.writeUInt8(EB_UT_FL_MTIME | EB_UT_FL_ATIME, 4);\n    // (ModTime)     Long        time of last modification (UTC/GMT)\n    var timestamp = Math.floor(this.mtime.getTime() / 1000);\n    if (timestamp < -0x80000000) timestamp = -0x80000000; // 1901-12-13T20:45:52.000Z\n    if (timestamp >  0x7fffffff) timestamp =  0x7fffffff; // 2038-01-19T03:14:07.000Z\n    izutefBuffer.writeUInt32LE(timestamp, 5);\n  }\n\n  var normalCompressedSize = this.compressedSize;\n  var normalUncompressedSize = this.uncompressedSize;\n  var normalRelativeOffsetOfLocalHeader = this.relativeOffsetOfLocalHeader;\n  var versionNeededToExtract = VERSION_NEEDED_TO_EXTRACT_UTF8;\n  var zeiefBuffer = EMPTY_BUFFER;\n  if (this.useZip64Format()) {\n    normalCompressedSize = 0xffffffff;\n    normalUncompressedSize = 0xffffffff;\n    normalRelativeOffsetOfLocalHeader = 0xffffffff;\n    versionNeededToExtract = VERSION_NEEDED_TO_EXTRACT_ZIP64;\n\n    // ZIP64 extended information extra field\n    zeiefBuffer = bufferAlloc(ZIP64_EXTENDED_INFORMATION_EXTRA_FIELD_SIZE);\n    // 0x0001                  2 bytes    Tag for this \"extra\" block type\n    zeiefBuffer.writeUInt16LE(0x0001, 0);\n    // Size                    2 bytes    Size of this \"extra\" block\n    zeiefBuffer.writeUInt16LE(ZIP64_EXTENDED_INFORMATION_EXTRA_FIELD_SIZE - 4, 2);\n    // Original Size           8 bytes    Original uncompressed file size\n    writeUInt64LE(zeiefBuffer, this.uncompressedSize, 4);\n    // Compressed Size         8 bytes    Size of compressed data\n    writeUInt64LE(zeiefBuffer, this.compressedSize, 12);\n    // Relative Header Offset  8 bytes    Offset of local header record\n    writeUInt64LE(zeiefBuffer, this.relativeOffsetOfLocalHeader, 20);\n    // Disk Start Number       4 bytes    Number of the disk on which this file starts\n    // (omit)\n  }\n\n  // central file header signature   4 bytes  (0x02014b50)\n  fixedSizeStuff.writeUInt32LE(0x02014b50, 0);\n  // version made by                 2 bytes\n  fixedSizeStuff.writeUInt16LE(VERSION_MADE_BY, 4);\n  // version needed to extract       2 bytes\n  fixedSizeStuff.writeUInt16LE(versionNeededToExtract, 6);\n  // general purpose bit flag        2 bytes\n  fixedSizeStuff.writeUInt16LE(generalPurposeBitFlag, 8);\n  // compression method              2 bytes\n  fixedSizeStuff.writeUInt16LE(this.getCompressionMethod(), 10);\n  // last mod file time              2 bytes\n  fixedSizeStuff.writeUInt16LE(this.lastModFileTime, 12);\n  // last mod file date              2 bytes\n  fixedSizeStuff.writeUInt16LE(this.lastModFileDate, 14);\n  // crc-32                          4 bytes\n  fixedSizeStuff.writeUInt32LE(this.crc32, 16);\n  // compressed size                 4 bytes\n  fixedSizeStuff.writeUInt32LE(normalCompressedSize, 20);\n  // uncompressed size               4 bytes\n  fixedSizeStuff.writeUInt32LE(normalUncompressedSize, 24);\n  // file name length                2 bytes\n  fixedSizeStuff.writeUInt16LE(this.utf8FileName.length, 28);\n  // extra field length              2 bytes\n  fixedSizeStuff.writeUInt16LE(izutefBuffer.length + zeiefBuffer.length, 30);\n  // file comment length             2 bytes\n  fixedSizeStuff.writeUInt16LE(this.fileComment.length, 32);\n  // disk number start               2 bytes\n  fixedSizeStuff.writeUInt16LE(0, 34);\n  // internal file attributes        2 bytes\n  fixedSizeStuff.writeUInt16LE(0, 36);\n  // external file attributes        4 bytes\n  fixedSizeStuff.writeUInt32LE(this.externalFileAttributes, 38);\n  // relative offset of local header 4 bytes\n  fixedSizeStuff.writeUInt32LE(normalRelativeOffsetOfLocalHeader, 42);\n\n  return Buffer.concat([\n    fixedSizeStuff,\n    // file name (variable size)\n    this.utf8FileName,\n    // extra field (variable size)\n    izutefBuffer,\n    zeiefBuffer,\n    // file comment (variable size)\n    this.fileComment,\n  ]);\n};\nEntry.prototype.getCompressionMethod = function() {\n  var NO_COMPRESSION = 0;\n  var DEFLATE_COMPRESSION = 8;\n  return this.compressionLevel === 0 ? NO_COMPRESSION : DEFLATE_COMPRESSION;\n};\n\n// These are intentionally computed in the current system timezone\n// to match how the DOS encoding operates in this library.\nvar minDosDate = new Date(1980, 0, 1);\nvar maxDosDate = new Date(2107, 11, 31, 23, 59, 58);\nfunction dateToDosDateTime(jsDate) {\n  // Clamp out of bounds timestamps.\n  if (jsDate < minDosDate) jsDate = minDosDate;\n  else if (jsDate > maxDosDate) jsDate = maxDosDate;\n\n  var date = 0;\n  date |= jsDate.getDate() & 0x1f; // 1-31\n  date |= ((jsDate.getMonth() + 1) & 0xf) << 5; // 0-11, 1-12\n  date |= ((jsDate.getFullYear() - 1980) & 0x7f) << 9; // 0-128, 1980-2108\n\n  var time = 0;\n  time |= Math.floor(jsDate.getSeconds() / 2); // 0-59, 0-29 (lose odd numbers)\n  time |= (jsDate.getMinutes() & 0x3f) << 5; // 0-59\n  time |= (jsDate.getHours() & 0x1f) << 11; // 0-23\n\n  return {date: date, time: time};\n}\n\nfunction writeUInt64LE(buffer, n, offset) {\n  // can't use bitshift here, because JavaScript only allows bitshifting on 32-bit integers.\n  var high = Math.floor(n / 0x100000000);\n  var low = n % 0x100000000;\n  buffer.writeUInt32LE(low, offset);\n  buffer.writeUInt32LE(high, offset + 4);\n}\n\nfunction defaultCallback(err) {\n  if (err) throw err;\n}\n\nutil.inherits(ByteCounter, Transform);\nfunction ByteCounter(options) {\n  Transform.call(this, options);\n  this.byteCount = 0;\n}\nByteCounter.prototype._transform = function(chunk, encoding, cb) {\n  this.byteCount += chunk.length;\n  cb(null, chunk);\n};\n\nutil.inherits(Crc32Watcher, Transform);\nfunction Crc32Watcher(options) {\n  Transform.call(this, options);\n  this.crc32 = 0;\n}\nCrc32Watcher.prototype._transform = function(chunk, encoding, cb) {\n  this.crc32 = crc32.unsigned(chunk, this.crc32);\n  cb(null, chunk);\n};\n\nvar cp437 = '\\u0000☺☻♥♦♣♠•◘○◙♂♀♪♫☼►◄↕‼¶§▬↨↑↓→←∟↔▲▼ !\"#$%&\\'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_`abcdefghijklmnopqrstuvwxyz{|}~⌂ÇüéâäàåçêëèïîìÄÅÉæÆôöòûùÿÖÜ¢£¥₧ƒáíóúñÑªº¿⌐¬½¼¡«»░▒▓│┤╡╢╖╕╣║╗╝╜╛┐└┴┬├─┼╞╟╚╔╩╦╠═╬╧╨╤╥╙╘╒╓╫╪┘┌█▄▌▐▀αßΓπΣσµτΦΘΩδ∞φε∩≡±≥≤⌠⌡÷≈°∙·√ⁿ²■ ';\nif (cp437.length !== 256) throw new Error(\"assertion failure\");\nvar reverseCp437 = null;\n\nfunction encodeCp437(string) {\n  if (/^[\\x20-\\x7e]*$/.test(string)) {\n    // CP437, ASCII, and UTF-8 overlap in this range.\n    return bufferFrom(string, \"utf-8\");\n  }\n\n  // This is the slow path.\n  if (reverseCp437 == null) {\n    // cache this once\n    reverseCp437 = {};\n    for (var i = 0; i < cp437.length; i++) {\n      reverseCp437[cp437[i]] = i;\n    }\n  }\n\n  var result = bufferAlloc(string.length);\n  for (var i = 0; i < string.length; i++) {\n    var b = reverseCp437[string[i]];\n    if (b == null) throw new Error(\"character not encodable in CP437: \" + JSON.stringify(string[i]));\n    result[i] = b;\n  }\n\n  return result;\n}\n\nfunction bufferAlloc(size) {\n  bufferAlloc = modern;\n  try {\n    return bufferAlloc(size);\n  } catch (e) {\n    bufferAlloc = legacy;\n    return bufferAlloc(size);\n  }\n  function modern(size) {\n    return Buffer.allocUnsafe(size);\n  }\n  function legacy(size) {\n    return new Buffer(size);\n  }\n}\nfunction bufferFrom(something, encoding) {\n  bufferFrom = modern;\n  try {\n    return bufferFrom(something, encoding);\n  } catch (e) {\n    bufferFrom = legacy;\n    return bufferFrom(something, encoding);\n  }\n  function modern(something, encoding) {\n    return Buffer.from(something, encoding);\n  }\n  function legacy(something, encoding) {\n    return new Buffer(something, encoding);\n  }\n}\nfunction bufferIncludes(buffer, content) {\n  bufferIncludes = modern;\n  try {\n    return bufferIncludes(buffer, content);\n  } catch (e) {\n    bufferIncludes = legacy;\n    return bufferIncludes(buffer, content);\n  }\n  function modern(buffer, content) {\n    return buffer.includes(content);\n  }\n  function legacy(buffer, content) {\n    for (var i = 0; i <= buffer.length - content.length; i++) {\n      for (var j = 0;; j++) {\n        if (j === content.length) return true;\n        if (buffer[i + j] !== content[j]) break;\n      }\n    }\n    return false;\n  }\n}\n","import { AppRouteRouteModule } from \"next/dist/esm/server/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/esm/server/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/esm/server/lib/patch-fetch\";\nimport { addRequestMeta, getRequestMeta } from \"next/dist/esm/server/request-meta\";\nimport { getTracer, SpanKind } from \"next/dist/esm/server/lib/trace/tracer\";\nimport { setManifestsSingleton } from \"next/dist/esm/server/app-render/manifests-singleton\";\nimport { normalizeAppPath } from \"next/dist/esm/shared/lib/router/utils/app-paths\";\nimport { NodeNextRequest, NodeNextResponse } from \"next/dist/esm/server/base-http/node\";\nimport { NextRequestAdapter, signalFromNodeResponse } from \"next/dist/esm/server/web/spec-extension/adapters/next-request\";\nimport { BaseServerSpan } from \"next/dist/esm/server/lib/trace/constants\";\nimport { getRevalidateReason } from \"next/dist/esm/server/instrumentation/utils\";\nimport { sendResponse } from \"next/dist/esm/server/send-response\";\nimport { fromNodeOutgoingHttpHeaders, toNodeOutgoingHttpHeaders } from \"next/dist/esm/server/web/utils\";\nimport { getCacheControlHeader } from \"next/dist/esm/server/lib/cache-control\";\nimport { INFINITE_CACHE, NEXT_CACHE_TAGS_HEADER } from \"next/dist/esm/lib/constants\";\nimport { NoFallbackError } from \"next/dist/esm/shared/lib/no-fallback-error.external\";\nimport { CachedRouteKind } from \"next/dist/esm/server/response-cache\";\nimport * as userland from \"INNER_APP_ROUTE\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/trades/[id]/proof-pack/route\",\n        pathname: \"/api/trades/[id]/proof-pack\",\n        filename: \"route\",\n        bundlePath: \"\"\n    },\n    distDir: process.env.__NEXT_RELATIVE_DIST_DIR || '',\n    relativeProjectDir: process.env.__NEXT_RELATIVE_PROJECT_DIR || '',\n    resolvedPagePath: \"[project]/src/app/api/trades/[id]/proof-pack/route.ts\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return _patchFetch({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\nexport { routeModule, workAsyncStorage, workUnitAsyncStorage, serverHooks, patchFetch,  };\nexport async function handler(req, res, ctx) {\n    if (routeModule.isDev) {\n        addRequestMeta(req, 'devRequestTimingInternalsEnd', process.hrtime.bigint());\n    }\n    let srcPage = \"/api/trades/[id]/proof-pack/route\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (process.env.TURBOPACK) {\n        srcPage = srcPage.replace(/\\/index$/, '') || '/';\n    } else if (srcPage === '/index') {\n        // we always normalize /index specifically\n        srcPage = '/';\n    }\n    const multiZoneDraftMode = process.env.__NEXT_MULTI_ZONE_DRAFT_MODE;\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage,\n        multiZoneDraftMode\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return null;\n    }\n    const { buildId, params, nextConfig, parsedUrl, isDraftMode, prerenderManifest, routerServerContext, isOnDemandRevalidate, revalidateOnlyGenerated, resolvedPathname, clientReferenceManifest, serverActionsManifest } = prepareResult;\n    const normalizedSrcPage = normalizeAppPath(srcPage);\n    let isIsr = Boolean(prerenderManifest.dynamicRoutes[normalizedSrcPage] || prerenderManifest.routes[resolvedPathname]);\n    const render404 = async ()=>{\n        // TODO: should route-module itself handle rendering the 404\n        if (routerServerContext == null ? void 0 : routerServerContext.render404) {\n            await routerServerContext.render404(req, res, parsedUrl, false);\n        } else {\n            res.end('This page could not be found');\n        }\n        return null;\n    };\n    if (isIsr && !isDraftMode) {\n        const isPrerendered = Boolean(prerenderManifest.routes[resolvedPathname]);\n        const prerenderInfo = prerenderManifest.dynamicRoutes[normalizedSrcPage];\n        if (prerenderInfo) {\n            if (prerenderInfo.fallback === false && !isPrerendered) {\n                if (nextConfig.experimental.adapterPath) {\n                    return await render404();\n                }\n                throw new NoFallbackError();\n            }\n        }\n    }\n    let cacheKey = null;\n    if (isIsr && !routeModule.isDev && !isDraftMode) {\n        cacheKey = resolvedPathname;\n        // ensure /index and / is normalized to one key\n        cacheKey = cacheKey === '/index' ? '/' : cacheKey;\n    }\n    const supportsDynamicResponse = // If we're in development, we always support dynamic HTML\n    routeModule.isDev === true || // If this is not SSG or does not have static paths, then it supports\n    // dynamic HTML.\n    !isIsr;\n    // This is a revalidation request if the request is for a static\n    // page and it is not being resumed from a postponed render and\n    // it is not a dynamic RSC request then it is a revalidation\n    // request.\n    const isStaticGeneration = isIsr && !supportsDynamicResponse;\n    // Before rendering (which initializes component tree modules), we have to\n    // set the reference manifests to our global store so Server Action's\n    // encryption util can access to them at the top level of the page module.\n    if (serverActionsManifest && clientReferenceManifest) {\n        setManifestsSingleton({\n            page: srcPage,\n            clientReferenceManifest,\n            serverActionsManifest\n        });\n    }\n    const method = req.method || 'GET';\n    const tracer = getTracer();\n    const activeSpan = tracer.getActiveScopeSpan();\n    const context = {\n        params,\n        prerenderManifest,\n        renderOpts: {\n            experimental: {\n                authInterrupts: Boolean(nextConfig.experimental.authInterrupts)\n            },\n            cacheComponents: Boolean(nextConfig.cacheComponents),\n            supportsDynamicResponse,\n            incrementalCache: getRequestMeta(req, 'incrementalCache'),\n            cacheLifeProfiles: nextConfig.cacheLife,\n            waitUntil: ctx.waitUntil,\n            onClose: (cb)=>{\n                res.on('close', cb);\n            },\n            onAfterTaskError: undefined,\n            onInstrumentationRequestError: (error, _request, errorContext, silenceLog)=>routeModule.onRequestError(req, error, errorContext, silenceLog, routerServerContext)\n        },\n        sharedContext: {\n            buildId\n        }\n    };\n    const nodeNextReq = new NodeNextRequest(req);\n    const nodeNextRes = new NodeNextResponse(res);\n    const nextReq = NextRequestAdapter.fromNodeNextRequest(nodeNextReq, signalFromNodeResponse(res));\n    try {\n        const invokeRouteModule = async (span)=>{\n            return routeModule.handle(nextReq, context).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${srcPage}`);\n                }\n            });\n        };\n        const isMinimalMode = Boolean(process.env.MINIMAL_MODE || getRequestMeta(req, 'minimalMode'));\n        const handleResponse = async (currentSpan)=>{\n            var _cacheEntry_value;\n            const responseGenerator = async ({ previousCacheEntry })=>{\n                try {\n                    if (!isMinimalMode && isOnDemandRevalidate && revalidateOnlyGenerated && !previousCacheEntry) {\n                        res.statusCode = 404;\n                        // on-demand revalidate always sets this header\n                        res.setHeader('x-nextjs-cache', 'REVALIDATED');\n                        res.end('This page could not be found');\n                        return null;\n                    }\n                    const response = await invokeRouteModule(currentSpan);\n                    req.fetchMetrics = context.renderOpts.fetchMetrics;\n                    let pendingWaitUntil = context.renderOpts.pendingWaitUntil;\n                    // Attempt using provided waitUntil if available\n                    // if it's not we fallback to sendResponse's handling\n                    if (pendingWaitUntil) {\n                        if (ctx.waitUntil) {\n                            ctx.waitUntil(pendingWaitUntil);\n                            pendingWaitUntil = undefined;\n                        }\n                    }\n                    const cacheTags = context.renderOpts.collectedTags;\n                    // If the request is for a static response, we can cache it so long\n                    // as it's not edge.\n                    if (isIsr) {\n                        const blob = await response.blob();\n                        // Copy the headers from the response.\n                        const headers = toNodeOutgoingHttpHeaders(response.headers);\n                        if (cacheTags) {\n                            headers[NEXT_CACHE_TAGS_HEADER] = cacheTags;\n                        }\n                        if (!headers['content-type'] && blob.type) {\n                            headers['content-type'] = blob.type;\n                        }\n                        const revalidate = typeof context.renderOpts.collectedRevalidate === 'undefined' || context.renderOpts.collectedRevalidate >= INFINITE_CACHE ? false : context.renderOpts.collectedRevalidate;\n                        const expire = typeof context.renderOpts.collectedExpire === 'undefined' || context.renderOpts.collectedExpire >= INFINITE_CACHE ? undefined : context.renderOpts.collectedExpire;\n                        // Create the cache entry for the response.\n                        const cacheEntry = {\n                            value: {\n                                kind: CachedRouteKind.APP_ROUTE,\n                                status: response.status,\n                                body: Buffer.from(await blob.arrayBuffer()),\n                                headers\n                            },\n                            cacheControl: {\n                                revalidate,\n                                expire\n                            }\n                        };\n                        return cacheEntry;\n                    } else {\n                        // send response without caching if not ISR\n                        await sendResponse(nodeNextReq, nodeNextRes, response, context.renderOpts.pendingWaitUntil);\n                        return null;\n                    }\n                } catch (err) {\n                    // if this is a background revalidate we need to report\n                    // the request error here as it won't be bubbled\n                    if (previousCacheEntry == null ? void 0 : previousCacheEntry.isStale) {\n                        const silenceLog = false;\n                        await routeModule.onRequestError(req, err, {\n                            routerKind: 'App Router',\n                            routePath: srcPage,\n                            routeType: 'route',\n                            revalidateReason: getRevalidateReason({\n                                isStaticGeneration,\n                                isOnDemandRevalidate\n                            })\n                        }, silenceLog, routerServerContext);\n                    }\n                    throw err;\n                }\n            };\n            const cacheEntry = await routeModule.handleResponse({\n                req,\n                nextConfig,\n                cacheKey,\n                routeKind: RouteKind.APP_ROUTE,\n                isFallback: false,\n                prerenderManifest,\n                isRoutePPREnabled: false,\n                isOnDemandRevalidate,\n                revalidateOnlyGenerated,\n                responseGenerator,\n                waitUntil: ctx.waitUntil,\n                isMinimalMode\n            });\n            // we don't create a cacheEntry for ISR\n            if (!isIsr) {\n                return null;\n            }\n            if ((cacheEntry == null ? void 0 : (_cacheEntry_value = cacheEntry.value) == null ? void 0 : _cacheEntry_value.kind) !== CachedRouteKind.APP_ROUTE) {\n                var _cacheEntry_value1;\n                throw Object.defineProperty(new Error(`Invariant: app-route received invalid cache entry ${cacheEntry == null ? void 0 : (_cacheEntry_value1 = cacheEntry.value) == null ? void 0 : _cacheEntry_value1.kind}`), \"__NEXT_ERROR_CODE\", {\n                    value: \"E701\",\n                    enumerable: false,\n                    configurable: true\n                });\n            }\n            if (!isMinimalMode) {\n                res.setHeader('x-nextjs-cache', isOnDemandRevalidate ? 'REVALIDATED' : cacheEntry.isMiss ? 'MISS' : cacheEntry.isStale ? 'STALE' : 'HIT');\n            }\n            // Draft mode should never be cached\n            if (isDraftMode) {\n                res.setHeader('Cache-Control', 'private, no-cache, no-store, max-age=0, must-revalidate');\n            }\n            const headers = fromNodeOutgoingHttpHeaders(cacheEntry.value.headers);\n            if (!(isMinimalMode && isIsr)) {\n                headers.delete(NEXT_CACHE_TAGS_HEADER);\n            }\n            // If cache control is already set on the response we don't\n            // override it to allow users to customize it via next.config\n            if (cacheEntry.cacheControl && !res.getHeader('Cache-Control') && !headers.get('Cache-Control')) {\n                headers.set('Cache-Control', getCacheControlHeader(cacheEntry.cacheControl));\n            }\n            await sendResponse(nodeNextReq, nodeNextRes, // @ts-expect-error - Argument of type 'Buffer<ArrayBufferLike>' is not assignable to parameter of type 'BodyInit | null | undefined'.\n            new Response(cacheEntry.value.body, {\n                headers,\n                status: cacheEntry.value.status || 200\n            }));\n            return null;\n        };\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await handleResponse(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${srcPage}`,\n                    kind: SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, handleResponse));\n        }\n    } catch (err) {\n        if (!(err instanceof NoFallbackError)) {\n            const silenceLog = false;\n            await routeModule.onRequestError(req, err, {\n                routerKind: 'App Router',\n                routePath: normalizedSrcPage,\n                routeType: 'route',\n                revalidateReason: getRevalidateReason({\n                    isStaticGeneration,\n                    isOnDemandRevalidate\n                })\n            }, silenceLog, routerServerContext);\n        }\n        // rethrow so that we can handle serving error page\n        // If this is during static generation, throw the error again.\n        if (isIsr) throw err;\n        // Otherwise, send a 500 response.\n        await sendResponse(nodeNextReq, nodeNextRes, new Response(null, {\n            status: 500\n        }));\n        return null;\n    }\n}\n\n//# sourceMappingURL=app-route.js.map\n","import { createPrivateKey, createPublicKey, sign } from \"node:crypto\";\r\n\r\nimport { z } from \"zod\";\r\n\r\nimport { apiError, apiZodError } from \"@/lib/api/errors\";\r\nimport { requireActiveUser } from \"@/lib/auth/activeUser\";\r\nimport { getActingUserId, isParty, requireActingUserIdInProd } from \"@/lib/auth/party\";\r\nimport { getSql } from \"@/lib/db\";\r\nimport { responseForDbError, retryOnceOnTransientDbError } from \"@/lib/dbTransient\";\r\nimport { computeEvidenceCompleteness } from \"@/lib/evidence/completeness\";\r\nimport { sanitizeFilename } from \"@/lib/evidence/local\";\r\nimport { getStorageBackend } from \"@/lib/evidence/storage\";\r\nimport { sha256Hex } from \"@/lib/proofpack/hash\";\r\nimport type { ProofPackManifestV1 } from \"@/lib/proofpack/types\";\r\nimport { createZipStream } from \"@/lib/proofpack/zip\";\r\nimport type { NodeReadableLike } from \"@/lib/proofpack/zip\";\r\n\r\nexport const runtime = \"nodejs\";\r\n\r\nconst tradeIdSchema = z.string().uuid();\r\n\r\nfunction jsonBuffer(value: unknown): Buffer {\r\n  return Buffer.from(JSON.stringify(value, null, 2) + \"\\n\", \"utf8\");\r\n}\r\n\r\nasync function nodeReadableToBuffer(stream: NodeReadableLike): Promise<Buffer> {\r\n  const chunks: Buffer[] = [];\r\n\r\n  return await new Promise<Buffer>((resolve, reject) => {\r\n    stream.on(\"data\", (chunk) => {\r\n      if (typeof chunk === \"string\") {\r\n        chunks.push(Buffer.from(chunk, \"utf8\"));\r\n      } else if (chunk instanceof Uint8Array) {\r\n        chunks.push(Buffer.from(chunk));\r\n      } else {\r\n        chunks.push(Buffer.from(String(chunk), \"utf8\"));\r\n      }\r\n    });\r\n    stream.on(\"end\", () => resolve(Buffer.concat(chunks)));\r\n    stream.on(\"error\", (err) => reject(err));\r\n  });\r\n}\r\n\r\nexport async function GET(\r\n  request: Request,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  const sql = getSql();\r\n  const { id } = await params;\r\n\r\n  try {\r\n    tradeIdSchema.parse(id);\r\n  } catch (e) {\r\n    return apiZodError(e) ?? apiError(\"invalid_input\");\r\n  }\r\n\r\n  const url = new URL(request.url);\r\n  const actingUserId = getActingUserId(request) ?? url.searchParams.get(\"user_id\");\r\n  const authErr = requireActingUserIdInProd(actingUserId);\r\n  if (authErr) {\r\n    return apiError(authErr);\r\n  }\r\n\r\n  let trade:\r\n    | {\r\n        id: string;\r\n        buyer_user_id: string;\r\n        seller_user_id: string;\r\n        fiat_currency: string;\r\n        crypto_asset: string;\r\n        fiat_amount: string;\r\n        crypto_amount: string;\r\n        price: string;\r\n        payment_method_label: string;\r\n        payment_method_risk_class: \"irreversible\" | \"reversible\" | \"unknown\";\r\n        status: string;\r\n        reference_market_snapshot_id: string | null;\r\n        fair_price_mid: string | null;\r\n        fair_price_lower: string | null;\r\n        fair_price_upper: string | null;\r\n        fair_band_pct: string | null;\r\n        fair_price_basis: string | null;\r\n        price_deviation_pct: string | null;\r\n        created_at: string;\r\n      }\r\n    | undefined;\r\n  let transitions:\r\n    | {\r\n        id: string;\r\n        from_status: string | null;\r\n        to_status: string;\r\n        actor_user_id: string | null;\r\n        actor_type: string;\r\n        reason_code: string | null;\r\n        created_at: string;\r\n      }[]\r\n    | undefined;\r\n  let risk_assessment_latest:\r\n    | {\r\n        id: string;\r\n        score: number;\r\n        version: string;\r\n        factors_json: unknown;\r\n        recommended_action: \"allow\" | \"friction\" | \"bond\" | \"hold\" | \"block\";\r\n        market_snapshot_id: string | null;\r\n        created_at: string;\r\n      }\r\n    | null\r\n    | undefined;\r\n  let evidence_objects:\r\n    | {\r\n        id: string;\r\n        submitted_by_user_id: string;\r\n        type: string;\r\n        storage_uri: string;\r\n        sha256: string;\r\n        metadata_json: unknown;\r\n        created_at: string;\r\n      }[]\r\n    | undefined;\r\n  let dispute:\r\n    | {\r\n        id: string;\r\n        trade_id: string;\r\n        opened_by_user_id: string;\r\n        reason_code: string;\r\n        status: string;\r\n        opened_at: string;\r\n        resolved_at: string | null;\r\n      }\r\n    | null\r\n    | undefined;\r\n  let dispute_decisions:\r\n    | {\r\n        id: string;\r\n        dispute_id: string;\r\n        decision: string;\r\n        rationale: string | null;\r\n        decided_by: string;\r\n        created_at: string;\r\n      }[]\r\n    | undefined;\r\n  let marketSnapshot:\r\n    | {\r\n        id: string;\r\n        exchange: string;\r\n        symbol: string;\r\n        last: string | null;\r\n        bid: string | null;\r\n        ask: string | null;\r\n        ts: string;\r\n        raw_json: unknown;\r\n        created_at: string;\r\n      }\r\n    | null\r\n    | undefined;\r\n\r\n  try {\r\n    const activeErr = await retryOnceOnTransientDbError(() =>\r\n      requireActiveUser(sql, actingUserId)\r\n    );\r\n    if (activeErr) {\r\n      return apiError(activeErr);\r\n    }\r\n\r\n    const trades = await retryOnceOnTransientDbError(async () => {\r\n      return await sql<{\r\n        id: string;\r\n        buyer_user_id: string;\r\n        seller_user_id: string;\r\n        fiat_currency: string;\r\n        crypto_asset: string;\r\n        fiat_amount: string;\r\n        crypto_amount: string;\r\n        price: string;\r\n        payment_method_label: string;\r\n        payment_method_risk_class: \"irreversible\" | \"reversible\" | \"unknown\";\r\n        status: string;\r\n        reference_market_snapshot_id: string | null;\r\n        fair_price_mid: string | null;\r\n        fair_price_lower: string | null;\r\n        fair_price_upper: string | null;\r\n        fair_band_pct: string | null;\r\n        fair_price_basis: string | null;\r\n        price_deviation_pct: string | null;\r\n        created_at: string;\r\n      }[]>`\r\n        SELECT\r\n          id,\r\n          buyer_user_id,\r\n          seller_user_id,\r\n          fiat_currency,\r\n          crypto_asset,\r\n          fiat_amount::text,\r\n          crypto_amount::text,\r\n          price::text,\r\n          payment_method_label,\r\n          payment_method_risk_class,\r\n          status,\r\n          reference_market_snapshot_id,\r\n          fair_price_mid::text,\r\n          fair_price_lower::text,\r\n          fair_price_upper::text,\r\n          fair_band_pct::text,\r\n          fair_price_basis,\r\n          price_deviation_pct::text,\r\n          created_at\r\n        FROM trade\r\n        WHERE id = ${id}\r\n        LIMIT 1\r\n      `;\r\n    });\r\n\r\n    if (trades.length === 0) {\r\n      return apiError(\"not_found\");\r\n    }\r\n\r\n    trade = trades[0]!;\r\n\r\n    if (actingUserId && !isParty(actingUserId, trade)) {\r\n      return apiError(\"not_party\");\r\n    }\r\n\r\n    transitions = await retryOnceOnTransientDbError(async () => {\r\n      return await sql<{\r\n        id: string;\r\n        from_status: string | null;\r\n        to_status: string;\r\n        actor_user_id: string | null;\r\n        actor_type: string;\r\n        reason_code: string | null;\r\n        created_at: string;\r\n      }[]>`\r\n        SELECT id, from_status, to_status, actor_user_id, actor_type, reason_code, created_at\r\n        FROM trade_state_transition\r\n        WHERE trade_id = ${id}\r\n        ORDER BY created_at ASC\r\n      `;\r\n    });\r\n\r\n    const riskRows = await retryOnceOnTransientDbError(async () => {\r\n      return await sql<{\r\n        id: string;\r\n        score: number;\r\n        version: string;\r\n        factors_json: unknown;\r\n        recommended_action: \"allow\" | \"friction\" | \"bond\" | \"hold\" | \"block\";\r\n        market_snapshot_id: string | null;\r\n        created_at: string;\r\n      }[]>`\r\n        SELECT id, score, version, factors_json, recommended_action, market_snapshot_id, created_at\r\n        FROM risk_assessment\r\n        WHERE trade_id = ${id}\r\n        ORDER BY created_at DESC\r\n        LIMIT 1\r\n      `;\r\n    });\r\n\r\n    risk_assessment_latest = riskRows[0] ?? null;\r\n\r\n    evidence_objects = await retryOnceOnTransientDbError(async () => {\r\n      return await sql<{\r\n        id: string;\r\n        submitted_by_user_id: string;\r\n        type: string;\r\n        storage_uri: string;\r\n        sha256: string;\r\n        metadata_json: unknown;\r\n        created_at: string;\r\n      }[]>`\r\n        SELECT id, submitted_by_user_id, type, storage_uri, sha256, metadata_json, created_at\r\n        FROM evidence_object\r\n        WHERE trade_id = ${id}\r\n        ORDER BY created_at ASC\r\n      `;\r\n    });\r\n\r\n    dispute =\r\n      (\r\n        await retryOnceOnTransientDbError(async () => {\r\n          return await sql<{\r\n            id: string;\r\n            trade_id: string;\r\n            opened_by_user_id: string;\r\n            reason_code: string;\r\n            status: string;\r\n            opened_at: string;\r\n            resolved_at: string | null;\r\n          }[]>`\r\n            SELECT id, trade_id, opened_by_user_id, reason_code, status, opened_at, resolved_at\r\n            FROM dispute\r\n            WHERE trade_id = ${id}\r\n            LIMIT 1\r\n          `;\r\n        })\r\n      )[0] ?? null;\r\n\r\n    dispute_decisions = dispute\r\n      ? await retryOnceOnTransientDbError(async () => {\r\n          return await sql<{\r\n            id: string;\r\n            dispute_id: string;\r\n            decision: string;\r\n            rationale: string | null;\r\n            decided_by: string;\r\n            created_at: string;\r\n          }[]>`\r\n            SELECT id, dispute_id, decision, rationale, decided_by, created_at\r\n            FROM dispute_decision\r\n            WHERE dispute_id = ${dispute!.id}\r\n            ORDER BY created_at ASC\r\n          `;\r\n        })\r\n      : [];\r\n\r\n    marketSnapshot = trade.reference_market_snapshot_id\r\n      ? (\r\n          await retryOnceOnTransientDbError(async () => {\r\n            return await sql<{\r\n              id: string;\r\n              exchange: string;\r\n              symbol: string;\r\n              last: string | null;\r\n              bid: string | null;\r\n              ask: string | null;\r\n              ts: string;\r\n              raw_json: unknown;\r\n              created_at: string;\r\n            }[]>`\r\n              SELECT\r\n                id,\r\n                exchange,\r\n                symbol,\r\n                last::text,\r\n                bid::text,\r\n                ask::text,\r\n                ts,\r\n                raw_json,\r\n                created_at\r\n              FROM market_snapshot\r\n              WHERE id = ${trade!.reference_market_snapshot_id}\r\n              LIMIT 1\r\n            `;\r\n          })\r\n        )[0] ?? null\r\n      : null;\r\n  } catch (e) {\r\n    const resp = responseForDbError(\"trades.proof_pack\", e);\r\n    if (resp) return resp;\r\n    throw e;\r\n  }\r\n\r\n  trade = trade!;\r\n  transitions = transitions!;\r\n  evidence_objects = evidence_objects!;\r\n  dispute = dispute!;\r\n  dispute_decisions = dispute_decisions!;\r\n  risk_assessment_latest = risk_assessment_latest!;\r\n  marketSnapshot = marketSnapshot!;\r\n\r\n  const files: Array<{ path: string; data: Buffer; mime: string }> = [];\r\n\r\n  files.push({ path: \"data/trade.json\", data: jsonBuffer(trade), mime: \"application/json\" });\r\n  files.push({\r\n    path: \"data/transitions.json\",\r\n    data: jsonBuffer(transitions),\r\n    mime: \"application/json\",\r\n  });\r\n  files.push({\r\n    path: \"data/risk_assessment_latest.json\",\r\n    data: jsonBuffer(risk_assessment_latest),\r\n    mime: \"application/json\",\r\n  });\r\n  files.push({\r\n    path: \"data/reference_market_snapshot.json\",\r\n    data: jsonBuffer(marketSnapshot),\r\n    mime: \"application/json\",\r\n  });\r\n  files.push({\r\n    path: \"data/evidence_objects.json\",\r\n    data: jsonBuffer(evidence_objects),\r\n    mime: \"application/json\",\r\n  });\r\n  files.push({\r\n    path: \"data/dispute.json\",\r\n    data: jsonBuffer(dispute),\r\n    mime: \"application/json\",\r\n  });\r\n  files.push({\r\n    path: \"data/dispute_decisions.json\",\r\n    data: jsonBuffer(dispute_decisions),\r\n    mime: \"application/json\",\r\n  });\r\n\r\n  const missingEvidence: Array<{ id: string; storage_uri: string; reason: string }> = [];\r\n\r\n  const storage = getStorageBackend();\r\n\r\n  for (const ev of evidence_objects) {\r\n    try {\r\n      const data = await storage.get(ev.storage_uri);\r\n      if (!data) {\r\n        missingEvidence.push({\r\n          id: ev.id,\r\n          storage_uri: ev.storage_uri,\r\n          reason: \"blob_not_found\",\r\n        });\r\n        continue;\r\n      }\r\n      const meta = ev.metadata_json as Record<string, unknown> | null;\r\n      const mime =\r\n        meta && typeof meta === \"object\" && typeof meta.mime === \"string\"\r\n          ? meta.mime\r\n          : \"application/octet-stream\";\r\n      // Derive a safe filename from the storage URI or sha256 fallback.\r\n      const uriParts = ev.storage_uri.split(\"/\");\r\n      const rawName = uriParts.length > 0 ? decodeURIComponent(uriParts[uriParts.length - 1]!) : ev.sha256;\r\n      const safeName = sanitizeFilename(rawName);\r\n      files.push({\r\n        path: `evidence/${ev.sha256}/${safeName}`,\r\n        data,\r\n        mime,\r\n      });\r\n    } catch (e) {\r\n      missingEvidence.push({\r\n        id: ev.id,\r\n        storage_uri: ev.storage_uri,\r\n        reason: e instanceof Error ? e.message : \"read_failed\",\r\n      });\r\n    }\r\n  }\r\n\r\n  if (missingEvidence.length > 0) {\r\n    files.push({\r\n      path: \"data/evidence_missing.json\",\r\n      data: jsonBuffer(missingEvidence),\r\n      mime: \"application/json\",\r\n    });\r\n  }\r\n\r\n  const evidenceCompleteness = computeEvidenceCompleteness(\r\n    evidence_objects.map((e) => ({ type: e.type, metadata_json: e.metadata_json }))\r\n  );\r\n\r\n  const latestTransition = transitions.length > 0 ? transitions[transitions.length - 1] : null;\r\n  const terminalStatuses = new Set([\"resolved\", \"canceled\"]);\r\n  const terminalStatus = terminalStatuses.has(trade.status) ? trade.status : null;\r\n  const latestDisputeDecision =\r\n    dispute_decisions.length > 0 ? dispute_decisions[dispute_decisions.length - 1] : null;\r\n\r\n  const manifest: ProofPackManifestV1 = {\r\n    manifest_version: \"proofpack.manifest.v1\",\r\n    generated_at: new Date().toISOString(),\r\n    trade_id: id,\r\n    includes: {\r\n      trade: true,\r\n      transitions: true,\r\n      risk_assessment_latest: true,\r\n      reference_market_snapshot: true,\r\n      evidence_objects: true,\r\n      dispute: true,\r\n      dispute_decisions: true,\r\n      evidence_missing: missingEvidence.length > 0,\r\n    },\r\n    files: [],\r\n    summary: {\r\n      trade: {\r\n        status: trade.status,\r\n        terminal_status: terminalStatus,\r\n        latest_transition: latestTransition\r\n          ? {\r\n              from_status: latestTransition.from_status,\r\n              to_status: latestTransition.to_status,\r\n              actor_user_id: latestTransition.actor_user_id,\r\n              actor_type: latestTransition.actor_type,\r\n              reason_code: latestTransition.reason_code,\r\n              created_at: latestTransition.created_at,\r\n            }\r\n          : null,\r\n        latest_dispute_decision: latestDisputeDecision\r\n          ? {\r\n              decision: latestDisputeDecision.decision,\r\n              decided_by: latestDisputeDecision.decided_by,\r\n              created_at: latestDisputeDecision.created_at,\r\n            }\r\n          : null,\r\n      },\r\n      risk_score: risk_assessment_latest?.score ?? null,\r\n      recommended_action: risk_assessment_latest?.recommended_action ?? null,\r\n      price_deviation_pct: trade.price_deviation_pct ?? null,\r\n      evidence_completeness: evidenceCompleteness,\r\n      dispute: {\r\n        status: dispute?.status ?? null,\r\n        reason_code: dispute?.reason_code ?? null,\r\n        opened_at: dispute?.opened_at ?? null,\r\n        resolved_at: dispute?.resolved_at ?? null,\r\n        decisions_count: dispute_decisions.length,\r\n      },\r\n    },\r\n  };\r\n\r\n  for (const f of files) {\r\n    manifest.files.push({\r\n      path: f.path,\r\n      bytes: f.data.byteLength,\r\n      sha256: sha256Hex(f.data),\r\n      mime: f.mime,\r\n    });\r\n  }\r\n\r\n  const manifestBuf = jsonBuffer(manifest);\r\n  files.push({ path: \"manifest.json\", data: manifestBuf, mime: \"application/json\" });\r\n\r\n  const manifestSha256 = sha256Hex(manifestBuf);\r\n  files.push({\r\n    path: \"manifest.sha256\",\r\n    data: Buffer.from(`${manifestSha256}  manifest.json\\n`, \"utf8\"),\r\n    mime: \"text/plain\",\r\n  });\r\n\r\n  const signingKeyPemRaw =\r\n    process.env.PROOFPACK_SIGNING_PRIVATE_KEY_B64\r\n      ? Buffer.from(process.env.PROOFPACK_SIGNING_PRIVATE_KEY_B64, \"base64\").toString(\"utf8\")\r\n      : process.env.PROOFPACK_SIGNING_PRIVATE_KEY;\r\n  const signingKeyPem = signingKeyPemRaw?.includes(\"\\\\n\")\r\n    ? signingKeyPemRaw.replace(/\\\\n/g, \"\\n\")\r\n    : signingKeyPemRaw;\r\n\r\n  if (signingKeyPem) {\r\n    const privateKey = createPrivateKey(signingKeyPem);\r\n    const publicKeyPem = createPublicKey(privateKey).export({ type: \"spki\", format: \"pem\" });\r\n    const publicKeyPemStr =\r\n      typeof publicKeyPem === \"string\" ? publicKeyPem : publicKeyPem.toString(\"utf8\");\r\n\r\n    const keyId = sha256Hex(Buffer.from(publicKeyPemStr, \"utf8\"));\r\n    const signature = sign(null, Buffer.from(manifestSha256, \"utf8\"), privateKey);\r\n\r\n    files.push({\r\n      path: \"public_key.pem\",\r\n      data: Buffer.from(publicKeyPemStr, \"utf8\"),\r\n      mime: \"application/x-pem-file\",\r\n    });\r\n\r\n    files.push({\r\n      path: \"signature.json\",\r\n      data: jsonBuffer({\r\n        signature_version: \"proofpack.signature.v0\",\r\n        status: \"signed\",\r\n        algorithm: \"ed25519\",\r\n        key_id: keyId,\r\n        payload: { type: \"manifest_sha256\", value: manifestSha256 },\r\n        signature_b64: signature.toString(\"base64\"),\r\n        public_key_pem: publicKeyPemStr,\r\n        public_key_pem_path: \"public_key.pem\",\r\n        signed_at: new Date().toISOString(),\r\n      }),\r\n      mime: \"application/json\",\r\n    });\r\n  } else {\r\n    files.push({\r\n      path: \"signature.json\",\r\n      data: jsonBuffer({\r\n        signature_version: \"proofpack.signature.v0\",\r\n        status: \"unsigned\",\r\n        algorithm: null,\r\n        key_id: null,\r\n        payload: { type: \"manifest_sha256\", value: manifestSha256 },\r\n        signature_b64: null,\r\n        public_key_pem: null,\r\n        public_key_pem_path: null,\r\n        signed_at: null,\r\n      }),\r\n      mime: \"application/json\",\r\n    });\r\n  }\r\n\r\n  const zipInputs = files.map((f) => ({ path: f.path, data: f.data }));\r\n  const { zipStream } = createZipStream(zipInputs);\r\n\r\n  const zipBuf = await nodeReadableToBuffer(zipStream);\r\n  const body = zipBuf.buffer.slice(\r\n    zipBuf.byteOffset,\r\n    zipBuf.byteOffset + zipBuf.byteLength\r\n  ) as ArrayBuffer;\r\n\r\n  return new Response(body, {\r\n    headers: {\r\n      \"Content-Type\": \"application/zip\",\r\n      \"Cache-Control\": \"no-store\",\r\n      \"X-Content-Type-Options\": \"nosniff\",\r\n    },\r\n  });\r\n}\r\n","import yazl from \"yazl\";\r\n\r\nimport type { Readable } from \"node:stream\";\r\n\r\nexport type NodeReadableLike = Readable;\r\n\r\nexport type ZipInputFile = {\r\n  path: string;\r\n  data: Buffer;\r\n};\r\n\r\nexport function createZipStream(files: ZipInputFile[]): {\r\n  zipStream: NodeReadableLike;\r\n} {\r\n  const zip = new yazl.ZipFile();\r\n\r\n  for (const file of files) {\r\n    zip.addBuffer(file.data, file.path);\r\n  }\r\n\r\n  zip.end();\r\n\r\n  // yazl's outputStream is a Node Readable at runtime; some typings represent it as a web stream.\r\n  const zipStream = zip.outputStream as unknown as Readable;\r\n\r\n  return {\r\n    zipStream,\r\n  };\r\n}\r\n","import { createHash } from \"node:crypto\";\r\n\r\nexport function sha256Hex(buffer: Buffer): string {\r\n  return createHash(\"sha256\").update(buffer).digest(\"hex\");\r\n}\r\n","export type EvidenceLike = {\r\n  type: string;\r\n  metadata_json?: unknown;\r\n};\r\n\r\nexport type EvidenceCompleteness = {\r\n  score: number;\r\n  evidence_count: number;\r\n  evidence_types: string[];\r\n  missing_recommendations: string[];\r\n};\r\n\r\nfunction uniqSorted(values: string[]): string[] {\r\n  return Array.from(new Set(values)).sort();\r\n}\r\n\r\nexport function computeEvidenceCompleteness(evidence: EvidenceLike[]): EvidenceCompleteness {\r\n  const evidenceTypes = uniqSorted(\r\n    evidence\r\n      .map((e) => (typeof e?.type === \"string\" ? e.type : \"\"))\r\n      .filter(Boolean)\r\n  );\r\n\r\n  const has = (t: string) => evidenceTypes.includes(t);\r\n\r\n  const evidence_count = evidence.length;\r\n  if (evidence_count === 0) {\r\n    return {\r\n      score: 0,\r\n      evidence_count,\r\n      evidence_types: evidenceTypes,\r\n      missing_recommendations: [\r\n        \"upload a payment proof (receipt/bank_sms)\",\r\n        \"upload chat export\",\r\n      ],\r\n    };\r\n  }\r\n\r\n  let score = 0;\r\n\r\n  if (has(\"receipt\") || has(\"bank_sms\")) score += 40;\r\n  if (has(\"chat_export\")) score += 30;\r\n  if (has(\"screenshot\")) score += 20;\r\n  if (evidence_count >= 2) score += 10;\r\n\r\n  score = Math.max(0, Math.min(100, score));\r\n\r\n  const missing_recommendations: string[] = [];\r\n  if (!has(\"receipt\") && !has(\"bank_sms\")) {\r\n    missing_recommendations.push(\"upload a payment proof (receipt/bank_sms)\");\r\n  }\r\n  if (!has(\"chat_export\")) missing_recommendations.push(\"upload chat export\");\r\n  if (!has(\"screenshot\")) missing_recommendations.push(\"upload screenshots\");\r\n\r\n  return {\r\n    score,\r\n    evidence_count,\r\n    evidence_types: evidenceTypes,\r\n    missing_recommendations,\r\n  };\r\n}\r\n"],"names":[],"mappings":"8CAMA,IAAM,EAAY,IAAI,WAAW,CAC/B,EACA,WACA,WACA,WACA,UACA,WACA,WACA,WACA,UACA,WACA,WACA,WACA,UACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,UACA,WACA,WACA,WACA,UACA,WACA,WACA,WACA,UACA,WACA,WACA,WACA,UACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,UACA,WACA,WACA,WACA,UACA,WACA,WACA,WACA,UACA,WACA,WACA,WACA,UACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,UACA,WACA,WACA,WACA,UACA,WACA,WACA,WACA,UACA,WACA,WACA,WACA,UACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WACA,WAC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","ignoreList":[0,1,2]}