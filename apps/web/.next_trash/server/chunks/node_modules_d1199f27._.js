module.exports=[882450,(e,t,r)=>{"use strict";let n=new Int32Array([0,0x77073096,0xee0e612c,0x990951ba,0x76dc419,0x706af48f,0xe963a535,0x9e6495a3,0xedb8832,0x79dcb8a4,0xe0d5e91e,0x97d2d988,0x9b64c2b,0x7eb17cbd,0xe7b82d07,0x90bf1d91,0x1db71064,0x6ab020f2,0xf3b97148,0x84be41de,0x1adad47d,0x6ddde4eb,0xf4d4b551,0x83d385c7,0x136c9856,0x646ba8c0,0xfd62f97a,0x8a65c9ec,0x14015c4f,0x63066cd9,0xfa0f3d63,0x8d080df5,0x3b6e20c8,0x4c69105e,0xd56041e4,0xa2677172,0x3c03e4d1,0x4b04d447,0xd20d85fd,0xa50ab56b,0x35b5a8fa,0x42b2986c,0xdbbbc9d6,0xacbcf940,0x32d86ce3,0x45df5c75,0xdcd60dcf,0xabd13d59,0x26d930ac,0x51de003a,0xc8d75180,0xbfd06116,0x21b4f4b5,0x56b3c423,0xcfba9599,0xb8bda50f,0x2802b89e,0x5f058808,0xc60cd9b2,0xb10be924,0x2f6f7c87,0x58684c11,0xc1611dab,0xb6662d3d,0x76dc4190,0x1db7106,0x98d220bc,0xefd5102a,0x71b18589,0x6b6b51f,0x9fbfe4a5,0xe8b8d433,0x7807c9a2,0xf00f934,0x9609a88e,0xe10e9818,0x7f6a0dbb,0x86d3d2d,0x91646c97,0xe6635c01,0x6b6b51f4,0x1c6c6162,0x856530d8,0xf262004e,0x6c0695ed,0x1b01a57b,0x8208f4c1,0xf50fc457,0x65b0d9c6,0x12b7e950,0x8bbeb8ea,0xfcb9887c,0x62dd1ddf,0x15da2d49,0x8cd37cf3,0xfbd44c65,0x4db26158,0x3ab551ce,0xa3bc0074,0xd4bb30e2,0x4adfa541,0x3dd895d7,0xa4d1c46d,0xd3d6f4fb,0x4369e96a,0x346ed9fc,0xad678846,0xda60b8d0,0x44042d73,0x33031de5,0xaa0a4c5f,0xdd0d7cc9,0x5005713c,0x270241aa,0xbe0b1010,0xc90c2086,0x5768b525,0x206f85b3,0xb966d409,0xce61e49f,0x5edef90e,0x29d9c998,0xb0d09822,0xc7d7a8b4,0x59b33d17,0x2eb40d81,0xb7bd5c3b,0xc0ba6cad,0xedb88320,0x9abfb3b6,0x3b6e20c,0x74b1d29a,0xead54739,0x9dd277af,0x4db2615,0x73dc1683,0xe3630b12,0x94643b84,0xd6d6a3e,0x7a6a5aa8,0xe40ecf0b,0x9309ff9d,0xa00ae27,0x7d079eb1,0xf00f9344,0x8708a3d2,0x1e01f268,0x6906c2fe,0xf762575d,0x806567cb,0x196c3671,0x6e6b06e7,0xfed41b76,0x89d32be0,0x10da7a5a,0x67dd4acc,0xf9b9df6f,0x8ebeeff9,0x17b7be43,0x60b08ed5,0xd6d6a3e8,0xa1d1937e,0x38d8c2c4,0x4fdff252,0xd1bb67f1,0xa6bc5767,0x3fb506dd,0x48b2364b,0xd80d2bda,0xaf0a1b4c,0x36034af6,0x41047a60,0xdf60efc3,0xa867df55,0x316e8eef,0x4669be79,0xcb61b38c,0xbc66831a,0x256fd2a0,0x5268e236,0xcc0c7795,0xbb0b4703,0x220216b9,0x5505262f,0xc5ba3bbe,0xb2bd0b28,0x2bb45a92,0x5cb36a04,0xc2d7ffa7,0xb5d0cf31,0x2cd99e8b,0x5bdeae1d,0x9b64c2b0,0xec63f226,0x756aa39c,0x26d930a,0x9c0906a9,0xeb0e363f,0x72076785,0x5005713,0x95bf4a82,0xe2b87a14,0x7bb12bae,0xcb61b38,0x92d28e9b,0xe5d5be0d,0x7cdcefb7,0xbdbdf21,0x86d3d2d4,0xf1d4e242,0x68ddb3f8,0x1fda836e,0x81be16cd,0xf6b9265b,0x6fb077e1,0x18b74777,0x88085ae6,0xff0f6a70,0x66063bca,0x11010b5c,0x8f659eff,0xf862ae69,0x616bffd3,0x166ccf45,0xa00ae278,0xd70dd2ee,0x4e048354,0x3903b3c2,0xa7672661,0xd06016f7,0x4969474d,0x3e6e77db,0xaed16a4a,0xd9d65adc,0x40df0b66,936918e3,0xa9bcae53,0xdebb9ec5,0x47b2cf7f,0x30b5ffe9,0xbdbdf21c,0xcabac28a,0x53b39330,0x24b4a3a6,0xbad03605,0xcdd70693,0x54de5729,0x23d967bf,0xb3667a2e,0xc4614ab8,0x5d681b02,0x2a6f2b94,0xb40bbe37,0xc30c8ea1,0x5a05df1b,0x2d02ef8d]);function a(e){if(Buffer.isBuffer(e))return e;if("number"==typeof e)return Buffer.alloc(e);if("string"==typeof e)return Buffer.from(e);throw Error("input must be buffer, number, or string, received "+typeof e)}function i(e,t){e=a(e),Buffer.isBuffer(t)&&(t=t.readUInt32BE(0));let r=-1^~~t;for(var i=0;i<e.length;i++)r=n[(r^e[i])&255]^r>>>8;return -1^r}function o(){var e;let t;return e=i.apply(null,arguments),(t=a(4)).writeInt32BE(e,0),t}o.signed=function(){return i.apply(null,arguments)},o.unsigned=function(){return i.apply(null,arguments)>>>0},t.exports=o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o},637121,(e,t,r)=>{var n=e.r(522734),a=e.r(688947).Transform,i=e.r(688947).PassThrough,o=e.r(406461),s=e.r(224361),c=e.r(427699).EventEmitter,d=e.r(427699).errorMonitor,f=e.r(882450);function l(){this.outputStream=new i,this.entries=[],this.outputStreamCursor=0,this.ended=!1,this.allDone=!1,this.forceZip64Eocd=!1,this.errored=!1,this.on(d,function(){this.errored=!0})}r.ZipFile=l,r.dateToDosDateTime=T,s.inherits(l,c),l.prototype.addFile=function(e,t,r){var a=this;if(t=w(t,!1),null==r&&(r={}),!x(a)){var i=new v(t,!1,r);a.entries.push(i),n.stat(e,function(t,o){return t?a.emit("error",t):o.isFile()?void(i.uncompressedSize=o.size,null==r.mtime&&i.setLastModDate(o.mtime),null==r.mode&&i.setFileAttributesMode(o.mode),i.setFileDataPumpFunction(function(){var t=n.createReadStream(e);i.state=v.FILE_DATA_IN_PROGRESS,t.on("error",function(e){a.emit("error",e)}),m(a,i,t)}),h(a)):a.emit("error",Error("not a file: "+e))})}},l.prototype.addReadStream=function(e,t,r){this.addReadStreamLazy(t,r,function(t){t(null,e)})},l.prototype.addReadStreamLazy=function(e,t,r){var n=this;if("function"==typeof t&&(r=t,t=null),null==t&&(t={}),e=w(e,!1),!x(n)){var a=new v(e,!1,t);n.entries.push(a),a.setFileDataPumpFunction(function(){a.state=v.FILE_DATA_IN_PROGRESS,r(function(e,t){if(e)return n.emit("error",e);m(n,a,t)})}),h(n)}},l.prototype.addBuffer=function(e,t,r){var n=this;if(t=w(t,!1),e.length>0x3fffffff)throw Error("buffer too large: "+e.length+" > 1073741823");if(null==r&&(r={}),null!=r.size)throw Error("options.size not allowed");if(!x(n)){var a=new v(t,!1,r);a.uncompressedSize=e.length,a.crc32=f.unsigned(e),a.crcAndFileSizeKnown=!0,n.entries.push(a),0===a.compressionLevel?i(e):o.deflateRaw(e,{level:a.compressionLevel},function(e,t){i(t)})}function i(e){a.compressedSize=e.length,a.setFileDataPumpFunction(function(){p(n,e),p(n,a.getDataDescriptor()),a.state=v.FILE_DATA_DONE,setImmediate(function(){h(n)})}),h(n)}},l.prototype.addEmptyDirectory=function(e,t){var r=this;if(e=w(e,!0),null==t&&(t={}),null!=t.size)throw Error("options.size not allowed");if(null!=t.compress)throw Error("options.compress not allowed");if(null!=t.compressionLevel)throw Error("options.compressionLevel not allowed");if(!x(r)){var n=new v(e,!0,t);r.entries.push(n),n.setFileDataPumpFunction(function(){p(r,n.getDataDescriptor()),n.state=v.FILE_DATA_DONE,h(r)}),h(r)}};var u=j([80,75,5,6]);function p(e,t){e.outputStream.write(t),e.outputStreamCursor+=t.length}function m(e,t,r){var n=new z,a=new P,s=0!==t.compressionLevel?new o.DeflateRaw({level:t.compressionLevel}):new i,c=new P;r.pipe(n).pipe(a).pipe(s).pipe(c).pipe(e.outputStream,{end:!1}),c.on("end",function(){if(t.crc32=n.crc32,null==t.uncompressedSize)t.uncompressedSize=a.byteCount;else if(t.uncompressedSize!==a.byteCount)return e.emit("error",Error("file data stream has unexpected number of bytes"));t.compressedSize=c.byteCount,e.outputStreamCursor+=t.compressedSize,p(e,t.getDataDescriptor()),t.state=v.FILE_DATA_DONE,h(e)})}function h(e){if(!e.allDone&&!e.errored){if(e.ended&&null!=e.calculatedTotalSizeCallback){var t=function(e){for(var t=0,r=0,n=0;n<e.entries.length;n++){var a=e.entries[n];if(0!==a.compressionLevel)return -1;if(a.state>=v.READY_TO_PUMP_FILE_DATA){if(null==a.uncompressedSize)return -1}else if(null==a.uncompressedSize)return null;a.relativeOffsetOfLocalHeader=t;var i=a.useZip64Format();t+=y+a.utf8FileName.length,t+=a.uncompressedSize,a.crcAndFileSizeKnown||(i?t+=R:t+=L),r+=O+a.utf8FileName.length+a.fileComment.length,a.forceDosTimestamp||(r+=A),i&&(r+=D)}var o=0;return(e.forceZip64Eocd||e.entries.length>=65535||r>=65535||t>=0xffffffff)&&(o+=b+_),t+r+(o+=E+e.comment.length)}(e);null!=t&&(e.calculatedTotalSizeCallback(t),e.calculatedTotalSizeCallback=null)}var r=function(){for(var t=0;t<e.entries.length;t++){var r=e.entries[t];if(r.state<v.FILE_DATA_DONE)return r}return null}();if(null!=r){if(r.state<v.READY_TO_PUMP_FILE_DATA||r.state===v.FILE_DATA_IN_PROGRESS)return;r.relativeOffsetOfLocalHeader=e.outputStreamCursor,p(e,r.getLocalFileHeader()),r.doFileDataPump()}else e.ended&&(e.offsetOfStartOfCentralDirectory=e.outputStreamCursor,e.entries.forEach(function(t){p(e,t.getCentralDirectoryRecord())}),p(e,function(e,t){var r=!1,n=e.entries.length;(e.forceZip64Eocd||e.entries.length>=65535)&&(n=65535,r=!0);var a=e.outputStreamCursor-e.offsetOfStartOfCentralDirectory,i=a;(e.forceZip64Eocd||a>=0xffffffff)&&(i=0xffffffff,r=!0);var o=e.offsetOfStartOfCentralDirectory;void((e.forceZip64Eocd||e.offsetOfStartOfCentralDirectory>=0xffffffff)&&(o=0xffffffff,r=!0));var s=N(E+e.comment.length);if(s.writeUInt32LE(0x6054b50,0),s.writeUInt16LE(0,4),s.writeUInt16LE(0,6),s.writeUInt16LE(n,8),s.writeUInt16LE(n,10),s.writeUInt32LE(i,12),s.writeUInt32LE(o,16),s.writeUInt16LE(e.comment.length,20),e.comment.copy(s,22),!r)return s;var c=N(b);c.writeUInt32LE(0x6064b50,0),U(c,b-12,4),c.writeUInt16LE(S,12),c.writeUInt16LE(I,14),c.writeUInt32LE(0,16),c.writeUInt32LE(0,20),U(c,e.entries.length,24),U(c,e.entries.length,32),U(c,a,40),U(c,e.offsetOfStartOfCentralDirectory,48);var d=N(_);return d.writeUInt32LE(0x7064b50,0),d.writeUInt32LE(0,4),U(d,e.outputStreamCursor,8),d.writeUInt32LE(1,16),Buffer.concat([c,d,s])}(e)),e.outputStream.end(),e.allDone=!0)}}function x(e){if(e.ended)throw Error("cannot add entries after calling end()");return!!e.errored}l.prototype.end=function(e,t){if(("function"==typeof e&&(t=e,e=null),null==e&&(e={}),!this.ended)&&(this.ended=!0,!this.errored)){if(this.calculatedTotalSizeCallback=t,this.forceZip64Eocd=!!e.forceZip64Format,e.comment){if("string"==typeof e.comment?this.comment=function(e){if(/^[\x20-\x7e]*$/.test(e))return j(e,"utf-8");if(null==k){k={};for(var t=0;t<M.length;t++)k[M[t]]=t}for(var r=N(e.length),t=0;t<e.length;t++){var n=k[e[t]];if(null==n)throw Error("character not encodable in CP437: "+JSON.stringify(e[t]));r[t]=n}return r}(e.comment):this.comment=e.comment,this.comment.length>65535)throw Error("comment is too large");if(B(this.comment,u))throw Error("comment contains end of central directory record signature")}else this.comment=g;h(this)}};var b=56,_=20,E=22;function w(e,t){if(""===e)throw Error("empty metadataPath");if(e=e.replace(/\\/g,"/"),/^[a-zA-Z]:/.test(e)||/^\//.test(e))throw Error("absolute path: "+e);if(-1!==e.split("/").indexOf(".."))throw Error("invalid relative path: "+e);var r=/\/$/.test(e);if(t)r||(e+="/");else if(r)throw Error("file path cannot end with '/': "+e);return e}var g=N(0);function v(e,t,r){if(this.utf8FileName=j(e),this.utf8FileName.length>65535)throw Error("utf8 file name too long. "+utf8FileName.length+" > 65535");if(this.isDirectory=t,this.state=v.WAITING_FOR_METADATA,this.setLastModDate(null!=r.mtime?r.mtime:new Date),this.forceDosTimestamp=!!r.forceDosTimestamp,null!=r.mode?this.setFileAttributesMode(r.mode):this.setFileAttributesMode(t?16893:33204),t?(this.crcAndFileSizeKnown=!0,this.crc32=0,this.uncompressedSize=0,this.compressedSize=0):(this.crcAndFileSizeKnown=!1,this.crc32=null,this.uncompressedSize=null,this.compressedSize=null,null!=r.size&&(this.uncompressedSize=r.size)),t?this.compressionLevel=0:this.compressionLevel=function(e){if(null!=e.compress&&null!=e.compressionLevel&&!!e.compress!=!!e.compressionLevel)throw Error("conflicting settings for compress and compressionLevel");return null!=e.compressionLevel?e.compressionLevel:6*(!1!==e.compress)}(r),this.forceZip64Format=!!r.forceZip64Format,r.fileComment){if("string"==typeof r.fileComment?this.fileComment=j(r.fileComment,"utf-8"):this.fileComment=r.fileComment,this.fileComment.length>65535)throw Error("fileComment is too large")}else this.fileComment=g}v.WAITING_FOR_METADATA=0,v.READY_TO_PUMP_FILE_DATA=1,v.FILE_DATA_IN_PROGRESS=2,v.FILE_DATA_DONE=3,v.prototype.setLastModDate=function(e){this.mtime=e;var t=T(e);this.lastModFileTime=t.time,this.lastModFileDate=t.date},v.prototype.setFileAttributesMode=function(e){if((65535&e)!==e)throw Error("invalid mode. expected: 0 <= "+e+" <= 65535");this.externalFileAttributes=e<<16>>>0},v.prototype.setFileDataPumpFunction=function(e){this.doFileDataPump=e,this.state=v.READY_TO_PUMP_FILE_DATA},v.prototype.useZip64Format=function(){return this.forceZip64Format||null!=this.uncompressedSize&&this.uncompressedSize>0xfffffffe||null!=this.compressedSize&&this.compressedSize>0xfffffffe||null!=this.relativeOffsetOfLocalHeader&&this.relativeOffsetOfLocalHeader>0xfffffffe};var y=30,I=45,S=831;v.prototype.getLocalFileHeader=function(){var e=0,t=0,r=0;this.crcAndFileSizeKnown&&(e=this.crc32,t=this.compressedSize,r=this.uncompressedSize);var n=N(y),a=2048;return this.crcAndFileSizeKnown||(a|=8),n.writeUInt32LE(0x4034b50,0),n.writeUInt16LE(20,4),n.writeUInt16LE(a,6),n.writeUInt16LE(this.getCompressionMethod(),8),n.writeUInt16LE(this.lastModFileTime,10),n.writeUInt16LE(this.lastModFileDate,12),n.writeUInt32LE(e,14),n.writeUInt32LE(t,18),n.writeUInt32LE(r,22),n.writeUInt16LE(this.utf8FileName.length,26),n.writeUInt16LE(0,28),Buffer.concat([n,this.utf8FileName])};var L=16,R=24;v.prototype.getDataDescriptor=function(){if(this.crcAndFileSizeKnown)return g;if(this.useZip64Format()){var e=N(R);return e.writeUInt32LE(0x8074b50,0),e.writeUInt32LE(this.crc32,4),U(e,this.compressedSize,8),U(e,this.uncompressedSize,16),e}var e=N(L);return e.writeUInt32LE(0x8074b50,0),e.writeUInt32LE(this.crc32,4),e.writeUInt32LE(this.compressedSize,8),e.writeUInt32LE(this.uncompressedSize,12),e};var O=46,A=9,D=28;v.prototype.getCentralDirectoryRecord=function(){var e=N(O),t=2048;this.crcAndFileSizeKnown||(t|=8);var r=g;if(!this.forceDosTimestamp){(r=N(A)).writeUInt16LE(21589,0),r.writeUInt16LE(A-4,2),r.writeUInt8(3,4);var n=Math.floor(this.mtime.getTime()/1e3);n<-0x80000000&&(n=-0x80000000),n>0x7fffffff&&(n=0x7fffffff),r.writeUInt32LE(n,5)}var a=this.compressedSize,i=this.uncompressedSize,o=this.relativeOffsetOfLocalHeader,s=20,c=g;return this.useZip64Format()&&(a=0xffffffff,i=0xffffffff,o=0xffffffff,s=I,(c=N(D)).writeUInt16LE(1,0),c.writeUInt16LE(D-4,2),U(c,this.uncompressedSize,4),U(c,this.compressedSize,12),U(c,this.relativeOffsetOfLocalHeader,20)),e.writeUInt32LE(0x2014b50,0),e.writeUInt16LE(S,4),e.writeUInt16LE(s,6),e.writeUInt16LE(t,8),e.writeUInt16LE(this.getCompressionMethod(),10),e.writeUInt16LE(this.lastModFileTime,12),e.writeUInt16LE(this.lastModFileDate,14),e.writeUInt32LE(this.crc32,16),e.writeUInt32LE(a,20),e.writeUInt32LE(i,24),e.writeUInt16LE(this.utf8FileName.length,28),e.writeUInt16LE(r.length+c.length,30),e.writeUInt16LE(this.fileComment.length,32),e.writeUInt16LE(0,34),e.writeUInt16LE(0,36),e.writeUInt32LE(this.externalFileAttributes,38),e.writeUInt32LE(o,42),Buffer.concat([e,this.utf8FileName,r,c,this.fileComment])},v.prototype.getCompressionMethod=function(){return 8*(0!==this.compressionLevel)};var C=new Date(1980,0,1),F=new Date(2107,11,31,23,59,58);function T(e){return e<C?e=C:e>F&&(e=F),{date:31&e.getDate()|(e.getMonth()+1&15)<<5|(e.getFullYear()-1980&127)<<9,time:Math.floor(e.getSeconds()/2)|(63&e.getMinutes())<<5|(31&e.getHours())<<11}}function U(e,t,r){var n=Math.floor(t/0x100000000);e.writeUInt32LE(t%0x100000000,r),e.writeUInt32LE(n,r+4)}function P(e){a.call(this,e),this.byteCount=0}function z(e){a.call(this,e),this.crc32=0}s.inherits(P,a),P.prototype._transform=function(e,t,r){this.byteCount+=e.length,r(null,e)},s.inherits(z,a),z.prototype._transform=function(e,t,r){this.crc32=f.unsigned(e,this.crc32),r(null,e)};var M="\0☺☻♥♦♣♠•◘○◙♂♀♪♫☼►◄↕‼¶§▬↨↑↓→←∟↔▲▼ !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~⌂ÇüéâäàåçêëèïîìÄÅÉæÆôöòûùÿÖÜ¢£¥₧ƒáíóúñÑªº¿⌐¬½¼¡«»░▒▓│┤╡╢╖╕╣║╗╝╜╛┐└┴┬├─┼╞╟╚╔╩╦╠═╬╧╨╤╥╙╘╒╓╫╪┘┌█▄▌▐▀αßΓπΣσµτΦΘΩδ∞φε∩≡±≥≤⌠⌡÷≈°∙·√ⁿ²■ ";if(256!==M.length)throw Error("assertion failure");var k=null;function N(e){N=function(e){return Buffer.allocUnsafe(e)};try{return N(e)}catch(t){return(N=function(e){return new Buffer(e)})(e)}}function j(e,t){j=function(e,t){return Buffer.from(e,t)};try{return j(e,t)}catch(r){return(j=function(e,t){return new Buffer(e,t)})(e,t)}}function B(e,t){B=function(e,t){return e.includes(t)};try{return B(e,t)}catch(r){return(B=function(e,t){for(var r=0;r<=e.length-t.length;r++)for(var n=0;;n++){if(n===t.length)return!0;if(e[r+n]!==t[n])break}return!1})(e,t)}}},15330,e=>{"use strict";var t=e.i(747909),r=e.i(174017),n=e.i(996250),a=e.i(759756),i=e.i(561916),o=e.i(174677),s=e.i(869741),c=e.i(316795),d=e.i(487718),f=e.i(995169),l=e.i(47587),u=e.i(666012),p=e.i(570101),m=e.i(626937),h=e.i(10372),x=e.i(193695);e.i(52474);var b=e.i(600220),_=e.i(666680),E=e.i(469719),w=e.i(300959),g=e.i(364608),v=e.i(977775),y=e.i(843793),I=e.i(184883),S=e.i(28450),L=e.i(531789);function R(e){return(0,_.createHash)("sha256").update(e).digest("hex")}var O=e.i(637121);let A=E.z.string().uuid();function D(e){return Buffer.from(JSON.stringify(e,null,2)+"\n","utf8")}async function C(e){let t=[];return await new Promise((r,n)=>{e.on("data",e=>{"string"==typeof e?t.push(Buffer.from(e,"utf8")):e instanceof Uint8Array?t.push(Buffer.from(e)):t.push(Buffer.from(String(e),"utf8"))}),e.on("end",()=>r(Buffer.concat(t))),e.on("error",e=>n(e))})}async function F(e,{params:t}){let r,n,a,i,o,s,c,d=(0,y.getSql)(),{id:f}=await t;try{A.parse(f)}catch(e){return(0,w.apiZodError)(e)??(0,w.apiError)("invalid_input")}let l=new URL(e.url),u=(0,v.getActingUserId)(e)??l.searchParams.get("user_id"),p=(0,v.requireActingUserIdInProd)(u);if(p)return(0,w.apiError)(p);try{let e=await (0,I.retryOnceOnTransientDbError)(()=>(0,g.requireActiveUser)(d,u));if(e)return(0,w.apiError)(e);let t=await (0,I.retryOnceOnTransientDbError)(async()=>await d`
        SELECT
          id,
          buyer_user_id,
          seller_user_id,
          fiat_currency,
          crypto_asset,
          fiat_amount::text,
          crypto_amount::text,
          price::text,
          payment_method_label,
          payment_method_risk_class,
          status,
          reference_market_snapshot_id,
          fair_price_mid::text,
          fair_price_lower::text,
          fair_price_upper::text,
          fair_band_pct::text,
          fair_price_basis,
          price_deviation_pct::text,
          created_at
        FROM trade
        WHERE id = ${f}
        LIMIT 1
      `);if(0===t.length)return(0,w.apiError)("not_found");if(r=t[0],u&&!(0,v.isParty)(u,r))return(0,w.apiError)("not_party");n=await (0,I.retryOnceOnTransientDbError)(async()=>await d`
        SELECT id, from_status, to_status, actor_user_id, actor_type, reason_code, created_at
        FROM trade_state_transition
        WHERE trade_id = ${f}
        ORDER BY created_at ASC
      `),a=(await (0,I.retryOnceOnTransientDbError)(async()=>await d`
        SELECT id, score, version, factors_json, recommended_action, market_snapshot_id, created_at
        FROM risk_assessment
        WHERE trade_id = ${f}
        ORDER BY created_at DESC
        LIMIT 1
      `))[0]??null,i=await (0,I.retryOnceOnTransientDbError)(async()=>await d`
        SELECT id, submitted_by_user_id, type, storage_uri, sha256, metadata_json, created_at
        FROM evidence_object
        WHERE trade_id = ${f}
        ORDER BY created_at ASC
      `),s=(o=(await (0,I.retryOnceOnTransientDbError)(async()=>await d`
            SELECT id, trade_id, opened_by_user_id, reason_code, status, opened_at, resolved_at
            FROM dispute
            WHERE trade_id = ${f}
            LIMIT 1
          `))[0]??null)?await (0,I.retryOnceOnTransientDbError)(async()=>await d`
            SELECT id, dispute_id, decision, rationale, decided_by, created_at
            FROM dispute_decision
            WHERE dispute_id = ${o.id}
            ORDER BY created_at ASC
          `):[],c=r.reference_market_snapshot_id?(await (0,I.retryOnceOnTransientDbError)(async()=>await d`
              SELECT
                id,
                exchange,
                symbol,
                last::text,
                bid::text,
                ask::text,
                ts,
                raw_json,
                created_at
              FROM market_snapshot
              WHERE id = ${r.reference_market_snapshot_id}
              LIMIT 1
            `))[0]??null:null}catch(t){let e=(0,I.responseForDbError)("trades.proof_pack",t);if(e)return e;throw t}let m=[];m.push({path:"data/trade.json",data:D(r),mime:"application/json"}),m.push({path:"data/transitions.json",data:D(n),mime:"application/json"}),m.push({path:"data/risk_assessment_latest.json",data:D(a),mime:"application/json"}),m.push({path:"data/reference_market_snapshot.json",data:D(c),mime:"application/json"}),m.push({path:"data/evidence_objects.json",data:D(i),mime:"application/json"}),m.push({path:"data/dispute.json",data:D(o),mime:"application/json"}),m.push({path:"data/dispute_decisions.json",data:D(s),mime:"application/json"});let h=[],x=(0,L.getStorageBackend)();for(let e of i)try{let t=await x.get(e.storage_uri);if(!t){h.push({id:e.id,storage_uri:e.storage_uri,reason:"blob_not_found"});continue}let r=e.metadata_json,n=r&&"object"==typeof r&&"string"==typeof r.mime?r.mime:"application/octet-stream",a=e.storage_uri.split("/"),i=a.length>0?decodeURIComponent(a[a.length-1]):e.sha256,o=(0,S.sanitizeFilename)(i);m.push({path:`evidence/${e.sha256}/${o}`,data:t,mime:n})}catch(t){h.push({id:e.id,storage_uri:e.storage_uri,reason:t instanceof Error?t.message:"read_failed"})}h.length>0&&m.push({path:"data/evidence_missing.json",data:D(h),mime:"application/json"});let b=function(e){let t=Array.from(new Set(e.map(e=>"string"==typeof e?.type?e.type:"").filter(Boolean))).sort(),r=e.length;if(0===r)return{score:0,evidence_count:r,evidence_types:t,missing_recommendations:["upload a payment proof (receipt/bank_sms)","upload chat export"]};let n=0;(t.includes("receipt")||t.includes("bank_sms"))&&(n+=40),t.includes("chat_export")&&(n+=30),t.includes("screenshot")&&(n+=20),r>=2&&(n+=10),n=Math.max(0,Math.min(100,n));let a=[];return t.includes("receipt")||t.includes("bank_sms")||a.push("upload a payment proof (receipt/bank_sms)"),t.includes("chat_export")||a.push("upload chat export"),t.includes("screenshot")||a.push("upload screenshots"),{score:n,evidence_count:r,evidence_types:t,missing_recommendations:a}}(i.map(e=>({type:e.type,metadata_json:e.metadata_json}))),E=n.length>0?n[n.length-1]:null,F=new Set(["resolved","canceled"]).has(r.status)?r.status:null,T=s.length>0?s[s.length-1]:null,U={manifest_version:"proofpack.manifest.v1",generated_at:new Date().toISOString(),trade_id:f,includes:{trade:!0,transitions:!0,risk_assessment_latest:!0,reference_market_snapshot:!0,evidence_objects:!0,dispute:!0,dispute_decisions:!0,evidence_missing:h.length>0},files:[],summary:{trade:{status:r.status,terminal_status:F,latest_transition:E?{from_status:E.from_status,to_status:E.to_status,actor_user_id:E.actor_user_id,actor_type:E.actor_type,reason_code:E.reason_code,created_at:E.created_at}:null,latest_dispute_decision:T?{decision:T.decision,decided_by:T.decided_by,created_at:T.created_at}:null},risk_score:a?.score??null,recommended_action:a?.recommended_action??null,price_deviation_pct:r.price_deviation_pct??null,evidence_completeness:b,dispute:{status:o?.status??null,reason_code:o?.reason_code??null,opened_at:o?.opened_at??null,resolved_at:o?.resolved_at??null,decisions_count:s.length}}};for(let e of m)U.files.push({path:e.path,bytes:e.data.byteLength,sha256:R(e.data),mime:e.mime});let P=D(U);m.push({path:"manifest.json",data:P,mime:"application/json"});let z=R(P);m.push({path:"manifest.sha256",data:Buffer.from(`${z}  manifest.json
`,"utf8"),mime:"text/plain"});let M=process.env.PROOFPACK_SIGNING_PRIVATE_KEY_B64?Buffer.from(process.env.PROOFPACK_SIGNING_PRIVATE_KEY_B64,"base64").toString("utf8"):process.env.PROOFPACK_SIGNING_PRIVATE_KEY,k=M?.includes("\\n")?M.replace(/\\n/g,"\n"):M;if(k){let e=(0,_.createPrivateKey)(k),t=(0,_.createPublicKey)(e).export({type:"spki",format:"pem"}),r="string"==typeof t?t:t.toString("utf8"),n=R(Buffer.from(r,"utf8")),a=(0,_.sign)(null,Buffer.from(z,"utf8"),e);m.push({path:"public_key.pem",data:Buffer.from(r,"utf8"),mime:"application/x-pem-file"}),m.push({path:"signature.json",data:D({signature_version:"proofpack.signature.v0",status:"signed",algorithm:"ed25519",key_id:n,payload:{type:"manifest_sha256",value:z},signature_b64:a.toString("base64"),public_key_pem:r,public_key_pem_path:"public_key.pem",signed_at:new Date().toISOString()}),mime:"application/json"})}else m.push({path:"signature.json",data:D({signature_version:"proofpack.signature.v0",status:"unsigned",algorithm:null,key_id:null,payload:{type:"manifest_sha256",value:z},signature_b64:null,public_key_pem:null,public_key_pem_path:null,signed_at:null}),mime:"application/json"});let{zipStream:N}=function(e){let t=new O.default.ZipFile;for(let r of e)t.addBuffer(r.data,r.path);return t.end(),{zipStream:t.outputStream}}(m.map(e=>({path:e.path,data:e.data}))),j=await C(N);return new Response(j.buffer.slice(j.byteOffset,j.byteOffset+j.byteLength),{headers:{"Content-Type":"application/zip","Cache-Control":"no-store","X-Content-Type-Options":"nosniff"}})}e.s(["GET",()=>F,"runtime",0,"nodejs"],144339);var T=e.i(144339);let U=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/trades/[id]/proof-pack/route",pathname:"/api/trades/[id]/proof-pack",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/trades/[id]/proof-pack/route.ts",nextConfigOutput:"",userland:T}),{workAsyncStorage:P,workUnitAsyncStorage:z,serverHooks:M}=U;function k(){return(0,n.patchFetch)({workAsyncStorage:P,workUnitAsyncStorage:z})}async function N(e,t,n){U.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let _="/api/trades/[id]/proof-pack/route";_=_.replace(/\/index$/,"")||"/";let E=await U.prepare(e,t,{srcPage:_,multiZoneDraftMode:!1});if(!E)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:w,params:g,nextConfig:v,parsedUrl:y,isDraftMode:I,prerenderManifest:S,routerServerContext:L,isOnDemandRevalidate:R,revalidateOnlyGenerated:O,resolvedPathname:A,clientReferenceManifest:D,serverActionsManifest:C}=E,F=(0,s.normalizeAppPath)(_),T=!!(S.dynamicRoutes[F]||S.routes[A]),P=async()=>((null==L?void 0:L.render404)?await L.render404(e,t,y,!1):t.end("This page could not be found"),null);if(T&&!I){let e=!!S.routes[A],t=S.dynamicRoutes[F];if(t&&!1===t.fallback&&!e){if(v.experimental.adapterPath)return await P();throw new x.NoFallbackError}}let z=null;!T||U.isDev||I||(z="/index"===(z=A)?"/":z);let M=!0===U.isDev||!T,k=T&&!M;C&&D&&(0,o.setManifestsSingleton)({page:_,clientReferenceManifest:D,serverActionsManifest:C});let N=e.method||"GET",j=(0,i.getTracer)(),B=j.getActiveScopeSpan(),H={params:g,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!v.experimental.authInterrupts},cacheComponents:!!v.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:v.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n,a)=>U.onRequestError(e,t,n,a,L)},sharedContext:{buildId:w}},K=new c.NodeNextRequest(e),$=new c.NodeNextResponse(t),Z=d.NextRequestAdapter.fromNodeNextRequest(K,(0,d.signalFromNodeResponse)(t));try{let o=async e=>U.handle(Z,H).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=j.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==f.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${N} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${N} ${_}`)}),s=!!(0,a.getRequestMeta)(e,"minimalMode"),c=async a=>{var i,c;let d=async({previousCacheEntry:r})=>{try{if(!s&&R&&O&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await o(a);e.fetchMetrics=H.renderOpts.fetchMetrics;let c=H.renderOpts.pendingWaitUntil;c&&n.waitUntil&&(n.waitUntil(c),c=void 0);let d=H.renderOpts.collectedTags;if(!T)return await (0,u.sendResponse)(K,$,i,H.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(i.headers);d&&(t[h.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==H.renderOpts.collectedRevalidate&&!(H.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&H.renderOpts.collectedRevalidate,n=void 0===H.renderOpts.collectedExpire||H.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:H.renderOpts.collectedExpire;return{value:{kind:b.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==r?void 0:r.isStale)&&await U.onRequestError(e,t,{routerKind:"App Router",routePath:_,routeType:"route",revalidateReason:(0,l.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:R})},!1,L),t}},f=await U.handleResponse({req:e,nextConfig:v,cacheKey:z,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:R,revalidateOnlyGenerated:O,responseGenerator:d,waitUntil:n.waitUntil,isMinimalMode:s});if(!T)return null;if((null==f||null==(i=f.value)?void 0:i.kind)!==b.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==f||null==(c=f.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",R?"REVALIDATED":f.isMiss?"MISS":f.isStale?"STALE":"HIT"),I&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let x=(0,p.fromNodeOutgoingHttpHeaders)(f.value.headers);return s&&T||x.delete(h.NEXT_CACHE_TAGS_HEADER),!f.cacheControl||t.getHeader("Cache-Control")||x.get("Cache-Control")||x.set("Cache-Control",(0,m.getCacheControlHeader)(f.cacheControl)),await (0,u.sendResponse)(K,$,new Response(f.value.body,{headers:x,status:f.value.status||200})),null};B?await c(B):await j.withPropagatedContext(e.headers,()=>j.trace(f.BaseServerSpan.handleRequest,{spanName:`${N} ${_}`,kind:i.SpanKind.SERVER,attributes:{"http.method":N,"http.target":e.url}},c))}catch(t){if(t instanceof x.NoFallbackError||await U.onRequestError(e,t,{routerKind:"App Router",routePath:F,routeType:"route",revalidateReason:(0,l.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:R})},!1,L),T)throw t;return await (0,u.sendResponse)(K,$,new Response(null,{status:500})),null}}e.s(["handler",()=>N,"patchFetch",()=>k,"routeModule",()=>U,"serverHooks",()=>M,"workAsyncStorage",()=>P,"workUnitAsyncStorage",()=>z],15330)}];

//# sourceMappingURL=node_modules_d1199f27._.js.map