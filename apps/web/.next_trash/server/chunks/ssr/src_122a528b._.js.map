{"version":3,"sources":["../../../../src/lib/api/client.ts","../../../../src/app/status/StatusClient.tsx"],"sourcesContent":["export type ApiErrorPayload = {\r\n  error?: string;\r\n  message?: string;\r\n  details?: unknown;\r\n  _raw?: unknown;\r\n};\r\n\r\nexport class ApiError extends Error {\r\n  code: string;\r\n  details?: unknown;\r\n  status?: number;\r\n  requestId?: string;\r\n\r\n  constructor(code: string, opts?: { details?: unknown; status?: number; requestId?: string }) {\r\n    const msg = opts?.requestId ? `${code} (req ${opts.requestId})` : code;\r\n    super(msg);\r\n    this.name = \"ApiError\";\r\n    this.code = code;\r\n    this.details = opts?.details;\r\n    this.status = opts?.status;\r\n    this.requestId = opts?.requestId;\r\n  }\r\n}\r\n\r\nfunction safeJsonParse(text: string): unknown {\r\n  try {\r\n    return text ? JSON.parse(text) : null;\r\n  } catch {\r\n    return { _raw: text };\r\n  }\r\n}\r\n\r\nfunction looksLikeHtml(text: string): boolean {\r\n  const s = String(text ?? \"\").trimStart();\r\n  return s.startsWith(\"<!DOCTYPE html\") || s.startsWith(\"<html\") || s.startsWith(\"<!doctype html\");\r\n}\r\n\r\nfunction sleep(ms: number): Promise<void> {\r\n  return new Promise((r) => setTimeout(r, Math.max(0, Math.floor(ms))));\r\n}\r\n\r\nfunction getImpersonateUserIdFromLocation(): string | null {\r\n  if (typeof window === \"undefined\") return null;\r\n  try {\r\n    const v = new URL(window.location.href).searchParams.get(\"user_id\") ?? \"\";\r\n    const trimmed = v.trim();\r\n    return trimmed ? trimmed : null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction shouldAttachImpersonationHeader(input: RequestInfo | URL): boolean {\r\n  if (typeof window === \"undefined\") return false;\r\n\r\n  try {\r\n    const origin = window.location.origin;\r\n    const url =\r\n      typeof input === \"string\"\r\n        ? new URL(input, origin)\r\n        : input instanceof URL\r\n          ? input\r\n          : input instanceof Request\r\n            ? new URL(input.url)\r\n            : null;\r\n\r\n    if (!url) return false;\r\n    if (url.origin !== origin) return false;\r\n    return url.pathname.startsWith(\"/api/\");\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction getCsrfToken(): string | null {\r\n  if (typeof document === \"undefined\") return null;\r\n  const match = document.cookie.match(/(?:^|;\\s*)__csrf=([^;]+)/);\r\n  return match?.[1] ?? null;\r\n}\r\n\r\nexport async function fetchJsonOrThrow<T>(\r\n  input: RequestInfo | URL,\r\n  init?: RequestInit\r\n): Promise<T> {\r\n  const mergedInit: RequestInit | undefined = init\r\n    ? ({\r\n        ...init,\r\n        credentials: init.credentials ?? \"same-origin\",\r\n      } as RequestInit)\r\n    : ({ credentials: \"same-origin\" } as RequestInit);\r\n\r\n  // Attach CSRF double-submit token on mutating requests\r\n  const method = (mergedInit?.method ?? \"GET\").toUpperCase();\r\n\r\n  // Read-only admin view-as: on GET/HEAD requests to our own API, forward the\r\n  // `user_id` from the current page URL as `x-impersonate-user-id`.\r\n  if ((method === \"GET\" || method === \"HEAD\") && shouldAttachImpersonationHeader(input)) {\r\n    const desired = getImpersonateUserIdFromLocation();\r\n    if (desired) {\r\n      const headers = new Headers(mergedInit?.headers);\r\n      if (!headers.has(\"x-impersonate-user-id\")) {\r\n        headers.set(\"x-impersonate-user-id\", desired);\r\n      }\r\n      mergedInit!.headers = headers;\r\n    }\r\n  }\r\n\r\n  if ([\"POST\", \"PUT\", \"PATCH\", \"DELETE\"].includes(method)) {\r\n    const csrf = getCsrfToken();\r\n    if (csrf) {\r\n      const headers = new Headers(mergedInit?.headers);\r\n      if (!headers.has(\"x-csrf-token\")) {\r\n        headers.set(\"x-csrf-token\", csrf);\r\n      }\r\n      mergedInit!.headers = headers;\r\n    }\r\n  }\r\n\r\n  const method0 = (mergedInit?.method ?? \"GET\").toUpperCase();\r\n  const canRetry = method0 === \"GET\" || method0 === \"HEAD\";\r\n  const maxRetries = canRetry ? 2 : 0;\r\n\r\n  let lastErr: unknown = null;\r\n  for (let attempt = 0; attempt <= maxRetries; attempt += 1) {\r\n    try {\r\n      const res = await fetch(input, mergedInit);\r\n      const requestId = res.headers.get(\"x-request-id\") ?? undefined;\r\n\r\n      // Best-effort: remember the last request id so UI/support flows can display it.\r\n      try {\r\n        if (typeof window !== \"undefined\" && requestId) {\r\n          window.sessionStorage.setItem(\"ts.last_request_id\", requestId);\r\n        }\r\n      } catch {\r\n        // ignore\r\n      }\r\n\r\n      const text = await res.text().catch(() => \"\");\r\n      const contentType = res.headers.get(\"content-type\") ?? \"\";\r\n      const isHtml = contentType.includes(\"text/html\") || looksLikeHtml(text);\r\n      const json = (isHtml ? { _raw: \"<html/>\" } : safeJsonParse(text)) as ApiErrorPayload | unknown;\r\n\r\n      if (!res.ok) {\r\n        // Retry transient upstream errors for idempotent requests.\r\n        if (canRetry && (res.status === 502 || res.status === 503 || res.status === 504) && attempt < maxRetries) {\r\n          await sleep(250 * Math.pow(2, attempt));\r\n          continue;\r\n        }\r\n\r\n        if (json && typeof json === \"object\" && \"error\" in (json as ApiErrorPayload)) {\r\n          const payload = json as ApiErrorPayload;\r\n          const code = typeof payload.error === \"string\" ? payload.error : `http_${res.status}`;\r\n          const details =\r\n            payload.details !== undefined\r\n              ? payload.details\r\n              : typeof payload.message === \"string\"\r\n                ? payload.message\r\n                : isHtml\r\n                  ? { message: `Upstream error (HTTP ${res.status}). Please retry.` }\r\n                  : undefined;\r\n          throw new ApiError(code, { details, status: res.status, requestId });\r\n        }\r\n\r\n        if (json && typeof json === \"object\" && \"message\" in (json as ApiErrorPayload)) {\r\n          const payload = json as ApiErrorPayload;\r\n          const details = typeof payload.message === \"string\" ? payload.message : json;\r\n          throw new ApiError(`http_${res.status}`, { details, status: res.status, requestId });\r\n        }\r\n\r\n        const details = isHtml ? { message: `Upstream error (HTTP ${res.status}). Please retry.` } : json;\r\n        throw new ApiError(`http_${res.status}`, { details, status: res.status, requestId });\r\n      }\r\n\r\n      return json as T;\r\n    } catch (e) {\r\n      lastErr = e;\r\n      // Retry network errors on idempotent requests.\r\n      if (canRetry && attempt < maxRetries) {\r\n        await sleep(250 * Math.pow(2, attempt));\r\n        continue;\r\n      }\r\n      throw e;\r\n    }\r\n  }\r\n\r\n  throw lastErr;\r\n}\r\n","\"use client\";\r\n\r\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\r\nimport { fetchJsonOrThrow } from \"@/lib/api/client\";\r\n\r\ntype StatusPayload = {\r\n  ok: boolean;\r\n  overall: \"online\" | \"degraded\" | \"offline\";\r\n  db?: { ok?: boolean; latency_ms?: number | null };\r\n  outbox?: { open?: number; dead?: number; with_errors?: number };\r\n  email_outbox?: { pending?: number; failed?: number; oldest_pending_at?: string | null; oldest_age_min?: number | null };\r\n  ops_alerts?: { degraded_last_sent_at?: string | null };\r\n  expected_services?: Array<{ service: string; staleAfterMs: number }>;\r\n  stale_expected_services?: string[];\r\n  heartbeats?: Array<{ service: string; status: string; last_seen_at: string }>;\r\n  took_ms?: number;\r\n};\r\n\r\nfunction Badge({ text, variant }: { text: string; variant: \"green\" | \"red\" | \"amber\" | \"gray\" }) {\r\n  const cls =\r\n    variant === \"green\"\r\n      ? \"border-emerald-300 bg-emerald-50 text-emerald-900 dark:border-emerald-900/40 dark:bg-emerald-950/30 dark:text-emerald-200\"\r\n      : variant === \"amber\"\r\n        ? \"border-amber-300 bg-amber-50 text-amber-900 dark:border-amber-900/40 dark:bg-amber-950/30 dark:text-amber-200\"\r\n        : variant === \"red\"\r\n          ? \"border-rose-300 bg-rose-50 text-rose-900 dark:border-rose-900/40 dark:bg-rose-950/30 dark:text-rose-200\"\r\n          : \"border-[var(--border)] bg-[var(--bg)] text-[var(--muted)]\";\r\n  return (\r\n    <span className={`inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[10px] font-extrabold uppercase tracking-[0.18em] ${cls}`}>\r\n      <span className=\"h-1.5 w-1.5 rounded-full bg-current opacity-70\" />\r\n      {text}\r\n    </span>\r\n  );\r\n}\r\n\r\nexport function StatusClient() {\r\n  const [data, setData] = useState<StatusPayload | null>(null);\r\n  const [err, setErr] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const load = useCallback(async () => {\r\n    setLoading(true);\r\n    setErr(null);\r\n    try {\r\n      const d = await fetchJsonOrThrow<StatusPayload>(\"/api/status\", { cache: \"no-store\" });\r\n      setData(d);\r\n    } catch (e: any) {\r\n      setData(null);\r\n      setErr(e?.message ? String(e.message) : \"status_failed\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    load();\r\n    const t = setInterval(load, 30_000);\r\n    return () => clearInterval(t);\r\n  }, [load]);\r\n\r\n  const overallBadge = useMemo(() => {\r\n    const o = data?.overall ?? \"offline\";\r\n    if (o === \"online\") return <Badge text=\"Online\" variant=\"green\" />;\r\n    if (o === \"degraded\") return <Badge text=\"Degraded\" variant=\"amber\" />;\r\n    return <Badge text=\"Offline\" variant=\"red\" />;\r\n  }, [data?.overall]);\r\n\r\n  const heartbeats = useMemo(() => {\r\n    const items = Array.isArray(data?.heartbeats) ? data!.heartbeats! : [];\r\n    return items\r\n      .slice()\r\n      .sort((a, b) => String(a.service).localeCompare(String(b.service)))\r\n      .slice(0, 20);\r\n  }, [data]);\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"relative overflow-hidden rounded-2xl border border-[var(--border)] bg-[var(--card)] p-6\">\r\n        <div\r\n          className=\"pointer-events-none absolute inset-0 opacity-60\"\r\n          style={{\r\n            background:\r\n              \"radial-gradient(700px 260px at 20% 0%, color-mix(in oklab, var(--accent) 18%, transparent) 0%, transparent 60%), radial-gradient(440px 220px at 90% 10%, color-mix(in oklab, var(--accent-2) 12%, transparent) 0%, transparent 55%)\",\r\n          }}\r\n        />\r\n\r\n        <div className=\"relative flex flex-wrap items-start justify-between gap-4\">\r\n          <div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <div className=\"h-2.5 w-2.5 rounded-full bg-[var(--accent)]\" />\r\n              <h1 className=\"text-xl font-extrabold tracking-tight\">Status</h1>\r\n            </div>\r\n            <p className=\"mt-1 text-xs text-[var(--muted)]\">Live system snapshot (DB, outbox, and background jobs).</p>\r\n          </div>\r\n\r\n          <div className=\"flex items-center gap-2\">\r\n            {overallBadge}\r\n            <button\r\n              type=\"button\"\r\n              className=\"rounded-lg border border-[var(--border)] bg-[var(--bg)] px-3 py-2 text-[11px] font-semibold text-[var(--muted)] hover:text-[var(--foreground)] hover:bg-[var(--card-2)]\"\r\n              onClick={load}\r\n              disabled={loading}\r\n            >\r\n              refresh\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {err ? <div className=\"relative mt-3 text-[11px] text-[var(--down)]\">{err}</div> : null}\r\n        {loading && !data ? <div className=\"relative mt-3 text-[11px] text-[var(--muted)]\">Checking…</div> : null}\r\n\r\n        {data ? (\r\n          <div className=\"relative mt-4 grid grid-cols-1 gap-3 md:grid-cols-3 lg:grid-cols-6\">\r\n            <div className=\"rounded-xl border border-[var(--border)] bg-[var(--bg)] p-3\">\r\n              <div className=\"text-[10px] font-extrabold uppercase tracking-[0.22em] text-[var(--muted)]\">Database</div>\r\n              <div className=\"mt-2 text-sm font-semibold text-[var(--foreground)]\">\r\n                {data.db?.ok ? \"ok\" : \"down\"}\r\n                {typeof data.db?.latency_ms === \"number\" ? (\r\n                  <span className=\"ml-2 text-[11px] text-[var(--muted)]\">{data.db.latency_ms}ms</span>\r\n                ) : null}\r\n              </div>\r\n            </div>\r\n            <div className=\"rounded-xl border border-[var(--border)] bg-[var(--bg)] p-3\">\r\n              <div className=\"text-[10px] font-extrabold uppercase tracking-[0.22em] text-[var(--muted)]\">Outbox</div>\r\n              <div className=\"mt-2 text-[11px] text-[var(--muted)]\">\r\n                open <span className=\"text-[var(--foreground)] font-semibold\">{data.outbox?.open ?? 0}</span>\r\n                {\" · \"}dead <span className=\"text-[var(--foreground)] font-semibold\">{data.outbox?.dead ?? 0}</span>\r\n                {\" · \"}errors <span className=\"text-[var(--foreground)] font-semibold\">{data.outbox?.with_errors ?? 0}</span>\r\n              </div>\r\n            </div>\r\n            <div className=\"rounded-xl border border-[var(--border)] bg-[var(--bg)] p-3\">\r\n              <div className=\"text-[10px] font-extrabold uppercase tracking-[0.22em] text-[var(--muted)]\">Email Outbox</div>\r\n              <div className=\"mt-2 text-[11px] text-[var(--muted)]\">\r\n                pending <span className=\"text-[var(--foreground)] font-semibold\">{data.email_outbox?.pending ?? 0}</span>\r\n                {\" · \"}failed <span className=\"text-[var(--foreground)] font-semibold\">{data.email_outbox?.failed ?? 0}</span>\r\n                {data.email_outbox?.oldest_age_min != null ? (\r\n                  <div className=\"mt-1 text-[10px]\">\r\n                    oldest pending: <span className=\"text-[var(--foreground)] font-semibold\">{data.email_outbox.oldest_age_min}m</span>\r\n                  </div>\r\n                ) : null}\r\n              </div>\r\n            </div>\r\n            <div className=\"rounded-xl border border-[var(--border)] bg-[var(--bg)] p-3\">\r\n              <div className=\"text-[10px] font-extrabold uppercase tracking-[0.22em] text-[var(--muted)]\">Expected Jobs</div>\r\n              <div className=\"mt-2 text-[11px] text-[var(--muted)]\">\r\n                {Array.isArray(data.expected_services) && data.expected_services.length > 0 ? (\r\n                  <>\r\n                    {data.expected_services.length} configured\r\n                    <div className=\"mt-1 text-[10px]\">\r\n                      stale: {Array.isArray(data.stale_expected_services) && data.stale_expected_services.length ? (\r\n                        <span className=\"text-[var(--down)]\">{data.stale_expected_services.join(\", \")}</span>\r\n                      ) : (\r\n                        <span className=\"text-[var(--muted)]\">none</span>\r\n                      )}\r\n                    </div>\r\n                  </>\r\n                ) : (\r\n                  <span className=\"text-[var(--muted)]\">none configured</span>\r\n                )}\r\n              </div>\r\n            </div>\r\n            <div className=\"rounded-xl border border-[var(--border)] bg-[var(--bg)] p-3\">\r\n              <div className=\"text-[10px] font-extrabold uppercase tracking-[0.22em] text-[var(--muted)]\">Ops Alerts</div>\r\n              <div className=\"mt-2 text-[11px] text-[var(--muted)]\">\r\n                {data.ops_alerts?.degraded_last_sent_at ? (\r\n                  <>\r\n                    last sent\r\n                    <div className=\"mt-1 text-[10px] text-[var(--foreground)] font-semibold\">\r\n                      {new Date(String(data.ops_alerts.degraded_last_sent_at)).toLocaleString()}\r\n                    </div>\r\n                  </>\r\n                ) : (\r\n                  <span className=\"text-[var(--muted)]\">none yet</span>\r\n                )}\r\n              </div>\r\n            </div>\r\n            <div className=\"rounded-xl border border-[var(--border)] bg-[var(--bg)] p-3\">\r\n              <div className=\"text-[10px] font-extrabold uppercase tracking-[0.22em] text-[var(--muted)]\">Latency</div>\r\n              <div className=\"mt-2 text-[11px] text-[var(--muted)]\">\r\n                took <span className=\"text-[var(--foreground)] font-semibold\">{Math.max(0, Number(data.took_ms ?? 0))}ms</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ) : null}\r\n      </div>\r\n\r\n      <div className=\"rounded-2xl border border-[var(--border)] bg-[var(--card)] overflow-hidden\">\r\n        <div className=\"flex items-center justify-between gap-3 px-4 py-3\">\r\n          <div className=\"text-sm font-semibold text-[var(--foreground)]\">Heartbeats</div>\r\n          <div className=\"text-[11px] text-[var(--muted)]\">{heartbeats.length}</div>\r\n        </div>\r\n        <div className=\"border-t border-[var(--border)]\">\r\n          {heartbeats.length === 0 ? (\r\n            <div className=\"px-4 py-4 text-xs text-[var(--muted)]\">No heartbeats recorded yet.</div>\r\n          ) : (\r\n            <table className=\"w-full text-[11px]\">\r\n              <tbody>\r\n                {heartbeats.map((hb) => {\r\n                  const svc = String(hb.service);\r\n                  const status = String(hb.status ?? \"ok\");\r\n                  const variant = status === \"ok\" ? \"green\" : status === \"degraded\" ? \"amber\" : \"red\";\r\n                  const last = hb.last_seen_at ? new Date(String(hb.last_seen_at)).toLocaleString() : \"—\";\r\n                  return (\r\n                    <tr key={svc} className=\"border-b border-[var(--border)] last:border-b-0\">\r\n                      <td className=\"px-4 py-2 font-semibold text-[var(--foreground)]\">{svc}</td>\r\n                      <td className=\"px-4 py-2 text-right\">\r\n                        <Badge text={status} variant={variant as any} />\r\n                      </td>\r\n                      <td className=\"px-4 py-2 text-right text-[10px] text-[var(--muted)]\">{last}</td>\r\n                    </tr>\r\n                  );\r\n                })}\r\n              </tbody>\r\n            </table>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"text-[11px] text-[var(--muted)]\">\r\n        Tip: for operational monitoring, set expectations via env (e.g. `EXPECT_OUTBOX_WORKER=1`).\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}