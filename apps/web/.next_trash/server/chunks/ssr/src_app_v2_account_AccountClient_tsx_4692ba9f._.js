module.exports=[20852,a=>{"use strict";var b=a.i(187924),c=a.i(238246),d=a.i(572131);function e(a){let b=new Uint8Array(a),c="";for(let a of b)c+=String.fromCharCode(a);return btoa(c).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function f(a){let b=a.replace(/-/g,"+").replace(/_/g,"/"),c=(4-b.length%4)%4,d=atob(b.padEnd(b.length+c,"=")),e=new ArrayBuffer(d.length),f=new Uint8Array(e);for(let a=0;a<d.length;a++)f[a]=d.charCodeAt(a);return e}function g(){return h.stubThis(globalThis?.PublicKeyCredential!==void 0&&"function"==typeof globalThis.PublicKeyCredential)}let h={stubThis:a=>a};function i(a){let{id:b}=a;return{...a,id:f(b),transports:a.transports}}function j(a){return"localhost"===a||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(a)}class k extends Error{constructor({message:a,code:b,cause:c,name:d}){super(a,{cause:c}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=d??c.name,this.code=b}}let l=new class{constructor(){Object.defineProperty(this,"controller",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}createNewAbortSignal(){if(this.controller){let a=Error("Cancelling existing WebAuthn API call for new one");a.name="AbortError",this.controller.abort(a)}let a=new AbortController;return this.controller=a,a.signal}cancelCeremony(){if(this.controller){let a=Error("Manually cancelling existing WebAuthn API call");a.name="AbortError",this.controller.abort(a),this.controller=void 0}}},m=["cross-platform","platform"];function n(a){if(a&&!(0>m.indexOf(a)))return a}async function o(a){let b,c,d,h,m;!a.optionsJSON&&a.challenge&&(console.warn("startRegistration() was not called correctly. It will try to continue with the provided options, but this call should be refactored to use the expected call structure instead. See https://simplewebauthn.dev/docs/packages/browser#typeerror-cannot-read-properties-of-undefined-reading-challenge for more information."),a={optionsJSON:a});let{optionsJSON:o,useAutoRegister:q=!1}=a;if(!g())throw Error("WebAuthn is not supported in this browser");let r={...o,challenge:f(o.challenge),user:{...o.user,id:f(o.user.id)},excludeCredentials:o.excludeCredentials?.map(i)},s={};q&&(s.mediation="conditional"),s.publicKey=r,s.signal=l.createNewAbortSignal();try{b=await navigator.credentials.create(s)}catch(a){throw function({error:a,options:b}){let{publicKey:c}=b;if(!c)throw Error("options was missing required publicKey property");if("AbortError"===a.name){if(b.signal instanceof AbortSignal)return new k({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:a})}else if("ConstraintError"===a.name){if(c.authenticatorSelection?.requireResidentKey===!0)return new k({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:a});else if("conditional"===b.mediation&&c.authenticatorSelection?.userVerification==="required")return new k({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:a});else if(c.authenticatorSelection?.userVerification==="required")return new k({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:a})}else if("InvalidStateError"===a.name)return new k({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:a});else if("NotAllowedError"===a.name)return new k({message:a.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a});else if("NotSupportedError"===a.name)return new k(0===c.pubKeyCredParams.filter(a=>"public-key"===a.type).length?{message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:a}:{message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:a});else if("SecurityError"===a.name){let b=globalThis.location.hostname;if(!j(b))return new k({message:`${globalThis.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:a});if(c.rp.id!==b)return new k({message:`The RP ID "${c.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:a})}else if("TypeError"===a.name){if(c.user.id.byteLength<1||c.user.id.byteLength>64)return new k({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:a})}else if("UnknownError"===a.name)return new k({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:a});return a}({error:a,options:s})}if(!b)throw Error("Registration was not completed");let{id:t,rawId:u,response:v,type:w}=b;if("function"==typeof v.getTransports&&(d=v.getTransports()),"function"==typeof v.getPublicKeyAlgorithm)try{h=v.getPublicKeyAlgorithm()}catch(a){p("getPublicKeyAlgorithm()",a)}if("function"==typeof v.getPublicKey)try{let a=v.getPublicKey();null!==a&&(m=e(a))}catch(a){p("getPublicKey()",a)}if("function"==typeof v.getAuthenticatorData)try{c=e(v.getAuthenticatorData())}catch(a){p("getAuthenticatorData()",a)}return{id:t,rawId:e(u),response:{attestationObject:e(v.attestationObject),clientDataJSON:e(v.clientDataJSON),transports:d,publicKeyAlgorithm:h,publicKey:m,authenticatorData:c},type:w,clientExtensionResults:b.getClientExtensionResults(),authenticatorAttachment:n(b.authenticatorAttachment)}}function p(a,b){console.warn(`The browser extension that intercepted this WebAuthn API call incorrectly implemented ${a}. You should report this error to them.
`,b)}let q=a=>a;async function r(a){let b,c,d;!a.optionsJSON&&a.challenge&&(console.warn("startAuthentication() was not called correctly. It will try to continue with the provided options, but this call should be refactored to use the expected call structure instead. See https://simplewebauthn.dev/docs/packages/browser#typeerror-cannot-read-properties-of-undefined-reading-challenge for more information."),a={optionsJSON:a});let{optionsJSON:h,useBrowserAutofill:m=!1,verifyBrowserAutofillInput:o=!0}=a;if(!g())throw Error("WebAuthn is not supported in this browser");h.allowCredentials?.length!==0&&(b=h.allowCredentials?.map(i));let p={...h,challenge:f(h.challenge),allowCredentials:b},r={};if(m){if(!await function(){if(!g())return q(new Promise(a=>a(!1)));let a=globalThis.PublicKeyCredential;return a?.isConditionalMediationAvailable===void 0?q(new Promise(a=>a(!1))):q(a.isConditionalMediationAvailable())}())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete$='webauthn']").length<1&&o)throw Error('No <input> with "webauthn" as the only or last value in its `autocomplete` attribute was detected');r.mediation="conditional",p.allowCredentials=[]}r.publicKey=p,r.signal=l.createNewAbortSignal();try{c=await navigator.credentials.get(r)}catch(a){throw function({error:a,options:b}){let{publicKey:c}=b;if(!c)throw Error("options was missing required publicKey property");if("AbortError"===a.name){if(b.signal instanceof AbortSignal)return new k({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:a})}else if("NotAllowedError"===a.name)return new k({message:a.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a});else if("SecurityError"===a.name){let b=globalThis.location.hostname;if(!j(b))return new k({message:`${globalThis.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:a});if(c.rpId!==b)return new k({message:`The RP ID "${c.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:a})}else if("UnknownError"===a.name)return new k({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:a});return a}({error:a,options:r})}if(!c)throw Error("Authentication was not completed");let{id:s,rawId:t,response:u,type:v}=c;return u.userHandle&&(d=e(u.userHandle)),{id:s,rawId:e(t),response:{authenticatorData:e(u.authenticatorData),clientDataJSON:e(u.clientDataJSON),signature:e(u.signature),userHandle:d},type:v,clientExtensionResults:c.getClientExtensionResults(),authenticatorAttachment:n(c.authenticatorAttachment)}}var s=a.i(556836),t=a.i(214373),u=a.i(56773),v=a.i(825683),w=a.i(782691);function x(a,b){if(!a||"object"!=typeof a)return b;let c=a.message,d=a.error;return"string"==typeof c&&c.trim()?c:"string"==typeof d&&d.trim()?d:b}function y(a){let b=Math.max(0,Math.min(1439,Math.trunc(a))),c=Math.floor(b/60);return`${String(c).padStart(2,"0")}:${String(b%60).padStart(2,"0")}`}function z(a){let b=String(a||"").trim(),c=/^([01]\d|2[0-3]):([0-5]\d)$/.exec(b);return c?60*Number(c[1])+Number(c[2]):0}function A(a){let b=String(a||"").replaceAll("_"," ").trim();return b?b[0].toUpperCase()+b.slice(1):"—"}function B(a,c,d){return(0,b.jsx)("span",{className:"inline-flex items-center rounded-full border px-2 py-0.5 text-[11px] font-semibold "+(a?"border-[var(--v2-border)] bg-[var(--up-bg)] text-[var(--up)]":"border-[var(--v2-border)] bg-[var(--v2-surface-2)] text-[var(--v2-muted)]"),children:a?c:d})}function C(a,c,d){return(0,b.jsx)("span",{className:"inline-flex items-center rounded-full border px-2 py-0.5 text-[11px] font-semibold "+(a?"border-[var(--v2-border)] bg-[var(--up-bg)] text-[var(--up)]":"border-[var(--v2-border)] bg-[var(--v2-surface-2)] text-[var(--v2-muted)]"),children:a?c:d})}function D(){let[a,e]=(0,d.useState)(!0),[f,g]=(0,d.useState)(!1),[h,i]=(0,d.useState)(null),[j,k]=(0,d.useState)({kind:"idle"}),[l,m]=(0,d.useState)(null),[n,p]=(0,d.useState)(null),[q,D]=(0,d.useState)(0),[E,F]=(0,d.useState)([]),[G,H]=(0,d.useState)(!1),[I,J]=(0,d.useState)(!1),[K,L]=(0,d.useState)(!1),[M,N]=(0,d.useState)({kind:"idle"}),[O,P]=(0,d.useState)(!1),[Q,R]=(0,d.useState)("idle"),[S,T]=(0,d.useState)(""),[U,V]=(0,d.useState)(""),[W,X]=(0,d.useState)(""),[Y,Z]=(0,d.useState)(""),[$,_]=(0,d.useState)([]),[aa,ab]=(0,d.useState)(null),[ac,ad]=(0,d.useState)({kind:"idle"}),[ae,af]=(0,d.useState)(!1),[ag,ah]=(0,d.useState)(""),[ai,aj]=(0,d.useState)(""),[ak,al]=(0,d.useState)(""),[am,an]=(0,d.useState)(""),[ao,ap]=(0,d.useState)(!1),[aq,ar]=(0,d.useState)({kind:"idle"}),[as,at]=(0,d.useState)(!1),[au,av]=(0,d.useState)({kind:"idle"}),[aw,ax]=(0,d.useState)(null),[ay,az]=(0,d.useState)(null),[aA,aB]=(0,d.useState)(!1),[aC,aD]=(0,d.useState)("passport"),[aE,aF]=(0,d.useState)(null),[aG,aH]=(0,d.useState)(null),[aI,aJ]=(0,d.useState)(null),[aK,aL]=(0,d.useState)(!1),[aM,aN]=(0,d.useState)({kind:"idle"}),[aO,aP]=(0,d.useState)(null),[aQ,aR]=(0,d.useState)([]),[aS,aT]=(0,d.useState)(null),[aU,aV]=(0,d.useState)(null),[aW,aX]=(0,d.useState)(!1),[aY,aZ]=(0,d.useState)(!1),[a$,a_]=(0,d.useState)(null),[a0,a1]=(0,d.useState)({kind:"idle"}),[a2,a3]=(0,d.useState)(!1),[a4,a5]=(0,d.useState)(!1),[a6,a7]=(0,d.useState)(null),[a8,a9]=(0,d.useState)([]),[ba,bb]=(0,d.useState)(0),bc=async()=>{i(null),az(null),aV(null);try{let a=await fetch("/api/account/profile",{cache:"no-store",credentials:"include"});if(!a.ok){g(!1),p(null),D(0),ax(null),aP(null),aT(null);return}let b=await a.json().catch(()=>null);if(!b?.user?.id){g(!1),p(null),D(0);return}g(!0),p(b.user),k({kind:"idle"});let c=await fetch("/api/account/passkeys",{cache:"no-store",credentials:"include"}).catch(()=>null);if(c&&c.ok){let a=await c.json().catch(()=>null),b=Array.isArray(a?.passkeys)?a.passkeys:[];F(b),D(b.length)}else F([]),D(0);let d=await fetch("/api/account/kyc",{cache:"no-store",credentials:"include"}).catch(()=>null);if(d&&d.ok){let a=await d.json().catch(()=>null);a&&"string"==typeof a.kyc_level&&Array.isArray(a.submissions)?ax(a):ax(null)}else ax(null),d&&"number"==typeof d.status&&az(`KYC unavailable (HTTP ${d.status}).`);let[e,f]=await Promise.all([fetch("/api/account/notification-preferences",{cache:"no-store",credentials:"include"}).catch(()=>null),fetch("/api/account/notification-schedule",{cache:"no-store",credentials:"include"}).catch(()=>null)]);if(e&&e.ok){let a=await e.json().catch(()=>null);a&&a.prefs&&"object"==typeof a.prefs?(aP(a.prefs),aR(Array.isArray(a.known_types)?a.known_types.map(String):[])):aP(null)}else aP(null),e&&"number"==typeof e.status&&aV(`Notifications unavailable (HTTP ${e.status}).`);if(f&&f.ok){let a=await f.json().catch(()=>null);a?.schedule?aT(a.schedule):aT(null)}else aT(null);let h=await fetch("/api/notifications?limit=1",{cache:"no-store",credentials:"include"}).catch(()=>null);if(h&&h.ok){let a=await h.json().catch(()=>null);a&&"number"==typeof a.unread_count&&bb(a.unread_count)}}catch(a){i(a instanceof Error?a.message:String(a))}finally{e(!1)}},bd=async()=>{a7(null),a5(!0);try{let a=await fetch("/api/notifications?limit=50",{cache:"no-store",credentials:"include"}),b=await a.json().catch(()=>null);if(!a.ok){let c=b?.message||b?.error;throw Error("string"==typeof c&&c.length?c:`http_${a.status}`)}a9(Array.isArray(b?.notifications)?b.notifications:[]),bb("number"==typeof b?.unread_count?b.unread_count:0)}catch(a){a7(a instanceof Error?a.message:String(a))}finally{a5(!1)}},be=async()=>{a7(null);try{await fetch("/api/notifications",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({mark_all_read:!0})})}finally{await bd()}},bf=async a=>{if(a){a7(null);try{await fetch("/api/notifications",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({ids:[a]})})}finally{a9(b=>b.map(b=>b.id===a?{...b,is_read:!0}:b)),bb(a=>Math.max(0,a-1)),bd()}}},bg=(a,b)=>{aP(c=>{if(!c)return c;let d=c[a]??{in_app:!0,email:!1};return{...c,[a]:{...d,...b}}})},bh=async()=>{if(aO){a1({kind:"idle"}),a_("prefs");try{let a=await fetch("/api/account/notification-preferences",{method:"PUT",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({prefs:aO})}),b=await a.json().catch(()=>null);if(!a.ok){let c=b?.message||b?.error;a1({kind:"error",message:"string"==typeof c&&c.length?c:`Failed (HTTP ${a.status}).`});return}a1({kind:"ok",message:"Preferences saved."}),aX(!1)}catch(a){a1({kind:"error",message:a instanceof Error?a.message:String(a)})}finally{a_(null)}}},bi=async()=>{if(aS){a1({kind:"idle"}),a_("schedule");try{let a=await fetch("/api/account/notification-schedule",{method:"PUT",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({quiet_enabled:!!aS.quiet_enabled,quiet_start_min:Math.max(0,Math.min(1439,Math.trunc(aS.quiet_start_min))),quiet_end_min:Math.max(0,Math.min(1439,Math.trunc(aS.quiet_end_min))),tz_offset_min:Math.max(-840,Math.min(840,Math.trunc(aS.tz_offset_min))),digest_enabled:!!aS.digest_enabled})}),b=await a.json().catch(()=>null);if(!a.ok){let c=b?.message||b?.error;a1({kind:"error",message:"string"==typeof c&&c.length?c:`Failed (HTTP ${a.status}).`});return}a1({kind:"ok",message:"Schedule saved."}),aZ(!1),await bc()}catch(a){a1({kind:"error",message:a instanceof Error?a.message:String(a)})}finally{a_(null)}}},bj=a=>new Promise((b,c)=>{let d=new FileReader;d.onerror=()=>c(Error("file_read_failed")),d.onload=()=>b(String(d.result??"")),d.readAsDataURL(a)}),bk=async()=>{if(aN({kind:"idle"}),!aE)return void aN({kind:"error",message:"Front image is required."});if(aE.size>9e5||aG&&aG.size>9e5||aI&&aI.size>9e5)return void aN({kind:"error",message:"Image too large. Use smaller files (≤ 900KB each)."});aL(!0);try{let a=await bj(aE),b=aG?await bj(aG):void 0,c=aI?await bj(aI):void 0,d=await fetch("/api/account/kyc",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({action:"submit_documents",document_type:aC,document_front:a,document_back:b,selfie:c})}),e=await d.json().catch(()=>null);if(!d.ok){let a=e?.details?.message||e?.message||e?.error;aN({kind:"error",message:"string"==typeof a&&a.length?a:`Failed (HTTP ${d.status}).`});return}aN({kind:"ok",message:String(e?.message??"Documents submitted")}),aF(null),aH(null),aJ(null),aB(!1),await bc()}catch(a){aN({kind:"error",message:a instanceof Error?a.message:String(a)})}finally{aL(!1)}};(0,d.useEffect)(()=>{bc()},[]),(0,d.useEffect)(()=>{H(!1)},[]);let bl=async()=>{try{let a=await fetch("/api/account/passkeys",{cache:"no-store",credentials:"include"});if(!a.ok)return;let b=await a.json().catch(()=>null),c=Array.isArray(b?.passkeys)?b.passkeys:[];F(c),D(c.length)}catch{}},bm=async()=>{if(N({kind:"idle"}),!G)return void N({kind:"error",message:"Passkeys aren’t supported in this browser/device."});let a=(window.prompt("Name this passkey (optional)","This device")??"").trim();L(!0);try{let b=await fetch("/api/account/passkeys/register/options",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify(a?{name:a}:{})}),c=await b.json().catch(()=>({}));if(!b.ok)return void N({kind:"error",message:x(c,"Failed to start passkey registration")});let d=c?.options;if(!d)return void N({kind:"error",message:"Invalid passkey registration options"});let e=await o(d),f=await fetch("/api/account/passkeys/register/verify",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({name:a||void 0,response:e})}),g=await f.json().catch(()=>({}));if(!f.ok)return void N({kind:"error",message:x(g,"Passkey verification failed")});N({kind:"ok",message:"Passkey added."}),await bl(),await bc()}catch(a){N({kind:"error",message:a instanceof Error?a.message:"Passkey registration canceled"})}finally{L(!1)}},bn=async()=>{if(N({kind:"idle"}),!G)return void N({kind:"error",message:"Passkeys aren’t supported in this browser/device."});L(!0);try{let a=await fetch("/api/account/passkeys/authenticate/options",{method:"POST",credentials:"include"}),b=await a.json().catch(()=>({}));if(!a.ok)return void N({kind:"error",message:x(b,"Failed to start passkey confirmation")});let c=b?.options;if(!c)return void N({kind:"error",message:"Invalid passkey authentication options"});let d=await r(c),e=await fetch("/api/account/passkeys/authenticate/verify",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({response:d})}),f=await e.json().catch(()=>({}));if(!e.ok)return void N({kind:"error",message:x(f,"Passkey verification failed")});N({kind:"ok",message:"Passkey confirmed (valid for a few minutes)."}),await bl(),await bc()}catch(a){N({kind:"error",message:a instanceof Error?a.message:"Passkey confirmation canceled"})}finally{L(!1)}},bo=async()=>{ad({kind:"idle"}),ab("setup");try{let a=await fetch("/api/account/totp/setup",{method:"POST",credentials:"include"}),b=await a.json().catch(()=>({}));if(!a.ok)return void ad({kind:"error",message:x(b,"Setup failed")});T(String(b?.secret??"")),V(String(b?.uri??"")),R("setup")}catch(a){ad({kind:"error",message:a instanceof Error?a.message:"Network error"})}finally{ab(null)}},bp=async()=>{ad({kind:"idle"}),ab("enable");try{let a=await fetch("/api/account/totp/enable",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({code:W})}),b=await a.json().catch(()=>({}));if(!a.ok){let a=b?.error==="invalid_totp_code"?"Invalid code — try again":x(b,"Failed");ad({kind:"error",message:a});return}_(Array.isArray(b?.backup_codes)?b.backup_codes.map(String):[]),R("backup"),X(""),ad({kind:"ok",message:"2FA enabled."}),await bc()}catch(a){ad({kind:"error",message:a instanceof Error?a.message:"Network error"})}finally{ab(null)}},bq=async()=>{ad({kind:"idle"}),ab("disable");try{let a=await fetch("/api/account/totp/disable",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({code:Y})}),b=await a.json().catch(()=>({}));if(!a.ok){let a=b?.error==="invalid_totp_code"?"Invalid code":x(b,"Failed");ad({kind:"error",message:a});return}Z(""),T(""),V(""),_([]),R("idle"),ad({kind:"ok",message:"2FA disabled."}),await bc()}catch(a){ad({kind:"error",message:a instanceof Error?a.message:"Network error"})}finally{ab(null)}},br=async a=>{let b=String(a||"").trim();if(b)try{await navigator.clipboard.writeText(b)}catch{}},bs=async()=>{if(ar({kind:"idle"}),ai.length<8)return void ar({kind:"error",message:"New password must be at least 8 characters."});if(ai!==ak)return void ar({kind:"error",message:"Passwords do not match."});ap(!0);try{let a={currentPassword:ag,newPassword:ai};6===String(am||"").trim().length&&(a.totp_code=am);let b=await fetch("/api/account/password",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify(a)}),c=await b.json().catch(()=>({}));if(!b.ok){let a=c?.error==="invalid_current_password"?"Current password is incorrect":c?.error==="totp_required"?"Enter your 2FA code":c?.error==="invalid_totp_code"?"Invalid 2FA code":x(c,"Failed to update password");ar({kind:"error",message:a});return}ar({kind:"ok",message:"Password updated."}),ah(""),aj(""),al(""),an("")}catch(a){ar({kind:"error",message:a instanceof Error?a.message:"Network error"})}finally{ap(!1)}},bt=async()=>{if(!as&&(av({kind:"idle"}),window.confirm("Log out all devices? You will be signed out everywhere."))){at(!0);try{let a=await fetch("/api/account/sessions/logout-all",{method:"POST",credentials:"include"}),b=await a.json().catch(()=>({}));if(!a.ok)return void av({kind:"error",message:x(b,"Failed to log out all devices")});av({kind:"ok",message:"Logged out on all devices."}),window.location.href="/login"}catch(a){av({kind:"error",message:a instanceof Error?a.message:"Network error"})}finally{at(!1)}}},bu=(0,d.useMemo)(()=>{if(!n)return"Account";let a=String(n.email??"").trim();return a||(n.display_name?String(n.display_name):"Account")},[n]),bv=async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}finally{window.location.href="/v2"}},bw=async()=>{k({kind:"idle"}),m("resend_email");try{let a=await fetch("/api/account/verify-email",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({action:"resend"})}),b=await a.json().catch(()=>null);if(!a.ok){let c=b?.details?.message||b?.message||b?.error;k({kind:"error",message:"string"==typeof c&&c.length?c:`Failed (HTTP ${a.status}).`});return}k({kind:"ok",message:String(b?.message??"Verification email sent")})}catch(a){k({kind:"error",message:a instanceof Error?a.message:String(a)})}finally{m(null)}},bx=async()=>{k({kind:"idle"}),m("upgrade_kyc");try{let a=await fetch("/api/account/kyc",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({action:"upgrade"})}),b=await a.json().catch(()=>null);if(!a.ok){let c=b?.details?.message||b?.message||b?.error;k({kind:"error",message:"string"==typeof c&&c.length?c:`Failed (HTTP ${a.status}).`});return}k({kind:"ok",message:`KYC upgraded to ${String(b?.kyc_level??"basic")}.`}),await bc()}catch(a){k({kind:"error",message:a instanceof Error?a.message:String(a)})}finally{m(null)}};return(0,b.jsxs)("main",{className:"space-y-4",children:[(0,b.jsxs)("header",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-[11px] font-bold uppercase tracking-widest text-[var(--v2-muted)]",children:"Account"}),(0,b.jsx)("h1",{className:"text-2xl font-extrabold tracking-tight",children:bu}),(0,b.jsx)("p",{className:"text-sm text-[var(--v2-muted)]",children:"Security & verification status."})]}),h?(0,b.jsxs)(t.V2Card,{children:[(0,b.jsx)(t.V2CardHeader,{title:"Account unavailable",subtitle:"Try again"}),(0,b.jsxs)(t.V2CardBody,{children:[(0,b.jsx)("div",{className:"text-sm text-[var(--v2-muted)]",children:h}),(0,b.jsx)("div",{className:"mt-3",children:(0,b.jsx)(s.V2Button,{variant:"primary",fullWidth:!0,onClick:()=>void bc(),children:"Retry"})})]})]}):null,(0,b.jsxs)(t.V2Card,{children:[(0,b.jsx)(t.V2CardHeader,{title:"Session",subtitle:"Signed-in status"}),(0,b.jsx)(t.V2CardBody,{children:a?(0,b.jsx)(w.V2Skeleton,{className:"h-14"}):f&&n?(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[C(n.email_verified,"Email verified","Email unverified"),C(n.totp_enabled,"2FA on","2FA off"),C(q>0,`Passkeys ${q}`,"No passkeys"),C("full"===n.kyc_level,"KYC full",`KYC ${n.kyc_level}`)]}),"ok"===j.kind?(0,b.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--up-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--up)]",children:j.message}):"error"===j.kind?(0,b.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--down-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--down)]",children:j.message}):null,n.email_verified?null:(0,b.jsx)(s.V2Button,{variant:"primary",fullWidth:!0,disabled:null!==l,onClick:()=>void bw(),children:"resend_email"===l?"Sending…":"Resend verification email"}),n.email_verified&&"none"===n.kyc_level?(0,b.jsx)(s.V2Button,{variant:"secondary",fullWidth:!0,disabled:null!==l,onClick:()=>void bx(),children:"upgrade_kyc"===l?"Upgrading…":"Upgrade KYC to Basic"}):null,(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsx)(s.V2Button,{variant:"secondary",fullWidth:!0,onClick:()=>{N({kind:"idle"}),J(!0),bl()},children:"Passkeys"}),(0,b.jsx)(s.V2Button,{variant:"secondary",fullWidth:!0,onClick:()=>{ad({kind:"idle"}),R("idle"),T(""),V(""),_([]),X(""),Z(""),P(!0)},children:"2FA (TOTP)"}),(0,b.jsx)(s.V2Button,{variant:"secondary",fullWidth:!0,onClick:()=>{ar({kind:"idle"}),af(!0)},children:"Change password"}),(0,b.jsx)(s.V2Button,{variant:"secondary",fullWidth:!0,disabled:as,onClick:()=>void bt(),children:as?"Working…":"Log out all"})]}),"error"===au.kind?(0,b.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--down-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--down)]",children:au.message}):null,(0,b.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:"Verification"}),(0,b.jsxs)("div",{className:"mt-1 text-[12px] text-[var(--v2-muted)]",children:["KYC: ",(0,b.jsx)("span",{className:"font-semibold text-[var(--v2-text)]",children:String(aw?.kyc_level??n.kyc_level)}),aw?.submissions?.[0]?.status?(0,b.jsxs)("span",{className:"ml-2",children:["• latest ",String(aw.submissions[0].status).replaceAll("_"," ")]}):null]}),ay?(0,b.jsx)("div",{className:"mt-1 text-[12px] text-[var(--v2-muted)]",children:ay}):null,aw?.submissions?.[0]?.rejection_reason?(0,b.jsxs)("div",{className:"mt-1 text-[12px] font-semibold text-[var(--down)]",children:["Rejected: ",aw.submissions[0].rejection_reason]}):null]}),n.email_verified&&"basic"===String(aw?.kyc_level??n.kyc_level)?(0,b.jsx)("div",{className:"shrink-0",children:(0,b.jsx)(s.V2Button,{variant:"secondary",onClick:()=>{aN({kind:"idle"}),aB(!0)},children:"Submit docs"})}):null]})}),(0,b.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:"Notifications"}),(0,b.jsxs)("div",{className:"mt-1 flex flex-wrap items-center gap-2",children:[B(!!aS?.quiet_enabled,"Quiet hours on","Quiet hours off"),B(!!aS?.digest_enabled,"Digest on","Digest off"),B(Object.values(aO??{}).some(a=>a.email),"Email enabled","Email off"),ba>0?(0,b.jsxs)("span",{className:"inline-flex items-center rounded-full border border-[var(--v2-border)] bg-[var(--warn-bg)] px-2 py-0.5 text-[11px] font-semibold text-[var(--warn)]",children:[ba," unread"]}):null]}),aU?(0,b.jsx)("div",{className:"mt-1 text-[12px] text-[var(--v2-muted)]",children:aU}):null]}),(0,b.jsxs)("div",{className:"shrink-0 grid gap-2",children:[(0,b.jsx)(s.V2Button,{variant:"secondary",size:"sm",onClick:()=>{a7(null),a3(!0),bd()},children:"Inbox"}),(0,b.jsx)(s.V2Button,{variant:"secondary",size:"sm",onClick:()=>{a1({kind:"idle"}),aZ(!0)},children:"Schedule"}),(0,b.jsx)(s.V2Button,{variant:"secondary",size:"sm",onClick:()=>{a1({kind:"idle"}),aX(!0)},children:"Preferences"})]})]})}),(0,b.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:"P2P"}),(0,b.jsx)("div",{className:"mt-1 text-[12px] text-[var(--v2-muted)]",children:"Escrow-backed marketplace and order chat."})]}),(0,b.jsxs)("div",{className:"shrink-0 grid gap-2",children:[(0,b.jsx)(c.default,{href:"/v2/p2p",className:(0,s.v2ButtonClassName)({variant:"secondary",size:"sm"}),children:"Marketplace"}),(0,b.jsx)(c.default,{href:"/v2/p2p/orders",className:(0,s.v2ButtonClassName)({variant:"secondary",size:"sm"}),children:"My orders"})]})]})}),(0,b.jsx)(s.V2Button,{variant:"primary",fullWidth:!0,onClick:()=>void bv(),children:"Sign out"})]}):(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("div",{className:"text-sm text-[var(--v2-muted)]",children:"You’re not signed in."}),(0,b.jsx)(c.default,{href:"/login",className:(0,s.v2ButtonClassName)({variant:"primary",fullWidth:!0}),children:"Sign in"})]})})]}),(0,b.jsx)(v.V2Sheet,{open:I,title:"Passkeys",onClose:()=>J(!1),children:(0,b.jsxs)("div",{className:"grid gap-3",children:[(0,b.jsx)("div",{className:"text-[12px] text-[var(--v2-muted)]",children:"Use a device passkey (biometrics / screen lock) for stronger security."}),"error"===M.kind?(0,b.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--down-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--down)]",children:M.message}):"ok"===M.kind?(0,b.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--up-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--up)]",children:M.message}):null,G?(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsx)(s.V2Button,{variant:"primary",fullWidth:!0,disabled:K,onClick:()=>void bm(),children:K?"Working…":"Add passkey"}),(0,b.jsx)(s.V2Button,{variant:"secondary",fullWidth:!0,disabled:K||0===E.length,onClick:()=>void bn(),children:"Confirm"})]}):(0,b.jsx)("div",{className:"text-[13px] text-[var(--v2-muted)]",children:"Passkeys aren’t available in this browser/device."}),(0,b.jsxs)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]",children:[(0,b.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:"Enrolled passkeys"}),0===E.length?(0,b.jsx)("div",{className:"mt-1 text-[12px] text-[var(--v2-muted)]",children:"No passkeys yet."}):(0,b.jsx)("div",{className:"mt-2 grid gap-2",children:E.map(a=>(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:a.name??"Passkey"}),(0,b.jsxs)("div",{className:"mt-0.5 text-[11px] text-[var(--v2-muted)]",children:["Added ",new Date(a.created_at).toLocaleDateString()]})]}),(0,b.jsx)("div",{className:"shrink-0 text-[11px] text-[var(--v2-muted)]",children:a.last_used_at?`Last used ${new Date(a.last_used_at).toLocaleDateString()}`:"Not used yet"})]},a.id))})]})]})}),(0,b.jsx)(v.V2Sheet,{open:O,title:"Two-factor authentication (2FA)",onClose:()=>P(!1),children:(0,b.jsxs)("div",{className:"grid gap-3",children:[(0,b.jsx)("div",{className:"text-[12px] text-[var(--v2-muted)]",children:"Protect your account with a 6‑digit code from an authenticator app."}),"error"===ac.kind?(0,b.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--down-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--down)]",children:ac.message}):"ok"===ac.kind?(0,b.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--up-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--up)]",children:ac.message}):null,n?.totp_enabled&&"backup"!==Q?(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:"2FA is enabled"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsx)(u.V2Input,{value:Y,onChange:a=>Z(a.target.value.replace(/\D/g,"").slice(0,6)),inputMode:"numeric",maxLength:6,placeholder:"000000",className:"font-mono tracking-[0.2em]",autoComplete:"one-time-code"}),(0,b.jsx)(s.V2Button,{variant:"secondary",fullWidth:!0,disabled:null!==aa||6!==Y.length,onClick:()=>void bq(),children:"disable"===aa?"Disabling…":"Disable"})]}),(0,b.jsx)("div",{className:"text-[11px] text-[var(--v2-muted)]",children:"Enter a current code to disable 2FA."})]}):"idle"===Q?(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:"2FA is off"}),(0,b.jsx)(s.V2Button,{variant:"primary",fullWidth:!0,disabled:null!==aa,onClick:()=>void bo(),children:"setup"===aa?"Setting up…":"Enable 2FA"})]}):"setup"===Q?(0,b.jsxs)("div",{className:"grid gap-3",children:[(0,b.jsxs)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]",children:[(0,b.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:"Setup key"}),(0,b.jsx)("div",{className:"mt-1 break-all rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface-2)] px-3 py-2 font-mono text-[12px] text-[var(--v2-text)]",children:S||"—"}),(0,b.jsxs)("div",{className:"mt-2 grid grid-cols-2 gap-2",children:[(0,b.jsx)(s.V2Button,{variant:"secondary",fullWidth:!0,onClick:()=>void br(S),children:"Copy key"}),(0,b.jsx)(s.V2Button,{variant:"secondary",fullWidth:!0,onClick:()=>void br(U),children:"Copy URI"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsx)(u.V2Input,{value:W,onChange:a=>X(a.target.value.replace(/\D/g,"").slice(0,6)),inputMode:"numeric",maxLength:6,placeholder:"000000",className:"font-mono tracking-[0.2em]",autoComplete:"one-time-code"}),(0,b.jsx)(s.V2Button,{variant:"primary",fullWidth:!0,disabled:null!==aa||6!==W.length,onClick:()=>void bp(),children:"enable"===aa?"Verifying…":"Verify"})]}),(0,b.jsx)(s.V2Button,{variant:"secondary",fullWidth:!0,disabled:null!==aa,onClick:()=>{R("idle"),ad({kind:"idle"})},children:"Cancel"})]}):"backup"===Q?(0,b.jsxs)("div",{className:"grid gap-3",children:[(0,b.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:"Save your backup codes"}),(0,b.jsx)("div",{className:"text-[12px] text-[var(--v2-muted)]",children:"Store these safely. Each code can be used once if you lose your authenticator."}),(0,b.jsx)("div",{className:"grid grid-cols-2 gap-2",children:$.slice(0,12).map((a,c)=>(0,b.jsx)("div",{className:"rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-2 text-center font-mono text-[12px] text-[var(--v2-text)]",children:a},c))}),(0,b.jsx)(s.V2Button,{variant:"primary",fullWidth:!0,onClick:()=>{R("idle"),P(!1)},children:"I’ve saved them"})]}):null]})}),(0,b.jsx)(v.V2Sheet,{open:ae,title:"Change password",onClose:()=>af(!1),children:(0,b.jsxs)("div",{className:"grid gap-3",children:["error"===aq.kind?(0,b.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--down-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--down)]",children:aq.message}):"ok"===aq.kind?(0,b.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--up-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--up)]",children:aq.message}):null,(0,b.jsxs)("label",{className:"grid gap-1",children:[(0,b.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:"Current password"}),(0,b.jsx)(u.V2Input,{type:"password",value:ag,onChange:a=>ah(a.target.value),autoComplete:"current-password"})]}),(0,b.jsxs)("label",{className:"grid gap-1",children:[(0,b.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:"New password"}),(0,b.jsx)(u.V2Input,{type:"password",value:ai,onChange:a=>aj(a.target.value),autoComplete:"new-password"})]}),(0,b.jsxs)("label",{className:"grid gap-1",children:[(0,b.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:"Confirm new password"}),(0,b.jsx)(u.V2Input,{type:"password",value:ak,onChange:a=>al(a.target.value),autoComplete:"new-password"})]}),n?.totp_enabled?(0,b.jsxs)("label",{className:"grid gap-1",children:[(0,b.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:"2FA code"}),(0,b.jsx)(u.V2Input,{value:am,onChange:a=>an(a.target.value.replace(/\D/g,"").slice(0,6)),inputMode:"numeric",maxLength:6,placeholder:"000000",className:"font-mono tracking-[0.2em]",autoComplete:"one-time-code"})]}):null,(0,b.jsx)(s.V2Button,{variant:"primary",fullWidth:!0,disabled:ao||!ag||!ai||!ak,onClick:()=>void bs(),children:ao?"Updating…":"Update password"})]})}),(0,b.jsx)(v.V2Sheet,{open:aA,title:"Submit KYC documents",onClose:()=>{aB(!1)},children:(0,b.jsxs)("div",{className:"grid gap-3",children:[(0,b.jsx)("div",{className:"text-[12px] text-[var(--v2-muted)]",children:"Upload clear photos. This sends images to the server for review."}),"error"===aM.kind?(0,b.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--down-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--down)]",children:aM.message}):"ok"===aM.kind?(0,b.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--up-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--up)]",children:aM.message}):null,(0,b.jsx)("div",{className:"grid grid-cols-3 gap-2",children:[{id:"passport",label:"Passport"},{id:"national_id",label:"National ID"},{id:"drivers_license",label:"Driver"}].map(a=>(0,b.jsx)("button",{type:"button",onClick:()=>aD(a.id),className:"h-10 rounded-xl border px-3 text-[13px] font-semibold shadow-[var(--v2-shadow-sm)] "+(aC===a.id?"border-[var(--v2-border)] bg-[var(--v2-surface-2)] text-[var(--v2-text)]":"border-[var(--v2-border)] bg-[var(--v2-surface)] text-[var(--v2-muted)] hover:bg-[var(--v2-surface-2)]"),children:a.label},a.id))}),(0,b.jsxs)("label",{className:"grid gap-1",children:[(0,b.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:"Front (required)"}),(0,b.jsx)("input",{type:"file",accept:"image/*",onChange:a=>aF(a.target.files?.[0]??null),className:"h-11 w-full rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 text-[13px] text-[var(--v2-text)] shadow-[var(--v2-shadow-sm)]"}),aE?(0,b.jsx)("div",{className:"text-[11px] text-[var(--v2-muted)]",children:aE.name}):null]}),(0,b.jsxs)("label",{className:"grid gap-1",children:[(0,b.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:"Back (optional)"}),(0,b.jsx)("input",{type:"file",accept:"image/*",onChange:a=>aH(a.target.files?.[0]??null),className:"h-11 w-full rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 text-[13px] text-[var(--v2-text)] shadow-[var(--v2-shadow-sm)]"}),aG?(0,b.jsx)("div",{className:"text-[11px] text-[var(--v2-muted)]",children:aG.name}):null]}),(0,b.jsxs)("label",{className:"grid gap-1",children:[(0,b.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:"Selfie (optional)"}),(0,b.jsx)("input",{type:"file",accept:"image/*",onChange:a=>aJ(a.target.files?.[0]??null),className:"h-11 w-full rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 text-[13px] text-[var(--v2-text)] shadow-[var(--v2-shadow-sm)]"}),aI?(0,b.jsx)("div",{className:"text-[11px] text-[var(--v2-muted)]",children:aI.name}):null]}),(0,b.jsx)(s.V2Button,{variant:"primary",fullWidth:!0,disabled:aK,onClick:()=>void bk(),children:aK?"Submitting…":"Submit"}),(0,b.jsx)("div",{className:"text-[11px] text-[var(--v2-muted)]",children:"Tip: Keep each image ≤ 900KB for reliability."})]})}),(0,b.jsx)(v.V2Sheet,{open:aY,title:"Notification schedule",onClose:()=>aZ(!1),children:(0,b.jsxs)("div",{className:"grid gap-3",children:["error"===a0.kind?(0,b.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--down-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--down)]",children:a0.message}):"ok"===a0.kind?(0,b.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--up-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--up)]",children:a0.message}):null,(0,b.jsxs)("button",{type:"button",onClick:()=>aT(a=>a?{...a,quiet_enabled:!a.quiet_enabled}:a),className:"flex items-center justify-between rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 text-left shadow-[var(--v2-shadow-sm)]",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:"Quiet hours"}),(0,b.jsx)("div",{className:"mt-0.5 text-[12px] text-[var(--v2-muted)]",children:"Mute non-critical alerts during set hours."})]}),B(!!aS?.quiet_enabled,"On","Off")]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"mb-1 text-[12px] font-semibold text-[var(--v2-text)]",children:"Start"}),(0,b.jsx)(u.V2Input,{type:"time",value:y(aS?.quiet_start_min??1320),onChange:a=>aT(b=>b?{...b,quiet_start_min:z(a.target.value)}:b)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"mb-1 text-[12px] font-semibold text-[var(--v2-text)]",children:"End"}),(0,b.jsx)(u.V2Input,{type:"time",value:y(aS?.quiet_end_min??480),onChange:a=>aT(b=>b?{...b,quiet_end_min:z(a.target.value)}:b)})]})]}),(0,b.jsxs)("button",{type:"button",onClick:()=>aT(a=>a?{...a,digest_enabled:!a.digest_enabled}:a),className:"flex items-center justify-between rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 text-left shadow-[var(--v2-shadow-sm)]",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:"Email digest"}),(0,b.jsx)("div",{className:"mt-0.5 text-[12px] text-[var(--v2-muted)]",children:"Periodic summaries (if email channel enabled)."})]}),B(!!aS?.digest_enabled,"On","Off")]}),(0,b.jsx)(s.V2Button,{variant:"primary",fullWidth:!0,disabled:"schedule"===a$||!aS,onClick:()=>void bi(),children:"schedule"===a$?"Saving…":"Save schedule"})]})}),(0,b.jsx)(v.V2Sheet,{open:aW,title:"Notification preferences",onClose:()=>aX(!1),children:(0,b.jsxs)("div",{className:"grid gap-3",children:["error"===a0.kind?(0,b.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--down-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--down)]",children:a0.message}):"ok"===a0.kind?(0,b.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--up-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--up)]",children:a0.message}):null,(0,b.jsx)("div",{className:"text-[12px] text-[var(--v2-muted)]",children:"Key alerts (in-app / email). Others keep defaults."}),["order_filled","order_rejected","deposit_credited","withdrawal_completed","p2p_order_expiring","system"].map(a=>{let c=(aO??{})[a]??{in_app:!0,email:!1};return(0,b.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]",children:(0,b.jsx)("div",{className:"flex items-start justify-between gap-3",children:(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:A(a)}),(0,b.jsxs)("div",{className:"mt-1 flex flex-wrap items-center gap-2",children:[(0,b.jsxs)("button",{type:"button",onClick:()=>bg(a,{in_app:!c.in_app}),className:"h-9 rounded-xl border px-3 text-[12px] font-semibold shadow-[var(--v2-shadow-sm)] "+(c.in_app?"border-[var(--v2-border)] bg-[var(--v2-surface-2)] text-[var(--v2-text)]":"border-[var(--v2-border)] bg-[var(--v2-surface)] text-[var(--v2-muted)] hover:bg-[var(--v2-surface-2)]"),children:["In-app: ",c.in_app?"On":"Off"]}),(0,b.jsxs)("button",{type:"button",onClick:()=>bg(a,{email:!c.email}),className:"h-9 rounded-xl border px-3 text-[12px] font-semibold shadow-[var(--v2-shadow-sm)] "+(c.email?"border-[var(--v2-border)] bg-[var(--v2-surface-2)] text-[var(--v2-text)]":"border-[var(--v2-border)] bg-[var(--v2-surface)] text-[var(--v2-muted)] hover:bg-[var(--v2-surface-2)]"),children:["Email: ",c.email?"On":"Off"]})]})]})})},a)}),(0,b.jsx)(s.V2Button,{variant:"primary",fullWidth:!0,disabled:"prefs"===a$||!aO,onClick:()=>void bh(),children:"prefs"===a$?"Saving…":"Save preferences"}),aQ.length?(0,b.jsxs)("div",{className:"text-[11px] text-[var(--v2-muted)]",children:["Known types: ",aQ.length]}):null]})}),(0,b.jsx)(v.V2Sheet,{open:a2,title:"Notifications",onClose:()=>a3(!1),children:(0,b.jsxs)("div",{className:"grid gap-3",children:[a6?(0,b.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--down-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--down)]",children:a6}):null,(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsx)(s.V2Button,{variant:"secondary",fullWidth:!0,disabled:a4,onClick:()=>void bd(),children:"Refresh"}),(0,b.jsx)(s.V2Button,{variant:"primary",fullWidth:!0,disabled:a4||0===ba,onClick:()=>void be(),children:"Mark all read"})]}),a4?(0,b.jsx)(w.V2Skeleton,{className:"h-32 w-full"}):0===a8.length?(0,b.jsx)("div",{className:"text-sm text-[var(--v2-muted)]",children:"No notifications."}):(0,b.jsx)("div",{className:"grid gap-2",children:a8.slice(0,50).map(a=>(0,b.jsx)("button",{type:"button",onClick:()=>{a.is_read||bf(a.id)},className:"rounded-2xl border border-[var(--v2-border)] px-3 py-3 text-left shadow-[var(--v2-shadow-sm)] "+(a.is_read?"bg-[var(--v2-surface)]":"bg-[color-mix(in_srgb,var(--warn-bg)_55%,var(--v2-surface))]"),children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:a.title}),(0,b.jsx)("div",{className:"mt-1 text-[12px] text-[var(--v2-muted)]",children:a.body}),(0,b.jsxs)("div",{className:"mt-1 text-[11px] text-[var(--v2-muted)]",children:[A(a.type)," • ",a.created_at?new Date(a.created_at).toLocaleString():""]})]}),a.is_read?null:(0,b.jsx)("span",{className:"mt-0.5 inline-flex h-2 w-2 rounded-full bg-[var(--warn)]","aria-label":"Unread"})]})},a.id))})]})})]})}a.s(["AccountClient",()=>D],20852)}];

//# sourceMappingURL=src_app_v2_account_AccountClient_tsx_4692ba9f._.js.map