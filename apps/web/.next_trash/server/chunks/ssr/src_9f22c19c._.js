module.exports=[56773,a=>{"use strict";var b=a.i(187924);let c=a.i(572131).forwardRef(function({className:a="",type:c="text",...d},e){return(0,b.jsx)("input",{ref:e,type:c,className:"h-11 w-full rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 text-[14px] text-[var(--v2-text)] shadow-[var(--v2-shadow-sm)] outline-none placeholder:text-[color-mix(in_srgb,var(--v2-muted)_70%,transparent)] focus:ring-2 focus:ring-[var(--v2-ring)] "+a,...d})});a.s(["V2Input",0,c])},556836,a=>{"use strict";var b=a.i(187924);function c(a){let b=a?.variant??"secondary",c=a?.size??"md";return["inline-flex select-none items-center justify-center gap-2 whitespace-nowrap rounded-xl transition focus:outline-none focus:ring-2 focus:ring-[var(--v2-ring)] disabled:pointer-events-none disabled:opacity-55","lg"===c?"h-12 px-5 text-[15px]":"sm"===c?"h-9 px-3 text-[13px]":"h-11 px-4 text-[14px]","primary"===b?"bg-[var(--v2-accent)] text-white font-semibold shadow-[var(--v2-shadow-sm)] hover:brightness-105":"danger"===b?"bg-[var(--down)] text-white font-semibold shadow-[var(--v2-shadow-sm)] hover:brightness-105":"ghost"===b?"bg-transparent text-[var(--v2-text)] font-semibold hover:bg-[var(--v2-surface-2)]":"border border-[var(--v2-border)] bg-[var(--v2-surface)] text-[var(--v2-text)] font-semibold shadow-[var(--v2-shadow-sm)] hover:bg-[var(--v2-surface-2)]",a?.fullWidth?"w-full":"",a?.className??""].filter(Boolean).join(" ")}let d=a.i(572131).forwardRef(function({variant:a,size:d,fullWidth:e,className:f,type:g,...h},i){return(0,b.jsx)("button",{ref:i,type:g??"button",className:c({variant:a,size:d,fullWidth:e,className:f}),...h})});a.s(["V2Button",0,d,"v2ButtonClassName",()=>c])},214373,a=>{"use strict";var b=a.i(187924);function c({children:a,className:c=""}){return(0,b.jsx)("section",{className:"rounded-[var(--v2-radius-lg)] border border-[var(--v2-border)] bg-[var(--v2-surface)] shadow-[var(--v2-shadow-sm)] "+c,children:a})}function d({title:a,subtitle:c,right:d}){return(0,b.jsxs)("header",{className:"flex items-start justify-between gap-3 px-4 pt-4",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-[15px] font-semibold text-[var(--v2-text)]",children:a}),c?(0,b.jsx)("div",{className:"mt-0.5 text-[13px] text-[var(--v2-muted)]",children:c}):null]}),d?(0,b.jsx)("div",{className:"shrink-0",children:d}):null]})}function e({children:a}){return(0,b.jsx)("div",{className:"px-4 pb-4 pt-3",children:a})}a.s(["V2Card",()=>c,"V2CardBody",()=>e,"V2CardHeader",()=>d])},782691,a=>{"use strict";var b=a.i(187924);function c({className:a=""}){return(0,b.jsx)("div",{className:"animate-pulse rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface-2)] "+a,"aria-hidden":"true"})}a.s(["V2Skeleton",()=>c])},979237,a=>{"use strict";var b=a.i(187924),c=a.i(238246),d=a.i(50944),e=a.i(572131),f=a.i(556836),g=a.i(214373),h=a.i(56773),i=a.i(782691);function j(a){if(!a)return"";try{return new Date(a).toLocaleString()}catch{return String(a)}}function k(a){let b="number"==typeof a?a:Number(String(a));return Number.isFinite(b)?b:null}function l(a,b){let c=k(a);if(null==c)return"—";try{return new Intl.NumberFormat(void 0,{style:"currency",currency:b,currencyDisplay:"code",maximumFractionDigits:2}).format(c)}catch{return`${c.toLocaleString()} ${b}`}}function m(){let a=(0,d.useParams)(),m=String(a?.id??""),[n,o]=(0,e.useState)(null),[p,q]=(0,e.useState)(null),[r,s]=(0,e.useState)([]),[t,u]=(0,e.useState)(!0),[v,w]=(0,e.useState)(null),[x,y]=(0,e.useState)(""),[z,A]=(0,e.useState)(!1),[B,C]=(0,e.useState)(null),[D,E]=(0,e.useState)(null),[F,G]=(0,e.useState)(null),H=(0,e.useRef)(0),I=(0,e.useRef)(null),J=(0,e.useRef)(!1),K=(0,e.useRef)(""),L=(0,e.useRef)(null),M=(0,e.useRef)(0);(0,e.useEffect)(()=>{K.current=String(p?.status??"").toLowerCase()},[p?.status]),(0,e.useEffect)(()=>{let a=!1;return fetch("/api/whoami",{cache:"no-store"}).then(a=>a.ok?a.json():null).then(b=>{a||o("string"==typeof b?.user?.id?b.user.id:null)}).catch(()=>{a||o(null)}),()=>{a=!0}},[]);let N=async()=>{if(!m)return;let a=++H.current;I.current?.abort();let b=new AbortController;I.current=b,w(null),J.current||u(!0);try{let c=await fetch(`/api/p2p/orders/${encodeURIComponent(m)}`,{cache:"no-store",signal:b.signal}),d=await c.json().catch(()=>null);if(!c.ok){let a="string"==typeof d?.error?d.error:`http_${c.status}`;throw Error(a)}if(a!==H.current)return;q(d?.order??null),s(Array.isArray(d?.messages)?d.messages:[]),J.current=!0}catch(b){if(b instanceof DOMException&&"AbortError"===b.name||a!==H.current)return;J.current||w(b instanceof Error?b.message:String(b))}finally{a===H.current&&u(!1)}};(0,e.useEffect)(()=>{N();let a=null,b=()=>{a&&(window.clearTimeout(a),a=null)},c=()=>{b();let d=K.current,e="completed"===d||"cancelled"===d,f=L.current?e?45e3:15e3:e?2e4:4e3;a=window.setTimeout(()=>{a=null,"visible"===document.visibilityState&&N(),c()},f)},d=()=>{"visible"===document.visibilityState?(N(),c()):b()};return document.addEventListener("visibilitychange",d),c(),()=>{document.removeEventListener("visibilitychange",d),b(),I.current?.abort()}},[m]),(0,e.useEffect)(()=>{if(!m)return;let a=()=>{try{L.current?.close()}catch{}L.current=null},b=()=>{let a=Date.now();a-M.current<700||(M.current=a,"visible"===document.visibilityState&&N())},c=()=>{if(!("visible"!==document.visibilityState||"u"<typeof EventSource)&&!L.current)try{let a=new EventSource("/api/notifications/stream",{withCredentials:!0});a.addEventListener("notification",a=>{try{let c=JSON.parse(String(a.data??"{}"));(a=>{if(!String(a?.type??"").startsWith("p2p_"))return!1;let b=String(a?.metadata?.order_id??"");return!b||b===m})(c)&&b()}catch{}}),a.addEventListener("ready",()=>b()),a.onerror=()=>{},L.current=a}catch{a()}},d=()=>{"visible"===document.visibilityState?c():a()};return document.addEventListener("visibilitychange",d),c(),()=>{document.removeEventListener("visibilitychange",d),a()}},[m]);let O=(0,e.useMemo)(()=>p&&n?String(p.buyer_id)===String(n)?"buyer":String(p.seller_id)===String(n)?"seller":null:null,[p,n]),P="buyer"===O&&"created"===String(p?.status),Q="seller"===O&&"paid_confirmed"===String(p?.status),R="created"===String(p?.status),S=async a=>{if(m&&!D){E(a),G(null);try{let b=await fetch(`/api/p2p/orders/${encodeURIComponent(m)}/action`,{method:"POST",headers:{"content-type":"application/json"},credentials:"include",body:JSON.stringify({action:a})}),c=await b.json().catch(()=>null);if(!b.ok){let a="string"==typeof c?.error?c.error:`http_${b.status}`;throw Error(a)}N()}catch(a){G(a instanceof Error?a.message:String(a))}finally{E(null)}}},T=async()=>{if(!m||z)return;let a=x.trim();if(a){A(!0),C(null);try{let b=await fetch(`/api/p2p/orders/${encodeURIComponent(m)}/chat`,{method:"POST",headers:{"content-type":"application/json"},credentials:"include",body:JSON.stringify({content:a})}),c=await b.json().catch(()=>null);if(!b.ok){let a="string"==typeof c?.error?c.error:`http_${b.status}`;throw Error(a)}y(""),N()}catch(a){C(a instanceof Error?a.message:String(a))}finally{A(!1)}}},U=Array.isArray(p?.payment_method_snapshot)?p.payment_method_snapshot:[],V=(0,b.jsxs)("header",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-[11px] font-bold uppercase tracking-widest text-[var(--v2-muted)]",children:"P2P"}),(0,b.jsx)("h1",{className:"text-2xl font-extrabold tracking-tight",children:"Order"})]}),(0,b.jsx)(c.default,{href:"/v2/p2p/orders",className:"rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-2 text-[12px] font-semibold text-[var(--v2-text)]",children:"Back"})]}),(0,b.jsx)("p",{className:"text-sm text-[var(--v2-muted)]",children:"Chat, payment details, and actions."})]});if(v&&!p)return(0,b.jsxs)("main",{className:"space-y-4",children:[V,(0,b.jsxs)(g.V2Card,{children:[(0,b.jsx)(g.V2CardHeader,{title:"Order unavailable",subtitle:"Sign in and try again."}),(0,b.jsxs)(g.V2CardBody,{children:[(0,b.jsx)("div",{className:"text-sm text-[var(--v2-muted)]",children:String(v)}),(0,b.jsx)("div",{className:"mt-3",children:(0,b.jsx)(f.V2Button,{variant:"primary",fullWidth:!0,onClick:()=>void N(),children:"Retry"})})]})]})]});if(t&&!p)return(0,b.jsxs)("main",{className:"space-y-4",children:[V,(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(i.V2Skeleton,{className:"h-24"}),(0,b.jsx)(i.V2Skeleton,{className:"h-24"}),(0,b.jsx)(i.V2Skeleton,{className:"h-24"})]})]});if(!p)return(0,b.jsxs)("main",{className:"space-y-4",children:[V,(0,b.jsx)(g.V2Card,{children:(0,b.jsx)(g.V2CardHeader,{title:"Not found",subtitle:"This order doesn’t exist or you don’t have access."})})]});let W=String(p.status||"").toLowerCase();return(0,b.jsxs)("main",{className:"space-y-4",children:[V,(0,b.jsxs)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-muted)]",children:"Status"}),(0,b.jsx)("div",{className:"mt-0.5 text-[15px] font-semibold text-[var(--v2-text)]",children:W.replaceAll("_"," ")||"—"}),(0,b.jsxs)("div",{className:"mt-2 text-[12px] text-[var(--v2-muted)]",children:["Created ",j(p.created_at)]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-muted)]",children:"You"}),(0,b.jsx)("div",{className:"mt-0.5 text-[13px] font-semibold text-[var(--v2-text)]",children:O?O.toUpperCase():"—"})]})]}),(0,b.jsxs)("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[(0,b.jsxs)("div",{className:"rounded-xl bg-[var(--v2-surface-2)] px-2 py-2",children:[(0,b.jsx)("div",{className:"text-[11px] font-semibold text-[var(--v2-muted)]",children:"Amount"}),(0,b.jsxs)("div",{className:"mt-0.5 font-mono text-[13px] font-semibold text-[var(--v2-text)]",children:[function(a){let b=k(a);if(null==b)return"—";if(0===b)return"0";let c=Math.abs(b);return b.toLocaleString(void 0,{maximumFractionDigits:c>=1e3?2:c>=1?4:c>=.01?6:8})}(p.amount_asset)," ",String(p.asset_symbol||"—")]}),(0,b.jsxs)("div",{className:"mt-0.5 text-[12px] text-[var(--v2-muted)]",children:["≈ ",l(p.amount_fiat,String(p.fiat_currency||"USD"))]})]}),(0,b.jsxs)("div",{className:"rounded-xl bg-[var(--v2-surface-2)] px-2 py-2",children:[(0,b.jsx)("div",{className:"text-[11px] font-semibold text-[var(--v2-muted)]",children:"Price"}),(0,b.jsx)("div",{className:"mt-0.5 font-mono text-[13px] font-semibold text-[var(--v2-text)]",children:l(p.price,String(p.fiat_currency||"USD"))}),(0,b.jsxs)("div",{className:"mt-0.5 text-[12px] text-[var(--v2-muted)]",children:["Window: ",String(p.payment_window_minutes??"—")," min"]})]})]}),F?(0,b.jsx)("div",{className:"mt-3 text-sm text-[var(--down)]",children:F}):null,(0,b.jsxs)("div",{className:"mt-3 grid gap-2",children:[P?(0,b.jsx)(f.V2Button,{variant:"primary",fullWidth:!0,disabled:null!==D,onClick:()=>void S("PAY_CONFIRMED"),children:"PAY_CONFIRMED"===D?"Marking…":"I have paid"}):null,Q?(0,b.jsx)(f.V2Button,{variant:"primary",fullWidth:!0,disabled:null!==D,onClick:()=>void S("RELEASE"),children:"RELEASE"===D?"Releasing…":"Release crypto"}):null,R?(0,b.jsx)(f.V2Button,{variant:"ghost",fullWidth:!0,disabled:null!==D,onClick:()=>void S("CANCEL"),children:"CANCEL"===D?"Canceling…":"Cancel order"}):null]})]}),(0,b.jsxs)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]",children:[(0,b.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:"Payment details"}),0===U.length?(0,b.jsx)("div",{className:"mt-2 text-[12px] text-[var(--v2-muted)]",children:"No payment details available."}):(0,b.jsx)("div",{className:"mt-2 grid gap-2",children:U.map((a,c)=>(0,b.jsxs)("div",{className:"rounded-xl bg-[var(--v2-surface-2)] px-2 py-2",children:[(0,b.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:String(a.name||a.identifier)}),(0,b.jsx)("div",{className:"mt-0.5 text-[11px] text-[var(--v2-muted)]",children:String(a.identifier)}),a.details?(0,b.jsx)("pre",{className:"mt-2 max-h-32 overflow-auto whitespace-pre-wrap break-words rounded-lg border border-[var(--v2-border)] bg-[var(--v2-surface)] p-2 text-[11px] text-[var(--v2-muted)]",children:JSON.stringify(a.details,null,2)}):null]},String(a.id||c)))}),p.ad_terms?(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-muted)]",children:"Terms"}),(0,b.jsx)("div",{className:"mt-1 whitespace-pre-wrap text-[12px] text-[var(--v2-text)]",children:String(p.ad_terms)})]}):null]}),(0,b.jsxs)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:"Chat"}),(0,b.jsx)("div",{className:"text-[12px] text-[var(--v2-muted)]",children:r.length})]}),(0,b.jsx)("div",{className:"mt-3 grid gap-2",children:0===r.length?(0,b.jsx)("div",{className:"text-[12px] text-[var(--v2-muted)]",children:"No messages yet."}):r.slice(-60).map(a=>{let c=null==a.sender_id;return(0,b.jsxs)("div",{className:"rounded-xl bg-[var(--v2-surface-2)] px-2 py-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsx)("div",{className:"text-[11px] font-semibold text-[var(--v2-muted)]",children:c?"System":String(a.sender_email||"User")}),(0,b.jsx)("div",{className:"text-[11px] text-[var(--v2-muted)]",children:j(a.created_at)})]}),(0,b.jsx)("div",{className:"mt-1 whitespace-pre-wrap text-[12px] text-[var(--v2-text)]",children:String(a.content||"")})]},String(a.id))})}),(0,b.jsxs)("div",{className:"mt-3 grid gap-2",children:[(0,b.jsx)(h.V2Input,{value:x,onChange:a=>y(a.target.value),placeholder:"Message…"}),B?(0,b.jsx)("div",{className:"text-sm text-[var(--down)]",children:B}):null,(0,b.jsx)(f.V2Button,{variant:"primary",fullWidth:!0,disabled:z,onClick:()=>void T(),children:z?"Sending…":"Send"})]})]})]})}a.s(["P2POrderClient",()=>m])}];

//# sourceMappingURL=src_9f22c19c._.js.map