module.exports=[392415,a=>{"use strict";class b extends Error{code;details;status;requestId;constructor(a,b){super(b?.requestId?`${a} (req ${b.requestId})`:a),this.name="ApiError",this.code=a,this.details=b?.details,this.status=b?.status,this.requestId=b?.requestId}}function c(a){return new Promise(b=>setTimeout(b,Math.max(0,Math.floor(a))))}async function d(a,d){let e=d?{...d,credentials:d.credentials??"same-origin"}:{credentials:"same-origin"},f=(e?.method??"GET").toUpperCase();if(["POST","PUT","PATCH","DELETE"].includes(f)){let a=function(){if("u"<typeof document)return null;let a=document.cookie.match(/(?:^|;\s*)__csrf=([^;]+)/);return a?.[1]??null}();if(a){let b=new Headers(e?.headers);b.has("x-csrf-token")||b.set("x-csrf-token",a),e.headers=b}}let g=(e?.method??"GET").toUpperCase(),h="GET"===g||"HEAD"===g,i=2*!!h,j=null;for(let d=0;d<=i;d+=1)try{let f=await fetch(a,e),g=f.headers.get("x-request-id")??void 0,j=await f.text().catch(()=>""),k=(f.headers.get("content-type")??"").includes("text/html")||function(a){let b=String(a??"").trimStart();return b.startsWith("<!DOCTYPE html")||b.startsWith("<html")||b.startsWith("<!doctype html")}(j),l=k?{_raw:"<html/>"}:function(a){try{return a?JSON.parse(a):null}catch{return{_raw:a}}}(j);if(!f.ok){if(h&&(502===f.status||503===f.status||504===f.status)&&d<i){await c(250*Math.pow(2,d));continue}if(l&&"object"==typeof l&&"error"in l){let a="string"==typeof l.error?l.error:`http_${f.status}`,c=void 0!==l.details?l.details:"string"==typeof l.message?l.message:k?{message:`Upstream error (HTTP ${f.status}). Please retry.`}:void 0;throw new b(a,{details:c,status:f.status,requestId:g})}if(l&&"object"==typeof l&&"message"in l){let a="string"==typeof l.message?l.message:l;throw new b(`http_${f.status}`,{details:a,status:f.status,requestId:g})}let a=k?{message:`Upstream error (HTTP ${f.status}). Please retry.`}:l;throw new b(`http_${f.status}`,{details:a,status:f.status,requestId:g})}return l}catch(a){if(j=a,h&&d<i){await c(250*Math.pow(2,d));continue}throw a}throw j}a.s(["ApiError",()=>b,"fetchJsonOrThrow",()=>d])},19559,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(392415);function e({text:a,variant:c}){return(0,b.jsxs)("span",{className:`inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[10px] font-extrabold uppercase tracking-[0.18em] ${"green"===c?"border-emerald-300 bg-emerald-50 text-emerald-900 dark:border-emerald-900/40 dark:bg-emerald-950/30 dark:text-emerald-200":"amber"===c?"border-amber-300 bg-amber-50 text-amber-900 dark:border-amber-900/40 dark:bg-amber-950/30 dark:text-amber-200":"red"===c?"border-rose-300 bg-rose-50 text-rose-900 dark:border-rose-900/40 dark:bg-rose-950/30 dark:text-rose-200":"border-[var(--border)] bg-[var(--bg)] text-[var(--muted)]"}`,children:[(0,b.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-current opacity-70"}),a]})}function f(){let[a,f]=(0,c.useState)(null),[g,h]=(0,c.useState)(null),[i,j]=(0,c.useState)(!0),k=(0,c.useCallback)(async()=>{j(!0),h(null);try{let a=await (0,d.fetchJsonOrThrow)("/api/status",{cache:"no-store"});f(a)}catch(a){f(null),h(a?.message?String(a.message):"status_failed")}finally{j(!1)}},[]);(0,c.useEffect)(()=>{k();let a=setInterval(k,3e4);return()=>clearInterval(a)},[k]);let l=(0,c.useMemo)(()=>{let c=a?.overall??"offline";return"online"===c?(0,b.jsx)(e,{text:"Online",variant:"green"}):"degraded"===c?(0,b.jsx)(e,{text:"Degraded",variant:"amber"}):(0,b.jsx)(e,{text:"Offline",variant:"red"})},[a?.overall]),m=(0,c.useMemo)(()=>(Array.isArray(a?.heartbeats)?a.heartbeats:[]).slice().sort((a,b)=>String(a.service).localeCompare(String(b.service))).slice(0,20),[a]);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"relative overflow-hidden rounded-2xl border border-[var(--border)] bg-[var(--card)] p-6",children:[(0,b.jsx)("div",{className:"pointer-events-none absolute inset-0 opacity-60",style:{background:"radial-gradient(700px 260px at 20% 0%, color-mix(in oklab, var(--accent) 18%, transparent) 0%, transparent 60%), radial-gradient(440px 220px at 90% 10%, color-mix(in oklab, var(--accent-2) 12%, transparent) 0%, transparent 55%)"}}),(0,b.jsxs)("div",{className:"relative flex flex-wrap items-start justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"h-2.5 w-2.5 rounded-full bg-[var(--accent)]"}),(0,b.jsx)("h1",{className:"text-xl font-extrabold tracking-tight",children:"Status"})]}),(0,b.jsx)("p",{className:"mt-1 text-xs text-[var(--muted)]",children:"Live system snapshot (DB, outbox, and background jobs)."})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[l,(0,b.jsx)("button",{type:"button",className:"rounded-lg border border-[var(--border)] bg-[var(--bg)] px-3 py-2 text-[11px] font-semibold text-[var(--muted)] hover:text-[var(--foreground)] hover:bg-[var(--card-2)]",onClick:k,disabled:i,children:"refresh"})]})]}),g?(0,b.jsx)("div",{className:"relative mt-3 text-[11px] text-[var(--down)]",children:g}):null,i&&!a?(0,b.jsx)("div",{className:"relative mt-3 text-[11px] text-[var(--muted)]",children:"Checking…"}):null,a?(0,b.jsxs)("div",{className:"relative mt-4 grid grid-cols-1 gap-3 md:grid-cols-3 lg:grid-cols-6",children:[(0,b.jsxs)("div",{className:"rounded-xl border border-[var(--border)] bg-[var(--bg)] p-3",children:[(0,b.jsx)("div",{className:"text-[10px] font-extrabold uppercase tracking-[0.22em] text-[var(--muted)]",children:"Database"}),(0,b.jsxs)("div",{className:"mt-2 text-sm font-semibold text-[var(--foreground)]",children:[a.db?.ok?"ok":"down","number"==typeof a.db?.latency_ms?(0,b.jsxs)("span",{className:"ml-2 text-[11px] text-[var(--muted)]",children:[a.db.latency_ms,"ms"]}):null]})]}),(0,b.jsxs)("div",{className:"rounded-xl border border-[var(--border)] bg-[var(--bg)] p-3",children:[(0,b.jsx)("div",{className:"text-[10px] font-extrabold uppercase tracking-[0.22em] text-[var(--muted)]",children:"Outbox"}),(0,b.jsxs)("div",{className:"mt-2 text-[11px] text-[var(--muted)]",children:["open ",(0,b.jsx)("span",{className:"text-[var(--foreground)] font-semibold",children:a.outbox?.open??0})," · ","dead ",(0,b.jsx)("span",{className:"text-[var(--foreground)] font-semibold",children:a.outbox?.dead??0})," · ","errors ",(0,b.jsx)("span",{className:"text-[var(--foreground)] font-semibold",children:a.outbox?.with_errors??0})]})]}),(0,b.jsxs)("div",{className:"rounded-xl border border-[var(--border)] bg-[var(--bg)] p-3",children:[(0,b.jsx)("div",{className:"text-[10px] font-extrabold uppercase tracking-[0.22em] text-[var(--muted)]",children:"Email Outbox"}),(0,b.jsxs)("div",{className:"mt-2 text-[11px] text-[var(--muted)]",children:["pending ",(0,b.jsx)("span",{className:"text-[var(--foreground)] font-semibold",children:a.email_outbox?.pending??0})," · ","failed ",(0,b.jsx)("span",{className:"text-[var(--foreground)] font-semibold",children:a.email_outbox?.failed??0}),a.email_outbox?.oldest_age_min!=null?(0,b.jsxs)("div",{className:"mt-1 text-[10px]",children:["oldest pending: ",(0,b.jsxs)("span",{className:"text-[var(--foreground)] font-semibold",children:[a.email_outbox.oldest_age_min,"m"]})]}):null]})]}),(0,b.jsxs)("div",{className:"rounded-xl border border-[var(--border)] bg-[var(--bg)] p-3",children:[(0,b.jsx)("div",{className:"text-[10px] font-extrabold uppercase tracking-[0.22em] text-[var(--muted)]",children:"Expected Jobs"}),(0,b.jsx)("div",{className:"mt-2 text-[11px] text-[var(--muted)]",children:Array.isArray(a.expected_services)&&a.expected_services.length>0?(0,b.jsxs)(b.Fragment,{children:[a.expected_services.length," configured",(0,b.jsxs)("div",{className:"mt-1 text-[10px]",children:["stale: ",Array.isArray(a.stale_expected_services)&&a.stale_expected_services.length?(0,b.jsx)("span",{className:"text-[var(--down)]",children:a.stale_expected_services.join(", ")}):(0,b.jsx)("span",{className:"text-[var(--muted)]",children:"none"})]})]}):(0,b.jsx)("span",{className:"text-[var(--muted)]",children:"none configured"})})]}),(0,b.jsxs)("div",{className:"rounded-xl border border-[var(--border)] bg-[var(--bg)] p-3",children:[(0,b.jsx)("div",{className:"text-[10px] font-extrabold uppercase tracking-[0.22em] text-[var(--muted)]",children:"Ops Alerts"}),(0,b.jsx)("div",{className:"mt-2 text-[11px] text-[var(--muted)]",children:a.ops_alerts?.degraded_last_sent_at?(0,b.jsxs)(b.Fragment,{children:["last sent",(0,b.jsx)("div",{className:"mt-1 text-[10px] text-[var(--foreground)] font-semibold",children:new Date(String(a.ops_alerts.degraded_last_sent_at)).toLocaleString()})]}):(0,b.jsx)("span",{className:"text-[var(--muted)]",children:"none yet"})})]}),(0,b.jsxs)("div",{className:"rounded-xl border border-[var(--border)] bg-[var(--bg)] p-3",children:[(0,b.jsx)("div",{className:"text-[10px] font-extrabold uppercase tracking-[0.22em] text-[var(--muted)]",children:"Latency"}),(0,b.jsxs)("div",{className:"mt-2 text-[11px] text-[var(--muted)]",children:["took ",(0,b.jsxs)("span",{className:"text-[var(--foreground)] font-semibold",children:[Math.max(0,Number(a.took_ms??0)),"ms"]})]})]})]}):null]}),(0,b.jsxs)("div",{className:"rounded-2xl border border-[var(--border)] bg-[var(--card)] overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3 px-4 py-3",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-[var(--foreground)]",children:"Heartbeats"}),(0,b.jsx)("div",{className:"text-[11px] text-[var(--muted)]",children:m.length})]}),(0,b.jsx)("div",{className:"border-t border-[var(--border)]",children:0===m.length?(0,b.jsx)("div",{className:"px-4 py-4 text-xs text-[var(--muted)]",children:"No heartbeats recorded yet."}):(0,b.jsx)("table",{className:"w-full text-[11px]",children:(0,b.jsx)("tbody",{children:m.map(a=>{let c=String(a.service),d=String(a.status??"ok"),f=a.last_seen_at?new Date(String(a.last_seen_at)).toLocaleString():"—";return(0,b.jsxs)("tr",{className:"border-b border-[var(--border)] last:border-b-0",children:[(0,b.jsx)("td",{className:"px-4 py-2 font-semibold text-[var(--foreground)]",children:c}),(0,b.jsx)("td",{className:"px-4 py-2 text-right",children:(0,b.jsx)(e,{text:d,variant:"ok"===d?"green":"degraded"===d?"amber":"red"})}),(0,b.jsx)("td",{className:"px-4 py-2 text-right text-[10px] text-[var(--muted)]",children:f})]},c)})})})})]}),(0,b.jsx)("div",{className:"text-[11px] text-[var(--muted)]",children:"Tip: for operational monitoring, set expectations via env (e.g. `EXPECT_OUTBOX_WORKER=1`)."})]})}a.s(["StatusClient",()=>f])}];

//# sourceMappingURL=src_122a528b._.js.map