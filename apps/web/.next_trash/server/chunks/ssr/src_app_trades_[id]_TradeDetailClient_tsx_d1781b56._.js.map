{"version":3,"sources":["../../../../src/app/trades/%5Bid%5D/TradeDetailClient.tsx","../../../../src/lib/evidence/completeness.ts"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useMemo, useState } from \"react\";\r\n\r\nimport { computeEvidenceCompleteness } from \"@/lib/evidence/completeness\";\r\nimport { ApiError, fetchJsonOrThrow } from \"@/lib/api/client\";\r\nimport { ApiErrorBanner, type ClientApiError } from \"@/components/ApiErrorBanner\";\r\nimport { canTransitionTrade, type TradeStatus } from \"@/lib/state/trade\";\r\nimport {\r\n  clearSessionCookie,\r\n  createSessionCookie,\r\n  fetchWhoAmI,\r\n} from \"@/lib/auth/clientSession\";\r\nimport {\r\n  persistActingUserIdPreference,\r\n  readActingUserIdPreference,\r\n} from \"@/lib/state/actingUser\";\r\nimport { copyToClipboard } from \"@/lib/ui/copyToClipboard\";\r\nimport { Toast, type ToastKind } from \"@/components/Toast\";\r\nimport { V2Button } from \"@/components/v2/Button\";\r\nimport { V2Card, V2CardBody, V2CardHeader } from \"@/components/v2/Card\";\r\nimport { V2Input } from \"@/components/v2/Input\";\r\n\r\ntype TradeDetail = {\r\n  id: string;\r\n  buyer_user_id: string;\r\n  seller_user_id: string;\r\n  fiat_currency: string;\r\n  crypto_asset: string;\r\n  fiat_amount: string;\r\n  crypto_amount: string;\r\n  price: string;\r\n  status: string;\r\n  reference_market_snapshot_id: string | null;\r\n  fair_price_mid: string | null;\r\n  fair_price_lower: string | null;\r\n  fair_price_upper: string | null;\r\n  fair_band_pct: string | null;\r\n  fair_price_basis: string | null;\r\n  price_deviation_pct: string | null;\r\n  created_at: string;\r\n};\r\n\r\ntype Transition = {\r\n  id: string;\r\n  from_status: string | null;\r\n  to_status: string;\r\n  actor_user_id: string | null;\r\n  actor_type: string;\r\n  reason_code: string | null;\r\n  created_at: string;\r\n};\r\n\r\ntype EvidenceObject = {\r\n  id: string;\r\n  submitted_by_user_id: string;\r\n  type: string;\r\n  storage_uri: string;\r\n  sha256: string;\r\n  metadata_json: unknown;\r\n  created_at: string;\r\n};\r\n\r\ntype RiskAssessment = {\r\n  id: string;\r\n  score: number;\r\n  version: string;\r\n  factors_json: unknown;\r\n  recommended_action: string;\r\n  market_snapshot_id: string | null;\r\n  created_at: string;\r\n} | null;\r\n\r\ntype Dispute = {\r\n  id: string;\r\n  trade_id: string;\r\n  opened_by_user_id: string;\r\n  reason_code: string;\r\n  status: string;\r\n  opened_at: string;\r\n  resolved_at: string | null;\r\n} | null;\r\n\r\ntype DisputeDecision = {\r\n  id: string;\r\n  dispute_id: string;\r\n  decision: string;\r\n  rationale: string | null;\r\n  decided_by: string;\r\n  created_at: string;\r\n};\r\n\r\nfunction formatJson(value: unknown): string {\r\n  try {\r\n    return JSON.stringify(value, null, 2);\r\n  } catch {\r\n    return \"\";\r\n  }\r\n}\r\n\r\nexport function TradeDetailClient({ tradeId }: { tradeId: string }) {\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<ClientApiError | null>(null);\r\n\r\n  const [authMode, setAuthMode] = useState<\"header\" | \"session\">(\"session\");\r\n  const [sessionUserId, setSessionUserId] = useState<string | null>(null);\r\n  const [sessionBootstrapKey, setSessionBootstrapKey] = useState<string>(\"\");\r\n  const [sessionLoading, setSessionLoading] = useState(false);\r\n\r\n  // Legacy ProofPack auth: buyer is default acting user. Exchange uses session auth instead.\r\n  const [actingUserId, setActingUserId] = useState<string>(\"\");\r\n  const [actingUserInitialized, setActingUserInitialized] = useState(false);\r\n\r\n  const [trade, setTrade] = useState<TradeDetail | null>(null);\r\n  const [transitions, setTransitions] = useState<Transition[]>([]);\r\n  const [evidence, setEvidence] = useState<EvidenceObject[]>([]);\r\n  const [risk, setRisk] = useState<RiskAssessment>(null);\r\n  const [dispute, setDispute] = useState<Dispute>(null);\r\n  const [disputeDecisions, setDisputeDecisions] = useState<DisputeDecision[]>([]);\r\n\r\n  const evidenceCompleteness = useMemo(() => computeEvidenceCompleteness(evidence), [evidence]);\r\n\r\n  const [uploadType, setUploadType] = useState<\r\n    \"receipt\" | \"screenshot\" | \"bank_sms\" | \"chat_export\" | \"other\"\r\n  >(\"receipt\");\r\n  const [submittedBy, setSubmittedBy] = useState<string>(\"\");\r\n  const [metadataJson, setMetadataJson] = useState<string>(\"{}\");\r\n  const [file, setFile] = useState<File | null>(null);\r\n  const [uploading, setUploading] = useState(false);\r\n\r\n  const [disputeOpenedBy, setDisputeOpenedBy] = useState<string>(\"\");\r\n  const [disputeReason, setDisputeReason] = useState<\r\n    \"non_payment\" | \"chargeback\" | \"phishing\" | \"other\"\r\n  >(\"non_payment\");\r\n  const [openingDispute, setOpeningDispute] = useState(false);\r\n\r\n  const [decisionBy, setDecisionBy] = useState<string>(\"reviewer@local\");\r\n  const [reviewerKey, setReviewerKey] = useState<string>(\"\");\r\n  const [decisionType, setDecisionType] = useState<\r\n    \"release_to_buyer\" | \"refund_buyer\" | \"release_to_seller\" | \"cancel_trade\"\r\n  >(\"release_to_buyer\");\r\n  const [decisionRationale, setDecisionRationale] = useState<string>(\"\");\r\n  const [submittingDecision, setSubmittingDecision] = useState(false);\r\n\r\n  const [toastMessage, setToastMessage] = useState<string | null>(null);\r\n  const [toastKind, setToastKind] = useState<ToastKind>(\"info\");\r\n\r\n  const [transitioning, setTransitioning] = useState(false);\r\n\r\n  const actingRole = useMemo(() => {\r\n    if (!trade || !actingUserId) return null;\r\n    if (actingUserId === trade.buyer_user_id) return \"buyer\" as const;\r\n    if (actingUserId === trade.seller_user_id) return \"seller\" as const;\r\n    return null;\r\n  }, [trade, actingUserId]);\r\n\r\n  const lifecycleTitle = (to: TradeStatus, opts?: { role?: \"buyer\" | \"seller\" }) => {\r\n    if (transitioning) return \"Working…\";\r\n    if (!trade) return \"\";\r\n    if (!actingUserId) return \"Select an acting user.\";\r\n\r\n    if (!canTransitionTrade(trade.status, to)) {\r\n      return `Not allowed from status: ${trade.status}`;\r\n    }\r\n    if (opts?.role === \"buyer\" && actingUserId !== trade.buyer_user_id) {\r\n      return \"Buyer only.\";\r\n    }\r\n    if (opts?.role === \"seller\" && actingUserId !== trade.seller_user_id) {\r\n      return \"Seller only.\";\r\n    }\r\n    if (to === \"canceled\" && trade.status === \"disputed\") {\r\n      return \"Use reviewer decision to cancel disputed trades.\";\r\n    }\r\n    return \"\";\r\n  };\r\n\r\n  const proofPackHref = useMemo(() => {\r\n    const base = `/api/trades/${tradeId}/proof-pack`;\r\n    const scoped = authMode === \"session\" ? sessionUserId ?? actingUserId : actingUserId;\r\n    return scoped ? `${base}?user_id=${encodeURIComponent(scoped)}` : base;\r\n  }, [tradeId, actingUserId, authMode, sessionUserId]);\r\n  const evidenceUploadHref = useMemo(\r\n    () => `/api/trades/${tradeId}/evidence/upload`,\r\n    [tradeId]\r\n  );\r\n  const disputeHref = useMemo(() => `/api/trades/${tradeId}/dispute`, [tradeId]);\r\n  const disputeDecisionHref = useMemo(\r\n    () => `/api/trades/${tradeId}/dispute/decision`,\r\n    [tradeId]\r\n  );\r\n\r\n  async function refreshSession() {\r\n    try {\r\n      const me = await fetchWhoAmI();\r\n      setSessionUserId(me.user_id);\r\n    } catch (e) {\r\n      if (e instanceof ApiError) {\r\n        if (e.code === \"missing_x_user_id\") {\r\n          setSessionUserId(null);\r\n          return;\r\n        }\r\n      }\r\n      setSessionUserId(null);\r\n    }\r\n  }\r\n\r\n  async function signInAs(userId: string): Promise<boolean> {\r\n    if (!userId) return false;\r\n\r\n    setSessionLoading(true);\r\n    setError(null);\r\n    try {\r\n      await createSessionCookie({\r\n        userId,\r\n        bootstrapKey: sessionBootstrapKey ? sessionBootstrapKey : undefined,\r\n      });\r\n      await refreshSession();\r\n      setToastKind(\"success\");\r\n      setToastMessage(\"Session cookie set.\");\r\n      return true;\r\n    } catch (e) {\r\n      if (e instanceof ApiError) {\r\n        setError({ code: e.code, details: e.details });\r\n      } else {\r\n        setError({ code: e instanceof Error ? e.message : \"session_failed\" });\r\n      }\r\n      return false;\r\n    } finally {\r\n      setSessionLoading(false);\r\n    }\r\n  }\r\n\r\n  async function signOut() {\r\n    setSessionLoading(true);\r\n    setError(null);\r\n    try {\r\n      await clearSessionCookie();\r\n      await refreshSession();\r\n      setToastKind(\"success\");\r\n      setToastMessage(\"Signed out.\");\r\n    } catch (e) {\r\n      if (e instanceof ApiError) {\r\n        setError({ code: e.code, details: e.details });\r\n      } else {\r\n        setError({ code: e instanceof Error ? e.message : \"signout_failed\" });\r\n      }\r\n    } finally {\r\n      setSessionLoading(false);\r\n    }\r\n  }\r\n\r\n  async function refreshAll() {\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const headers: HeadersInit =\r\n        authMode === \"header\" && actingUserId ? { \"x-user-id\": actingUserId } : {};\r\n\r\n      const [tradeJson, evidenceJson, riskJson, disputeJson] = await Promise.all([\r\n        fetchJsonOrThrow<{ trade?: TradeDetail; transitions?: Transition[] }>(\r\n          `/api/trades/${tradeId}`,\r\n          { cache: \"no-store\", headers }\r\n        ),\r\n        fetchJsonOrThrow<{ evidence?: EvidenceObject[] }>(\r\n          `/api/trades/${tradeId}/evidence`,\r\n          { cache: \"no-store\", headers }\r\n        ),\r\n        fetchJsonOrThrow<{ risk_assessment?: RiskAssessment }>(\r\n          `/api/trades/${tradeId}/risk`,\r\n          { cache: \"no-store\", headers }\r\n        ),\r\n        fetchJsonOrThrow<{ dispute?: Dispute; decisions?: DisputeDecision[] }>(\r\n          disputeHref,\r\n          { cache: \"no-store\", headers }\r\n        ),\r\n      ]);\r\n\r\n      setTrade(tradeJson.trade ?? null);\r\n      setTransitions(tradeJson.transitions ?? []);\r\n      setEvidence(evidenceJson.evidence ?? []);\r\n      setRisk(riskJson.risk_assessment ?? null);\r\n      setDispute(disputeJson.dispute ?? null);\r\n      setDisputeDecisions(disputeJson.decisions ?? []);\r\n\r\n      const defaultSubmittedBy = tradeJson.trade?.buyer_user_id ?? \"\";\r\n      setSubmittedBy((prev) => (prev ? prev : defaultSubmittedBy));\r\n\r\n      const defaultDisputeOpenedBy = tradeJson.trade?.buyer_user_id ?? \"\";\r\n      setDisputeOpenedBy((prev) => (prev ? prev : defaultDisputeOpenedBy));\r\n\r\n      const defaultActing = sessionUserId ?? tradeJson.trade?.buyer_user_id ?? \"\";\r\n      setActingUserId((prev) => (prev ? prev : defaultActing));\r\n    } catch (e) {\r\n      if (e instanceof ApiError) {\r\n        setError({ code: e.code, details: e.details });\r\n      } else {\r\n        setError({ code: e instanceof Error ? e.message : \"load_failed\" });\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    const preferred = readActingUserIdPreference();\r\n    if (preferred) {\r\n      setActingUserId((prev) => (prev ? prev : preferred));\r\n    }\r\n    void refreshSession();\r\n    setActingUserInitialized(true);\r\n  }, [tradeId]);\r\n\r\n  useEffect(() => {\r\n    if (authMode !== \"session\") return;\r\n    if (!actingUserId) return;\r\n    if (sessionUserId === actingUserId) return;\r\n    if (sessionLoading) return;\r\n\r\n    const isProd = process.env.NODE_ENV === \"production\";\r\n    if (isProd && !sessionBootstrapKey) return;\r\n\r\n    void signInAs(actingUserId);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [authMode]);\r\n\r\n  useEffect(() => {\r\n    if (!actingUserId) return;\r\n    persistActingUserIdPreference(actingUserId);\r\n  }, [actingUserId]);\r\n\r\n  useEffect(() => {\r\n    if (!actingUserInitialized) return;\r\n    if (authMode === \"header\" && !actingUserId && process.env.NODE_ENV === \"production\") {\r\n      setLoading(false);\r\n      setError({ code: \"missing_x_user_id\" });\r\n      return;\r\n    }\r\n    if (authMode === \"session\" && !sessionUserId && process.env.NODE_ENV === \"production\") {\r\n      setLoading(false);\r\n      setError({ code: \"missing_x_user_id\" });\r\n      return;\r\n    }\r\n    void refreshAll();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [tradeId, actingUserId, actingUserInitialized, authMode, sessionUserId]);\r\n\r\n  async function runRiskAssessment() {\r\n    setError(null);\r\n    try {\r\n      if (authMode === \"session\" && sessionUserId && actingUserId && sessionUserId !== actingUserId) {\r\n        setError({ code: \"session_user_mismatch\" });\r\n        return;\r\n      }\r\n\r\n      await fetchJsonOrThrow(`/api/trades/${tradeId}/risk`, {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          ...(authMode === \"header\" && actingUserId ? { \"x-user-id\": actingUserId } : {}),\r\n        },\r\n        body: JSON.stringify({ version: \"v0\" }),\r\n      });\r\n      await refreshAll();\r\n    } catch (e) {\r\n      if (e instanceof ApiError) {\r\n        setError({ code: e.code, details: e.details });\r\n      } else {\r\n        setError({ code: e instanceof Error ? e.message : \"risk_failed\" });\r\n      }\r\n    }\r\n  }\r\n\r\n  async function uploadEvidence() {\r\n    if (!file) {\r\n      setError({ code: \"missing_file\" });\r\n      return;\r\n    }\r\n    if (!submittedBy) {\r\n      setError({ code: \"missing_submitted_by_user_id\" });\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      if (authMode === \"session\" && sessionUserId && submittedBy && sessionUserId !== submittedBy) {\r\n        setError({ code: \"session_user_mismatch\" });\r\n        return;\r\n      }\r\n\r\n      const form = new FormData();\r\n      form.set(\"submitted_by_user_id\", submittedBy);\r\n      form.set(\"type\", uploadType);\r\n      form.set(\"metadata_json\", metadataJson);\r\n      form.set(\"file\", file);\r\n\r\n      const init: RequestInit = { method: \"POST\", body: form };\r\n      if (authMode === \"header\" && submittedBy) {\r\n        init.headers = { \"x-user-id\": submittedBy };\r\n      }\r\n\r\n      await fetchJsonOrThrow(evidenceUploadHref, init);\r\n\r\n      setFile(null);\r\n      await refreshAll();\r\n    } catch (e) {\r\n      if (e instanceof ApiError) {\r\n        setError({ code: e.code, details: e.details });\r\n      } else {\r\n        setError({ code: e instanceof Error ? e.message : \"upload_failed\" });\r\n      }\r\n    } finally {\r\n      setUploading(false);\r\n    }\r\n  }\r\n\r\n  async function openDispute() {\r\n    if (!disputeOpenedBy) {\r\n      setError({ code: \"missing_opened_by_user_id\" });\r\n      return;\r\n    }\r\n\r\n    setOpeningDispute(true);\r\n    setError(null);\r\n\r\n    try {\r\n      if (authMode === \"session\" && sessionUserId && disputeOpenedBy && sessionUserId !== disputeOpenedBy) {\r\n        setError({ code: \"session_user_mismatch\" });\r\n        return;\r\n      }\r\n\r\n      await fetchJsonOrThrow(disputeHref, {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          ...(authMode === \"header\" ? { \"x-user-id\": disputeOpenedBy } : {}),\r\n        },\r\n        body: JSON.stringify({\r\n          opened_by_user_id: disputeOpenedBy,\r\n          reason_code: disputeReason,\r\n        }),\r\n      });\r\n      await refreshAll();\r\n    } catch (e) {\r\n      if (e instanceof ApiError) {\r\n        setError({ code: e.code, details: e.details });\r\n      } else {\r\n        setError({ code: e instanceof Error ? e.message : \"open_dispute_failed\" });\r\n      }\r\n    } finally {\r\n      setOpeningDispute(false);\r\n    }\r\n  }\r\n\r\n  async function submitDecision() {\r\n    if (!decisionBy) {\r\n      setError({ code: \"missing_decided_by\" });\r\n      return;\r\n    }\r\n\r\n    setSubmittingDecision(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const headers: Record<string, string> = { \"Content-Type\": \"application/json\" };\r\n      if (reviewerKey) headers[\"x-reviewer-key\"] = reviewerKey;\r\n\r\n      await fetchJsonOrThrow(disputeDecisionHref, {\r\n        method: \"POST\",\r\n        headers,\r\n        body: JSON.stringify({\r\n          decision: decisionType,\r\n          decided_by: decisionBy,\r\n          rationale: decisionRationale ? decisionRationale : undefined,\r\n        }),\r\n      });\r\n\r\n      setDecisionRationale(\"\");\r\n      await refreshAll();\r\n    } catch (e) {\r\n      if (e instanceof ApiError) {\r\n        setError({ code: e.code, details: e.details });\r\n      } else {\r\n        setError({ code: e instanceof Error ? e.message : \"submit_decision_failed\" });\r\n      }\r\n    } finally {\r\n      setSubmittingDecision(false);\r\n    }\r\n  }\r\n\r\n  async function transitionTrade(next: TradeStatus) {\r\n    setTransitioning(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const segment: Record<TradeStatus, string> = {\r\n        created: \"\",\r\n        awaiting_payment: \"awaiting-payment\",\r\n        paid_marked: \"paid-marked\",\r\n        released: \"released\",\r\n        disputed: \"\",\r\n        resolved: \"resolved\",\r\n        canceled: \"canceled\",\r\n      };\r\n\r\n      const path = segment[next];\r\n      if (!path) {\r\n        setError({ code: \"trade_transition_not_allowed\" });\r\n        return;\r\n      }\r\n\r\n      const init: RequestInit = { method: \"POST\" };\r\n      if (authMode === \"header\" && actingUserId) {\r\n        init.headers = { \"x-user-id\": actingUserId };\r\n      }\r\n\r\n      await fetchJsonOrThrow(`/api/trades/${tradeId}/status/${path}`, init);\r\n\r\n      setToastKind(\"success\");\r\n      setToastMessage(`Trade moved to ${next}.`);\r\n      await refreshAll();\r\n    } catch (e) {\r\n      if (e instanceof ApiError) {\r\n        setError({ code: e.code, details: e.details });\r\n      } else {\r\n        setError({ code: e instanceof Error ? e.message : \"transition_failed\" });\r\n      }\r\n    } finally {\r\n      setTransitioning(false);\r\n    }\r\n  }\r\n\r\n  if (loading) {\r\n    return <div className=\"mt-6 text-[13px] text-[var(--v2-muted)]\">Loading…</div>;\r\n  }\r\n\r\n  if (error) {\r\n    return <ApiErrorBanner error={error} className=\"mt-6\" onRetry={() => void refreshAll()} />;\r\n  }\r\n\r\n  if (!trade) {\r\n    return <div className=\"mt-6 text-[13px] text-[var(--v2-muted)]\">Not found.</div>;\r\n  }\r\n\r\n  const selectClass =\r\n    \"h-11 w-full rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 text-[14px] font-semibold text-[var(--v2-text)] shadow-[var(--v2-shadow-sm)] outline-none focus:ring-2 focus:ring-[var(--v2-ring)]\";\r\n  const selectClassSm =\r\n    \"h-9 rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 text-[12px] font-semibold text-[var(--v2-text)] shadow-[var(--v2-shadow-sm)] outline-none focus:ring-2 focus:ring-[var(--v2-ring)]\";\r\n  const textareaClass =\r\n    \"min-h-20 w-full rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-2 text-[13px] text-[var(--v2-text)] shadow-[var(--v2-shadow-sm)] outline-none focus:ring-2 focus:ring-[var(--v2-ring)]\";\r\n  const preClass =\r\n    \"overflow-auto rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface-2)] px-3 py-2 font-mono text-[12px] text-[var(--v2-text)]\";\r\n\r\n  return (\r\n    <div className=\"mt-6 grid gap-6\">\r\n      <Toast\r\n        message={toastMessage}\r\n        kind={toastKind}\r\n        onDone={() => setToastMessage(null)}\r\n      />\r\n\r\n      <V2Card>\r\n        <V2CardHeader\r\n          title=\"Viewer\"\r\n          subtitle={\r\n            <span>\r\n              Auth: use a session cookie (recommended) or send{\" \"}\r\n              <span className=\"font-mono\">x-user-id</span>.\r\n            </span>\r\n          }\r\n        />\r\n        <V2CardBody>\r\n          <div className=\"grid gap-2\">\r\n            <div className=\"flex flex-wrap items-center gap-3\">\r\n              <label className=\"flex items-center gap-2 text-[12px] text-[var(--v2-muted)]\">\r\n                <span className=\"font-semibold\">Auth mode</span>\r\n                <select\r\n                  className={selectClassSm}\r\n                value={authMode}\r\n                onChange={(e) => {\r\n                  const next = e.target.value as typeof authMode;\r\n                  setAuthMode(next);\r\n\r\n                  if (next !== \"session\") return;\r\n\r\n                  if (!actingUserId) return;\r\n                  if (sessionUserId === actingUserId) return;\r\n\r\n                  const isProd = process.env.NODE_ENV === \"production\";\r\n                  if (isProd && !sessionBootstrapKey) return;\r\n\r\n                  void signInAs(actingUserId);\r\n                }}\r\n              >\r\n                <option value=\"session\">session cookie</option>\r\n                <option value=\"header\">x-user-id header</option>\r\n              </select>\r\n            </label>\r\n\r\n            {authMode === \"session\" ? (\r\n              <div className=\"flex flex-wrap items-center gap-2 text-[12px] text-[var(--v2-muted)]\">\r\n                <span className=\"font-semibold\">Session</span>\r\n                <span className=\"font-mono\">\r\n                  {sessionUserId ? `${sessionUserId.slice(0, 8)}…` : \"(none)\"}\r\n                </span>\r\n                <V2Button\r\n                  size=\"sm\"\r\n                  variant=\"secondary\"\r\n                  disabled={!actingUserId || sessionLoading}\r\n                  onClick={() => void signInAs(actingUserId)}\r\n                >\r\n                  Sign in\r\n                </V2Button>\r\n                <V2Button\r\n                  size=\"sm\"\r\n                  variant=\"secondary\"\r\n                  disabled={sessionLoading}\r\n                  onClick={() => void signOut()}\r\n                >\r\n                  Sign out\r\n                </V2Button>\r\n                <details>\r\n                  <summary className=\"cursor-pointer text-[11px] font-semibold text-[var(--v2-muted)]\">prod bootstrap</summary>\r\n                  <div className=\"mt-2 grid gap-1\">\r\n                    <label className=\"grid gap-1\">\r\n                      <span className=\"text-[11px] font-semibold text-[var(--v2-muted)]\">x-session-bootstrap-key</span>\r\n                      <V2Input\r\n                        className=\"h-10 font-mono text-[12px]\"\r\n                        value={sessionBootstrapKey}\r\n                        type=\"password\"\r\n                        placeholder=\"(only needed in production)\"\r\n                        onChange={(e) => setSessionBootstrapKey(e.target.value)}\r\n                      />\r\n                    </label>\r\n                  </div>\r\n                </details>\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-[12px] text-[var(--v2-muted)]\">Requests send x-user-id.</div>\r\n            )}\r\n          </div>\r\n\r\n          <label className=\"grid gap-1\">\r\n            <span className=\"text-[12px] font-semibold text-[var(--v2-muted)]\">Acting user</span>\r\n            <select\r\n              className={selectClass}\r\n              value={actingUserId}\r\n              onChange={(e) => {\r\n                const next = e.target.value;\r\n                if (authMode !== \"session\") {\r\n                  setActingUserId(next);\r\n                  return;\r\n                }\r\n\r\n                const prev = actingUserId;\r\n                setActingUserId(next);\r\n\r\n                if (sessionUserId === next) return;\r\n\r\n                const isProd = process.env.NODE_ENV === \"production\";\r\n                if (isProd && !sessionBootstrapKey) return;\r\n\r\n                void (async () => {\r\n                  const ok = await signInAs(next);\r\n                  if (!ok) setActingUserId(prev);\r\n                })();\r\n              }}\r\n            >\r\n              <option value={trade.buyer_user_id}>buyer {trade.buyer_user_id.slice(0, 8)}…</option>\r\n              <option value={trade.seller_user_id}>seller {trade.seller_user_id.slice(0, 8)}…</option>\r\n            </select>\r\n          </label>\r\n          </div>\r\n        </V2CardBody>\r\n      </V2Card>\r\n\r\n      <V2Card>\r\n        <V2CardHeader\r\n          title=\"Trade\"\r\n          right={\r\n            <div className=\"flex items-center gap-2\">\r\n              <a className=\"text-[13px] font-semibold text-[var(--v2-accent-2)] underline\" href={proofPackHref}>\r\n                Download Proof Pack\r\n              </a>\r\n              <V2Button\r\n                size=\"sm\"\r\n                variant=\"secondary\"\r\n                onClick={async () => {\r\n                  try {\r\n                    const absolute = new URL(proofPackHref, window.location.origin).toString();\r\n                    const ok = await copyToClipboard(absolute);\r\n                    if (ok) {\r\n                      setToastKind(\"success\");\r\n                      setToastMessage(\"Proof pack link copied.\");\r\n                    } else {\r\n                      setToastKind(\"error\");\r\n                      setToastMessage(\"Copy failed.\");\r\n                    }\r\n                  } catch {\r\n                    setToastKind(\"error\");\r\n                    setToastMessage(\"Copy failed.\");\r\n                  }\r\n                }}\r\n              >\r\n                Copy link\r\n              </V2Button>\r\n            </div>\r\n          }\r\n        />\r\n        <V2CardBody>\r\n\r\n        <details className=\"mt-2\">\r\n          <summary className=\"cursor-pointer text-[12px] font-semibold text-[var(--v2-muted)]\">Verify locally</summary>\r\n          <div className=\"mt-2 grid gap-2 text-[12px] text-[var(--v2-muted)]\">\r\n            <div>\r\n              Run from <span className=\"font-mono\">apps/web</span> after downloading the ZIP:\r\n            </div>\r\n            <div className=\"flex flex-wrap items-center gap-2\">\r\n              <pre className={preClass}>\r\n                npm run verify:proofpack -- &lt;path-to-zip&gt;\r\n              </pre>\r\n              <V2Button\r\n                size=\"sm\"\r\n                variant=\"secondary\"\r\n                onClick={async () => {\r\n                  const ok = await copyToClipboard(\"npm run verify:proofpack -- <path-to-zip>\");\r\n                  setToastKind(ok ? \"success\" : \"error\");\r\n                  setToastMessage(ok ? \"Command copied.\" : \"Copy failed.\");\r\n                }}\r\n              >\r\n                Copy\r\n              </V2Button>\r\n            </div>\r\n            <div className=\"flex flex-wrap items-center gap-2\">\r\n              <pre className={preClass}>\r\n                npm run verify:proofpack -- --require-signed &lt;path-to-zip&gt;\r\n              </pre>\r\n              <V2Button\r\n                size=\"sm\"\r\n                variant=\"secondary\"\r\n                onClick={async () => {\r\n                  const ok = await copyToClipboard(\r\n                    \"npm run verify:proofpack -- --require-signed <path-to-zip>\"\r\n                  );\r\n                  setToastKind(ok ? \"success\" : \"error\");\r\n                  setToastMessage(ok ? \"Command copied.\" : \"Copy failed.\");\r\n                }}\r\n              >\r\n                Copy\r\n              </V2Button>\r\n            </div>\r\n          </div>\r\n        </details>\r\n\r\n        {transitions.length ? (\r\n          <div className=\"mt-3 rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface-2)] p-3 text-[13px]\">\r\n            <div className=\"flex flex-wrap items-center gap-2\">\r\n              <span className=\"text-[var(--v2-muted)]\">Latest transition:</span>\r\n              <span className=\"font-mono\">\r\n                {transitions[transitions.length - 1]!.from_status ?? \"∅\"} → {transitions[transitions.length - 1]!.to_status}\r\n              </span>\r\n              <span className=\"text-[var(--v2-muted)]\">@</span>\r\n              <span className=\"font-mono text-[12px] text-[var(--v2-muted)]\">\r\n                {transitions[transitions.length - 1]!.created_at}\r\n              </span>\r\n            </div>\r\n            {transitions[transitions.length - 1]!.reason_code ? (\r\n              <div className=\"mt-1 font-mono text-[12px] text-[var(--v2-muted)]\">\r\n                {transitions[transitions.length - 1]!.reason_code}\r\n              </div>\r\n            ) : null}\r\n          </div>\r\n        ) : null}\r\n\r\n        <div className=\"mt-3 grid gap-2 text-[13px] text-[var(--v2-text)]\">\r\n          <div>\r\n            <span className=\"text-[var(--v2-muted)]\">Status:</span> {trade.status}\r\n          </div>\r\n\r\n          {actingRole ? (\r\n            <div className=\"flex flex-wrap items-center gap-2\">\r\n              <span className=\"text-[var(--v2-muted)]\">You are:</span>\r\n              <span\r\n                className={\r\n                  actingRole === \"buyer\"\r\n                    ? \"rounded-full border border-[color-mix(in_srgb,var(--up)_35%,var(--v2-border))] bg-[color-mix(in_srgb,var(--up)_10%,transparent)] px-2 py-0.5 text-[11px] font-semibold text-[var(--up)]\"\r\n                    : \"rounded-full border border-[color-mix(in_srgb,var(--v2-accent-2)_35%,var(--v2-border))] bg-[color-mix(in_srgb,var(--v2-accent-2)_10%,transparent)] px-2 py-0.5 text-[11px] font-semibold text-[var(--v2-accent-2)]\"\r\n                }\r\n              >\r\n                {actingRole}\r\n              </span>\r\n            </div>\r\n          ) : null}\r\n\r\n          <div className=\"flex flex-wrap items-center gap-2\">\r\n            <span className=\"text-[12px] text-[var(--v2-muted)]\">Lifecycle:</span>\r\n\r\n            <V2Button\r\n              size=\"sm\"\r\n              variant=\"secondary\"\r\n              disabled={\r\n                transitioning ||\r\n                !canTransitionTrade(trade.status, \"awaiting_payment\")\r\n              }\r\n              onClick={() => void transitionTrade(\"awaiting_payment\")}\r\n              title={lifecycleTitle(\"awaiting_payment\") || \"created → awaiting_payment\"}\r\n            >\r\n              Awaiting payment\r\n            </V2Button>\r\n\r\n            <V2Button\r\n              size=\"sm\"\r\n              variant=\"secondary\"\r\n              disabled={\r\n                transitioning ||\r\n                !canTransitionTrade(trade.status, \"paid_marked\") ||\r\n                actingUserId !== trade.buyer_user_id\r\n              }\r\n              onClick={() => void transitionTrade(\"paid_marked\")}\r\n              title={\r\n                lifecycleTitle(\"paid_marked\", { role: \"buyer\" }) ||\r\n                \"awaiting_payment → paid_marked\"\r\n              }\r\n            >\r\n              Mark paid (buyer)\r\n            </V2Button>\r\n\r\n            <V2Button\r\n              size=\"sm\"\r\n              variant=\"secondary\"\r\n              disabled={\r\n                transitioning ||\r\n                !canTransitionTrade(trade.status, \"released\") ||\r\n                actingUserId !== trade.seller_user_id\r\n              }\r\n              onClick={() => void transitionTrade(\"released\")}\r\n              title={\r\n                lifecycleTitle(\"released\", { role: \"seller\" }) || \"paid_marked → released\"\r\n              }\r\n            >\r\n              Release (seller)\r\n            </V2Button>\r\n\r\n            <V2Button\r\n              size=\"sm\"\r\n              variant=\"secondary\"\r\n              disabled={transitioning || !canTransitionTrade(trade.status, \"resolved\")}\r\n              onClick={() => void transitionTrade(\"resolved\")}\r\n              title={lifecycleTitle(\"resolved\") || \"Resolve trade\"}\r\n            >\r\n              Resolve\r\n            </V2Button>\r\n\r\n            <V2Button\r\n              size=\"sm\"\r\n              variant=\"danger\"\r\n              disabled={\r\n                transitioning ||\r\n                trade.status === \"disputed\" ||\r\n                !canTransitionTrade(trade.status, \"canceled\")\r\n              }\r\n              onClick={() => void transitionTrade(\"canceled\")}\r\n              title={lifecycleTitle(\"canceled\") || \"Cancel trade\"}\r\n            >\r\n              Cancel\r\n            </V2Button>\r\n          </div>\r\n\r\n          <div>\r\n            <span className=\"text-[var(--v2-muted)]\">Pair:</span> {trade.crypto_asset}/\r\n            {trade.fiat_currency}\r\n          </div>\r\n          <div className=\"font-mono\">\r\n            <span className=\"text-[var(--v2-muted)] font-sans\">Price:</span> {trade.price}\r\n          </div>\r\n          <div className=\"font-mono\">\r\n            <span className=\"text-[var(--v2-muted)] font-sans\">Fair mid:</span> {trade.fair_price_mid ?? \"—\"}\r\n          </div>\r\n          <div className=\"font-mono\">\r\n            <span className=\"text-[var(--v2-muted)] font-sans\">Deviation pct:</span> {trade.price_deviation_pct ?? \"—\"}\r\n          </div>\r\n          <div className=\"flex flex-wrap items-center gap-2 text-[12px]\">\r\n            <span className=\"font-mono text-[var(--v2-muted)]\">{trade.id}</span>\r\n            <V2Button\r\n              size=\"sm\"\r\n              variant=\"secondary\"\r\n              onClick={async () => {\r\n                const ok = await copyToClipboard(trade.id);\r\n                setToastKind(ok ? \"success\" : \"error\");\r\n                setToastMessage(ok ? \"Trade ID copied.\" : \"Copy failed.\");\r\n              }}\r\n            >\r\n              Copy ID\r\n            </V2Button>\r\n            <V2Button\r\n              size=\"sm\"\r\n              variant=\"secondary\"\r\n              onClick={async () => {\r\n                try {\r\n                  const relative = actingUserId\r\n                    ? `/trades/${trade.id}?user_id=${encodeURIComponent(actingUserId)}`\r\n                    : `/trades/${trade.id}`;\r\n                  const absolute = new URL(relative, window.location.origin).toString();\r\n                  const ok = await copyToClipboard(absolute);\r\n                  setToastKind(ok ? \"success\" : \"error\");\r\n                  setToastMessage(ok ? \"Trade link copied.\" : \"Copy failed.\");\r\n                } catch {\r\n                  setToastKind(\"error\");\r\n                  setToastMessage(\"Copy failed.\");\r\n                }\r\n              }}\r\n            >\r\n              Copy link\r\n            </V2Button>\r\n          </div>\r\n        </div>\r\n      </V2CardBody>\r\n      </V2Card>\r\n\r\n      <V2Card>\r\n        <V2CardHeader\r\n          title=\"Risk\"\r\n          right={\r\n            <V2Button variant=\"secondary\" onClick={() => void runRiskAssessment()}>\r\n              Recompute v0\r\n            </V2Button>\r\n          }\r\n        />\r\n        <V2CardBody>\r\n\r\n        {risk ? (\r\n          <div className=\"mt-1 text-[13px]\">\r\n            <div>\r\n              <span className=\"text-[var(--v2-muted)]\">Score:</span> {risk.score}\r\n            </div>\r\n            <div>\r\n              <span className=\"text-[var(--v2-muted)]\">Action:</span> {risk.recommended_action}\r\n            </div>\r\n            <details className=\"mt-3\">\r\n              <summary className=\"cursor-pointer text-[12px] font-semibold text-[var(--v2-muted)]\">Factors JSON</summary>\r\n              <pre className={\"mt-2 \" + preClass}>\r\n                {formatJson(risk.factors_json)}\r\n              </pre>\r\n            </details>\r\n          </div>\r\n        ) : (\r\n          <div className=\"mt-1 text-[13px] text-[var(--v2-muted)]\">No risk assessment yet.</div>\r\n        )}\r\n        </V2CardBody>\r\n      </V2Card>\r\n\r\n      <V2Card>\r\n        <V2CardHeader title=\"Evidence\" />\r\n        <V2CardBody>\r\n\r\n        <div className=\"text-[13px] text-[var(--v2-muted)]\">\r\n          Completeness score: <span className=\"font-mono\">{evidenceCompleteness.score}</span>/100\r\n          {evidenceCompleteness.missing_recommendations.length ? (\r\n            <span>\r\n              {\" \"}— next: {evidenceCompleteness.missing_recommendations.join(\", \")}\r\n            </span>\r\n          ) : null}\r\n        </div>\r\n\r\n        <div className=\"mt-3 grid gap-3\">\r\n          <div className=\"grid gap-2 md:grid-cols-2\">\r\n            <label className=\"grid gap-1\">\r\n              <span className=\"text-[12px] font-semibold text-[var(--v2-muted)]\">Submitted by</span>\r\n              <select\r\n                className={selectClass}\r\n                value={submittedBy}\r\n                onChange={(e) => setSubmittedBy(e.target.value)}\r\n              >\r\n                <option value={trade.buyer_user_id}>buyer {trade.buyer_user_id.slice(0, 8)}…</option>\r\n                <option value={trade.seller_user_id}>seller {trade.seller_user_id.slice(0, 8)}…</option>\r\n              </select>\r\n            </label>\r\n\r\n            <label className=\"grid gap-1\">\r\n              <span className=\"text-[12px] font-semibold text-[var(--v2-muted)]\">Type</span>\r\n              <select\r\n                className={selectClass}\r\n                value={uploadType}\r\n                onChange={(e) => setUploadType(e.target.value as typeof uploadType)}\r\n              >\r\n                <option value=\"receipt\">receipt</option>\r\n                <option value=\"screenshot\">screenshot</option>\r\n                <option value=\"bank_sms\">bank_sms</option>\r\n                <option value=\"chat_export\">chat_export</option>\r\n                <option value=\"other\">other</option>\r\n              </select>\r\n            </label>\r\n          </div>\r\n\r\n          <label className=\"grid gap-1\">\r\n            <span className=\"text-[12px] font-semibold text-[var(--v2-muted)]\">Metadata JSON</span>\r\n            <textarea\r\n              className={textareaClass + \" font-mono text-[12px]\"}\r\n              value={metadataJson}\r\n              onChange={(e) => setMetadataJson(e.target.value)}\r\n            />\r\n          </label>\r\n\r\n          <label className=\"grid gap-1\">\r\n            <span className=\"text-[12px] font-semibold text-[var(--v2-muted)]\">File</span>\r\n            <input\r\n              className=\"text-[13px] text-[var(--v2-text)]\"\r\n              type=\"file\"\r\n              onChange={(e) => setFile(e.target.files?.item(0) ?? null)}\r\n            />\r\n          </label>\r\n\r\n          <div className=\"flex items-center gap-3\">\r\n            <V2Button\r\n              variant=\"primary\"\r\n              disabled={uploading}\r\n              onClick={() => void uploadEvidence()}\r\n            >\r\n              {uploading ? \"Uploading…\" : \"Upload\"}\r\n            </V2Button>\r\n            <V2Button variant=\"ghost\" onClick={() => void refreshAll()}>\r\n              Refresh\r\n            </V2Button>\r\n          </div>\r\n\r\n          <div className=\"mt-2 rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)]\">\r\n            <div className=\"border-b border-[var(--v2-border)] px-3 py-2 text-[12px] font-semibold text-[var(--v2-muted)]\">\r\n              Evidence objects ({evidence.length})\r\n            </div>\r\n            <ul className=\"divide-y divide-[var(--v2-border)] text-[13px]\">\r\n              {evidence.map((ev) => (\r\n                <li key={ev.id} className=\"px-3 py-2\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <span className=\"text-[var(--v2-muted)]\">{ev.type}</span> — {ev.sha256.slice(0, 10)}…\r\n                    </div>\r\n                    <div className=\"text-[12px] text-[var(--v2-muted)]\">{ev.created_at}</div>\r\n                  </div>\r\n                  <div className=\"mt-1 font-mono text-[12px] text-[var(--v2-muted)]\">\r\n                    {ev.storage_uri}\r\n                  </div>\r\n                </li>\r\n              ))}\r\n              {evidence.length === 0 ? (\r\n                <li className=\"px-3 py-3 text-[13px] text-[var(--v2-muted)]\">No evidence yet.</li>\r\n              ) : null}\r\n            </ul>\r\n          </div>\r\n        </div>\r\n        </V2CardBody>\r\n      </V2Card>\r\n\r\n      <V2Card>\r\n        <V2CardHeader title=\"Dispute\" />\r\n        <V2CardBody>\r\n\r\n        {dispute ? (\r\n          <div className=\"grid gap-3 text-[13px]\">\r\n            <div>\r\n              <span className=\"text-[var(--v2-muted)]\">Status:</span> {dispute.status}\r\n            </div>\r\n            <div>\r\n              <span className=\"text-[var(--v2-muted)]\">Reason:</span> {dispute.reason_code}\r\n            </div>\r\n            <div className=\"font-mono text-[12px] text-[var(--v2-muted)]\">\r\n              opened_by={dispute.opened_by_user_id} opened_at={dispute.opened_at}\r\n            </div>\r\n\r\n            <div className=\"rounded-2xl border border-[var(--v2-border)]\">\r\n              <div className=\"border-b border-[var(--v2-border)] px-3 py-2 text-[12px] font-semibold text-[var(--v2-muted)]\">\r\n                Decisions ({disputeDecisions.length})\r\n              </div>\r\n              <ul className=\"divide-y divide-[var(--v2-border)] text-[13px]\">\r\n                {disputeDecisions.map((d) => (\r\n                  <li key={d.id} className=\"px-3 py-2\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div>\r\n                        <span className=\"text-[var(--v2-muted)]\">{d.decision}</span> — {d.decided_by}\r\n                      </div>\r\n                      <div className=\"text-[12px] text-[var(--v2-muted)]\">{d.created_at}</div>\r\n                    </div>\r\n                    {d.rationale ? (\r\n                      <div className=\"mt-1 text-[12px] text-[var(--v2-muted)]\">{d.rationale}</div>\r\n                    ) : null}\r\n                  </li>\r\n                ))}\r\n                {disputeDecisions.length === 0 ? (\r\n                  <li className=\"px-3 py-3 text-sm text-zinc-500\">\r\n                    No decisions yet.\r\n                  </li>\r\n                ) : null}\r\n              </ul>\r\n            </div>\r\n\r\n            {dispute.status !== \"resolved\" ? (\r\n              <div className=\"mt-2 grid gap-2\">\r\n                <div className=\"text-[13px] text-[var(--v2-muted)]\">Add decision (demo)</div>\r\n\r\n                <label className=\"grid gap-1\">\r\n                  <span className=\"text-[12px] font-semibold text-[var(--v2-muted)]\">Decided by</span>\r\n                  <V2Input\r\n                    value={decisionBy}\r\n                    onChange={(e) => setDecisionBy(e.target.value)}\r\n                  />\r\n                </label>\r\n\r\n                <label className=\"grid gap-1\">\r\n                  <span className=\"text-[12px] font-semibold text-[var(--v2-muted)]\">Reviewer key (optional)</span>\r\n                  <V2Input\r\n                    className=\"font-mono text-[12px]\"\r\n                    placeholder=\"PROOFPACK_REVIEWER_KEY\"\r\n                    value={reviewerKey}\r\n                    onChange={(e) => setReviewerKey(e.target.value)}\r\n                  />\r\n                </label>\r\n\r\n                <label className=\"grid gap-1\">\r\n                  <span className=\"text-[12px] font-semibold text-[var(--v2-muted)]\">Decision</span>\r\n                  <select\r\n                    className={selectClass}\r\n                    value={decisionType}\r\n                    onChange={(e) => setDecisionType(e.target.value as typeof decisionType)}\r\n                  >\r\n                    <option value=\"release_to_buyer\">release_to_buyer</option>\r\n                    <option value=\"refund_buyer\">refund_buyer</option>\r\n                    <option value=\"release_to_seller\">release_to_seller</option>\r\n                    <option value=\"cancel_trade\">cancel_trade</option>\r\n                  </select>\r\n                </label>\r\n\r\n                <label className=\"grid gap-1\">\r\n                  <span className=\"text-[12px] font-semibold text-[var(--v2-muted)]\">Rationale</span>\r\n                  <textarea\r\n                    className={textareaClass}\r\n                    value={decisionRationale}\r\n                    onChange={(e) => setDecisionRationale(e.target.value)}\r\n                  />\r\n                </label>\r\n\r\n                <div className=\"flex items-center gap-3\">\r\n                  <V2Button\r\n                    variant=\"primary\"\r\n                    disabled={submittingDecision}\r\n                    onClick={() => void submitDecision()}\r\n                  >\r\n                    {submittingDecision ? \"Submitting…\" : \"Submit decision\"}\r\n                  </V2Button>\r\n                  <V2Button variant=\"ghost\" onClick={() => void refreshAll()}>\r\n                    Refresh\r\n                  </V2Button>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"mt-2 text-[13px] text-[var(--v2-muted)]\">Resolved at {dispute.resolved_at ?? \"—\"}</div>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <div className=\"mt-3 grid gap-3\">\r\n            <div className=\"text-[13px] text-[var(--v2-muted)]\">No dispute yet.</div>\r\n\r\n            <div className=\"grid gap-2 md:grid-cols-2\">\r\n              <label className=\"grid gap-1\">\r\n                <span className=\"text-[12px] font-semibold text-[var(--v2-muted)]\">Opened by</span>\r\n                <select\r\n                  className={selectClass}\r\n                  value={disputeOpenedBy}\r\n                  onChange={(e) => setDisputeOpenedBy(e.target.value)}\r\n                >\r\n                  <option value={trade.buyer_user_id}>buyer {trade.buyer_user_id.slice(0, 8)}…</option>\r\n                  <option value={trade.seller_user_id}>seller {trade.seller_user_id.slice(0, 8)}…</option>\r\n                </select>\r\n              </label>\r\n\r\n              <label className=\"grid gap-1\">\r\n                <span className=\"text-[12px] font-semibold text-[var(--v2-muted)]\">Reason</span>\r\n                <select\r\n                  className={selectClass}\r\n                  value={disputeReason}\r\n                  onChange={(e) => setDisputeReason(e.target.value as typeof disputeReason)}\r\n                >\r\n                  <option value=\"non_payment\">non_payment</option>\r\n                  <option value=\"chargeback\">chargeback</option>\r\n                  <option value=\"phishing\">phishing</option>\r\n                  <option value=\"other\">other</option>\r\n                </select>\r\n              </label>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-3\">\r\n              <V2Button\r\n                variant=\"primary\"\r\n                disabled={openingDispute}\r\n                onClick={() => void openDispute()}\r\n              >\r\n                {openingDispute ? \"Opening…\" : \"Open dispute\"}\r\n              </V2Button>\r\n              <V2Button variant=\"ghost\" onClick={() => void refreshAll()}>\r\n                Refresh\r\n              </V2Button>\r\n            </div>\r\n          </div>\r\n        )}\r\n        </V2CardBody>\r\n      </V2Card>\r\n\r\n      <V2Card>\r\n        <V2CardHeader title=\"Transitions\" />\r\n        <V2CardBody>\r\n        <ul className=\"divide-y divide-[var(--v2-border)] text-[13px]\">\r\n          {transitions.map((t) => (\r\n            <li key={t.id} className=\"py-2\">\r\n              <div>\r\n                <span className=\"text-[var(--v2-muted)]\">{t.created_at}</span> — {t.from_status ?? \"∅\"} → {t.to_status}\r\n              </div>\r\n              <div className=\"text-[12px] text-[var(--v2-muted)] font-mono\">\r\n                {t.reason_code ?? \"\"}\r\n              </div>\r\n            </li>\r\n          ))}\r\n        </ul>\r\n        </V2CardBody>\r\n      </V2Card>\r\n    </div>\r\n  );\r\n}\r\n","export type EvidenceLike = {\r\n  type: string;\r\n  metadata_json?: unknown;\r\n};\r\n\r\nexport type EvidenceCompleteness = {\r\n  score: number;\r\n  evidence_count: number;\r\n  evidence_types: string[];\r\n  missing_recommendations: string[];\r\n};\r\n\r\nfunction uniqSorted(values: string[]): string[] {\r\n  return Array.from(new Set(values)).sort();\r\n}\r\n\r\nexport function computeEvidenceCompleteness(evidence: EvidenceLike[]): EvidenceCompleteness {\r\n  const evidenceTypes = uniqSorted(\r\n    evidence\r\n      .map((e) => (typeof e?.type === \"string\" ? e.type : \"\"))\r\n      .filter(Boolean)\r\n  );\r\n\r\n  const has = (t: string) => evidenceTypes.includes(t);\r\n\r\n  const evidence_count = evidence.length;\r\n  if (evidence_count === 0) {\r\n    return {\r\n      score: 0,\r\n      evidence_count,\r\n      evidence_types: evidenceTypes,\r\n      missing_recommendations: [\r\n        \"upload a payment proof (receipt/bank_sms)\",\r\n        \"upload chat export\",\r\n      ],\r\n    };\r\n  }\r\n\r\n  let score = 0;\r\n\r\n  if (has(\"receipt\") || has(\"bank_sms\")) score += 40;\r\n  if (has(\"chat_export\")) score += 30;\r\n  if (has(\"screenshot\")) score += 20;\r\n  if (evidence_count >= 2) score += 10;\r\n\r\n  score = Math.max(0, Math.min(100, score));\r\n\r\n  const missing_recommendations: string[] = [];\r\n  if (!has(\"receipt\") && !has(\"bank_sms\")) {\r\n    missing_recommendations.push(\"upload a payment proof (receipt/bank_sms)\");\r\n  }\r\n  if (!has(\"chat_export\")) missing_recommendations.push(\"upload chat export\");\r\n  if (!has(\"screenshot\")) missing_recommendations.push(\"upload screenshots\");\r\n\r\n  return {\r\n    score,\r\n    evidence_count,\r\n    evidence_types: evidenceTypes,\r\n    missing_recommendations,\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}