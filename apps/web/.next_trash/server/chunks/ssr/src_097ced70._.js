module.exports=[56773,a=>{"use strict";var b=a.i(187924);let c=a.i(572131).forwardRef(function({className:a="",type:c="text",...d},e){return(0,b.jsx)("input",{ref:e,type:c,className:"h-11 w-full rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 text-[14px] text-[var(--v2-text)] shadow-[var(--v2-shadow-sm)] outline-none placeholder:text-[color-mix(in_srgb,var(--v2-muted)_70%,transparent)] focus:ring-2 focus:ring-[var(--v2-ring)] "+a,...d})});a.s(["V2Input",0,c])},556836,a=>{"use strict";var b=a.i(187924);function c(a){let b=a?.variant??"secondary",c=a?.size??"md";return["inline-flex select-none items-center justify-center gap-2 whitespace-nowrap rounded-xl transition focus:outline-none focus:ring-2 focus:ring-[var(--v2-ring)] disabled:pointer-events-none disabled:opacity-55","lg"===c?"h-12 px-5 text-[15px]":"sm"===c?"h-9 px-3 text-[13px]":"h-11 px-4 text-[14px]","primary"===b?"bg-[var(--v2-accent)] text-white font-semibold shadow-[var(--v2-shadow-sm)] hover:brightness-105":"danger"===b?"bg-[var(--down)] text-white font-semibold shadow-[var(--v2-shadow-sm)] hover:brightness-105":"ghost"===b?"bg-transparent text-[var(--v2-text)] font-semibold hover:bg-[var(--v2-surface-2)]":"border border-[var(--v2-border)] bg-[var(--v2-surface)] text-[var(--v2-text)] font-semibold shadow-[var(--v2-shadow-sm)] hover:bg-[var(--v2-surface-2)]",a?.fullWidth?"w-full":"",a?.className??""].filter(Boolean).join(" ")}let d=a.i(572131).forwardRef(function({variant:a,size:d,fullWidth:e,className:f,type:g,...h},i){return(0,b.jsx)("button",{ref:i,type:g??"button",className:c({variant:a,size:d,fullWidth:e,className:f}),...h})});a.s(["V2Button",0,d,"v2ButtonClassName",()=>c])},214373,a=>{"use strict";var b=a.i(187924);function c({children:a,className:c=""}){return(0,b.jsx)("section",{className:"rounded-[var(--v2-radius-lg)] border border-[var(--v2-border)] bg-[var(--v2-surface)] shadow-[var(--v2-shadow-sm)] "+c,children:a})}function d({title:a,subtitle:c,right:d}){return(0,b.jsxs)("header",{className:"flex items-start justify-between gap-3 px-4 pt-4",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"text-[15px] font-semibold text-[var(--v2-text)]",children:a}),c?(0,b.jsx)("div",{className:"mt-0.5 text-[13px] text-[var(--v2-muted)]",children:c}):null]}),d?(0,b.jsx)("div",{className:"shrink-0",children:d}):null]})}function e({children:a}){return(0,b.jsx)("div",{className:"px-4 pb-4 pt-3",children:a})}a.s(["V2Card",()=>c,"V2CardBody",()=>e,"V2CardHeader",()=>d])},782691,a=>{"use strict";var b=a.i(187924);function c({className:a=""}){return(0,b.jsx)("div",{className:"animate-pulse rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface-2)] "+a,"aria-hidden":"true"})}a.s(["V2Skeleton",()=>c])},152608,a=>{"use strict";var b=a.i(187924);function c({tabs:a,activeId:c,onChange:d}){return(0,b.jsx)("div",{className:"grid gap-1 rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] p-1 shadow-[var(--v2-shadow-sm)]",style:{gridTemplateColumns:`repeat(${Math.max(1,a.length)}, minmax(0, 1fr))`},role:"tablist",children:a.map(a=>{let e=a.id===c;return(0,b.jsx)("button",{type:"button",role:"tab","aria-selected":e,className:"h-10 rounded-xl text-[13px] font-semibold transition "+(e?"bg-[var(--v2-surface-2)] text-[var(--v2-text)]":"text-[var(--v2-muted)] hover:bg-[var(--v2-surface-2)]/70"),onClick:()=>d(a.id),children:a.label},a.id)})})}a.s(["V2Tabs",()=>c])},825683,a=>{"use strict";var b=a.i(187924),c=a.i(572131);function d({open:a,title:d,onClose:e,children:f}){return((0,c.useEffect)(()=>{if(!a)return;let b=a=>{"Escape"===a.key&&e()};document.addEventListener("keydown",b);let c=document.documentElement.style.overflow;return document.documentElement.style.overflow="hidden",()=>{document.removeEventListener("keydown",b),document.documentElement.style.overflow=c}},[a,e]),a)?(0,b.jsxs)("div",{className:"fixed inset-0 z-[100]",children:[(0,b.jsx)("button",{type:"button",className:"absolute inset-0 bg-black/40","aria-label":"Close",onClick:e}),(0,b.jsxs)("div",{className:"absolute inset-x-0 bottom-0 mx-auto w-full max-w-xl rounded-t-[28px] border border-[var(--v2-border)] bg-[var(--v2-surface)] shadow-[var(--v2-shadow-md)]",style:{paddingBottom:"env(safe-area-inset-bottom)"},role:"dialog","aria-modal":"true",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3 px-4 pb-2 pt-3",children:[(0,b.jsx)("div",{className:"min-w-0",children:d?(0,b.jsx)("div",{className:"truncate text-[15px] font-semibold text-[var(--v2-text)]",children:d}):null}),(0,b.jsx)("button",{type:"button",onClick:e,className:"h-9 rounded-xl px-3 text-[13px] font-semibold text-[var(--v2-muted)] hover:bg-[var(--v2-surface-2)]",children:"Close"})]}),(0,b.jsx)("div",{className:"max-h-[70dvh] overflow-auto px-4 pb-4 pt-2",children:f})]})]}):null}a.s(["V2Sheet",()=>d])},270877,a=>{"use strict";var b=a.i(187924),c=a.i(238246),d=a.i(572131),e=a.i(50944),f=a.i(556836),g=a.i(214373),h=a.i(56773),i=a.i(825683),j=a.i(782691),k=a.i(152608);function l(a){let b="number"==typeof a?a:Number(String(a));return Number.isFinite(b)?b:null}function m(a,b){let c=l(a);if(null==c)return"—";try{return new Intl.NumberFormat(void 0,{style:"currency",currency:b,currencyDisplay:"code",maximumFractionDigits:2}).format(c)}catch{return`${c.toLocaleString()} ${b}`}}function n(a){let b=l(a);if(null==b)return"—";if(0===b)return"0";let c=Math.abs(b);return b.toLocaleString(void 0,{maximumFractionDigits:c>=1e3?2:c>=1?4:c>=.01?6:8})}function o(){let a=(0,e.useRouter)(),[o,p]=(0,d.useState)("BUY"),q="USDT",[r,s]=(0,d.useState)(""),[t,u]=(0,d.useState)([]),[v,w]=(0,d.useState)(!0),[x,y]=(0,d.useState)(null),z=(0,d.useRef)(!1),A=(0,d.useRef)("BUY"),B=(0,d.useRef)(""),C=(0,d.useRef)(0),D=(0,d.useRef)(null),E=async()=>{let a=++C.current;D.current?.abort();let b=new AbortController;D.current=b,y(null),z.current||w(!0);try{let c=new URLSearchParams({side:A.current,asset:q,fiat:"USD"}),d=l(B.current);null!=d&&d>0&&c.set("amount",String(d));let e=await fetch(`/api/p2p/ads?${c.toString()}`,{cache:"no-store",signal:b.signal}),f=await e.json().catch(()=>null);if(!e.ok){let a="string"==typeof f?.error?f.error:`http_${e.status}`;throw Error(a)}if(a!==C.current)return;u(Array.isArray(f?.ads)?f.ads:[]),z.current=!0}catch(b){if(b instanceof DOMException&&"AbortError"===b.name||a!==C.current)return;z.current||y(b instanceof Error?b.message:String(b))}finally{a===C.current&&w(!1)}};(0,d.useEffect)(()=>{A.current=o},[o]),(0,d.useEffect)(()=>{B.current=r},[r]),(0,d.useEffect)(()=>{E();let a=null,b=()=>{a&&(window.clearTimeout(a),a=null)},c=()=>{b(),a=window.setTimeout(()=>{a=null,"visible"===document.visibilityState&&E(),c()},35e3)},d=()=>{"visible"===document.visibilityState?(E(),c()):b()};return document.addEventListener("visibilitychange",d),c(),()=>{document.removeEventListener("visibilitychange",d),b(),D.current?.abort()}},[]),(0,d.useEffect)(()=>{E()},[o]),(0,d.useEffect)(()=>{let a=window.setTimeout(()=>{"visible"===document.visibilityState&&E()},250);return()=>window.clearTimeout(a)},[r]);let F=(0,d.useMemo)(()=>[{id:"BUY",label:"Buy"},{id:"SELL",label:"Sell"}],[]),[G,H]=(0,d.useState)(!1),[I,J]=(0,d.useState)(null),[K,L]=(0,d.useState)(""),[M,N]=(0,d.useState)(null),[O,P]=(0,d.useState)(!1),[Q,R]=(0,d.useState)([]),[S,T]=(0,d.useState)(!1),[U,V]=(0,d.useState)(null),W="SELL"===o,X=async()=>{if(!S)try{let a=await fetch("/api/p2p/payment-methods",{cache:"no-store",credentials:"include"}),b=await a.json().catch(()=>null);if(a.ok){let a=Array.isArray(b?.methods)?b.methods:[];R(a)}}finally{T(!0)}};(0,d.useEffect)(()=>{!G||W&&X()},[G,W]);let Y=async()=>{var b;if(!I||O)return;let c=l(I.min_limit)??0,d=l(I.max_limit)??0,e=l(K);if(null==e||e<=0)return void N("Enter an amount.");let f=d>0?(b=c||0,Number.isFinite(e)?Math.min(d,Math.max(b,e)):b):e;if(c>0&&f<c)return void N(`Minimum is ${n(String(c))} USD.`);if(d>0&&f>d)return void N(`Maximum is ${n(String(d))} USD.`);if(W&&!U)return void N("Select a payout method (required to sell).");P(!0),N(null);try{let b=await fetch("/api/p2p/orders",{method:"POST",headers:{"content-type":"application/json"},credentials:"include",body:JSON.stringify({ad_id:I.id,amount_fiat:f,...W?{payment_method_id:U}:{}})}),c=await b.json().catch(()=>null);if(!b.ok){let a="string"==typeof c?.error?c.error:`http_${b.status}`;throw Error(a)}let d="string"==typeof c?.order_id?c.order_id:null;if(!d)throw Error("order_create_failed");H(!1),a.push(`/v2/p2p/orders/${encodeURIComponent(d)}`)}catch(a){N(a instanceof Error?a.message:String(a))}finally{P(!1)}};return(0,b.jsxs)("main",{className:"space-y-4",children:[(0,b.jsxs)("header",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-[11px] font-bold uppercase tracking-widest text-[var(--v2-muted)]",children:"P2P"}),(0,b.jsxs)("h1",{className:"text-2xl font-extrabold tracking-tight",children:["Buy / sell ",q]})]}),(0,b.jsx)(c.default,{href:"/v2/p2p/orders",className:"rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-2 text-[12px] font-semibold text-[var(--v2-text)]",children:"My orders"})]}),(0,b.jsx)("p",{className:"text-sm text-[var(--v2-muted)]",children:"Escrow-backed trades. Choose an ad and place an order."})]}),(0,b.jsx)(k.V2Tabs,{tabs:F,activeId:o,onChange:a=>p(a)}),(0,b.jsx)(h.V2Input,{value:r,onChange:a=>s(a.target.value),placeholder:"Optional amount (USD)",inputMode:"decimal"}),x&&0===t.length?(0,b.jsxs)(g.V2Card,{children:[(0,b.jsx)(g.V2CardHeader,{title:"Marketplace unavailable",subtitle:"Try again in a moment."}),(0,b.jsxs)(g.V2CardBody,{children:[(0,b.jsx)("div",{className:"text-sm text-[var(--v2-muted)]",children:String(x)}),(0,b.jsx)("div",{className:"mt-3",children:(0,b.jsx)(f.V2Button,{variant:"primary",fullWidth:!0,onClick:()=>void E(),children:"Retry"})})]})]}):v&&0===t.length?(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(j.V2Skeleton,{className:"h-20"}),(0,b.jsx)(j.V2Skeleton,{className:"h-20"}),(0,b.jsx)(j.V2Skeleton,{className:"h-20"})]}):0===t.length?(0,b.jsxs)(g.V2Card,{children:[(0,b.jsx)(g.V2CardHeader,{title:"No ads available",subtitle:"Try switching side or changing the amount."}),(0,b.jsx)(g.V2CardBody,{children:(0,b.jsx)("div",{className:"text-sm text-[var(--v2-muted)]",children:"We couldn’t find matching ads right now."})})]}):(0,b.jsx)("section",{className:"grid gap-2",children:t.map(a=>{let c=String(a.display_name||a.email||"Trader"),d=m(a.fixed_price,"USD"),e=m(a.min_limit,"USD"),g=m(a.max_limit,"USD"),h=`${n(a.remaining_amount)} ${q}`,i=Array.isArray(a.payment_methods)?a.payment_methods:[];return(0,b.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]"+(a.highlighted_until?" ring-1 ring-[color-mix(in_srgb,var(--v2-accent)_35%,transparent)]":""),children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)("div",{className:"truncate text-[15px] font-semibold text-[var(--v2-text)]",children:c}),a.is_verified_agent?(0,b.jsx)("span",{className:"rounded-full border border-[var(--v2-border)] bg-[var(--v2-surface-2)] px-2 py-0.5 text-[11px] font-semibold text-[var(--v2-muted)]",children:"Verified"}):null]}),(0,b.jsxs)("div",{className:"mt-1 text-[12px] text-[var(--v2-muted)]",children:["Limit ",e," – ",g," · Remaining ",h]}),i.length?(0,b.jsx)("div",{className:"mt-2 flex flex-wrap gap-1",children:i.slice(0,4).map(a=>(0,b.jsx)("span",{className:"rounded-full border border-[var(--v2-border)] bg-[var(--v2-surface-2)] px-2 py-0.5 text-[11px] font-semibold text-[var(--v2-muted)]",children:String(a)},a))}):null]}),(0,b.jsxs)("div",{className:"shrink-0 text-right",children:[(0,b.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-muted)]",children:"Price"}),(0,b.jsx)("div",{className:"mt-0.5 font-mono text-[14px] font-semibold text-[var(--v2-text)]",children:d}),(0,b.jsx)("div",{className:"mt-2",children:(0,b.jsx)(f.V2Button,{variant:"primary",size:"sm",onClick:()=>{J(a),N(null),L(""),V(null),H(!0)},children:"Take"})})]})]})},a.id)})}),(0,b.jsx)(i.V2Sheet,{open:G,onClose:()=>H(!1),title:"Take ad",children:I?(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3",children:[(0,b.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-muted)]",children:"Price"}),(0,b.jsx)("div",{className:"mt-1 font-mono text-[16px] font-semibold text-[var(--v2-text)]",children:m(I.fixed_price,"USD")}),(0,b.jsxs)("div",{className:"mt-1 text-[12px] text-[var(--v2-muted)]",children:["Limit ",m(I.min_limit,"USD")," – ",m(I.max_limit,"USD")]})]}),(0,b.jsx)(h.V2Input,{value:K,onChange:a=>L(a.target.value),placeholder:"Amount (USD)",inputMode:"decimal"}),W?(0,b.jsxs)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3",children:[(0,b.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:"Payout method"}),(0,b.jsx)("div",{className:"mt-1 text-[12px] text-[var(--v2-muted)]",children:"Required when you sell (so the buyer can pay you)."}),S?0===Q.length?(0,b.jsx)("div",{className:"mt-2 text-[12px] text-[var(--v2-muted)]",children:"No payment methods found. Add one from the legacy P2P page for now."}):(0,b.jsx)("div",{className:"mt-2 grid gap-2",children:Q.slice(0,6).map(a=>{let c=U===a.id;return(0,b.jsxs)("button",{type:"button",onClick:()=>V(a.id),className:"flex w-full items-center justify-between gap-2 rounded-xl border px-3 py-2 text-left"+(c?" border-[color-mix(in_srgb,var(--v2-accent)_55%,transparent)] bg-[color-mix(in_srgb,var(--v2-accent)_12%,transparent)]":" border-[var(--v2-border)] bg-[var(--v2-surface-2)]"),children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"truncate text-[13px] font-semibold text-[var(--v2-text)]",children:String(a.name||a.identifier)}),(0,b.jsx)("div",{className:"truncate text-[11px] text-[var(--v2-muted)]",children:String(a.identifier)})]}),(0,b.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-muted)]",children:c?"Selected":"Select"})]},a.id)})}):(0,b.jsxs)("div",{className:"mt-3 grid gap-2",children:[(0,b.jsx)(j.V2Skeleton,{className:"h-10"}),(0,b.jsx)(j.V2Skeleton,{className:"h-10"})]})]}):null,M?(0,b.jsx)("div",{className:"text-sm text-[var(--down)]",children:M}):null,(0,b.jsx)(f.V2Button,{variant:"primary",fullWidth:!0,disabled:O,onClick:()=>void Y(),children:O?"Creating…":"Create order"}),(0,b.jsx)(c.default,{href:"/p2p",className:"block text-center text-[12px] font-semibold text-[var(--v2-muted)]",children:"Need advanced options? Open legacy P2P."})]}):(0,b.jsx)("div",{className:"text-sm text-[var(--v2-muted)]",children:"No ad selected."})})]})}a.s(["P2PClient",()=>o])}];

//# sourceMappingURL=src_097ced70._.js.map