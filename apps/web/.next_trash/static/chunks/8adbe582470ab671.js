(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,796830,e=>{"use strict";var t=e.i(843476);let r=e.i(271645).forwardRef(function({className:e="",type:r="text",...s},a){return(0,t.jsx)("input",{ref:a,type:r,className:"h-11 w-full rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 text-[14px] text-[var(--v2-text)] shadow-[var(--v2-shadow-sm)] outline-none placeholder:text-[color-mix(in_srgb,var(--v2-muted)_70%,transparent)] focus:ring-2 focus:ring-[var(--v2-ring)] "+e,...s})});e.s(["V2Input",0,r])},184724,e=>{"use strict";var t=e.i(843476);function r(e){let t=e?.variant??"secondary",r=e?.size??"md";return["inline-flex select-none items-center justify-center gap-2 whitespace-nowrap rounded-xl transition focus:outline-none focus:ring-2 focus:ring-[var(--v2-ring)] disabled:pointer-events-none disabled:opacity-55","lg"===r?"h-12 px-5 text-[15px]":"sm"===r?"h-9 px-3 text-[13px]":"h-11 px-4 text-[14px]","primary"===t?"bg-[var(--v2-accent)] text-white font-semibold shadow-[var(--v2-shadow-sm)] hover:brightness-105":"danger"===t?"bg-[var(--down)] text-white font-semibold shadow-[var(--v2-shadow-sm)] hover:brightness-105":"ghost"===t?"bg-transparent text-[var(--v2-text)] font-semibold hover:bg-[var(--v2-surface-2)]":"border border-[var(--v2-border)] bg-[var(--v2-surface)] text-[var(--v2-text)] font-semibold shadow-[var(--v2-shadow-sm)] hover:bg-[var(--v2-surface-2)]",e?.fullWidth?"w-full":"",e?.className??""].filter(Boolean).join(" ")}let s=e.i(271645).forwardRef(function({variant:e,size:s,fullWidth:a,className:i,type:n,...l},d){return(0,t.jsx)("button",{ref:d,type:n??"button",className:r({variant:e,size:s,fullWidth:a,className:i}),...l})});e.s(["V2Button",0,s,"v2ButtonClassName",()=>r])},283538,e=>{"use strict";var t=e.i(843476);function r({children:e,className:r=""}){return(0,t.jsx)("section",{className:"rounded-[var(--v2-radius-lg)] border border-[var(--v2-border)] bg-[var(--v2-surface)] shadow-[var(--v2-shadow-sm)] "+r,children:e})}function s({title:e,subtitle:r,right:s}){return(0,t.jsxs)("header",{className:"flex items-start justify-between gap-3 px-4 pt-4",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"text-[15px] font-semibold text-[var(--v2-text)]",children:e}),r?(0,t.jsx)("div",{className:"mt-0.5 text-[13px] text-[var(--v2-muted)]",children:r}):null]}),s?(0,t.jsx)("div",{className:"shrink-0",children:s}):null]})}function a({children:e}){return(0,t.jsx)("div",{className:"px-4 pb-4 pt-3",children:e})}e.s(["V2Card",()=>r,"V2CardBody",()=>a,"V2CardHeader",()=>s])},59298,e=>{"use strict";var t=e.i(843476);function r({className:e=""}){return(0,t.jsx)("div",{className:"animate-pulse rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface-2)] "+e,"aria-hidden":"true"})}e.s(["V2Skeleton",()=>r])},759923,e=>{"use strict";var t=e.i(843476),r=e.i(522016),s=e.i(618566),a=e.i(271645),i=e.i(184724),n=e.i(283538),l=e.i(796830),d=e.i(59298);function c(e){if(!e)return"";try{return new Date(e).toLocaleString()}catch{return String(e)}}function o(e){let t="number"==typeof e?e:Number(String(e));return Number.isFinite(t)?t:null}function u(e,t){let r=o(e);if(null==r)return"—";try{return new Intl.NumberFormat(void 0,{style:"currency",currency:t,currencyDisplay:"code",maximumFractionDigits:2}).format(r)}catch{return`${r.toLocaleString()} ${t}`}}function v(){let e=(0,s.useParams)(),v=String(e?.id??""),[x,m]=(0,a.useState)(null),[h,p]=(0,a.useState)(null),[f,g]=(0,a.useState)([]),[b,j]=(0,a.useState)(!0),[y,N]=(0,a.useState)(null),[S,w]=(0,a.useState)(""),[C,E]=(0,a.useState)(!1),[_,R]=(0,a.useState)(null),[V,k]=(0,a.useState)(null),[A,L]=(0,a.useState)(null),O=(0,a.useRef)(0),B=(0,a.useRef)(null),P=(0,a.useRef)(!1),D=(0,a.useRef)(""),T=(0,a.useRef)(null),I=(0,a.useRef)(0);(0,a.useEffect)(()=>{D.current=String(h?.status??"").toLowerCase()},[h?.status]),(0,a.useEffect)(()=>{let e=!1;return fetch("/api/whoami",{cache:"no-store"}).then(e=>e.ok?e.json():null).then(t=>{e||m("string"==typeof t?.user?.id?t.user.id:null)}).catch(()=>{e||m(null)}),()=>{e=!0}},[]);let U=async()=>{if(!v)return;let e=++O.current;B.current?.abort();let t=new AbortController;B.current=t,N(null),P.current||j(!0);try{let r=await fetch(`/api/p2p/orders/${encodeURIComponent(v)}`,{cache:"no-store",signal:t.signal}),s=await r.json().catch(()=>null);if(!r.ok){let e="string"==typeof s?.error?s.error:`http_${r.status}`;throw Error(e)}if(e!==O.current)return;p(s?.order??null),g(Array.isArray(s?.messages)?s.messages:[]),P.current=!0}catch(t){if(t instanceof DOMException&&"AbortError"===t.name||e!==O.current)return;P.current||N(t instanceof Error?t.message:String(t))}finally{e===O.current&&j(!1)}};(0,a.useEffect)(()=>{U();let e=null,t=()=>{e&&(window.clearTimeout(e),e=null)},r=()=>{t();let s=D.current,a="completed"===s||"cancelled"===s,i=T.current?a?45e3:15e3:a?2e4:4e3;e=window.setTimeout(()=>{e=null,"visible"===document.visibilityState&&U(),r()},i)},s=()=>{"visible"===document.visibilityState?(U(),r()):t()};return document.addEventListener("visibilitychange",s),r(),()=>{document.removeEventListener("visibilitychange",s),t(),B.current?.abort()}},[v]),(0,a.useEffect)(()=>{if(!v)return;let e=()=>{try{T.current?.close()}catch{}T.current=null},t=()=>{let e=Date.now();e-I.current<700||(I.current=e,"visible"===document.visibilityState&&U())},r=()=>{if(!("visible"!==document.visibilityState||"u"<typeof EventSource)&&!T.current)try{let e=new EventSource("/api/notifications/stream",{withCredentials:!0});e.addEventListener("notification",e=>{try{let r=JSON.parse(String(e.data??"{}"));(e=>{if(!String(e?.type??"").startsWith("p2p_"))return!1;let t=String(e?.metadata?.order_id??"");return!t||t===v})(r)&&t()}catch{}}),e.addEventListener("ready",()=>t()),e.onerror=()=>{},T.current=e}catch{e()}},s=()=>{"visible"===document.visibilityState?r():e()};return document.addEventListener("visibilitychange",s),r(),()=>{document.removeEventListener("visibilitychange",s),e()}},[v]);let W=(0,a.useMemo)(()=>h&&x?String(h.buyer_id)===String(x)?"buyer":String(h.seller_id)===String(x)?"seller":null:null,[h,x]),$="buyer"===W&&"created"===String(h?.status),M="seller"===W&&"paid_confirmed"===String(h?.status),F="created"===String(h?.status),J=async e=>{if(v&&!V){k(e),L(null);try{let t=await fetch(`/api/p2p/orders/${encodeURIComponent(v)}/action`,{method:"POST",headers:{"content-type":"application/json"},credentials:"include",body:JSON.stringify({action:e})}),r=await t.json().catch(()=>null);if(!t.ok){let e="string"==typeof r?.error?r.error:`http_${t.status}`;throw Error(e)}U()}catch(e){L(e instanceof Error?e.message:String(e))}finally{k(null)}}},H=async()=>{if(!v||C)return;let e=S.trim();if(e){E(!0),R(null);try{let t=await fetch(`/api/p2p/orders/${encodeURIComponent(v)}/chat`,{method:"POST",headers:{"content-type":"application/json"},credentials:"include",body:JSON.stringify({content:e})}),r=await t.json().catch(()=>null);if(!t.ok){let e="string"==typeof r?.error?r.error:`http_${t.status}`;throw Error(e)}w(""),U()}catch(e){R(e instanceof Error?e.message:String(e))}finally{E(!1)}}},Y=Array.isArray(h?.payment_method_snapshot)?h.payment_method_snapshot:[],K=(0,t.jsxs)("header",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-[11px] font-bold uppercase tracking-widest text-[var(--v2-muted)]",children:"P2P"}),(0,t.jsx)("h1",{className:"text-2xl font-extrabold tracking-tight",children:"Order"})]}),(0,t.jsx)(r.default,{href:"/v2/p2p/orders",className:"rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-2 text-[12px] font-semibold text-[var(--v2-text)]",children:"Back"})]}),(0,t.jsx)("p",{className:"text-sm text-[var(--v2-muted)]",children:"Chat, payment details, and actions."})]});if(y&&!h)return(0,t.jsxs)("main",{className:"space-y-4",children:[K,(0,t.jsxs)(n.V2Card,{children:[(0,t.jsx)(n.V2CardHeader,{title:"Order unavailable",subtitle:"Sign in and try again."}),(0,t.jsxs)(n.V2CardBody,{children:[(0,t.jsx)("div",{className:"text-sm text-[var(--v2-muted)]",children:String(y)}),(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsx)(i.V2Button,{variant:"primary",fullWidth:!0,onClick:()=>void U(),children:"Retry"})})]})]})]});if(b&&!h)return(0,t.jsxs)("main",{className:"space-y-4",children:[K,(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(d.V2Skeleton,{className:"h-24"}),(0,t.jsx)(d.V2Skeleton,{className:"h-24"}),(0,t.jsx)(d.V2Skeleton,{className:"h-24"})]})]});if(!h)return(0,t.jsxs)("main",{className:"space-y-4",children:[K,(0,t.jsx)(n.V2Card,{children:(0,t.jsx)(n.V2CardHeader,{title:"Not found",subtitle:"This order doesn’t exist or you don’t have access."})})]});let z=String(h.status||"").toLowerCase();return(0,t.jsxs)("main",{className:"space-y-4",children:[K,(0,t.jsxs)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-muted)]",children:"Status"}),(0,t.jsx)("div",{className:"mt-0.5 text-[15px] font-semibold text-[var(--v2-text)]",children:z.replaceAll("_"," ")||"—"}),(0,t.jsxs)("div",{className:"mt-2 text-[12px] text-[var(--v2-muted)]",children:["Created ",c(h.created_at)]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-muted)]",children:"You"}),(0,t.jsx)("div",{className:"mt-0.5 text-[13px] font-semibold text-[var(--v2-text)]",children:W?W.toUpperCase():"—"})]})]}),(0,t.jsxs)("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[(0,t.jsxs)("div",{className:"rounded-xl bg-[var(--v2-surface-2)] px-2 py-2",children:[(0,t.jsx)("div",{className:"text-[11px] font-semibold text-[var(--v2-muted)]",children:"Amount"}),(0,t.jsxs)("div",{className:"mt-0.5 font-mono text-[13px] font-semibold text-[var(--v2-text)]",children:[function(e){let t=o(e);if(null==t)return"—";if(0===t)return"0";let r=Math.abs(t);return t.toLocaleString(void 0,{maximumFractionDigits:r>=1e3?2:r>=1?4:r>=.01?6:8})}(h.amount_asset)," ",String(h.asset_symbol||"—")]}),(0,t.jsxs)("div",{className:"mt-0.5 text-[12px] text-[var(--v2-muted)]",children:["≈ ",u(h.amount_fiat,String(h.fiat_currency||"USD"))]})]}),(0,t.jsxs)("div",{className:"rounded-xl bg-[var(--v2-surface-2)] px-2 py-2",children:[(0,t.jsx)("div",{className:"text-[11px] font-semibold text-[var(--v2-muted)]",children:"Price"}),(0,t.jsx)("div",{className:"mt-0.5 font-mono text-[13px] font-semibold text-[var(--v2-text)]",children:u(h.price,String(h.fiat_currency||"USD"))}),(0,t.jsxs)("div",{className:"mt-0.5 text-[12px] text-[var(--v2-muted)]",children:["Window: ",String(h.payment_window_minutes??"—")," min"]})]})]}),A?(0,t.jsx)("div",{className:"mt-3 text-sm text-[var(--down)]",children:A}):null,(0,t.jsxs)("div",{className:"mt-3 grid gap-2",children:[$?(0,t.jsx)(i.V2Button,{variant:"primary",fullWidth:!0,disabled:null!==V,onClick:()=>void J("PAY_CONFIRMED"),children:"PAY_CONFIRMED"===V?"Marking…":"I have paid"}):null,M?(0,t.jsx)(i.V2Button,{variant:"primary",fullWidth:!0,disabled:null!==V,onClick:()=>void J("RELEASE"),children:"RELEASE"===V?"Releasing…":"Release crypto"}):null,F?(0,t.jsx)(i.V2Button,{variant:"ghost",fullWidth:!0,disabled:null!==V,onClick:()=>void J("CANCEL"),children:"CANCEL"===V?"Canceling…":"Cancel order"}):null]})]}),(0,t.jsxs)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]",children:[(0,t.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:"Payment details"}),0===Y.length?(0,t.jsx)("div",{className:"mt-2 text-[12px] text-[var(--v2-muted)]",children:"No payment details available."}):(0,t.jsx)("div",{className:"mt-2 grid gap-2",children:Y.map((e,r)=>(0,t.jsxs)("div",{className:"rounded-xl bg-[var(--v2-surface-2)] px-2 py-2",children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:String(e.name||e.identifier)}),(0,t.jsx)("div",{className:"mt-0.5 text-[11px] text-[var(--v2-muted)]",children:String(e.identifier)}),e.details?(0,t.jsx)("pre",{className:"mt-2 max-h-32 overflow-auto whitespace-pre-wrap break-words rounded-lg border border-[var(--v2-border)] bg-[var(--v2-surface)] p-2 text-[11px] text-[var(--v2-muted)]",children:JSON.stringify(e.details,null,2)}):null]},String(e.id||r)))}),h.ad_terms?(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-muted)]",children:"Terms"}),(0,t.jsx)("div",{className:"mt-1 whitespace-pre-wrap text-[12px] text-[var(--v2-text)]",children:String(h.ad_terms)})]}):null]}),(0,t.jsxs)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:"Chat"}),(0,t.jsx)("div",{className:"text-[12px] text-[var(--v2-muted)]",children:f.length})]}),(0,t.jsx)("div",{className:"mt-3 grid gap-2",children:0===f.length?(0,t.jsx)("div",{className:"text-[12px] text-[var(--v2-muted)]",children:"No messages yet."}):f.slice(-60).map(e=>{let r=null==e.sender_id;return(0,t.jsxs)("div",{className:"rounded-xl bg-[var(--v2-surface-2)] px-2 py-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)("div",{className:"text-[11px] font-semibold text-[var(--v2-muted)]",children:r?"System":String(e.sender_email||"User")}),(0,t.jsx)("div",{className:"text-[11px] text-[var(--v2-muted)]",children:c(e.created_at)})]}),(0,t.jsx)("div",{className:"mt-1 whitespace-pre-wrap text-[12px] text-[var(--v2-text)]",children:String(e.content||"")})]},String(e.id))})}),(0,t.jsxs)("div",{className:"mt-3 grid gap-2",children:[(0,t.jsx)(l.V2Input,{value:S,onChange:e=>w(e.target.value),placeholder:"Message…"}),_?(0,t.jsx)("div",{className:"text-sm text-[var(--down)]",children:_}):null,(0,t.jsx)(i.V2Button,{variant:"primary",fullWidth:!0,disabled:C,onClick:()=>void H(),children:C?"Sending…":"Send"})]})]})]})}e.s(["P2POrderClient",()=>v])}]);