(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,163765,e=>{"use strict";var t=e.i(843476),a=e.i(522016),r=e.i(271645);function s(e){let t=new Uint8Array(e),a="";for(let e of t)a+=String.fromCharCode(e);return btoa(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function i(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),a=(4-t.length%4)%4,r=atob(t.padEnd(t.length+a,"=")),s=new ArrayBuffer(r.length),i=new Uint8Array(s);for(let e=0;e<r.length;e++)i[e]=r.charCodeAt(e);return s}function n(){return l.stubThis(globalThis?.PublicKeyCredential!==void 0&&"function"==typeof globalThis.PublicKeyCredential)}let l={stubThis:e=>e};function o(e){let{id:t}=e;return{...e,id:i(t),transports:e.transports}}function d(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}class c extends Error{constructor({message:e,code:t,cause:a,name:r}){super(e,{cause:a}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=r??a.name,this.code=t}}let u=new class{constructor(){Object.defineProperty(this,"controller",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}createNewAbortSignal(){if(this.controller){let e=Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}let e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){let e=Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}},m=["cross-platform","platform"];function v(e){if(e&&!(0>m.indexOf(e)))return e}async function p(e){let t,a,r,l,m;!e.optionsJSON&&e.challenge&&(console.warn("startRegistration() was not called correctly. It will try to continue with the provided options, but this call should be refactored to use the expected call structure instead. See https://simplewebauthn.dev/docs/packages/browser#typeerror-cannot-read-properties-of-undefined-reading-challenge for more information."),e={optionsJSON:e});let{optionsJSON:p,useAutoRegister:x=!1}=e;if(!n())throw Error("WebAuthn is not supported in this browser");let g={...p,challenge:i(p.challenge),user:{...p.user,id:i(p.user.id)},excludeCredentials:p.excludeCredentials?.map(o)},f={};x&&(f.mediation="conditional"),f.publicKey=g,f.signal=u.createNewAbortSignal();try{t=await navigator.credentials.create(f)}catch(e){throw function({error:e,options:t}){let{publicKey:a}=t;if(!a)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new c({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("ConstraintError"===e.name){if(a.authenticatorSelection?.requireResidentKey===!0)return new c({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});else if("conditional"===t.mediation&&a.authenticatorSelection?.userVerification==="required")return new c({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});else if(a.authenticatorSelection?.userVerification==="required")return new c({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else if("InvalidStateError"===e.name)return new c({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});else if("NotAllowedError"===e.name)return new c({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});else if("NotSupportedError"===e.name)return new c(0===a.pubKeyCredParams.filter(e=>"public-key"===e.type).length?{message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}:{message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});else if("SecurityError"===e.name){let t=globalThis.location.hostname;if(!d(t))return new c({message:`${globalThis.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(a.rp.id!==t)return new c({message:`The RP ID "${a.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("TypeError"===e.name){if(a.user.id.byteLength<1||a.user.id.byteLength>64)return new c({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if("UnknownError"===e.name)return new c({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e});return e}({error:e,options:f})}if(!t)throw Error("Registration was not completed");let{id:b,rawId:y,response:w,type:j}=t;if("function"==typeof w.getTransports&&(r=w.getTransports()),"function"==typeof w.getPublicKeyAlgorithm)try{l=w.getPublicKeyAlgorithm()}catch(e){h("getPublicKeyAlgorithm()",e)}if("function"==typeof w.getPublicKey)try{let e=w.getPublicKey();null!==e&&(m=s(e))}catch(e){h("getPublicKey()",e)}if("function"==typeof w.getAuthenticatorData)try{a=s(w.getAuthenticatorData())}catch(e){h("getAuthenticatorData()",e)}return{id:b,rawId:s(y),response:{attestationObject:s(w.attestationObject),clientDataJSON:s(w.clientDataJSON),transports:r,publicKeyAlgorithm:l,publicKey:m,authenticatorData:a},type:j,clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:v(t.authenticatorAttachment)}}function h(e,t){console.warn(`The browser extension that intercepted this WebAuthn API call incorrectly implemented ${e}. You should report this error to them.
`,t)}let x=e=>e;async function g(e){let t,a,r;!e.optionsJSON&&e.challenge&&(console.warn("startAuthentication() was not called correctly. It will try to continue with the provided options, but this call should be refactored to use the expected call structure instead. See https://simplewebauthn.dev/docs/packages/browser#typeerror-cannot-read-properties-of-undefined-reading-challenge for more information."),e={optionsJSON:e});let{optionsJSON:l,useBrowserAutofill:m=!1,verifyBrowserAutofillInput:p=!0}=e;if(!n())throw Error("WebAuthn is not supported in this browser");l.allowCredentials?.length!==0&&(t=l.allowCredentials?.map(o));let h={...l,challenge:i(l.challenge),allowCredentials:t},g={};if(m){if(!await function(){if(!n())return x(new Promise(e=>e(!1)));let e=globalThis.PublicKeyCredential;return e?.isConditionalMediationAvailable===void 0?x(new Promise(e=>e(!1))):x(e.isConditionalMediationAvailable())}())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete$='webauthn']").length<1&&p)throw Error('No <input> with "webauthn" as the only or last value in its `autocomplete` attribute was detected');g.mediation="conditional",h.allowCredentials=[]}g.publicKey=h,g.signal=u.createNewAbortSignal();try{a=await navigator.credentials.get(g)}catch(e){throw function({error:e,options:t}){let{publicKey:a}=t;if(!a)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new c({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("NotAllowedError"===e.name)return new c({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});else if("SecurityError"===e.name){let t=globalThis.location.hostname;if(!d(t))return new c({message:`${globalThis.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(a.rpId!==t)return new c({message:`The RP ID "${a.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("UnknownError"===e.name)return new c({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e});return e}({error:e,options:g})}if(!a)throw Error("Authentication was not completed");let{id:f,rawId:b,response:y,type:w}=a;return y.userHandle&&(r=s(y.userHandle)),{id:f,rawId:s(b),response:{authenticatorData:s(y.authenticatorData),clientDataJSON:s(y.clientDataJSON),signature:s(y.signature),userHandle:r},type:w,clientExtensionResults:a.getClientExtensionResults(),authenticatorAttachment:v(a.authenticatorAttachment)}}var f=e.i(184724),b=e.i(283538),y=e.i(796830),w=e.i(355506),j=e.i(59298);function k(e,t){if(!e||"object"!=typeof e)return t;let a=e.message,r=e.error;return"string"==typeof a&&a.trim()?a:"string"==typeof r&&r.trim()?r:t}function N(e){let t=Math.max(0,Math.min(1439,Math.trunc(e))),a=Math.floor(t/60);return`${String(a).padStart(2,"0")}:${String(t%60).padStart(2,"0")}`}function S(e){let t=String(e||"").trim(),a=/^([01]\d|2[0-3]):([0-5]\d)$/.exec(t);return a?60*Number(a[1])+Number(a[2]):0}function _(e){let t=String(e||"").replaceAll("_"," ").trim();return t?t[0].toUpperCase()+t.slice(1):"—"}function E(e,a,r){return(0,t.jsx)("span",{className:"inline-flex items-center rounded-full border px-2 py-0.5 text-[11px] font-semibold "+(e?"border-[var(--v2-border)] bg-[var(--up-bg)] text-[var(--up)]":"border-[var(--v2-border)] bg-[var(--v2-surface-2)] text-[var(--v2-muted)]"),children:e?a:r})}function C(e,a,r){return(0,t.jsx)("span",{className:"inline-flex items-center rounded-full border px-2 py-0.5 text-[11px] font-semibold "+(e?"border-[var(--v2-border)] bg-[var(--up-bg)] text-[var(--up)]":"border-[var(--v2-border)] bg-[var(--v2-surface-2)] text-[var(--v2-muted)]"),children:e?a:r})}function A(){let[e,s]=(0,r.useState)(!0),[i,n]=(0,r.useState)(!1),[l,o]=(0,r.useState)(null),[d,c]=(0,r.useState)({kind:"idle"}),[u,m]=(0,r.useState)(null),[v,h]=(0,r.useState)(null),[x,A]=(0,r.useState)(0),[R,O]=(0,r.useState)([]),[T,P]=(0,r.useState)(!1),[I,V]=(0,r.useState)(!1),[D,B]=(0,r.useState)(!1),[U,K]=(0,r.useState)({kind:"idle"}),[M,W]=(0,r.useState)(!1),[F,L]=(0,r.useState)("idle"),[q,H]=(0,r.useState)(""),[$,J]=(0,r.useState)(""),[Y,z]=(0,r.useState)(""),[G,Q]=(0,r.useState)(""),[X,Z]=(0,r.useState)([]),[ee,et]=(0,r.useState)(null),[ea,er]=(0,r.useState)({kind:"idle"}),[es,ei]=(0,r.useState)(!1),[en,el]=(0,r.useState)(""),[eo,ed]=(0,r.useState)(""),[ec,eu]=(0,r.useState)(""),[em,ev]=(0,r.useState)(""),[ep,eh]=(0,r.useState)(!1),[ex,eg]=(0,r.useState)({kind:"idle"}),[ef,eb]=(0,r.useState)(!1),[ey,ew]=(0,r.useState)({kind:"idle"}),[ej,ek]=(0,r.useState)(null),[eN,eS]=(0,r.useState)(null),[e_,eE]=(0,r.useState)(!1),[eC,eA]=(0,r.useState)("passport"),[eR,eO]=(0,r.useState)(null),[eT,eP]=(0,r.useState)(null),[eI,eV]=(0,r.useState)(null),[eD,eB]=(0,r.useState)(!1),[eU,eK]=(0,r.useState)({kind:"idle"}),[eM,eW]=(0,r.useState)(null),[eF,eL]=(0,r.useState)([]),[eq,eH]=(0,r.useState)(null),[e$,eJ]=(0,r.useState)(null),[eY,ez]=(0,r.useState)(!1),[eG,eQ]=(0,r.useState)(!1),[eX,eZ]=(0,r.useState)(null),[e0,e2]=(0,r.useState)({kind:"idle"}),[e1,e3]=(0,r.useState)(!1),[e5,e6]=(0,r.useState)(!1),[e4,e9]=(0,r.useState)(null),[e8,e7]=(0,r.useState)([]),[te,tt]=(0,r.useState)(0),ta=async()=>{o(null),eS(null),eJ(null);try{let e=await fetch("/api/account/profile",{cache:"no-store",credentials:"include"});if(!e.ok){n(!1),h(null),A(0),ek(null),eW(null),eH(null);return}let t=await e.json().catch(()=>null);if(!t?.user?.id){n(!1),h(null),A(0);return}n(!0),h(t.user),c({kind:"idle"});let a=await fetch("/api/account/passkeys",{cache:"no-store",credentials:"include"}).catch(()=>null);if(a&&a.ok){let e=await a.json().catch(()=>null),t=Array.isArray(e?.passkeys)?e.passkeys:[];O(t),A(t.length)}else O([]),A(0);let r=await fetch("/api/account/kyc",{cache:"no-store",credentials:"include"}).catch(()=>null);if(r&&r.ok){let e=await r.json().catch(()=>null);e&&"string"==typeof e.kyc_level&&Array.isArray(e.submissions)?ek(e):ek(null)}else ek(null),r&&"number"==typeof r.status&&eS(`KYC unavailable (HTTP ${r.status}).`);let[s,i]=await Promise.all([fetch("/api/account/notification-preferences",{cache:"no-store",credentials:"include"}).catch(()=>null),fetch("/api/account/notification-schedule",{cache:"no-store",credentials:"include"}).catch(()=>null)]);if(s&&s.ok){let e=await s.json().catch(()=>null);e&&e.prefs&&"object"==typeof e.prefs?(eW(e.prefs),eL(Array.isArray(e.known_types)?e.known_types.map(String):[])):eW(null)}else eW(null),s&&"number"==typeof s.status&&eJ(`Notifications unavailable (HTTP ${s.status}).`);if(i&&i.ok){let e=await i.json().catch(()=>null);e?.schedule?eH(e.schedule):eH(null)}else eH(null);let l=await fetch("/api/notifications?limit=1",{cache:"no-store",credentials:"include"}).catch(()=>null);if(l&&l.ok){let e=await l.json().catch(()=>null);e&&"number"==typeof e.unread_count&&tt(e.unread_count)}}catch(e){o(e instanceof Error?e.message:String(e))}finally{s(!1)}},tr=async()=>{e9(null),e6(!0);try{let e=await fetch("/api/notifications?limit=50",{cache:"no-store",credentials:"include"}),t=await e.json().catch(()=>null);if(!e.ok){let a=t?.message||t?.error;throw Error("string"==typeof a&&a.length?a:`http_${e.status}`)}e7(Array.isArray(t?.notifications)?t.notifications:[]),tt("number"==typeof t?.unread_count?t.unread_count:0)}catch(e){e9(e instanceof Error?e.message:String(e))}finally{e6(!1)}},ts=async()=>{e9(null);try{await fetch("/api/notifications",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({mark_all_read:!0})})}finally{await tr()}},ti=async e=>{if(e){e9(null);try{await fetch("/api/notifications",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({ids:[e]})})}finally{e7(t=>t.map(t=>t.id===e?{...t,is_read:!0}:t)),tt(e=>Math.max(0,e-1)),tr()}}},tn=(e,t)=>{eW(a=>{if(!a)return a;let r=a[e]??{in_app:!0,email:!1};return{...a,[e]:{...r,...t}}})},tl=async()=>{if(eM){e2({kind:"idle"}),eZ("prefs");try{let e=await fetch("/api/account/notification-preferences",{method:"PUT",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({prefs:eM})}),t=await e.json().catch(()=>null);if(!e.ok){let a=t?.message||t?.error;e2({kind:"error",message:"string"==typeof a&&a.length?a:`Failed (HTTP ${e.status}).`});return}e2({kind:"ok",message:"Preferences saved."}),ez(!1)}catch(e){e2({kind:"error",message:e instanceof Error?e.message:String(e)})}finally{eZ(null)}}},to=async()=>{if(eq){e2({kind:"idle"}),eZ("schedule");try{let e=await fetch("/api/account/notification-schedule",{method:"PUT",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({quiet_enabled:!!eq.quiet_enabled,quiet_start_min:Math.max(0,Math.min(1439,Math.trunc(eq.quiet_start_min))),quiet_end_min:Math.max(0,Math.min(1439,Math.trunc(eq.quiet_end_min))),tz_offset_min:Math.max(-840,Math.min(840,Math.trunc(eq.tz_offset_min))),digest_enabled:!!eq.digest_enabled})}),t=await e.json().catch(()=>null);if(!e.ok){let a=t?.message||t?.error;e2({kind:"error",message:"string"==typeof a&&a.length?a:`Failed (HTTP ${e.status}).`});return}e2({kind:"ok",message:"Schedule saved."}),eQ(!1),await ta()}catch(e){e2({kind:"error",message:e instanceof Error?e.message:String(e)})}finally{eZ(null)}}},td=e=>new Promise((t,a)=>{let r=new FileReader;r.onerror=()=>a(Error("file_read_failed")),r.onload=()=>t(String(r.result??"")),r.readAsDataURL(e)}),tc=async()=>{if(eK({kind:"idle"}),!eR)return void eK({kind:"error",message:"Front image is required."});if(eR.size>9e5||eT&&eT.size>9e5||eI&&eI.size>9e5)return void eK({kind:"error",message:"Image too large. Use smaller files (≤ 900KB each)."});eB(!0);try{let e=await td(eR),t=eT?await td(eT):void 0,a=eI?await td(eI):void 0,r=await fetch("/api/account/kyc",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({action:"submit_documents",document_type:eC,document_front:e,document_back:t,selfie:a})}),s=await r.json().catch(()=>null);if(!r.ok){let e=s?.details?.message||s?.message||s?.error;eK({kind:"error",message:"string"==typeof e&&e.length?e:`Failed (HTTP ${r.status}).`});return}eK({kind:"ok",message:String(s?.message??"Documents submitted")}),eO(null),eP(null),eV(null),eE(!1),await ta()}catch(e){eK({kind:"error",message:e instanceof Error?e.message:String(e)})}finally{eB(!1)}};(0,r.useEffect)(()=>{ta()},[]),(0,r.useEffect)(()=>{P(void 0!==window.PublicKeyCredential)},[]);let tu=async()=>{try{let e=await fetch("/api/account/passkeys",{cache:"no-store",credentials:"include"});if(!e.ok)return;let t=await e.json().catch(()=>null),a=Array.isArray(t?.passkeys)?t.passkeys:[];O(a),A(a.length)}catch{}},tm=async()=>{if(K({kind:"idle"}),!T)return void K({kind:"error",message:"Passkeys aren’t supported in this browser/device."});let e=(window.prompt("Name this passkey (optional)","This device")??"").trim();B(!0);try{let t=await fetch("/api/account/passkeys/register/options",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify(e?{name:e}:{})}),a=await t.json().catch(()=>({}));if(!t.ok)return void K({kind:"error",message:k(a,"Failed to start passkey registration")});let r=a?.options;if(!r)return void K({kind:"error",message:"Invalid passkey registration options"});let s=await p(r),i=await fetch("/api/account/passkeys/register/verify",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({name:e||void 0,response:s})}),n=await i.json().catch(()=>({}));if(!i.ok)return void K({kind:"error",message:k(n,"Passkey verification failed")});K({kind:"ok",message:"Passkey added."}),await tu(),await ta()}catch(e){K({kind:"error",message:e instanceof Error?e.message:"Passkey registration canceled"})}finally{B(!1)}},tv=async()=>{if(K({kind:"idle"}),!T)return void K({kind:"error",message:"Passkeys aren’t supported in this browser/device."});B(!0);try{let e=await fetch("/api/account/passkeys/authenticate/options",{method:"POST",credentials:"include"}),t=await e.json().catch(()=>({}));if(!e.ok)return void K({kind:"error",message:k(t,"Failed to start passkey confirmation")});let a=t?.options;if(!a)return void K({kind:"error",message:"Invalid passkey authentication options"});let r=await g(a),s=await fetch("/api/account/passkeys/authenticate/verify",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({response:r})}),i=await s.json().catch(()=>({}));if(!s.ok)return void K({kind:"error",message:k(i,"Passkey verification failed")});K({kind:"ok",message:"Passkey confirmed (valid for a few minutes)."}),await tu(),await ta()}catch(e){K({kind:"error",message:e instanceof Error?e.message:"Passkey confirmation canceled"})}finally{B(!1)}},tp=async()=>{er({kind:"idle"}),et("setup");try{let e=await fetch("/api/account/totp/setup",{method:"POST",credentials:"include"}),t=await e.json().catch(()=>({}));if(!e.ok)return void er({kind:"error",message:k(t,"Setup failed")});H(String(t?.secret??"")),J(String(t?.uri??"")),L("setup")}catch(e){er({kind:"error",message:e instanceof Error?e.message:"Network error"})}finally{et(null)}},th=async()=>{er({kind:"idle"}),et("enable");try{let e=await fetch("/api/account/totp/enable",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({code:Y})}),t=await e.json().catch(()=>({}));if(!e.ok){let e=t?.error==="invalid_totp_code"?"Invalid code — try again":k(t,"Failed");er({kind:"error",message:e});return}Z(Array.isArray(t?.backup_codes)?t.backup_codes.map(String):[]),L("backup"),z(""),er({kind:"ok",message:"2FA enabled."}),await ta()}catch(e){er({kind:"error",message:e instanceof Error?e.message:"Network error"})}finally{et(null)}},tx=async()=>{er({kind:"idle"}),et("disable");try{let e=await fetch("/api/account/totp/disable",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({code:G})}),t=await e.json().catch(()=>({}));if(!e.ok){let e=t?.error==="invalid_totp_code"?"Invalid code":k(t,"Failed");er({kind:"error",message:e});return}Q(""),H(""),J(""),Z([]),L("idle"),er({kind:"ok",message:"2FA disabled."}),await ta()}catch(e){er({kind:"error",message:e instanceof Error?e.message:"Network error"})}finally{et(null)}},tg=async e=>{let t=String(e||"").trim();if(t)try{await navigator.clipboard.writeText(t)}catch{}},tf=async()=>{if(eg({kind:"idle"}),eo.length<8)return void eg({kind:"error",message:"New password must be at least 8 characters."});if(eo!==ec)return void eg({kind:"error",message:"Passwords do not match."});eh(!0);try{let e={currentPassword:en,newPassword:eo};6===String(em||"").trim().length&&(e.totp_code=em);let t=await fetch("/api/account/password",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify(e)}),a=await t.json().catch(()=>({}));if(!t.ok){let e=a?.error==="invalid_current_password"?"Current password is incorrect":a?.error==="totp_required"?"Enter your 2FA code":a?.error==="invalid_totp_code"?"Invalid 2FA code":k(a,"Failed to update password");eg({kind:"error",message:e});return}eg({kind:"ok",message:"Password updated."}),el(""),ed(""),eu(""),ev("")}catch(e){eg({kind:"error",message:e instanceof Error?e.message:"Network error"})}finally{eh(!1)}},tb=async()=>{if(!ef&&(ew({kind:"idle"}),window.confirm("Log out all devices? You will be signed out everywhere."))){eb(!0);try{let e=await fetch("/api/account/sessions/logout-all",{method:"POST",credentials:"include"}),t=await e.json().catch(()=>({}));if(!e.ok)return void ew({kind:"error",message:k(t,"Failed to log out all devices")});ew({kind:"ok",message:"Logged out on all devices."}),window.location.href="/login"}catch(e){ew({kind:"error",message:e instanceof Error?e.message:"Network error"})}finally{eb(!1)}}},ty=(0,r.useMemo)(()=>{if(!v)return"Account";let e=String(v.email??"").trim();return e||(v.display_name?String(v.display_name):"Account")},[v]),tw=async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}finally{window.location.href="/v2"}},tj=async()=>{c({kind:"idle"}),m("resend_email");try{let e=await fetch("/api/account/verify-email",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({action:"resend"})}),t=await e.json().catch(()=>null);if(!e.ok){let a=t?.details?.message||t?.message||t?.error;c({kind:"error",message:"string"==typeof a&&a.length?a:`Failed (HTTP ${e.status}).`});return}c({kind:"ok",message:String(t?.message??"Verification email sent")})}catch(e){c({kind:"error",message:e instanceof Error?e.message:String(e)})}finally{m(null)}},tk=async()=>{c({kind:"idle"}),m("upgrade_kyc");try{let e=await fetch("/api/account/kyc",{method:"POST",credentials:"include",headers:{"content-type":"application/json"},body:JSON.stringify({action:"upgrade"})}),t=await e.json().catch(()=>null);if(!e.ok){let a=t?.details?.message||t?.message||t?.error;c({kind:"error",message:"string"==typeof a&&a.length?a:`Failed (HTTP ${e.status}).`});return}c({kind:"ok",message:`KYC upgraded to ${String(t?.kyc_level??"basic")}.`}),await ta()}catch(e){c({kind:"error",message:e instanceof Error?e.message:String(e)})}finally{m(null)}};return(0,t.jsxs)("main",{className:"space-y-4",children:[(0,t.jsxs)("header",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"text-[11px] font-bold uppercase tracking-widest text-[var(--v2-muted)]",children:"Account"}),(0,t.jsx)("h1",{className:"text-2xl font-extrabold tracking-tight",children:ty}),(0,t.jsx)("p",{className:"text-sm text-[var(--v2-muted)]",children:"Security & verification status."})]}),l?(0,t.jsxs)(b.V2Card,{children:[(0,t.jsx)(b.V2CardHeader,{title:"Account unavailable",subtitle:"Try again"}),(0,t.jsxs)(b.V2CardBody,{children:[(0,t.jsx)("div",{className:"text-sm text-[var(--v2-muted)]",children:l}),(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsx)(f.V2Button,{variant:"primary",fullWidth:!0,onClick:()=>void ta(),children:"Retry"})})]})]}):null,(0,t.jsxs)(b.V2Card,{children:[(0,t.jsx)(b.V2CardHeader,{title:"Session",subtitle:"Signed-in status"}),(0,t.jsx)(b.V2CardBody,{children:e?(0,t.jsx)(j.V2Skeleton,{className:"h-14"}):i&&v?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[C(v.email_verified,"Email verified","Email unverified"),C(v.totp_enabled,"2FA on","2FA off"),C(x>0,`Passkeys ${x}`,"No passkeys"),C("full"===v.kyc_level,"KYC full",`KYC ${v.kyc_level}`)]}),"ok"===d.kind?(0,t.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--up-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--up)]",children:d.message}):"error"===d.kind?(0,t.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--down-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--down)]",children:d.message}):null,v.email_verified?null:(0,t.jsx)(f.V2Button,{variant:"primary",fullWidth:!0,disabled:null!==u,onClick:()=>void tj(),children:"resend_email"===u?"Sending…":"Resend verification email"}),v.email_verified&&"none"===v.kyc_level?(0,t.jsx)(f.V2Button,{variant:"secondary",fullWidth:!0,disabled:null!==u,onClick:()=>void tk(),children:"upgrade_kyc"===u?"Upgrading…":"Upgrade KYC to Basic"}):null,(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsx)(f.V2Button,{variant:"secondary",fullWidth:!0,onClick:()=>{K({kind:"idle"}),V(!0),tu()},children:"Passkeys"}),(0,t.jsx)(f.V2Button,{variant:"secondary",fullWidth:!0,onClick:()=>{er({kind:"idle"}),L("idle"),H(""),J(""),Z([]),z(""),Q(""),W(!0)},children:"2FA (TOTP)"}),(0,t.jsx)(f.V2Button,{variant:"secondary",fullWidth:!0,onClick:()=>{eg({kind:"idle"}),ei(!0)},children:"Change password"}),(0,t.jsx)(f.V2Button,{variant:"secondary",fullWidth:!0,disabled:ef,onClick:()=>void tb(),children:ef?"Working…":"Log out all"})]}),"error"===ey.kind?(0,t.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--down-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--down)]",children:ey.message}):null,(0,t.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:"Verification"}),(0,t.jsxs)("div",{className:"mt-1 text-[12px] text-[var(--v2-muted)]",children:["KYC: ",(0,t.jsx)("span",{className:"font-semibold text-[var(--v2-text)]",children:String(ej?.kyc_level??v.kyc_level)}),ej?.submissions?.[0]?.status?(0,t.jsxs)("span",{className:"ml-2",children:["• latest ",String(ej.submissions[0].status).replaceAll("_"," ")]}):null]}),eN?(0,t.jsx)("div",{className:"mt-1 text-[12px] text-[var(--v2-muted)]",children:eN}):null,ej?.submissions?.[0]?.rejection_reason?(0,t.jsxs)("div",{className:"mt-1 text-[12px] font-semibold text-[var(--down)]",children:["Rejected: ",ej.submissions[0].rejection_reason]}):null]}),v.email_verified&&"basic"===String(ej?.kyc_level??v.kyc_level)?(0,t.jsx)("div",{className:"shrink-0",children:(0,t.jsx)(f.V2Button,{variant:"secondary",onClick:()=>{eK({kind:"idle"}),eE(!0)},children:"Submit docs"})}):null]})}),(0,t.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:"Notifications"}),(0,t.jsxs)("div",{className:"mt-1 flex flex-wrap items-center gap-2",children:[E(!!eq?.quiet_enabled,"Quiet hours on","Quiet hours off"),E(!!eq?.digest_enabled,"Digest on","Digest off"),E(Object.values(eM??{}).some(e=>e.email),"Email enabled","Email off"),te>0?(0,t.jsxs)("span",{className:"inline-flex items-center rounded-full border border-[var(--v2-border)] bg-[var(--warn-bg)] px-2 py-0.5 text-[11px] font-semibold text-[var(--warn)]",children:[te," unread"]}):null]}),e$?(0,t.jsx)("div",{className:"mt-1 text-[12px] text-[var(--v2-muted)]",children:e$}):null]}),(0,t.jsxs)("div",{className:"shrink-0 grid gap-2",children:[(0,t.jsx)(f.V2Button,{variant:"secondary",size:"sm",onClick:()=>{e9(null),e3(!0),tr()},children:"Inbox"}),(0,t.jsx)(f.V2Button,{variant:"secondary",size:"sm",onClick:()=>{e2({kind:"idle"}),eQ(!0)},children:"Schedule"}),(0,t.jsx)(f.V2Button,{variant:"secondary",size:"sm",onClick:()=>{e2({kind:"idle"}),ez(!0)},children:"Preferences"})]})]})}),(0,t.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:"P2P"}),(0,t.jsx)("div",{className:"mt-1 text-[12px] text-[var(--v2-muted)]",children:"Escrow-backed marketplace and order chat."})]}),(0,t.jsxs)("div",{className:"shrink-0 grid gap-2",children:[(0,t.jsx)(a.default,{href:"/v2/p2p",className:(0,f.v2ButtonClassName)({variant:"secondary",size:"sm"}),children:"Marketplace"}),(0,t.jsx)(a.default,{href:"/v2/p2p/orders",className:(0,f.v2ButtonClassName)({variant:"secondary",size:"sm"}),children:"My orders"})]})]})}),(0,t.jsx)(f.V2Button,{variant:"primary",fullWidth:!0,onClick:()=>void tw(),children:"Sign out"})]}):(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"text-sm text-[var(--v2-muted)]",children:"You’re not signed in."}),(0,t.jsx)(a.default,{href:"/login",className:(0,f.v2ButtonClassName)({variant:"primary",fullWidth:!0}),children:"Sign in"})]})})]}),(0,t.jsx)(w.V2Sheet,{open:I,title:"Passkeys",onClose:()=>V(!1),children:(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)("div",{className:"text-[12px] text-[var(--v2-muted)]",children:"Use a device passkey (biometrics / screen lock) for stronger security."}),"error"===U.kind?(0,t.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--down-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--down)]",children:U.message}):"ok"===U.kind?(0,t.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--up-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--up)]",children:U.message}):null,T?(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsx)(f.V2Button,{variant:"primary",fullWidth:!0,disabled:D,onClick:()=>void tm(),children:D?"Working…":"Add passkey"}),(0,t.jsx)(f.V2Button,{variant:"secondary",fullWidth:!0,disabled:D||0===R.length,onClick:()=>void tv(),children:"Confirm"})]}):(0,t.jsx)("div",{className:"text-[13px] text-[var(--v2-muted)]",children:"Passkeys aren’t available in this browser/device."}),(0,t.jsxs)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]",children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:"Enrolled passkeys"}),0===R.length?(0,t.jsx)("div",{className:"mt-1 text-[12px] text-[var(--v2-muted)]",children:"No passkeys yet."}):(0,t.jsx)("div",{className:"mt-2 grid gap-2",children:R.map(e=>(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:e.name??"Passkey"}),(0,t.jsxs)("div",{className:"mt-0.5 text-[11px] text-[var(--v2-muted)]",children:["Added ",new Date(e.created_at).toLocaleDateString()]})]}),(0,t.jsx)("div",{className:"shrink-0 text-[11px] text-[var(--v2-muted)]",children:e.last_used_at?`Last used ${new Date(e.last_used_at).toLocaleDateString()}`:"Not used yet"})]},e.id))})]})]})}),(0,t.jsx)(w.V2Sheet,{open:M,title:"Two-factor authentication (2FA)",onClose:()=>W(!1),children:(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)("div",{className:"text-[12px] text-[var(--v2-muted)]",children:"Protect your account with a 6‑digit code from an authenticator app."}),"error"===ea.kind?(0,t.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--down-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--down)]",children:ea.message}):"ok"===ea.kind?(0,t.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--up-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--up)]",children:ea.message}):null,v?.totp_enabled&&"backup"!==F?(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:"2FA is enabled"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsx)(y.V2Input,{value:G,onChange:e=>Q(e.target.value.replace(/\D/g,"").slice(0,6)),inputMode:"numeric",maxLength:6,placeholder:"000000",className:"font-mono tracking-[0.2em]",autoComplete:"one-time-code"}),(0,t.jsx)(f.V2Button,{variant:"secondary",fullWidth:!0,disabled:null!==ee||6!==G.length,onClick:()=>void tx(),children:"disable"===ee?"Disabling…":"Disable"})]}),(0,t.jsx)("div",{className:"text-[11px] text-[var(--v2-muted)]",children:"Enter a current code to disable 2FA."})]}):"idle"===F?(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:"2FA is off"}),(0,t.jsx)(f.V2Button,{variant:"primary",fullWidth:!0,disabled:null!==ee,onClick:()=>void tp(),children:"setup"===ee?"Setting up…":"Enable 2FA"})]}):"setup"===F?(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsxs)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]",children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:"Setup key"}),(0,t.jsx)("div",{className:"mt-1 break-all rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface-2)] px-3 py-2 font-mono text-[12px] text-[var(--v2-text)]",children:q||"—"}),(0,t.jsxs)("div",{className:"mt-2 grid grid-cols-2 gap-2",children:[(0,t.jsx)(f.V2Button,{variant:"secondary",fullWidth:!0,onClick:()=>void tg(q),children:"Copy key"}),(0,t.jsx)(f.V2Button,{variant:"secondary",fullWidth:!0,onClick:()=>void tg($),children:"Copy URI"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsx)(y.V2Input,{value:Y,onChange:e=>z(e.target.value.replace(/\D/g,"").slice(0,6)),inputMode:"numeric",maxLength:6,placeholder:"000000",className:"font-mono tracking-[0.2em]",autoComplete:"one-time-code"}),(0,t.jsx)(f.V2Button,{variant:"primary",fullWidth:!0,disabled:null!==ee||6!==Y.length,onClick:()=>void th(),children:"enable"===ee?"Verifying…":"Verify"})]}),(0,t.jsx)(f.V2Button,{variant:"secondary",fullWidth:!0,disabled:null!==ee,onClick:()=>{L("idle"),er({kind:"idle"})},children:"Cancel"})]}):"backup"===F?(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:"Save your backup codes"}),(0,t.jsx)("div",{className:"text-[12px] text-[var(--v2-muted)]",children:"Store these safely. Each code can be used once if you lose your authenticator."}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-2",children:X.slice(0,12).map((e,a)=>(0,t.jsx)("div",{className:"rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-2 text-center font-mono text-[12px] text-[var(--v2-text)]",children:e},a))}),(0,t.jsx)(f.V2Button,{variant:"primary",fullWidth:!0,onClick:()=>{L("idle"),W(!1)},children:"I’ve saved them"})]}):null]})}),(0,t.jsx)(w.V2Sheet,{open:es,title:"Change password",onClose:()=>ei(!1),children:(0,t.jsxs)("div",{className:"grid gap-3",children:["error"===ex.kind?(0,t.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--down-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--down)]",children:ex.message}):"ok"===ex.kind?(0,t.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--up-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--up)]",children:ex.message}):null,(0,t.jsxs)("label",{className:"grid gap-1",children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:"Current password"}),(0,t.jsx)(y.V2Input,{type:"password",value:en,onChange:e=>el(e.target.value),autoComplete:"current-password"})]}),(0,t.jsxs)("label",{className:"grid gap-1",children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:"New password"}),(0,t.jsx)(y.V2Input,{type:"password",value:eo,onChange:e=>ed(e.target.value),autoComplete:"new-password"})]}),(0,t.jsxs)("label",{className:"grid gap-1",children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:"Confirm new password"}),(0,t.jsx)(y.V2Input,{type:"password",value:ec,onChange:e=>eu(e.target.value),autoComplete:"new-password"})]}),v?.totp_enabled?(0,t.jsxs)("label",{className:"grid gap-1",children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:"2FA code"}),(0,t.jsx)(y.V2Input,{value:em,onChange:e=>ev(e.target.value.replace(/\D/g,"").slice(0,6)),inputMode:"numeric",maxLength:6,placeholder:"000000",className:"font-mono tracking-[0.2em]",autoComplete:"one-time-code"})]}):null,(0,t.jsx)(f.V2Button,{variant:"primary",fullWidth:!0,disabled:ep||!en||!eo||!ec,onClick:()=>void tf(),children:ep?"Updating…":"Update password"})]})}),(0,t.jsx)(w.V2Sheet,{open:e_,title:"Submit KYC documents",onClose:()=>{eE(!1)},children:(0,t.jsxs)("div",{className:"grid gap-3",children:[(0,t.jsx)("div",{className:"text-[12px] text-[var(--v2-muted)]",children:"Upload clear photos. This sends images to the server for review."}),"error"===eU.kind?(0,t.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--down-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--down)]",children:eU.message}):"ok"===eU.kind?(0,t.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--up-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--up)]",children:eU.message}):null,(0,t.jsx)("div",{className:"grid grid-cols-3 gap-2",children:[{id:"passport",label:"Passport"},{id:"national_id",label:"National ID"},{id:"drivers_license",label:"Driver"}].map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>eA(e.id),className:"h-10 rounded-xl border px-3 text-[13px] font-semibold shadow-[var(--v2-shadow-sm)] "+(eC===e.id?"border-[var(--v2-border)] bg-[var(--v2-surface-2)] text-[var(--v2-text)]":"border-[var(--v2-border)] bg-[var(--v2-surface)] text-[var(--v2-muted)] hover:bg-[var(--v2-surface-2)]"),children:e.label},e.id))}),(0,t.jsxs)("label",{className:"grid gap-1",children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:"Front (required)"}),(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:e=>eO(e.target.files?.[0]??null),className:"h-11 w-full rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 text-[13px] text-[var(--v2-text)] shadow-[var(--v2-shadow-sm)]"}),eR?(0,t.jsx)("div",{className:"text-[11px] text-[var(--v2-muted)]",children:eR.name}):null]}),(0,t.jsxs)("label",{className:"grid gap-1",children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:"Back (optional)"}),(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:e=>eP(e.target.files?.[0]??null),className:"h-11 w-full rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 text-[13px] text-[var(--v2-text)] shadow-[var(--v2-shadow-sm)]"}),eT?(0,t.jsx)("div",{className:"text-[11px] text-[var(--v2-muted)]",children:eT.name}):null]}),(0,t.jsxs)("label",{className:"grid gap-1",children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:"Selfie (optional)"}),(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:e=>eV(e.target.files?.[0]??null),className:"h-11 w-full rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 text-[13px] text-[var(--v2-text)] shadow-[var(--v2-shadow-sm)]"}),eI?(0,t.jsx)("div",{className:"text-[11px] text-[var(--v2-muted)]",children:eI.name}):null]}),(0,t.jsx)(f.V2Button,{variant:"primary",fullWidth:!0,disabled:eD,onClick:()=>void tc(),children:eD?"Submitting…":"Submit"}),(0,t.jsx)("div",{className:"text-[11px] text-[var(--v2-muted)]",children:"Tip: Keep each image ≤ 900KB for reliability."})]})}),(0,t.jsx)(w.V2Sheet,{open:eG,title:"Notification schedule",onClose:()=>eQ(!1),children:(0,t.jsxs)("div",{className:"grid gap-3",children:["error"===e0.kind?(0,t.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--down-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--down)]",children:e0.message}):"ok"===e0.kind?(0,t.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--up-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--up)]",children:e0.message}):null,(0,t.jsxs)("button",{type:"button",onClick:()=>eH(e=>e?{...e,quiet_enabled:!e.quiet_enabled}:e),className:"flex items-center justify-between rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 text-left shadow-[var(--v2-shadow-sm)]",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:"Quiet hours"}),(0,t.jsx)("div",{className:"mt-0.5 text-[12px] text-[var(--v2-muted)]",children:"Mute non-critical alerts during set hours."})]}),E(!!eq?.quiet_enabled,"On","Off")]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"mb-1 text-[12px] font-semibold text-[var(--v2-text)]",children:"Start"}),(0,t.jsx)(y.V2Input,{type:"time",value:N(eq?.quiet_start_min??1320),onChange:e=>eH(t=>t?{...t,quiet_start_min:S(e.target.value)}:t)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"mb-1 text-[12px] font-semibold text-[var(--v2-text)]",children:"End"}),(0,t.jsx)(y.V2Input,{type:"time",value:N(eq?.quiet_end_min??480),onChange:e=>eH(t=>t?{...t,quiet_end_min:S(e.target.value)}:t)})]})]}),(0,t.jsxs)("button",{type:"button",onClick:()=>eH(e=>e?{...e,digest_enabled:!e.digest_enabled}:e),className:"flex items-center justify-between rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 text-left shadow-[var(--v2-shadow-sm)]",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:"Email digest"}),(0,t.jsx)("div",{className:"mt-0.5 text-[12px] text-[var(--v2-muted)]",children:"Periodic summaries (if email channel enabled)."})]}),E(!!eq?.digest_enabled,"On","Off")]}),(0,t.jsx)(f.V2Button,{variant:"primary",fullWidth:!0,disabled:"schedule"===eX||!eq,onClick:()=>void to(),children:"schedule"===eX?"Saving…":"Save schedule"})]})}),(0,t.jsx)(w.V2Sheet,{open:eY,title:"Notification preferences",onClose:()=>ez(!1),children:(0,t.jsxs)("div",{className:"grid gap-3",children:["error"===e0.kind?(0,t.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--down-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--down)]",children:e0.message}):"ok"===e0.kind?(0,t.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--up-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--up)]",children:e0.message}):null,(0,t.jsx)("div",{className:"text-[12px] text-[var(--v2-muted)]",children:"Key alerts (in-app / email). Others keep defaults."}),["order_filled","order_rejected","deposit_credited","withdrawal_completed","p2p_order_expiring","system"].map(e=>{let a=(eM??{})[e]??{in_app:!0,email:!1};return(0,t.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]",children:(0,t.jsx)("div",{className:"flex items-start justify-between gap-3",children:(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:_(e)}),(0,t.jsxs)("div",{className:"mt-1 flex flex-wrap items-center gap-2",children:[(0,t.jsxs)("button",{type:"button",onClick:()=>tn(e,{in_app:!a.in_app}),className:"h-9 rounded-xl border px-3 text-[12px] font-semibold shadow-[var(--v2-shadow-sm)] "+(a.in_app?"border-[var(--v2-border)] bg-[var(--v2-surface-2)] text-[var(--v2-text)]":"border-[var(--v2-border)] bg-[var(--v2-surface)] text-[var(--v2-muted)] hover:bg-[var(--v2-surface-2)]"),children:["In-app: ",a.in_app?"On":"Off"]}),(0,t.jsxs)("button",{type:"button",onClick:()=>tn(e,{email:!a.email}),className:"h-9 rounded-xl border px-3 text-[12px] font-semibold shadow-[var(--v2-shadow-sm)] "+(a.email?"border-[var(--v2-border)] bg-[var(--v2-surface-2)] text-[var(--v2-text)]":"border-[var(--v2-border)] bg-[var(--v2-surface)] text-[var(--v2-muted)] hover:bg-[var(--v2-surface-2)]"),children:["Email: ",a.email?"On":"Off"]})]})]})})},e)}),(0,t.jsx)(f.V2Button,{variant:"primary",fullWidth:!0,disabled:"prefs"===eX||!eM,onClick:()=>void tl(),children:"prefs"===eX?"Saving…":"Save preferences"}),eF.length?(0,t.jsxs)("div",{className:"text-[11px] text-[var(--v2-muted)]",children:["Known types: ",eF.length]}):null]})}),(0,t.jsx)(w.V2Sheet,{open:e1,title:"Notifications",onClose:()=>e3(!1),children:(0,t.jsxs)("div",{className:"grid gap-3",children:[e4?(0,t.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--down-bg)] px-3 py-2 text-[13px] font-semibold text-[var(--down)]",children:e4}):null,(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsx)(f.V2Button,{variant:"secondary",fullWidth:!0,disabled:e5,onClick:()=>void tr(),children:"Refresh"}),(0,t.jsx)(f.V2Button,{variant:"primary",fullWidth:!0,disabled:e5||0===te,onClick:()=>void ts(),children:"Mark all read"})]}),e5?(0,t.jsx)(j.V2Skeleton,{className:"h-32 w-full"}):0===e8.length?(0,t.jsx)("div",{className:"text-sm text-[var(--v2-muted)]",children:"No notifications."}):(0,t.jsx)("div",{className:"grid gap-2",children:e8.slice(0,50).map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>{e.is_read||ti(e.id)},className:"rounded-2xl border border-[var(--v2-border)] px-3 py-3 text-left shadow-[var(--v2-shadow-sm)] "+(e.is_read?"bg-[var(--v2-surface)]":"bg-[color-mix(in_srgb,var(--warn-bg)_55%,var(--v2-surface))]"),children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-text)]",children:e.title}),(0,t.jsx)("div",{className:"mt-1 text-[12px] text-[var(--v2-muted)]",children:e.body}),(0,t.jsxs)("div",{className:"mt-1 text-[11px] text-[var(--v2-muted)]",children:[_(e.type)," • ",e.created_at?new Date(e.created_at).toLocaleString():""]})]}),e.is_read?null:(0,t.jsx)("span",{className:"mt-0.5 inline-flex h-2 w-2 rounded-full bg-[var(--warn)]","aria-label":"Unread"})]})},e.id))})]})})]})}e.s(["AccountClient",()=>A],163765)}]);