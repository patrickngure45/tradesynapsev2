(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,261238,e=>{"use strict";class t extends Error{code;details;status;requestId;constructor(e,t){super(t?.requestId?`${e} (req ${t.requestId})`:e),this.name="ApiError",this.code=e,this.details=t?.details,this.status=t?.status,this.requestId=t?.requestId}}function s(e){return new Promise(t=>setTimeout(t,Math.max(0,Math.floor(e))))}async function a(e,a){let r=a?{...a,credentials:a.credentials??"same-origin"}:{credentials:"same-origin"},i=(r?.method??"GET").toUpperCase();if(("GET"===i||"HEAD"===i)&&function(e){try{let t=window.location.origin,s="string"==typeof e?new URL(e,t):e instanceof URL?e:e instanceof Request?new URL(e.url):null;if(!s||s.origin!==t)return!1;return s.pathname.startsWith("/api/")}catch{return!1}}(e)){let e=function(){try{return(new URL(window.location.href).searchParams.get("user_id")??"").trim()||null}catch{return null}}();if(e){let t=new Headers(r?.headers);t.has("x-impersonate-user-id")||t.set("x-impersonate-user-id",e),r.headers=t}}if(["POST","PUT","PATCH","DELETE"].includes(i)){let e=function(){if("u"<typeof document)return null;let e=document.cookie.match(/(?:^|;\s*)__csrf=([^;]+)/);return e?.[1]??null}();if(e){let t=new Headers(r?.headers);t.has("x-csrf-token")||t.set("x-csrf-token",e),r.headers=t}}let n=(r?.method??"GET").toUpperCase(),o="GET"===n||"HEAD"===n,d=2*!!o,l=null;for(let a=0;a<=d;a+=1)try{let i=await fetch(e,r),n=i.headers.get("x-request-id")??void 0;try{n&&window.sessionStorage.setItem("ts.last_request_id",n)}catch{}let l=await i.text().catch(()=>""),c=(i.headers.get("content-type")??"").includes("text/html")||function(e){let t=String(e??"").trimStart();return t.startsWith("<!DOCTYPE html")||t.startsWith("<html")||t.startsWith("<!doctype html")}(l),u=c?{_raw:"<html/>"}:function(e){try{return e?JSON.parse(e):null}catch{return{_raw:e}}}(l);if(!i.ok){if(o&&(502===i.status||503===i.status||504===i.status)&&a<d){await s(250*Math.pow(2,a));continue}if(u&&"object"==typeof u&&"error"in u){let e="string"==typeof u.error?u.error:`http_${i.status}`,s=void 0!==u.details?u.details:"string"==typeof u.message?u.message:c?{message:`Upstream error (HTTP ${i.status}). Please retry.`}:void 0;throw new t(e,{details:s,status:i.status,requestId:n})}if(u&&"object"==typeof u&&"message"in u){let e="string"==typeof u.message?u.message:u;throw new t(`http_${i.status}`,{details:e,status:i.status,requestId:n})}let e=c?{message:`Upstream error (HTTP ${i.status}). Please retry.`}:u;throw new t(`http_${i.status}`,{details:e,status:i.status,requestId:n})}return u}catch(e){if(l=e,o&&a<d){await s(250*Math.pow(2,a));continue}throw e}throw l}e.s(["ApiError",()=>t,"fetchJsonOrThrow",()=>a])},184724,e=>{"use strict";var t=e.i(843476);function s(e){let t=e?.variant??"secondary",s=e?.size??"md";return["inline-flex select-none items-center justify-center gap-2 whitespace-nowrap rounded-xl transition focus:outline-none focus:ring-2 focus:ring-[var(--v2-ring)] disabled:pointer-events-none disabled:opacity-55","lg"===s?"h-12 px-5 text-[15px]":"sm"===s?"h-9 px-3 text-[13px]":"h-11 px-4 text-[14px]","primary"===t?"bg-[var(--v2-accent)] text-white font-semibold shadow-[var(--v2-shadow-sm)] hover:brightness-105":"danger"===t?"bg-[var(--down)] text-white font-semibold shadow-[var(--v2-shadow-sm)] hover:brightness-105":"ghost"===t?"bg-transparent text-[var(--v2-text)] font-semibold hover:bg-[var(--v2-surface-2)]":"border border-[var(--v2-border)] bg-[var(--v2-surface)] text-[var(--v2-text)] font-semibold shadow-[var(--v2-shadow-sm)] hover:bg-[var(--v2-surface-2)]",e?.fullWidth?"w-full":"",e?.className??""].filter(Boolean).join(" ")}let a=e.i(271645).forwardRef(function({variant:e,size:a,fullWidth:r,className:i,type:n,...o},d){return(0,t.jsx)("button",{ref:d,type:n??"button",className:s({variant:e,size:a,fullWidth:r,className:i}),...o})});e.s(["V2Button",0,a,"v2ButtonClassName",()=>s])},283538,e=>{"use strict";var t=e.i(843476);function s({children:e,className:s=""}){return(0,t.jsx)("section",{className:"rounded-[var(--v2-radius-lg)] border border-[var(--v2-border)] bg-[var(--v2-surface)] shadow-[var(--v2-shadow-sm)] "+s,children:e})}function a({title:e,subtitle:s,right:a}){return(0,t.jsxs)("header",{className:"flex items-start justify-between gap-3 px-4 pt-4",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"text-[15px] font-semibold text-[var(--v2-text)]",children:e}),s?(0,t.jsx)("div",{className:"mt-0.5 text-[13px] text-[var(--v2-muted)]",children:s}):null]}),a?(0,t.jsx)("div",{className:"shrink-0",children:a}):null]})}function r({children:e}){return(0,t.jsx)("div",{className:"px-4 pb-4 pt-3",children:e})}e.s(["V2Card",()=>s,"V2CardBody",()=>r,"V2CardHeader",()=>a])},796830,e=>{"use strict";var t=e.i(843476);let s=e.i(271645).forwardRef(function({className:e="",type:s="text",...a},r){return(0,t.jsx)("input",{ref:r,type:s,className:"h-11 w-full rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 text-[14px] text-[var(--v2-text)] shadow-[var(--v2-shadow-sm)] outline-none placeholder:text-[color-mix(in_srgb,var(--v2-muted)_70%,transparent)] focus:ring-2 focus:ring-[var(--v2-ring)] "+e,...a})});e.s(["V2Input",0,s])},85222,470928,780827,238488,707709,783036,e=>{"use strict";var t=e.i(843476),s=e.i(271645);let a={missing_acting_user_id:{title:"Select an acting user",message:"Pick an acting user first (scopes the trade list)."},missing_or_invalid_users:{title:"Select buyer and seller",message:"Choose a buyer and a different seller before creating a trade."},missing_file:{title:"Missing file",message:"Choose a file to upload."},missing_submitted_by_user_id:{title:"Missing submitter",message:"Pick who is submitting this evidence."},missing_opened_by_user_id:{title:"Missing opener",message:"Pick who is opening the dispute."},missing_decided_by:{title:"Missing reviewer identity",message:"Enter a reviewer identity (decided_by)."},missing_x_user_id:{title:"Missing acting user",message:"This endpoint requires an acting user (session cookie or x-user-id)."},missing_user_id:{title:"Missing acting user",message:"Provide an acting user (session cookie, x-user-id, or user_id)."},session_user_mismatch:{title:"Signed-in user mismatch",message:"Your session is signed in as a different user. Sign in as the user for this action, or switch to header auth."},x_user_id_mismatch:{title:"Acting user mismatch",message:"The acting user does not match the user for this action."},arcade_key_required:{title:"Key required",message:"This action requires a Gate Key. Earn one from Arcade drops, then try again."},user_not_found:{title:"User not found",message:"That user id does not exist."},user_not_active:{title:"User not active",message:"That user is not active and cannot act on trades."},not_party:{title:"Not a party",message:"Only the buyer or seller can access this trade."},opened_by_not_party:{title:"Not a party",message:"Only the buyer or seller can open a dispute."},actor_not_allowed:{title:"Not allowed",message:"The signed-in user is not allowed to perform this action."},email_not_verified:{title:"Email not verified",message:"Verify your email to continue."},totp_setup_required:{title:"2FA required",message:"Set up 2FA (authenticator app) to continue."},totp_required:{title:"2FA code required",message:"Enter your 6-digit authenticator code to continue."},invalid_totp_code:{title:"Invalid 2FA code",message:"That code is invalid. Try again."},stepup_required:{title:"Passkey confirmation required",message:"Confirm with your passkey to continue."},passkey_not_configured:{title:"No passkeys enrolled",message:"Add a passkey in Account settings to use passkey confirmation."},webauthn_verification_failed:{title:"Passkey verification failed",message:"Passkey verification failed. Please try again."},invalid_or_expired_token:{title:"Expired",message:"This request expired. Please try again."},p2p_country_not_supported:{title:"Country not supported",message:"P2P is not available in your country yet."},p2p_open_orders_limit:{title:"Too many open trades",message:"You already have too many open P2P orders awaiting payment. Finish or cancel an existing order and try again."},p2p_order_duplicate_open:{title:"Order already open",message:"You already have an open order for this ad. Open the existing order to continue."},p2p_order_create_cooldown:{title:"Temporarily blocked",message:"You have too many recent payment timeouts. Please wait a bit before creating a new P2P order."},not_found:{title:"Not found",message:"The requested resource was not found."},trade_not_found:{title:"Trade not found",message:"That trade id was not found."},trade_transition_not_allowed:{title:"Invalid transition",message:"That action is not allowed for the trade's current status."},trade_not_cancelable:{title:"Cannot cancel",message:"This trade can't be canceled in its current state. If it's disputed, resolve it via a reviewer decision."},dispute_not_found:{title:"Dispute not found",message:"No dispute exists for this trade."},invalid_input:{title:"Invalid input",message:"Some fields were invalid. Check your inputs and try again."},internal_error:{title:"Server error",message:"The server hit an unexpected error. Try again in a moment."},upstream_unavailable:{title:"Service unavailable",message:"A required dependency is unavailable (typically the database). Try again shortly."},invalid_metadata_json:{title:"Invalid metadata",message:"Metadata JSON must be a valid JSON object."},unsupported_version:{title:"Unsupported version",message:"That API version is not supported."},dispute_already_exists:{title:"Dispute already exists",message:"This trade already has a dispute."},trade_not_disputable:{title:"Trade not disputable",message:"This trade can't be disputed in its current state."},dispute_not_open:{title:"Dispute not open",message:"This dispute is not open (already resolved or closed)."},trade_not_resolvable:{title:"Trade not resolvable",message:"This trade can't be resolved from dispute in its current state."},trade_not_disputed:{title:"Trade not in dispute",message:"This decision requires the trade to be in the disputed state."},trade_state_conflict:{title:"State changed",message:"The trade/dispute state changed while processing. Refresh and try again."},insufficient_balance:{title:"Insufficient balance",message:"You don't have enough available balance for this action."},recipient_not_found:{title:"Recipient not found",message:"No user exists with that email. Check for typos and try again."},recipient_inactive:{title:"Recipient unavailable",message:"That recipient account is not active and cannot receive transfers."},recipient_same_as_sender:{title:"Invalid recipient",message:"You cannot send a transfer to yourself."},transfer_not_found:{title:"Transfer not found",message:"That transfer could not be found."},transfer_not_reversible:{title:"Transfer not reversible",message:"This transfer cannot be reversed automatically."},transfer_already_reversed:{title:"Already reversed",message:"This transfer has already been reversed."},recipient_insufficient_balance_for_reversal:{title:"Cannot reverse transfer",message:"The recipient no longer has enough available balance to reverse this transfer."},withdrawal_address_not_allowlisted:{title:"Address not allowlisted",message:"Withdrawals are allowlist-only. Add this destination address to your allowlist first."},withdrawal_allowlist_cooldown:{title:"Address cooling down",message:"This address was added recently. Wait for the cooldown period before using it."},kyc_required_for_asset:{title:"Verification required",message:"This asset requires additional verification to withdraw."},withdrawal_requires_kyc:{title:"Verification required",message:"This withdrawal requires a higher verification tier."},reviewer_key_invalid:{title:"Reviewer key invalid",message:"Provide the correct reviewer key (x-reviewer-key)."},reviewer_key_not_configured:{title:"Reviewer key not configured",message:"Server is missing reviewer key configuration."},admin_key_invalid:{title:"Admin key invalid",message:"Provide the correct admin key (x-admin-key)."},admin_key_not_configured:{title:"Admin key not configured",message:"Server is missing exchange admin key configuration."},session_secret_not_configured:{title:"Session not configured",message:"Server is missing PROOFPACK_SESSION_SECRET."},session_bootstrap_not_configured:{title:"Bootstrap not configured",message:"Server is missing PROOFPACK_SESSION_BOOTSTRAP_KEY."},session_bootstrap_key_invalid:{title:"Unauthorized",message:"Missing or invalid session bootstrap key."},buyer_not_found:{title:"Buyer not found",message:"The buyer user id does not exist."},seller_not_found:{title:"Seller not found",message:"The seller user id does not exist."},buyer_not_active:{title:"Buyer not active",message:"The buyer user is not active."},seller_not_active:{title:"Seller not active",message:"The seller user is not active."},load_failed:{title:"Load failed",message:"Failed to load this page. Try again."},refresh_failed:{title:"Refresh failed",message:"Failed to refresh data. Try again."},create_trade_failed:{title:"Create trade failed",message:"Failed to create the trade. Try again."},users_failed:{title:"Load users failed",message:"Failed to load users. Try again."},upload_failed:{title:"Upload failed",message:"Failed to upload evidence. Try again."},evacuation_failed:{title:"Add funds failed",message:"Could not pull funds from connected exchanges. Check connection status and try again."},open_dispute_failed:{title:"Open dispute failed",message:"Failed to open dispute. Try again."},submit_decision_failed:{title:"Submit decision failed",message:"Failed to submit reviewer decision. Try again."},risk_failed:{title:"Risk assessment failed",message:"Failed to run risk assessment. Try again."},rate_limit_exceeded:{title:"Too many requests",message:"You're sending too many requests. Please wait a moment and try again."},session_token_expired:{title:"Session expired",message:"Your session has expired. Please sign in again."},dispute_transition_not_allowed:{title:"Invalid dispute transition",message:"That action is not allowed for the dispute's current status."},order_not_found:{title:"Order not found",message:"That order id was not found."},post_only_would_take:{title:"Post-only rejected",message:"This order would immediately take liquidity. Adjust the price or disable post-only."},fok_insufficient_liquidity:{title:"Fill-or-kill failed",message:"There is not enough liquidity to fill the entire order immediately."},idempotency_key_conflict:{title:"Duplicate request key",message:"This idempotency key was already used for a different order payload. Use a new key and try again."},open_orders_limit:{title:"Too many open orders",message:"You have too many open orders. Cancel an existing order and try again."},order_notional_too_large:{title:"Order too large",message:"This order exceeds the current maximum order size limit."},exchange_price_out_of_band:{title:"Price out of band",message:"That limit price is too far from the current market price band. Adjust the price and try again."},market_halted:{title:"Market temporarily halted",message:"This market is temporarily halted due to risk controls. Please try again shortly."},stp_cancel_newest:{title:"Self-trade prevented",message:"This order would cross against your own resting order(s). Adjust your orders and try again."},stp_cancel_both:{title:"Self-trade prevented",message:"This order would cross against your own resting order(s). Your crossing order(s) were canceled."},market_not_found:{title:"Market not found",message:"That market was not found."},market_disabled:{title:"Market disabled",message:"This market is currently disabled for trading."},order_state_conflict:{title:"Order state changed",message:"The order's state changed while processing. Refresh and try again."},price_not_multiple_of_tick:{title:"Invalid price",message:"Price must be a multiple of the market's tick size."},quantity_not_multiple_of_lot:{title:"Invalid quantity",message:"Quantity must be a multiple of the market's lot size."},withdrawal_risk_blocked:{title:"Withdrawal blocked",message:"This withdrawal was flagged by risk controls. Contact support if you believe this is an error."}};function r({error:e,onRetry:r,className:i}){let[n,o]=(0,s.useState)(null),d=(0,s.useMemo)(()=>e?function(e){let t=(e??"").trim();if(!t)return{title:"Error",message:"Something went wrong.",code:"unknown"};if(t.startsWith("http_")){let e=t.match(/^http_(\d{3})$/);if(!e)return{title:"Request failed",message:"Request failed.",code:t};let s=Number(e[1]);return 401===s?{title:"Unauthorized",message:"You are not authenticated for this action.",code:t}:403===s?{title:"Forbidden",message:"You are not allowed to perform this action.",code:t}:404===s?{title:"Not found",message:"The requested resource was not found.",code:t}:409===s?{title:"Conflict",message:"The request conflicts with current state.",code:t}:{title:"Request failed",message:`Request failed with HTTP ${s}.`,code:t}}let s=a[t];return s?{...s,code:t}:{title:"Error",message:t.length>180?t.slice(0,180)+"…":t,code:t}}(e.code):null,[e]),l=(0,s.useMemo)(()=>e?function(e){if(!e)return null;if(Array.isArray(e)){let t=[];for(let s of e){if(!s||"object"!=typeof s)continue;let e=s.path,a=s.message,r=Array.isArray(e)?e.map(e=>String(e)).filter(Boolean).join("."):"",i="string"==typeof a?a:null;i&&t.push(r?`${r}: ${i}`:i)}return t.length?t:null}if("string"==typeof e)return[e];if(e&&"object"==typeof e){let t=[],s="string"==typeof e.message?e.message:null,a="string"==typeof e.error?e.error:null;if(s&&t.push(s),a&&a!==s&&t.push(`error: ${a}`),t.length>0)return t}try{return[JSON.stringify(e,null,2)]}catch{return[String(e)]}}(e.details):null,[e]);if(!d)return null;let c="rounded border border-red-300 bg-red-50 p-4 text-sm text-red-800 dark:border-red-900 dark:bg-red-950 dark:text-red-200",u=i?`${c} ${i}`:c,m=!!(e&&n===e.code);return(0,t.jsxs)("div",{className:u,children:[(0,t.jsx)("div",{className:"font-semibold",children:d.title}),(0,t.jsx)("div",{className:"mt-1",children:d.message}),l?(0,t.jsxs)("div",{className:"mt-2 rounded border border-red-200 bg-white/50 p-2 text-xs dark:border-red-900/50 dark:bg-black/20",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)("div",{className:"font-semibold",children:"Details"}),l.length>6?(0,t.jsx)("button",{type:"button",className:"text-xs underline",onClick:()=>{e&&o(t=>t===e.code?null:e.code)},children:m?"Show less":`Show all (${l.length})`}):null]}),(0,t.jsx)("ul",{className:"mt-1 list-disc pl-5",children:(m?l:l.slice(0,6)).map((e,s)=>(0,t.jsx)("li",{className:"whitespace-pre-wrap break-words font-mono",children:e},s))})]}):null,(0,t.jsx)("div",{className:"mt-2 font-mono text-xs opacity-80",children:d.code}),r?(0,t.jsx)("button",{type:"button",className:"mt-3 rounded bg-zinc-900 px-3 py-2 text-white dark:bg-zinc-100 dark:text-black",onClick:r,children:"Retry"}):null]})}e.s(["ApiErrorBanner",()=>r],85222);let i={created:["awaiting_payment","disputed","canceled"],awaiting_payment:["paid_marked","disputed","canceled"],paid_marked:["released","disputed","resolved","canceled"],released:["resolved","disputed"],disputed:["resolved"],resolved:[],canceled:[]};function n(e,t){return("created"===e||"awaiting_payment"===e||"paid_marked"===e||"released"===e||"disputed"===e||"resolved"===e||"canceled"===e)&&i[e].includes(t)}function o(e){return n(e,"disputed")}e.s(["canOpenDispute",()=>o,"canTransitionTrade",()=>n],470928);var d=e.i(261238);async function l(){return await (0,d.fetchJsonOrThrow)("/api/whoami",{cache:"no-store"})}async function c(e){let t={"Content-Type":"application/json"};return e.bootstrapKey&&(t["x-session-bootstrap-key"]=e.bootstrapKey),await (0,d.fetchJsonOrThrow)("/api/auth/session",{method:"POST",headers:t,body:JSON.stringify({user_id:e.userId,ttl_seconds:e.ttlSeconds})})}async function u(){return await (0,d.fetchJsonOrThrow)("/api/auth/session",{method:"DELETE"})}e.s(["clearSessionCookie",()=>u,"createSessionCookie",()=>c,"fetchWhoAmI",()=>l],780827);let m="proofpack.acting_user_id";function p(e=window.location.href){let t="";try{t=new URL(e).searchParams.get("user_id")??""}catch{}let s="";try{s=window.localStorage.getItem(m)??""}catch{}return t||s}function h(e,t=window.location.href){if(e){try{window.localStorage.setItem(m,e)}catch{}try{let s=new URL(t);s.searchParams.set("user_id",e),window.history.replaceState(null,"",s.toString())}catch{}}}async function x(e){if(!e)return!1;try{let t=globalThis.navigator;if(t?.clipboard?.writeText)return await t.clipboard.writeText(e),!0}catch{}try{let t=globalThis.document;if(!t)return!1;let s=t.createElement("textarea");s.value=e,s.setAttribute("readonly","true"),s.style.position="fixed",s.style.left="-9999px",s.style.top="-9999px",t.body.appendChild(s),s.focus(),s.select();let a=t.execCommand?.("copy")??!1;return t.body.removeChild(s),!!a}catch{return!1}}function v({message:e,kind:a="info",durationMs:r=1500,onDone:i}){if((0,s.useEffect)(()=>{if(!e)return;let t=window.setTimeout(()=>i?.(),r);return()=>window.clearTimeout(t)},[e,r,i]),!e)return null;let n="pointer-events-none fixed bottom-4 left-4 right-4 z-50 rounded-xl border px-3 py-2 text-sm shadow-[var(--shadow)] sm:left-auto sm:right-4 sm:w-[420px] overflow-hidden",o="success"===a?`${n} border-[color-mix(in_srgb,var(--up)_25%,var(--border))] bg-[color-mix(in_srgb,var(--up-bg)_70%,var(--card))] text-[var(--foreground)]`:"error"===a?`${n} border-[color-mix(in_srgb,var(--down)_25%,var(--border))] bg-[color-mix(in_srgb,var(--down-bg)_70%,var(--card))] text-[var(--foreground)]`:`${n} border-[var(--border)] bg-[var(--card)] text-[var(--foreground)]`;return(0,t.jsxs)("div",{role:"status","aria-live":"polite",className:o,children:[(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 opacity-60",style:{background:"radial-gradient(420px 140px at 10% 0%, color-mix(in oklab, var(--accent) 18%, transparent) 0%, transparent 60%), radial-gradient(260px 140px at 90% 10%, color-mix(in oklab, var(--accent-2) 12%, transparent) 0%, transparent 55%)"}}),(0,t.jsxs)("div",{className:"relative flex items-start gap-2",children:[(0,t.jsx)("div",{className:"mt-0.5 h-2.5 w-2.5 rounded-full "+("success"===a?"bg-[var(--up)]":"error"===a?"bg-[var(--down)]":"bg-[var(--accent)]")}),(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"text-[11px] font-semibold text-[var(--muted)]",children:"success"===a?"Signal":"error"===a?"Error":"Update"}),(0,t.jsx)("div",{className:"mt-0.5 text-sm leading-snug text-[var(--foreground)] break-words",children:e})]})]})]})}e.s(["persistActingUserIdPreference",()=>h,"readActingUserIdPreference",()=>p],238488),e.s(["copyToClipboard",()=>x],707709),e.s(["Toast",()=>v],783036)},194971,e=>{"use strict";e.i(247167);var t=e.i(843476),s=e.i(271645),a=e.i(261238),r=e.i(85222),i=e.i(470928),n=e.i(780827),o=e.i(238488),d=e.i(707709),l=e.i(783036),c=e.i(184724),u=e.i(283538),m=e.i(796830);function p({tradeId:e}){let[p,h]=(0,s.useState)(!0),[x,v]=(0,s.useState)(null),[f,g]=(0,s.useState)("session"),[_,y]=(0,s.useState)(null),[b,j]=(0,s.useState)(""),[w,N]=(0,s.useState)(!1),[k,T]=(0,s.useState)(""),[C,S]=(0,s.useState)(!1),[P,A]=(0,s.useState)(null),[E,O]=(0,s.useState)([]),[R,V]=(0,s.useState)([]),[q,B]=(0,s.useState)(null),[I,$]=(0,s.useState)(null),[U,M]=(0,s.useState)([]),z=(0,s.useMemo)(()=>(function(e){let t=Array.from(new Set(e.map(e=>"string"==typeof e?.type?e.type:"").filter(Boolean))).sort(),s=e.length;if(0===s)return{score:0,evidence_count:s,evidence_types:t,missing_recommendations:["upload a payment proof (receipt/bank_sms)","upload chat export"]};let a=0;(t.includes("receipt")||t.includes("bank_sms"))&&(a+=40),t.includes("chat_export")&&(a+=30),t.includes("screenshot")&&(a+=20),s>=2&&(a+=10),a=Math.max(0,Math.min(100,a));let r=[];return t.includes("receipt")||t.includes("bank_sms")||r.push("upload a payment proof (receipt/bank_sms)"),t.includes("chat_export")||r.push("upload chat export"),t.includes("screenshot")||r.push("upload screenshots"),{score:a,evidence_count:s,evidence_types:t,missing_recommendations:r}})(R),[R]),[J,D]=(0,s.useState)("receipt"),[F,Y]=(0,s.useState)(""),[H,L]=(0,s.useState)("{}"),[W,K]=(0,s.useState)(null),[G,Q]=(0,s.useState)(!1),[Z,X]=(0,s.useState)(""),[ee,et]=(0,s.useState)("non_payment"),[es,ea]=(0,s.useState)(!1),[er,ei]=(0,s.useState)("reviewer@local"),[en,eo]=(0,s.useState)(""),[ed,el]=(0,s.useState)("release_to_buyer"),[ec,eu]=(0,s.useState)(""),[em,ep]=(0,s.useState)(!1),[eh,ex]=(0,s.useState)(null),[ev,ef]=(0,s.useState)("info"),[eg,e_]=(0,s.useState)(!1),ey=(0,s.useMemo)(()=>P&&k?k===P.buyer_user_id?"buyer":k===P.seller_user_id?"seller":null:null,[P,k]),eb=(e,t)=>eg?"Working…":P?k?(0,i.canTransitionTrade)(P.status,e)?t?.role==="buyer"&&k!==P.buyer_user_id?"Buyer only.":t?.role==="seller"&&k!==P.seller_user_id?"Seller only.":"canceled"===e&&"disputed"===P.status?"Use reviewer decision to cancel disputed trades.":"":`Not allowed from status: ${P.status}`:"Select an acting user.":"",ej=(0,s.useMemo)(()=>{let t=`/api/trades/${e}/proof-pack`,s="session"===f?_??k:k;return s?`${t}?user_id=${encodeURIComponent(s)}`:t},[e,k,f,_]),ew=(0,s.useMemo)(()=>`/api/trades/${e}/evidence/upload`,[e]),eN=(0,s.useMemo)(()=>`/api/trades/${e}/dispute`,[e]),ek=(0,s.useMemo)(()=>`/api/trades/${e}/dispute/decision`,[e]);async function eT(){try{let e=await (0,n.fetchWhoAmI)();y(e.user_id)}catch(e){if(e instanceof a.ApiError&&"missing_x_user_id"===e.code)return void y(null);y(null)}}async function eC(e){if(!e)return!1;N(!0),v(null);try{return await (0,n.createSessionCookie)({userId:e,bootstrapKey:b||void 0}),await eT(),ef("success"),ex("Session cookie set."),!0}catch(e){return e instanceof a.ApiError?v({code:e.code,details:e.details}):v({code:e instanceof Error?e.message:"session_failed"}),!1}finally{N(!1)}}async function eS(){N(!0),v(null);try{await (0,n.clearSessionCookie)(),await eT(),ef("success"),ex("Signed out.")}catch(e){e instanceof a.ApiError?v({code:e.code,details:e.details}):v({code:e instanceof Error?e.message:"signout_failed"})}finally{N(!1)}}async function eP(){h(!0),v(null);try{let t="header"===f&&k?{"x-user-id":k}:{},[s,r,i,n]=await Promise.all([(0,a.fetchJsonOrThrow)(`/api/trades/${e}`,{cache:"no-store",headers:t}),(0,a.fetchJsonOrThrow)(`/api/trades/${e}/evidence`,{cache:"no-store",headers:t}),(0,a.fetchJsonOrThrow)(`/api/trades/${e}/risk`,{cache:"no-store",headers:t}),(0,a.fetchJsonOrThrow)(eN,{cache:"no-store",headers:t})]);A(s.trade??null),O(s.transitions??[]),V(r.evidence??[]),B(i.risk_assessment??null),$(n.dispute??null),M(n.decisions??[]);let o=s.trade?.buyer_user_id??"";Y(e=>e||o);let d=s.trade?.buyer_user_id??"";X(e=>e||d);let l=_??s.trade?.buyer_user_id??"";T(e=>e||l)}catch(e){e instanceof a.ApiError?v({code:e.code,details:e.details}):v({code:e instanceof Error?e.message:"load_failed"})}finally{h(!1)}}async function eA(){v(null);try{if("session"===f&&_&&k&&_!==k)return void v({code:"session_user_mismatch"});await (0,a.fetchJsonOrThrow)(`/api/trades/${e}/risk`,{method:"POST",headers:{"Content-Type":"application/json",..."header"===f&&k?{"x-user-id":k}:{}},body:JSON.stringify({version:"v0"})}),await eP()}catch(e){e instanceof a.ApiError?v({code:e.code,details:e.details}):v({code:e instanceof Error?e.message:"risk_failed"})}}async function eE(){if(!W)return void v({code:"missing_file"});if(!F)return void v({code:"missing_submitted_by_user_id"});Q(!0),v(null);try{if("session"===f&&_&&F&&_!==F)return void v({code:"session_user_mismatch"});let e=new FormData;e.set("submitted_by_user_id",F),e.set("type",J),e.set("metadata_json",H),e.set("file",W);let t={method:"POST",body:e};"header"===f&&F&&(t.headers={"x-user-id":F}),await (0,a.fetchJsonOrThrow)(ew,t),K(null),await eP()}catch(e){e instanceof a.ApiError?v({code:e.code,details:e.details}):v({code:e instanceof Error?e.message:"upload_failed"})}finally{Q(!1)}}async function eO(){if(!Z)return void v({code:"missing_opened_by_user_id"});ea(!0),v(null);try{if("session"===f&&_&&Z&&_!==Z)return void v({code:"session_user_mismatch"});await (0,a.fetchJsonOrThrow)(eN,{method:"POST",headers:{"Content-Type":"application/json",..."header"===f?{"x-user-id":Z}:{}},body:JSON.stringify({opened_by_user_id:Z,reason_code:ee})}),await eP()}catch(e){e instanceof a.ApiError?v({code:e.code,details:e.details}):v({code:e instanceof Error?e.message:"open_dispute_failed"})}finally{ea(!1)}}async function eR(){if(!er)return void v({code:"missing_decided_by"});ep(!0),v(null);try{let e={"Content-Type":"application/json"};en&&(e["x-reviewer-key"]=en),await (0,a.fetchJsonOrThrow)(ek,{method:"POST",headers:e,body:JSON.stringify({decision:ed,decided_by:er,rationale:ec||void 0})}),eu(""),await eP()}catch(e){e instanceof a.ApiError?v({code:e.code,details:e.details}):v({code:e instanceof Error?e.message:"submit_decision_failed"})}finally{ep(!1)}}async function eV(t){e_(!0),v(null);try{let s={created:"",awaiting_payment:"awaiting-payment",paid_marked:"paid-marked",released:"released",disputed:"",resolved:"resolved",canceled:"canceled"}[t];if(!s)return void v({code:"trade_transition_not_allowed"});let r={method:"POST"};"header"===f&&k&&(r.headers={"x-user-id":k}),await (0,a.fetchJsonOrThrow)(`/api/trades/${e}/status/${s}`,r),ef("success"),ex(`Trade moved to ${t}.`),await eP()}catch(e){e instanceof a.ApiError?v({code:e.code,details:e.details}):v({code:e instanceof Error?e.message:"transition_failed"})}finally{e_(!1)}}if((0,s.useEffect)(()=>{let e=(0,o.readActingUserIdPreference)();e&&T(t=>t||e),eT(),S(!0)},[e]),(0,s.useEffect)(()=>{"session"!==f||!k||_===k||w||b&&eC(k)},[f]),(0,s.useEffect)(()=>{k&&(0,o.persistActingUserIdPreference)(k)},[k]),(0,s.useEffect)(()=>{if(C){if("header"===f&&!k||"session"===f&&!_){h(!1),v({code:"missing_x_user_id"});return}eP()}},[e,k,C,f,_]),p)return(0,t.jsx)("div",{className:"mt-6 text-[13px] text-[var(--v2-muted)]",children:"Loading…"});if(x)return(0,t.jsx)(r.ApiErrorBanner,{error:x,className:"mt-6",onRetry:()=>void eP()});if(!P)return(0,t.jsx)("div",{className:"mt-6 text-[13px] text-[var(--v2-muted)]",children:"Not found."});let eq="h-11 w-full rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 text-[14px] font-semibold text-[var(--v2-text)] shadow-[var(--v2-shadow-sm)] outline-none focus:ring-2 focus:ring-[var(--v2-ring)]",eB="min-h-20 w-full rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-2 text-[13px] text-[var(--v2-text)] shadow-[var(--v2-shadow-sm)] outline-none focus:ring-2 focus:ring-[var(--v2-ring)]",eI="overflow-auto rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface-2)] px-3 py-2 font-mono text-[12px] text-[var(--v2-text)]";return(0,t.jsxs)("div",{className:"mt-6 grid gap-6",children:[(0,t.jsx)(l.Toast,{message:eh,kind:ev,onDone:()=>ex(null)}),(0,t.jsxs)(u.V2Card,{children:[(0,t.jsx)(u.V2CardHeader,{title:"Viewer",subtitle:(0,t.jsxs)("span",{children:["Auth: use a session cookie (recommended) or send"," ",(0,t.jsx)("span",{className:"font-mono",children:"x-user-id"}),"."]})}),(0,t.jsx)(u.V2CardBody,{children:(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2 text-[12px] text-[var(--v2-muted)]",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Auth mode"}),(0,t.jsxs)("select",{className:"h-9 rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 text-[12px] font-semibold text-[var(--v2-text)] shadow-[var(--v2-shadow-sm)] outline-none focus:ring-2 focus:ring-[var(--v2-ring)]",value:f,onChange:e=>{let t=e.target.value;g(t),"session"!==t||!k||_===k||b&&eC(k)},children:[(0,t.jsx)("option",{value:"session",children:"session cookie"}),(0,t.jsx)("option",{value:"header",children:"x-user-id header"})]})]}),"session"===f?(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-[12px] text-[var(--v2-muted)]",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Session"}),(0,t.jsx)("span",{className:"font-mono",children:_?`${_.slice(0,8)}…`:"(none)"}),(0,t.jsx)(c.V2Button,{size:"sm",variant:"secondary",disabled:!k||w,onClick:()=>void eC(k),children:"Sign in"}),(0,t.jsx)(c.V2Button,{size:"sm",variant:"secondary",disabled:w,onClick:()=>void eS(),children:"Sign out"}),(0,t.jsxs)("details",{children:[(0,t.jsx)("summary",{className:"cursor-pointer text-[11px] font-semibold text-[var(--v2-muted)]",children:"prod bootstrap"}),(0,t.jsx)("div",{className:"mt-2 grid gap-1",children:(0,t.jsxs)("label",{className:"grid gap-1",children:[(0,t.jsx)("span",{className:"text-[11px] font-semibold text-[var(--v2-muted)]",children:"x-session-bootstrap-key"}),(0,t.jsx)(m.V2Input,{className:"h-10 font-mono text-[12px]",value:b,type:"password",placeholder:"(only needed in production)",onChange:e=>j(e.target.value)})]})})]})]}):(0,t.jsx)("div",{className:"text-[12px] text-[var(--v2-muted)]",children:"Requests send x-user-id."})]}),(0,t.jsxs)("label",{className:"grid gap-1",children:[(0,t.jsx)("span",{className:"text-[12px] font-semibold text-[var(--v2-muted)]",children:"Acting user"}),(0,t.jsxs)("select",{className:eq,value:k,onChange:e=>{let t=e.target.value;"session"!==f?T(t):(T(t),_===t||b&&(async()=>{await eC(t)||T(k)})())},children:[(0,t.jsxs)("option",{value:P.buyer_user_id,children:["buyer ",P.buyer_user_id.slice(0,8),"…"]}),(0,t.jsxs)("option",{value:P.seller_user_id,children:["seller ",P.seller_user_id.slice(0,8),"…"]})]})]})]})})]}),(0,t.jsxs)(u.V2Card,{children:[(0,t.jsx)(u.V2CardHeader,{title:"Trade",right:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("a",{className:"text-[13px] font-semibold text-[var(--v2-accent-2)] underline",href:ej,children:"Download Proof Pack"}),(0,t.jsx)(c.V2Button,{size:"sm",variant:"secondary",onClick:async()=>{try{let e=new URL(ej,window.location.origin).toString();await (0,d.copyToClipboard)(e)?(ef("success"),ex("Proof pack link copied.")):(ef("error"),ex("Copy failed."))}catch{ef("error"),ex("Copy failed.")}},children:"Copy link"})]})}),(0,t.jsxs)(u.V2CardBody,{children:[(0,t.jsxs)("details",{className:"mt-2",children:[(0,t.jsx)("summary",{className:"cursor-pointer text-[12px] font-semibold text-[var(--v2-muted)]",children:"Verify locally"}),(0,t.jsxs)("div",{className:"mt-2 grid gap-2 text-[12px] text-[var(--v2-muted)]",children:[(0,t.jsxs)("div",{children:["Run from ",(0,t.jsx)("span",{className:"font-mono",children:"apps/web"})," after downloading the ZIP:"]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)("pre",{className:eI,children:"npm run verify:proofpack -- <path-to-zip>"}),(0,t.jsx)(c.V2Button,{size:"sm",variant:"secondary",onClick:async()=>{let e=await (0,d.copyToClipboard)("npm run verify:proofpack -- <path-to-zip>");ef(e?"success":"error"),ex(e?"Command copied.":"Copy failed.")},children:"Copy"})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)("pre",{className:eI,children:"npm run verify:proofpack -- --require-signed <path-to-zip>"}),(0,t.jsx)(c.V2Button,{size:"sm",variant:"secondary",onClick:async()=>{let e=await (0,d.copyToClipboard)("npm run verify:proofpack -- --require-signed <path-to-zip>");ef(e?"success":"error"),ex(e?"Command copied.":"Copy failed.")},children:"Copy"})]})]})]}),E.length?(0,t.jsxs)("div",{className:"mt-3 rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface-2)] p-3 text-[13px]",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)("span",{className:"text-[var(--v2-muted)]",children:"Latest transition:"}),(0,t.jsxs)("span",{className:"font-mono",children:[E[E.length-1].from_status??"∅"," → ",E[E.length-1].to_status]}),(0,t.jsx)("span",{className:"text-[var(--v2-muted)]",children:"@"}),(0,t.jsx)("span",{className:"font-mono text-[12px] text-[var(--v2-muted)]",children:E[E.length-1].created_at})]}),E[E.length-1].reason_code?(0,t.jsx)("div",{className:"mt-1 font-mono text-[12px] text-[var(--v2-muted)]",children:E[E.length-1].reason_code}):null]}):null,(0,t.jsxs)("div",{className:"mt-3 grid gap-2 text-[13px] text-[var(--v2-text)]",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-[var(--v2-muted)]",children:"Status:"})," ",P.status]}),ey?(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)("span",{className:"text-[var(--v2-muted)]",children:"You are:"}),(0,t.jsx)("span",{className:"buyer"===ey?"rounded-full border border-[color-mix(in_srgb,var(--up)_35%,var(--v2-border))] bg-[color-mix(in_srgb,var(--up)_10%,transparent)] px-2 py-0.5 text-[11px] font-semibold text-[var(--up)]":"rounded-full border border-[color-mix(in_srgb,var(--v2-accent-2)_35%,var(--v2-border))] bg-[color-mix(in_srgb,var(--v2-accent-2)_10%,transparent)] px-2 py-0.5 text-[11px] font-semibold text-[var(--v2-accent-2)]",children:ey})]}):null,(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)("span",{className:"text-[12px] text-[var(--v2-muted)]",children:"Lifecycle:"}),(0,t.jsx)(c.V2Button,{size:"sm",variant:"secondary",disabled:eg||!(0,i.canTransitionTrade)(P.status,"awaiting_payment"),onClick:()=>void eV("awaiting_payment"),title:eb("awaiting_payment")||"created → awaiting_payment",children:"Awaiting payment"}),(0,t.jsx)(c.V2Button,{size:"sm",variant:"secondary",disabled:eg||!(0,i.canTransitionTrade)(P.status,"paid_marked")||k!==P.buyer_user_id,onClick:()=>void eV("paid_marked"),title:eb("paid_marked",{role:"buyer"})||"awaiting_payment → paid_marked",children:"Mark paid (buyer)"}),(0,t.jsx)(c.V2Button,{size:"sm",variant:"secondary",disabled:eg||!(0,i.canTransitionTrade)(P.status,"released")||k!==P.seller_user_id,onClick:()=>void eV("released"),title:eb("released",{role:"seller"})||"paid_marked → released",children:"Release (seller)"}),(0,t.jsx)(c.V2Button,{size:"sm",variant:"secondary",disabled:eg||!(0,i.canTransitionTrade)(P.status,"resolved"),onClick:()=>void eV("resolved"),title:eb("resolved")||"Resolve trade",children:"Resolve"}),(0,t.jsx)(c.V2Button,{size:"sm",variant:"danger",disabled:eg||"disputed"===P.status||!(0,i.canTransitionTrade)(P.status,"canceled"),onClick:()=>void eV("canceled"),title:eb("canceled")||"Cancel trade",children:"Cancel"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-[var(--v2-muted)]",children:"Pair:"})," ",P.crypto_asset,"/",P.fiat_currency]}),(0,t.jsxs)("div",{className:"font-mono",children:[(0,t.jsx)("span",{className:"text-[var(--v2-muted)] font-sans",children:"Price:"})," ",P.price]}),(0,t.jsxs)("div",{className:"font-mono",children:[(0,t.jsx)("span",{className:"text-[var(--v2-muted)] font-sans",children:"Fair mid:"})," ",P.fair_price_mid??"—"]}),(0,t.jsxs)("div",{className:"font-mono",children:[(0,t.jsx)("span",{className:"text-[var(--v2-muted)] font-sans",children:"Deviation pct:"})," ",P.price_deviation_pct??"—"]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-[12px]",children:[(0,t.jsx)("span",{className:"font-mono text-[var(--v2-muted)]",children:P.id}),(0,t.jsx)(c.V2Button,{size:"sm",variant:"secondary",onClick:async()=>{let e=await (0,d.copyToClipboard)(P.id);ef(e?"success":"error"),ex(e?"Trade ID copied.":"Copy failed.")},children:"Copy ID"}),(0,t.jsx)(c.V2Button,{size:"sm",variant:"secondary",onClick:async()=>{try{let e=k?`/trades/${P.id}?user_id=${encodeURIComponent(k)}`:`/trades/${P.id}`,t=new URL(e,window.location.origin).toString(),s=await (0,d.copyToClipboard)(t);ef(s?"success":"error"),ex(s?"Trade link copied.":"Copy failed.")}catch{ef("error"),ex("Copy failed.")}},children:"Copy link"})]})]})]})]}),(0,t.jsxs)(u.V2Card,{children:[(0,t.jsx)(u.V2CardHeader,{title:"Risk",right:(0,t.jsx)(c.V2Button,{variant:"secondary",onClick:()=>void eA(),children:"Recompute v0"})}),(0,t.jsx)(u.V2CardBody,{children:q?(0,t.jsxs)("div",{className:"mt-1 text-[13px]",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-[var(--v2-muted)]",children:"Score:"})," ",q.score]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-[var(--v2-muted)]",children:"Action:"})," ",q.recommended_action]}),(0,t.jsxs)("details",{className:"mt-3",children:[(0,t.jsx)("summary",{className:"cursor-pointer text-[12px] font-semibold text-[var(--v2-muted)]",children:"Factors JSON"}),(0,t.jsx)("pre",{className:"mt-2 "+eI,children:function(e){try{return JSON.stringify(e,null,2)}catch{return""}}(q.factors_json)})]})]}):(0,t.jsx)("div",{className:"mt-1 text-[13px] text-[var(--v2-muted)]",children:"No risk assessment yet."})})]}),(0,t.jsxs)(u.V2Card,{children:[(0,t.jsx)(u.V2CardHeader,{title:"Evidence"}),(0,t.jsxs)(u.V2CardBody,{children:[(0,t.jsxs)("div",{className:"text-[13px] text-[var(--v2-muted)]",children:["Completeness score: ",(0,t.jsx)("span",{className:"font-mono",children:z.score}),"/100",z.missing_recommendations.length?(0,t.jsxs)("span",{children:[" ","— next: ",z.missing_recommendations.join(", ")]}):null]}),(0,t.jsxs)("div",{className:"mt-3 grid gap-3",children:[(0,t.jsxs)("div",{className:"grid gap-2 md:grid-cols-2",children:[(0,t.jsxs)("label",{className:"grid gap-1",children:[(0,t.jsx)("span",{className:"text-[12px] font-semibold text-[var(--v2-muted)]",children:"Submitted by"}),(0,t.jsxs)("select",{className:eq,value:F,onChange:e=>Y(e.target.value),children:[(0,t.jsxs)("option",{value:P.buyer_user_id,children:["buyer ",P.buyer_user_id.slice(0,8),"…"]}),(0,t.jsxs)("option",{value:P.seller_user_id,children:["seller ",P.seller_user_id.slice(0,8),"…"]})]})]}),(0,t.jsxs)("label",{className:"grid gap-1",children:[(0,t.jsx)("span",{className:"text-[12px] font-semibold text-[var(--v2-muted)]",children:"Type"}),(0,t.jsxs)("select",{className:eq,value:J,onChange:e=>D(e.target.value),children:[(0,t.jsx)("option",{value:"receipt",children:"receipt"}),(0,t.jsx)("option",{value:"screenshot",children:"screenshot"}),(0,t.jsx)("option",{value:"bank_sms",children:"bank_sms"}),(0,t.jsx)("option",{value:"chat_export",children:"chat_export"}),(0,t.jsx)("option",{value:"other",children:"other"})]})]})]}),(0,t.jsxs)("label",{className:"grid gap-1",children:[(0,t.jsx)("span",{className:"text-[12px] font-semibold text-[var(--v2-muted)]",children:"Metadata JSON"}),(0,t.jsx)("textarea",{className:eB+" font-mono text-[12px]",value:H,onChange:e=>L(e.target.value)})]}),(0,t.jsxs)("label",{className:"grid gap-1",children:[(0,t.jsx)("span",{className:"text-[12px] font-semibold text-[var(--v2-muted)]",children:"File"}),(0,t.jsx)("input",{className:"text-[13px] text-[var(--v2-text)]",type:"file",onChange:e=>K(e.target.files?.item(0)??null)})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(c.V2Button,{variant:"primary",disabled:G,onClick:()=>void eE(),children:G?"Uploading…":"Upload"}),(0,t.jsx)(c.V2Button,{variant:"ghost",onClick:()=>void eP(),children:"Refresh"})]}),(0,t.jsxs)("div",{className:"mt-2 rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)]",children:[(0,t.jsxs)("div",{className:"border-b border-[var(--v2-border)] px-3 py-2 text-[12px] font-semibold text-[var(--v2-muted)]",children:["Evidence objects (",R.length,")"]}),(0,t.jsxs)("ul",{className:"divide-y divide-[var(--v2-border)] text-[13px]",children:[R.map(e=>(0,t.jsxs)("li",{className:"px-3 py-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-[var(--v2-muted)]",children:e.type})," — ",e.sha256.slice(0,10),"…"]}),(0,t.jsx)("div",{className:"text-[12px] text-[var(--v2-muted)]",children:e.created_at})]}),(0,t.jsx)("div",{className:"mt-1 font-mono text-[12px] text-[var(--v2-muted)]",children:e.storage_uri})]},e.id)),0===R.length?(0,t.jsx)("li",{className:"px-3 py-3 text-[13px] text-[var(--v2-muted)]",children:"No evidence yet."}):null]})]})]})]})]}),(0,t.jsxs)(u.V2Card,{children:[(0,t.jsx)(u.V2CardHeader,{title:"Dispute"}),(0,t.jsx)(u.V2CardBody,{children:I?(0,t.jsxs)("div",{className:"grid gap-3 text-[13px]",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-[var(--v2-muted)]",children:"Status:"})," ",I.status]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-[var(--v2-muted)]",children:"Reason:"})," ",I.reason_code]}),(0,t.jsxs)("div",{className:"font-mono text-[12px] text-[var(--v2-muted)]",children:["opened_by=",I.opened_by_user_id," opened_at=",I.opened_at]}),(0,t.jsxs)("div",{className:"rounded-2xl border border-[var(--v2-border)]",children:[(0,t.jsxs)("div",{className:"border-b border-[var(--v2-border)] px-3 py-2 text-[12px] font-semibold text-[var(--v2-muted)]",children:["Decisions (",U.length,")"]}),(0,t.jsxs)("ul",{className:"divide-y divide-[var(--v2-border)] text-[13px]",children:[U.map(e=>(0,t.jsxs)("li",{className:"px-3 py-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-[var(--v2-muted)]",children:e.decision})," — ",e.decided_by]}),(0,t.jsx)("div",{className:"text-[12px] text-[var(--v2-muted)]",children:e.created_at})]}),e.rationale?(0,t.jsx)("div",{className:"mt-1 text-[12px] text-[var(--v2-muted)]",children:e.rationale}):null]},e.id)),0===U.length?(0,t.jsx)("li",{className:"px-3 py-3 text-sm text-zinc-500",children:"No decisions yet."}):null]})]}),"resolved"!==I.status?(0,t.jsxs)("div",{className:"mt-2 grid gap-2",children:[(0,t.jsx)("div",{className:"text-[13px] text-[var(--v2-muted)]",children:"Add decision (demo)"}),(0,t.jsxs)("label",{className:"grid gap-1",children:[(0,t.jsx)("span",{className:"text-[12px] font-semibold text-[var(--v2-muted)]",children:"Decided by"}),(0,t.jsx)(m.V2Input,{value:er,onChange:e=>ei(e.target.value)})]}),(0,t.jsxs)("label",{className:"grid gap-1",children:[(0,t.jsx)("span",{className:"text-[12px] font-semibold text-[var(--v2-muted)]",children:"Reviewer key (optional)"}),(0,t.jsx)(m.V2Input,{className:"font-mono text-[12px]",placeholder:"PROOFPACK_REVIEWER_KEY",value:en,onChange:e=>eo(e.target.value)})]}),(0,t.jsxs)("label",{className:"grid gap-1",children:[(0,t.jsx)("span",{className:"text-[12px] font-semibold text-[var(--v2-muted)]",children:"Decision"}),(0,t.jsxs)("select",{className:eq,value:ed,onChange:e=>el(e.target.value),children:[(0,t.jsx)("option",{value:"release_to_buyer",children:"release_to_buyer"}),(0,t.jsx)("option",{value:"refund_buyer",children:"refund_buyer"}),(0,t.jsx)("option",{value:"release_to_seller",children:"release_to_seller"}),(0,t.jsx)("option",{value:"cancel_trade",children:"cancel_trade"})]})]}),(0,t.jsxs)("label",{className:"grid gap-1",children:[(0,t.jsx)("span",{className:"text-[12px] font-semibold text-[var(--v2-muted)]",children:"Rationale"}),(0,t.jsx)("textarea",{className:eB,value:ec,onChange:e=>eu(e.target.value)})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(c.V2Button,{variant:"primary",disabled:em,onClick:()=>void eR(),children:em?"Submitting…":"Submit decision"}),(0,t.jsx)(c.V2Button,{variant:"ghost",onClick:()=>void eP(),children:"Refresh"})]})]}):(0,t.jsxs)("div",{className:"mt-2 text-[13px] text-[var(--v2-muted)]",children:["Resolved at ",I.resolved_at??"—"]})]}):(0,t.jsxs)("div",{className:"mt-3 grid gap-3",children:[(0,t.jsx)("div",{className:"text-[13px] text-[var(--v2-muted)]",children:"No dispute yet."}),(0,t.jsxs)("div",{className:"grid gap-2 md:grid-cols-2",children:[(0,t.jsxs)("label",{className:"grid gap-1",children:[(0,t.jsx)("span",{className:"text-[12px] font-semibold text-[var(--v2-muted)]",children:"Opened by"}),(0,t.jsxs)("select",{className:eq,value:Z,onChange:e=>X(e.target.value),children:[(0,t.jsxs)("option",{value:P.buyer_user_id,children:["buyer ",P.buyer_user_id.slice(0,8),"…"]}),(0,t.jsxs)("option",{value:P.seller_user_id,children:["seller ",P.seller_user_id.slice(0,8),"…"]})]})]}),(0,t.jsxs)("label",{className:"grid gap-1",children:[(0,t.jsx)("span",{className:"text-[12px] font-semibold text-[var(--v2-muted)]",children:"Reason"}),(0,t.jsxs)("select",{className:eq,value:ee,onChange:e=>et(e.target.value),children:[(0,t.jsx)("option",{value:"non_payment",children:"non_payment"}),(0,t.jsx)("option",{value:"chargeback",children:"chargeback"}),(0,t.jsx)("option",{value:"phishing",children:"phishing"}),(0,t.jsx)("option",{value:"other",children:"other"})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(c.V2Button,{variant:"primary",disabled:es,onClick:()=>void eO(),children:es?"Opening…":"Open dispute"}),(0,t.jsx)(c.V2Button,{variant:"ghost",onClick:()=>void eP(),children:"Refresh"})]})]})})]}),(0,t.jsxs)(u.V2Card,{children:[(0,t.jsx)(u.V2CardHeader,{title:"Transitions"}),(0,t.jsx)(u.V2CardBody,{children:(0,t.jsx)("ul",{className:"divide-y divide-[var(--v2-border)] text-[13px]",children:E.map(e=>(0,t.jsxs)("li",{className:"py-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-[var(--v2-muted)]",children:e.created_at})," — ",e.from_status??"∅"," → ",e.to_status]}),(0,t.jsx)("div",{className:"text-[12px] text-[var(--v2-muted)] font-mono",children:e.reason_code??""})]},e.id))})})]})]})}e.s(["TradeDetailClient",()=>p],194971)}]);