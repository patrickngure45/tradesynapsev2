(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,261238,t=>{"use strict";class e extends Error{code;details;status;requestId;constructor(t,e){super(e?.requestId?`${t} (req ${e.requestId})`:t),this.name="ApiError",this.code=t,this.details=e?.details,this.status=e?.status,this.requestId=e?.requestId}}function s(t){return new Promise(e=>setTimeout(e,Math.max(0,Math.floor(t))))}async function r(t,r){let a=r?{...r,credentials:r.credentials??"same-origin"}:{credentials:"same-origin"},i=(a?.method??"GET").toUpperCase();if(("GET"===i||"HEAD"===i)&&function(t){try{let e=window.location.origin,s="string"==typeof t?new URL(t,e):t instanceof URL?t:t instanceof Request?new URL(t.url):null;if(!s||s.origin!==e)return!1;return s.pathname.startsWith("/api/")}catch{return!1}}(t)){let t=function(){try{return(new URL(window.location.href).searchParams.get("user_id")??"").trim()||null}catch{return null}}();if(t){let e=new Headers(a?.headers);e.has("x-impersonate-user-id")||e.set("x-impersonate-user-id",t),a.headers=e}}if(["POST","PUT","PATCH","DELETE"].includes(i)){let t=function(){if("u"<typeof document)return null;let t=document.cookie.match(/(?:^|;\s*)__csrf=([^;]+)/);return t?.[1]??null}();if(t){let e=new Headers(a?.headers);e.has("x-csrf-token")||e.set("x-csrf-token",t),a.headers=e}}let n=(a?.method??"GET").toUpperCase(),o="GET"===n||"HEAD"===n,u=2*!!o,c=null;for(let r=0;r<=u;r+=1)try{let i=await fetch(t,a),n=i.headers.get("x-request-id")??void 0;try{n&&window.sessionStorage.setItem("ts.last_request_id",n)}catch{}let c=await i.text().catch(()=>""),l=(i.headers.get("content-type")??"").includes("text/html")||function(t){let e=String(t??"").trimStart();return e.startsWith("<!DOCTYPE html")||e.startsWith("<html")||e.startsWith("<!doctype html")}(c),h=l?{_raw:"<html/>"}:function(t){try{return t?JSON.parse(t):null}catch{return{_raw:t}}}(c);if(!i.ok){if(o&&(502===i.status||503===i.status||504===i.status)&&r<u){await s(250*Math.pow(2,r));continue}if(h&&"object"==typeof h&&"error"in h){let t="string"==typeof h.error?h.error:`http_${i.status}`,s=void 0!==h.details?h.details:"string"==typeof h.message?h.message:l?{message:`Upstream error (HTTP ${i.status}). Please retry.`}:void 0;throw new e(t,{details:s,status:i.status,requestId:n})}if(h&&"object"==typeof h&&"message"in h){let t="string"==typeof h.message?h.message:h;throw new e(`http_${i.status}`,{details:t,status:i.status,requestId:n})}let t=l?{message:`Upstream error (HTTP ${i.status}). Please retry.`}:h;throw new e(`http_${i.status}`,{details:t,status:i.status,requestId:n})}return h}catch(t){if(c=t,o&&r<u){await s(250*Math.pow(2,r));continue}throw t}throw c}t.s(["ApiError",()=>e,"fetchJsonOrThrow",()=>r])}]);