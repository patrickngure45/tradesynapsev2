(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,261238,e=>{"use strict";class t extends Error{code;details;status;requestId;constructor(e,t){super(t?.requestId?`${e} (req ${t.requestId})`:e),this.name="ApiError",this.code=e,this.details=t?.details,this.status=t?.status,this.requestId=t?.requestId}}function r(e){return new Promise(t=>setTimeout(t,Math.max(0,Math.floor(e))))}async function s(e,s){let a=s?{...s,credentials:s.credentials??"same-origin"}:{credentials:"same-origin"},d=(a?.method??"GET").toUpperCase();if(("GET"===d||"HEAD"===d)&&function(e){try{let t=window.location.origin,r="string"==typeof e?new URL(e,t):e instanceof URL?e:e instanceof Request?new URL(e.url):null;if(!r||r.origin!==t)return!1;return r.pathname.startsWith("/api/")}catch{return!1}}(e)){let e=function(){try{return(new URL(window.location.href).searchParams.get("user_id")??"").trim()||null}catch{return null}}();if(e){let t=new Headers(a?.headers);t.has("x-impersonate-user-id")||t.set("x-impersonate-user-id",e),a.headers=t}}if(["POST","PUT","PATCH","DELETE"].includes(d)){let e=function(){if("u"<typeof document)return null;let e=document.cookie.match(/(?:^|;\s*)__csrf=([^;]+)/);return e?.[1]??null}();if(e){let t=new Headers(a?.headers);t.has("x-csrf-token")||t.set("x-csrf-token",e),a.headers=t}}let n=(a?.method??"GET").toUpperCase(),l="GET"===n||"HEAD"===n,i=2*!!l,o=null;for(let s=0;s<=i;s+=1)try{let d=await fetch(e,a),n=d.headers.get("x-request-id")??void 0;try{n&&window.sessionStorage.setItem("ts.last_request_id",n)}catch{}let o=await d.text().catch(()=>""),c=(d.headers.get("content-type")??"").includes("text/html")||function(e){let t=String(e??"").trimStart();return t.startsWith("<!DOCTYPE html")||t.startsWith("<html")||t.startsWith("<!doctype html")}(o),x=c?{_raw:"<html/>"}:function(e){try{return e?JSON.parse(e):null}catch{return{_raw:e}}}(o);if(!d.ok){if(l&&(502===d.status||503===d.status||504===d.status)&&s<i){await r(250*Math.pow(2,s));continue}if(x&&"object"==typeof x&&"error"in x){let e="string"==typeof x.error?x.error:`http_${d.status}`,r=void 0!==x.details?x.details:"string"==typeof x.message?x.message:c?{message:`Upstream error (HTTP ${d.status}). Please retry.`}:void 0;throw new t(e,{details:r,status:d.status,requestId:n})}if(x&&"object"==typeof x&&"message"in x){let e="string"==typeof x.message?x.message:x;throw new t(`http_${d.status}`,{details:e,status:d.status,requestId:n})}let e=c?{message:`Upstream error (HTTP ${d.status}). Please retry.`}:x;throw new t(`http_${d.status}`,{details:e,status:d.status,requestId:n})}return x}catch(e){if(o=e,l&&s<i){await r(250*Math.pow(2,s));continue}throw e}throw o}e.s(["ApiError",()=>t,"fetchJsonOrThrow",()=>s])},609983,e=>{"use strict";var t=e.i(843476),r=e.i(271645),s=e.i(261238);function a({text:e,variant:r}){return(0,t.jsxs)("span",{className:`inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[10px] font-extrabold uppercase tracking-[0.18em] ${"green"===r?"border-emerald-300 bg-emerald-50 text-emerald-900 dark:border-emerald-900/40 dark:bg-emerald-950/30 dark:text-emerald-200":"amber"===r?"border-amber-300 bg-amber-50 text-amber-900 dark:border-amber-900/40 dark:bg-amber-950/30 dark:text-amber-200":"red"===r?"border-rose-300 bg-rose-50 text-rose-900 dark:border-rose-900/40 dark:bg-rose-950/30 dark:text-rose-200":"border-[var(--border)] bg-[var(--bg)] text-[var(--muted)]"}`,children:[(0,t.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-current opacity-70"}),e]})}function d(){let[e,d]=(0,r.useState)(null),[n,l]=(0,r.useState)(null),[i,o]=(0,r.useState)(!0),c=(0,r.useCallback)(async()=>{o(!0),l(null);try{let e=await (0,s.fetchJsonOrThrow)("/api/status",{cache:"no-store"});d(e)}catch(e){d(null),l(e?.message?String(e.message):"status_failed")}finally{o(!1)}},[]);(0,r.useEffect)(()=>{c();let e=setInterval(c,3e4);return()=>clearInterval(e)},[c]);let x=(0,r.useMemo)(()=>{let r=e?.overall??"offline";return"online"===r?(0,t.jsx)(a,{text:"Online",variant:"green"}):"degraded"===r?(0,t.jsx)(a,{text:"Degraded",variant:"amber"}):(0,t.jsx)(a,{text:"Offline",variant:"red"})},[e?.overall]),m=(0,r.useMemo)(()=>(Array.isArray(e?.heartbeats)?e.heartbeats:[]).slice().sort((e,t)=>String(e.service).localeCompare(String(t.service))).slice(0,20),[e]);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"relative overflow-hidden rounded-2xl border border-[var(--border)] bg-[var(--card)] p-6",children:[(0,t.jsx)("div",{className:"pointer-events-none absolute inset-0 opacity-60",style:{background:"radial-gradient(700px 260px at 20% 0%, color-mix(in oklab, var(--accent) 18%, transparent) 0%, transparent 60%), radial-gradient(440px 220px at 90% 10%, color-mix(in oklab, var(--accent-2) 12%, transparent) 0%, transparent 55%)"}}),(0,t.jsxs)("div",{className:"relative flex flex-wrap items-start justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"h-2.5 w-2.5 rounded-full bg-[var(--accent)]"}),(0,t.jsx)("h1",{className:"text-xl font-extrabold tracking-tight",children:"Status"})]}),(0,t.jsx)("p",{className:"mt-1 text-xs text-[var(--muted)]",children:"Live system snapshot (DB, outbox, and background jobs)."})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[x,(0,t.jsx)("button",{type:"button",className:"rounded-lg border border-[var(--border)] bg-[var(--bg)] px-3 py-2 text-[11px] font-semibold text-[var(--muted)] hover:text-[var(--foreground)] hover:bg-[var(--card-2)]",onClick:c,disabled:i,children:"refresh"})]})]}),n?(0,t.jsx)("div",{className:"relative mt-3 text-[11px] text-[var(--down)]",children:n}):null,i&&!e?(0,t.jsx)("div",{className:"relative mt-3 text-[11px] text-[var(--muted)]",children:"Checking…"}):null,e?(0,t.jsxs)("div",{className:"relative mt-4 grid grid-cols-1 gap-3 md:grid-cols-3 lg:grid-cols-6",children:[(0,t.jsxs)("div",{className:"rounded-xl border border-[var(--border)] bg-[var(--bg)] p-3",children:[(0,t.jsx)("div",{className:"text-[10px] font-extrabold uppercase tracking-[0.22em] text-[var(--muted)]",children:"Database"}),(0,t.jsxs)("div",{className:"mt-2 text-sm font-semibold text-[var(--foreground)]",children:[e.db?.ok?"ok":"down","number"==typeof e.db?.latency_ms?(0,t.jsxs)("span",{className:"ml-2 text-[11px] text-[var(--muted)]",children:[e.db.latency_ms,"ms"]}):null]})]}),(0,t.jsxs)("div",{className:"rounded-xl border border-[var(--border)] bg-[var(--bg)] p-3",children:[(0,t.jsx)("div",{className:"text-[10px] font-extrabold uppercase tracking-[0.22em] text-[var(--muted)]",children:"Outbox"}),(0,t.jsxs)("div",{className:"mt-2 text-[11px] text-[var(--muted)]",children:["open ",(0,t.jsx)("span",{className:"text-[var(--foreground)] font-semibold",children:e.outbox?.open??0})," · ","dead ",(0,t.jsx)("span",{className:"text-[var(--foreground)] font-semibold",children:e.outbox?.dead??0})," · ","errors ",(0,t.jsx)("span",{className:"text-[var(--foreground)] font-semibold",children:e.outbox?.with_errors??0})]})]}),(0,t.jsxs)("div",{className:"rounded-xl border border-[var(--border)] bg-[var(--bg)] p-3",children:[(0,t.jsx)("div",{className:"text-[10px] font-extrabold uppercase tracking-[0.22em] text-[var(--muted)]",children:"Email Outbox"}),(0,t.jsxs)("div",{className:"mt-2 text-[11px] text-[var(--muted)]",children:["pending ",(0,t.jsx)("span",{className:"text-[var(--foreground)] font-semibold",children:e.email_outbox?.pending??0})," · ","failed ",(0,t.jsx)("span",{className:"text-[var(--foreground)] font-semibold",children:e.email_outbox?.failed??0}),e.email_outbox?.oldest_age_min!=null?(0,t.jsxs)("div",{className:"mt-1 text-[10px]",children:["oldest pending: ",(0,t.jsxs)("span",{className:"text-[var(--foreground)] font-semibold",children:[e.email_outbox.oldest_age_min,"m"]})]}):null]})]}),(0,t.jsxs)("div",{className:"rounded-xl border border-[var(--border)] bg-[var(--bg)] p-3",children:[(0,t.jsx)("div",{className:"text-[10px] font-extrabold uppercase tracking-[0.22em] text-[var(--muted)]",children:"Expected Jobs"}),(0,t.jsx)("div",{className:"mt-2 text-[11px] text-[var(--muted)]",children:Array.isArray(e.expected_services)&&e.expected_services.length>0?(0,t.jsxs)(t.Fragment,{children:[e.expected_services.length," configured",(0,t.jsxs)("div",{className:"mt-1 text-[10px]",children:["stale: ",Array.isArray(e.stale_expected_services)&&e.stale_expected_services.length?(0,t.jsx)("span",{className:"text-[var(--down)]",children:e.stale_expected_services.join(", ")}):(0,t.jsx)("span",{className:"text-[var(--muted)]",children:"none"})]})]}):(0,t.jsx)("span",{className:"text-[var(--muted)]",children:"none configured"})})]}),(0,t.jsxs)("div",{className:"rounded-xl border border-[var(--border)] bg-[var(--bg)] p-3",children:[(0,t.jsx)("div",{className:"text-[10px] font-extrabold uppercase tracking-[0.22em] text-[var(--muted)]",children:"Ops Alerts"}),(0,t.jsx)("div",{className:"mt-2 text-[11px] text-[var(--muted)]",children:e.ops_alerts?.degraded_last_sent_at?(0,t.jsxs)(t.Fragment,{children:["last sent",(0,t.jsx)("div",{className:"mt-1 text-[10px] text-[var(--foreground)] font-semibold",children:new Date(String(e.ops_alerts.degraded_last_sent_at)).toLocaleString()})]}):(0,t.jsx)("span",{className:"text-[var(--muted)]",children:"none yet"})})]}),(0,t.jsxs)("div",{className:"rounded-xl border border-[var(--border)] bg-[var(--bg)] p-3",children:[(0,t.jsx)("div",{className:"text-[10px] font-extrabold uppercase tracking-[0.22em] text-[var(--muted)]",children:"Latency"}),(0,t.jsxs)("div",{className:"mt-2 text-[11px] text-[var(--muted)]",children:["took ",(0,t.jsxs)("span",{className:"text-[var(--foreground)] font-semibold",children:[Math.max(0,Number(e.took_ms??0)),"ms"]})]})]})]}):null]}),(0,t.jsxs)("div",{className:"rounded-2xl border border-[var(--border)] bg-[var(--card)] overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 px-4 py-3",children:[(0,t.jsx)("div",{className:"text-sm font-semibold text-[var(--foreground)]",children:"Heartbeats"}),(0,t.jsx)("div",{className:"text-[11px] text-[var(--muted)]",children:m.length})]}),(0,t.jsx)("div",{className:"border-t border-[var(--border)]",children:0===m.length?(0,t.jsx)("div",{className:"px-4 py-4 text-xs text-[var(--muted)]",children:"No heartbeats recorded yet."}):(0,t.jsx)("table",{className:"w-full text-[11px]",children:(0,t.jsx)("tbody",{children:m.map(e=>{let r=String(e.service),s=String(e.status??"ok"),d=e.last_seen_at?new Date(String(e.last_seen_at)).toLocaleString():"—";return(0,t.jsxs)("tr",{className:"border-b border-[var(--border)] last:border-b-0",children:[(0,t.jsx)("td",{className:"px-4 py-2 font-semibold text-[var(--foreground)]",children:r}),(0,t.jsx)("td",{className:"px-4 py-2 text-right",children:(0,t.jsx)(a,{text:s,variant:"ok"===s?"green":"degraded"===s?"amber":"red"})}),(0,t.jsx)("td",{className:"px-4 py-2 text-right text-[10px] text-[var(--muted)]",children:d})]},r)})})})})]}),(0,t.jsx)("div",{className:"text-[11px] text-[var(--muted)]",children:"Tip: for operational monitoring, set expectations via env (e.g. `EXPECT_OUTBOX_WORKER=1`)."})]})}e.s(["StatusClient",()=>d])}]);