(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,184724,e=>{"use strict";var t=e.i(843476);function r(e){let t=e?.variant??"secondary",r=e?.size??"md";return["inline-flex select-none items-center justify-center gap-2 whitespace-nowrap rounded-xl transition focus:outline-none focus:ring-2 focus:ring-[var(--v2-ring)] disabled:pointer-events-none disabled:opacity-55","lg"===r?"h-12 px-5 text-[15px]":"sm"===r?"h-9 px-3 text-[13px]":"h-11 px-4 text-[14px]","primary"===t?"bg-[var(--v2-accent)] text-white font-semibold shadow-[var(--v2-shadow-sm)] hover:brightness-105":"danger"===t?"bg-[var(--down)] text-white font-semibold shadow-[var(--v2-shadow-sm)] hover:brightness-105":"ghost"===t?"bg-transparent text-[var(--v2-text)] font-semibold hover:bg-[var(--v2-surface-2)]":"border border-[var(--v2-border)] bg-[var(--v2-surface)] text-[var(--v2-text)] font-semibold shadow-[var(--v2-shadow-sm)] hover:bg-[var(--v2-surface-2)]",e?.fullWidth?"w-full":"",e?.className??""].filter(Boolean).join(" ")}let s=e.i(271645).forwardRef(function({variant:e,size:s,fullWidth:a,className:i,type:n,...l},d){return(0,t.jsx)("button",{ref:d,type:n??"button",className:r({variant:e,size:s,fullWidth:a,className:i}),...l})});e.s(["V2Button",0,s,"v2ButtonClassName",()=>r])},283538,e=>{"use strict";var t=e.i(843476);function r({children:e,className:r=""}){return(0,t.jsx)("section",{className:"rounded-[var(--v2-radius-lg)] border border-[var(--v2-border)] bg-[var(--v2-surface)] shadow-[var(--v2-shadow-sm)] "+r,children:e})}function s({title:e,subtitle:r,right:s}){return(0,t.jsxs)("header",{className:"flex items-start justify-between gap-3 px-4 pt-4",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"text-[15px] font-semibold text-[var(--v2-text)]",children:e}),r?(0,t.jsx)("div",{className:"mt-0.5 text-[13px] text-[var(--v2-muted)]",children:r}):null]}),s?(0,t.jsx)("div",{className:"shrink-0",children:s}):null]})}function a({children:e}){return(0,t.jsx)("div",{className:"px-4 pb-4 pt-3",children:e})}e.s(["V2Card",()=>r,"V2CardBody",()=>a,"V2CardHeader",()=>s])},59298,e=>{"use strict";var t=e.i(843476);function r({className:e=""}){return(0,t.jsx)("div",{className:"animate-pulse rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface-2)] "+e,"aria-hidden":"true"})}e.s(["V2Skeleton",()=>r])},882277,e=>{"use strict";var t=e.i(843476);function r({tabs:e,activeId:r,onChange:s}){return(0,t.jsx)("div",{className:"grid gap-1 rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] p-1 shadow-[var(--v2-shadow-sm)]",style:{gridTemplateColumns:`repeat(${Math.max(1,e.length)}, minmax(0, 1fr))`},role:"tablist",children:e.map(e=>{let a=e.id===r;return(0,t.jsx)("button",{type:"button",role:"tab","aria-selected":a,className:"h-10 rounded-xl text-[13px] font-semibold transition "+(a?"bg-[var(--v2-surface-2)] text-[var(--v2-text)]":"text-[var(--v2-muted)] hover:bg-[var(--v2-surface-2)]/70"),onClick:()=>s(e.id),children:e.label},e.id)})})}e.s(["V2Tabs",()=>r])},769072,e=>{"use strict";var t=e.i(843476),r=e.i(271645),s=e.i(184724),a=e.i(283538),i=e.i(59298),n=e.i(882277);function l(e){let t=Number(String(e??""));if(!Number.isFinite(t))return"—";if(0===t)return"0";let r=Math.abs(t);return t.toLocaleString(void 0,{maximumFractionDigits:r>=1e3?2:r>=1?4:r>=.01?6:8})}function d(e){if(!e)return"";try{return new Date(e).toLocaleString()}catch{return String(e)}}function o(){let[e,o]=(0,r.useState)("open"),[c,v]=(0,r.useState)(!0),[x,u]=(0,r.useState)(null),[m,h]=(0,r.useState)([]),[p,f]=(0,r.useState)([]),[b,g]=(0,r.useState)(null),j=(0,r.useRef)(null),y=(0,r.useRef)(0),N=(0,r.useRef)(!1),w=(0,r.useRef)(0),S=(0,r.useRef)(null),C=(0,r.useMemo)(()=>[{id:"open",label:"Open"},{id:"history",label:"History"},{id:"fills",label:"Fills"}],[]),V=async()=>{let e=++w.current;S.current?.abort();let t=new AbortController;S.current=t,N.current||v(!0),u(null);try{let[r,s]=await Promise.all([fetch("/api/exchange/orders",{cache:"no-store",credentials:"include",signal:t.signal}),fetch("/api/exchange/orders/history?status=all&limit=200",{cache:"no-store",credentials:"include",signal:t.signal})]),a=await r.json().catch(()=>null),i=await s.json().catch(()=>null);if(!r.ok)throw Error("string"==typeof a?.error?a.error:`http_${r.status}`);if(!s.ok)throw Error("string"==typeof i?.error?i.error:`http_${s.status}`);if(e!==w.current)return;h(Array.isArray(a?.orders)?a.orders:[]),f(Array.isArray(i?.orders)?i.orders:[])}catch(t){if(t instanceof DOMException&&"AbortError"===t.name||e!==w.current)return;N.current||u(t instanceof Error?t.message:String(t))}finally{e===w.current&&(v(!1),N.current=!0)}};(0,r.useEffect)(()=>{V();let e=window.setInterval(()=>{"visible"===document.visibilityState&&V()},12e3),t=()=>{"visible"===document.visibilityState&&V()};return document.addEventListener("visibilitychange",t),()=>{window.clearInterval(e),document.removeEventListener("visibilitychange",t)}},[]),(0,r.useEffect)(()=>{let e=()=>{try{j.current?.close()}catch{}j.current=null},t=()=>{let e=Date.now();e-y.current<800||(y.current=e,"visible"===document.visibilityState&&V())},r=()=>{if(!("visible"!==document.visibilityState||"u"<typeof EventSource)&&!j.current)try{let e=new EventSource("/api/notifications/stream",{withCredentials:!0});e.addEventListener("notification",e=>{try{var r;let s,a=JSON.parse(String(e.data??"{}"));r=String(a?.type??""),s=String(r||""),("order_placed"===s||"order_filled"===s||"order_partially_filled"===s||"order_canceled"===s||"order_rejected"===s)&&t()}catch{}}),e.addEventListener("ready",()=>t()),e.onerror=()=>{},j.current=e}catch{e()}},s=()=>{"visible"===document.visibilityState?r():e()};return document.addEventListener("visibilitychange",s),r(),()=>{document.removeEventListener("visibilitychange",s),e()}},[]);let _=(0,r.useMemo)(()=>{let e=[];for(let t of p)for(let r of Array.isArray(t.fills)?t.fills:[])e.push({order:t,fill:r});return e.sort((e,t)=>{let r=e.fill?.created_at?Date.parse(String(e.fill.created_at)):0;return(t.fill?.created_at?Date.parse(String(t.fill.created_at)):0)-r}),e.slice(0,200)},[p]),E=async e=>{if(e&&!b){g(e),u(null),h(t=>t.filter(t=>t.id!==e));try{let t=await fetch(`/api/exchange/orders/${encodeURIComponent(e)}/cancel`,{method:"POST",credentials:"include"}),r=await t.json().catch(()=>null);if(!t.ok)throw h(m),Error("string"==typeof r?.error?r.error:`http_${t.status}`);V()}catch(e){u(e instanceof Error?e.message:String(e))}finally{g(null)}}},k=(e,r)=>{let a="buy"===e.side?"text-[var(--up)]":"text-[var(--down)]",i=String(e.status??"").toLowerCase();return(0,t.jsxs)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)("div",{className:"text-[15px] font-semibold text-[var(--v2-text)]",children:String(e.market_symbol??"—")}),(0,t.jsx)("span",{className:`text-[12px] font-semibold ${a}`,children:e.side.toUpperCase()}),(0,t.jsx)("span",{className:"rounded-full border border-[var(--v2-border)] bg-[var(--v2-surface-2)] px-2 py-0.5 text-[11px] font-semibold text-[var(--v2-muted)]",children:e.type.toUpperCase()}),(0,t.jsx)("span",{className:"rounded-full border border-[var(--v2-border)] bg-[var(--v2-surface-2)] px-2 py-0.5 text-[11px] font-semibold text-[var(--v2-muted)]",children:i.replaceAll("_"," ")})]}),(0,t.jsx)("div",{className:"mt-1 text-[12px] text-[var(--v2-muted)]",children:d(e.created_at)})]}),r?(0,t.jsx)(s.V2Button,{variant:"ghost",size:"sm",disabled:b===e.id,onClick:()=>void E(e.id),className:"border border-[var(--v2-border)]",children:b===e.id?"Canceling…":"Cancel"}):null]}),(0,t.jsxs)("div",{className:"mt-3 grid grid-cols-3 gap-2 text-[12px]",children:[(0,t.jsxs)("div",{className:"rounded-xl bg-[var(--v2-surface-2)] px-2 py-2",children:[(0,t.jsx)("div",{className:"text-[11px] font-semibold text-[var(--v2-muted)]",children:"Price"}),(0,t.jsx)("div",{className:"mt-0.5 font-mono text-[12px] text-[var(--v2-text)]",children:"market"===e.type?"MKT":l(e.price)})]}),(0,t.jsxs)("div",{className:"rounded-xl bg-[var(--v2-surface-2)] px-2 py-2",children:[(0,t.jsx)("div",{className:"text-[11px] font-semibold text-[var(--v2-muted)]",children:"Qty"}),(0,t.jsx)("div",{className:"mt-0.5 font-mono text-[12px] text-[var(--v2-text)]",children:l(e.quantity)})]}),(0,t.jsxs)("div",{className:"rounded-xl bg-[var(--v2-surface-2)] px-2 py-2",children:[(0,t.jsx)("div",{className:"text-[11px] font-semibold text-[var(--v2-muted)]",children:"Remaining"}),(0,t.jsx)("div",{className:"mt-0.5 font-mono text-[12px] text-[var(--v2-text)]",children:l(e.remaining_quantity)})]})]})]},e.id)};return(0,t.jsxs)("main",{className:"space-y-4",children:[(0,t.jsxs)("header",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"text-[11px] font-bold uppercase tracking-widest text-[var(--v2-muted)]",children:"Orders"}),(0,t.jsx)("h1",{className:"text-2xl font-extrabold tracking-tight",children:"Your activity"}),(0,t.jsx)("p",{className:"text-sm text-[var(--v2-muted)]",children:"Open orders, history, and fills — built for mobile."})]}),(0,t.jsx)(n.V2Tabs,{tabs:C,activeId:e,onChange:e=>o(e)}),x?(0,t.jsxs)(a.V2Card,{children:[(0,t.jsx)(a.V2CardHeader,{title:"Orders unavailable",subtitle:"Sign in and try again."}),(0,t.jsxs)(a.V2CardBody,{children:[(0,t.jsx)("div",{className:"text-sm text-[var(--v2-muted)]",children:String(x)}),(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsx)(s.V2Button,{variant:"primary",fullWidth:!0,onClick:()=>void V(),children:"Retry"})})]})]}):c?(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(i.V2Skeleton,{className:"h-20"}),(0,t.jsx)(i.V2Skeleton,{className:"h-20"}),(0,t.jsx)(i.V2Skeleton,{className:"h-20"})]}):"open"===e?0===m.length?(0,t.jsxs)(a.V2Card,{children:[(0,t.jsx)(a.V2CardHeader,{title:"No open orders",subtitle:"Your active orders will appear here."}),(0,t.jsx)(a.V2CardBody,{children:(0,t.jsx)("div",{className:"text-sm text-[var(--v2-muted)]",children:"Place an order from Trade to get started."})})]}):(0,t.jsx)("div",{className:"grid gap-2",children:m.map(e=>k(e,!0))}):"history"===e?0===p.length?(0,t.jsxs)(a.V2Card,{children:[(0,t.jsx)(a.V2CardHeader,{title:"No history",subtitle:"Your completed orders will show here."}),(0,t.jsx)(a.V2CardBody,{children:(0,t.jsx)("div",{className:"text-sm text-[var(--v2-muted)]",children:"Once you trade, you’ll see filled/canceled orders."})})]}):(0,t.jsx)("div",{className:"grid gap-2",children:p.slice(0,80).map(e=>k(e,!1))}):0===_.length?(0,t.jsxs)(a.V2Card,{children:[(0,t.jsx)(a.V2CardHeader,{title:"No fills",subtitle:"Trades (fills) will show here."}),(0,t.jsx)(a.V2CardBody,{children:(0,t.jsx)("div",{className:"text-sm text-[var(--v2-muted)]",children:"When an order matches, fills appear with price/qty."})})]}):(0,t.jsx)("div",{className:"grid gap-2",children:_.slice(0,120).map(({order:e,fill:r})=>{let s="buy"===e.side?"text-[var(--up)]":"text-[var(--down)]";return(0,t.jsxs)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-[15px] font-semibold text-[var(--v2-text)]",children:String(e.market_symbol??"—")}),(0,t.jsx)("div",{className:`mt-0.5 text-[12px] font-semibold ${s}`,children:e.side.toUpperCase()})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("div",{className:"font-mono text-[13px] font-semibold text-[var(--v2-text)]",children:l(r.price)}),(0,t.jsx)("div",{className:"font-mono text-[12px] text-[var(--v2-muted)]",children:l(r.quantity)})]})]}),(0,t.jsx)("div",{className:"mt-2 text-[12px] text-[var(--v2-muted)]",children:d(r.created_at)})]},String(r.id))})})]})}e.s(["OrdersClient",()=>o])}]);