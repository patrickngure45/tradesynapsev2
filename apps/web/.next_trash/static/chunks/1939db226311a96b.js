(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,796830,e=>{"use strict";var t=e.i(843476);let r=e.i(271645).forwardRef(function({className:e="",type:r="text",...a},s){return(0,t.jsx)("input",{ref:s,type:r,className:"h-11 w-full rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 text-[14px] text-[var(--v2-text)] shadow-[var(--v2-shadow-sm)] outline-none placeholder:text-[color-mix(in_srgb,var(--v2-muted)_70%,transparent)] focus:ring-2 focus:ring-[var(--v2-ring)] "+e,...a})});e.s(["V2Input",0,r])},184724,e=>{"use strict";var t=e.i(843476);function r(e){let t=e?.variant??"secondary",r=e?.size??"md";return["inline-flex select-none items-center justify-center gap-2 whitespace-nowrap rounded-xl transition focus:outline-none focus:ring-2 focus:ring-[var(--v2-ring)] disabled:pointer-events-none disabled:opacity-55","lg"===r?"h-12 px-5 text-[15px]":"sm"===r?"h-9 px-3 text-[13px]":"h-11 px-4 text-[14px]","primary"===t?"bg-[var(--v2-accent)] text-white font-semibold shadow-[var(--v2-shadow-sm)] hover:brightness-105":"danger"===t?"bg-[var(--down)] text-white font-semibold shadow-[var(--v2-shadow-sm)] hover:brightness-105":"ghost"===t?"bg-transparent text-[var(--v2-text)] font-semibold hover:bg-[var(--v2-surface-2)]":"border border-[var(--v2-border)] bg-[var(--v2-surface)] text-[var(--v2-text)] font-semibold shadow-[var(--v2-shadow-sm)] hover:bg-[var(--v2-surface-2)]",e?.fullWidth?"w-full":"",e?.className??""].filter(Boolean).join(" ")}let a=e.i(271645).forwardRef(function({variant:e,size:a,fullWidth:s,className:i,type:n,...l},d){return(0,t.jsx)("button",{ref:d,type:n??"button",className:r({variant:e,size:a,fullWidth:s,className:i}),...l})});e.s(["V2Button",0,a,"v2ButtonClassName",()=>r])},283538,e=>{"use strict";var t=e.i(843476);function r({children:e,className:r=""}){return(0,t.jsx)("section",{className:"rounded-[var(--v2-radius-lg)] border border-[var(--v2-border)] bg-[var(--v2-surface)] shadow-[var(--v2-shadow-sm)] "+r,children:e})}function a({title:e,subtitle:r,right:a}){return(0,t.jsxs)("header",{className:"flex items-start justify-between gap-3 px-4 pt-4",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"text-[15px] font-semibold text-[var(--v2-text)]",children:e}),r?(0,t.jsx)("div",{className:"mt-0.5 text-[13px] text-[var(--v2-muted)]",children:r}):null]}),a?(0,t.jsx)("div",{className:"shrink-0",children:a}):null]})}function s({children:e}){return(0,t.jsx)("div",{className:"px-4 pb-4 pt-3",children:e})}e.s(["V2Card",()=>r,"V2CardBody",()=>s,"V2CardHeader",()=>a])},59298,e=>{"use strict";var t=e.i(843476);function r({className:e=""}){return(0,t.jsx)("div",{className:"animate-pulse rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface-2)] "+e,"aria-hidden":"true"})}e.s(["V2Skeleton",()=>r])},882277,e=>{"use strict";var t=e.i(843476);function r({tabs:e,activeId:r,onChange:a}){return(0,t.jsx)("div",{className:"grid gap-1 rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] p-1 shadow-[var(--v2-shadow-sm)]",style:{gridTemplateColumns:`repeat(${Math.max(1,e.length)}, minmax(0, 1fr))`},role:"tablist",children:e.map(e=>{let s=e.id===r;return(0,t.jsx)("button",{type:"button",role:"tab","aria-selected":s,className:"h-10 rounded-xl text-[13px] font-semibold transition "+(s?"bg-[var(--v2-surface-2)] text-[var(--v2-text)]":"text-[var(--v2-muted)] hover:bg-[var(--v2-surface-2)]/70"),onClick:()=>a(e.id),children:e.label},e.id)})})}e.s(["V2Tabs",()=>r])},355506,e=>{"use strict";var t=e.i(843476),r=e.i(271645);function a({open:e,title:a,onClose:s,children:i}){return((0,r.useEffect)(()=>{if(!e)return;let t=e=>{"Escape"===e.key&&s()};document.addEventListener("keydown",t);let r=document.documentElement.style.overflow;return document.documentElement.style.overflow="hidden",()=>{document.removeEventListener("keydown",t),document.documentElement.style.overflow=r}},[e,s]),e)?(0,t.jsxs)("div",{className:"fixed inset-0 z-[100]",children:[(0,t.jsx)("button",{type:"button",className:"absolute inset-0 bg-black/40","aria-label":"Close",onClick:s}),(0,t.jsxs)("div",{className:"absolute inset-x-0 bottom-0 mx-auto w-full max-w-xl rounded-t-[28px] border border-[var(--v2-border)] bg-[var(--v2-surface)] shadow-[var(--v2-shadow-md)]",style:{paddingBottom:"env(safe-area-inset-bottom)"},role:"dialog","aria-modal":"true",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 px-4 pb-2 pt-3",children:[(0,t.jsx)("div",{className:"min-w-0",children:a?(0,t.jsx)("div",{className:"truncate text-[15px] font-semibold text-[var(--v2-text)]",children:a}):null}),(0,t.jsx)("button",{type:"button",onClick:s,className:"h-9 rounded-xl px-3 text-[13px] font-semibold text-[var(--v2-muted)] hover:bg-[var(--v2-surface-2)]",children:"Close"})]}),(0,t.jsx)("div",{className:"max-h-[70dvh] overflow-auto px-4 pb-4 pt-2",children:i})]})]}):null}e.s(["V2Sheet",()=>a])},237434,e=>{"use strict";var t=e.i(843476),r=e.i(522016),a=e.i(271645),s=e.i(618566),i=e.i(184724),n=e.i(283538),l=e.i(796830),d=e.i(355506),o=e.i(59298),c=e.i(882277);function u(e){let t="number"==typeof e?e:Number(String(e));return Number.isFinite(t)?t:null}function m(e,t){let r=u(e);if(null==r)return"—";try{return new Intl.NumberFormat(void 0,{style:"currency",currency:t,currencyDisplay:"code",maximumFractionDigits:2}).format(r)}catch{return`${r.toLocaleString()} ${t}`}}function v(e){let t=u(e);if(null==t)return"—";if(0===t)return"0";let r=Math.abs(t);return t.toLocaleString(void 0,{maximumFractionDigits:r>=1e3?2:r>=1?4:r>=.01?6:8})}function x(){let e=(0,s.useRouter)(),[x,h]=(0,a.useState)("BUY"),f="USDT",[p,b]=(0,a.useState)(""),[g,j]=(0,a.useState)([]),[y,N]=(0,a.useState)(!0),[w,S]=(0,a.useState)(null),_=(0,a.useRef)(!1),C=(0,a.useRef)("BUY"),k=(0,a.useRef)(""),V=(0,a.useRef)(0),E=(0,a.useRef)(null),U=async()=>{let e=++V.current;E.current?.abort();let t=new AbortController;E.current=t,S(null),_.current||N(!0);try{let r=new URLSearchParams({side:C.current,asset:f,fiat:"USD"}),a=u(k.current);null!=a&&a>0&&r.set("amount",String(a));let s=await fetch(`/api/p2p/ads?${r.toString()}`,{cache:"no-store",signal:t.signal}),i=await s.json().catch(()=>null);if(!s.ok){let e="string"==typeof i?.error?i.error:`http_${s.status}`;throw Error(e)}if(e!==V.current)return;j(Array.isArray(i?.ads)?i.ads:[]),_.current=!0}catch(t){if(t instanceof DOMException&&"AbortError"===t.name||e!==V.current)return;_.current||S(t instanceof Error?t.message:String(t))}finally{e===V.current&&N(!1)}};(0,a.useEffect)(()=>{C.current=x},[x]),(0,a.useEffect)(()=>{k.current=p},[p]),(0,a.useEffect)(()=>{U();let e=null,t=()=>{e&&(window.clearTimeout(e),e=null)},r=()=>{t(),e=window.setTimeout(()=>{e=null,"visible"===document.visibilityState&&U(),r()},35e3)},a=()=>{"visible"===document.visibilityState?(U(),r()):t()};return document.addEventListener("visibilitychange",a),r(),()=>{document.removeEventListener("visibilitychange",a),t(),E.current?.abort()}},[]),(0,a.useEffect)(()=>{U()},[x]),(0,a.useEffect)(()=>{let e=window.setTimeout(()=>{"visible"===document.visibilityState&&U()},250);return()=>window.clearTimeout(e)},[p]);let T=(0,a.useMemo)(()=>[{id:"BUY",label:"Buy"},{id:"SELL",label:"Sell"}],[]),[B,D]=(0,a.useState)(!1),[P,R]=(0,a.useState)(null),[L,A]=(0,a.useState)(""),[M,$]=(0,a.useState)(null),[O,I]=(0,a.useState)(!1),[F,W]=(0,a.useState)([]),[z,H]=(0,a.useState)(!1),[Y,q]=(0,a.useState)(null),K="SELL"===x,J=async()=>{if(!z)try{let e=await fetch("/api/p2p/payment-methods",{cache:"no-store",credentials:"include"}),t=await e.json().catch(()=>null);if(e.ok){let e=Array.isArray(t?.methods)?t.methods:[];W(e)}}finally{H(!0)}};(0,a.useEffect)(()=>{!B||K&&J()},[B,K]);let G=async()=>{var t;if(!P||O)return;let r=u(P.min_limit)??0,a=u(P.max_limit)??0,s=u(L);if(null==s||s<=0)return void $("Enter an amount.");let i=a>0?(t=r||0,Number.isFinite(s)?Math.min(a,Math.max(t,s)):t):s;if(r>0&&i<r)return void $(`Minimum is ${v(String(r))} USD.`);if(a>0&&i>a)return void $(`Maximum is ${v(String(a))} USD.`);if(K&&!Y)return void $("Select a payout method (required to sell).");I(!0),$(null);try{let t=await fetch("/api/p2p/orders",{method:"POST",headers:{"content-type":"application/json"},credentials:"include",body:JSON.stringify({ad_id:P.id,amount_fiat:i,...K?{payment_method_id:Y}:{}})}),r=await t.json().catch(()=>null);if(!t.ok){let e="string"==typeof r?.error?r.error:`http_${t.status}`;throw Error(e)}let a="string"==typeof r?.order_id?r.order_id:null;if(!a)throw Error("order_create_failed");D(!1),e.push(`/v2/p2p/orders/${encodeURIComponent(a)}`)}catch(e){$(e instanceof Error?e.message:String(e))}finally{I(!1)}};return(0,t.jsxs)("main",{className:"space-y-4",children:[(0,t.jsxs)("header",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-[11px] font-bold uppercase tracking-widest text-[var(--v2-muted)]",children:"P2P"}),(0,t.jsxs)("h1",{className:"text-2xl font-extrabold tracking-tight",children:["Buy / sell ",f]})]}),(0,t.jsx)(r.default,{href:"/v2/p2p/orders",className:"rounded-xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-2 text-[12px] font-semibold text-[var(--v2-text)]",children:"My orders"})]}),(0,t.jsx)("p",{className:"text-sm text-[var(--v2-muted)]",children:"Escrow-backed trades. Choose an ad and place an order."})]}),(0,t.jsx)(c.V2Tabs,{tabs:T,activeId:x,onChange:e=>h(e)}),(0,t.jsx)(l.V2Input,{value:p,onChange:e=>b(e.target.value),placeholder:"Optional amount (USD)",inputMode:"decimal"}),w&&0===g.length?(0,t.jsxs)(n.V2Card,{children:[(0,t.jsx)(n.V2CardHeader,{title:"Marketplace unavailable",subtitle:"Try again in a moment."}),(0,t.jsxs)(n.V2CardBody,{children:[(0,t.jsx)("div",{className:"text-sm text-[var(--v2-muted)]",children:String(w)}),(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsx)(i.V2Button,{variant:"primary",fullWidth:!0,onClick:()=>void U(),children:"Retry"})})]})]}):y&&0===g.length?(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(o.V2Skeleton,{className:"h-20"}),(0,t.jsx)(o.V2Skeleton,{className:"h-20"}),(0,t.jsx)(o.V2Skeleton,{className:"h-20"})]}):0===g.length?(0,t.jsxs)(n.V2Card,{children:[(0,t.jsx)(n.V2CardHeader,{title:"No ads available",subtitle:"Try switching side or changing the amount."}),(0,t.jsx)(n.V2CardBody,{children:(0,t.jsx)("div",{className:"text-sm text-[var(--v2-muted)]",children:"We couldn’t find matching ads right now."})})]}):(0,t.jsx)("section",{className:"grid gap-2",children:g.map(e=>{let r=String(e.display_name||e.email||"Trader"),a=m(e.fixed_price,"USD"),s=m(e.min_limit,"USD"),n=m(e.max_limit,"USD"),l=`${v(e.remaining_amount)} ${f}`,d=Array.isArray(e.payment_methods)?e.payment_methods:[];return(0,t.jsx)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3 shadow-[var(--v2-shadow-sm)]"+(e.highlighted_until?" ring-1 ring-[color-mix(in_srgb,var(--v2-accent)_35%,transparent)]":""),children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)("div",{className:"truncate text-[15px] font-semibold text-[var(--v2-text)]",children:r}),e.is_verified_agent?(0,t.jsx)("span",{className:"rounded-full border border-[var(--v2-border)] bg-[var(--v2-surface-2)] px-2 py-0.5 text-[11px] font-semibold text-[var(--v2-muted)]",children:"Verified"}):null]}),(0,t.jsxs)("div",{className:"mt-1 text-[12px] text-[var(--v2-muted)]",children:["Limit ",s," – ",n," · Remaining ",l]}),d.length?(0,t.jsx)("div",{className:"mt-2 flex flex-wrap gap-1",children:d.slice(0,4).map(e=>(0,t.jsx)("span",{className:"rounded-full border border-[var(--v2-border)] bg-[var(--v2-surface-2)] px-2 py-0.5 text-[11px] font-semibold text-[var(--v2-muted)]",children:String(e)},e))}):null]}),(0,t.jsxs)("div",{className:"shrink-0 text-right",children:[(0,t.jsx)("div",{className:"text-[13px] font-semibold text-[var(--v2-muted)]",children:"Price"}),(0,t.jsx)("div",{className:"mt-0.5 font-mono text-[14px] font-semibold text-[var(--v2-text)]",children:a}),(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)(i.V2Button,{variant:"primary",size:"sm",onClick:()=>{R(e),$(null),A(""),q(null),D(!0)},children:"Take"})})]})]})},e.id)})}),(0,t.jsx)(d.V2Sheet,{open:B,onClose:()=>D(!1),title:"Take ad",children:P?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3",children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-muted)]",children:"Price"}),(0,t.jsx)("div",{className:"mt-1 font-mono text-[16px] font-semibold text-[var(--v2-text)]",children:m(P.fixed_price,"USD")}),(0,t.jsxs)("div",{className:"mt-1 text-[12px] text-[var(--v2-muted)]",children:["Limit ",m(P.min_limit,"USD")," – ",m(P.max_limit,"USD")]})]}),(0,t.jsx)(l.V2Input,{value:L,onChange:e=>A(e.target.value),placeholder:"Amount (USD)",inputMode:"decimal"}),K?(0,t.jsxs)("div",{className:"rounded-2xl border border-[var(--v2-border)] bg-[var(--v2-surface)] px-3 py-3",children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-text)]",children:"Payout method"}),(0,t.jsx)("div",{className:"mt-1 text-[12px] text-[var(--v2-muted)]",children:"Required when you sell (so the buyer can pay you)."}),z?0===F.length?(0,t.jsx)("div",{className:"mt-2 text-[12px] text-[var(--v2-muted)]",children:"No payment methods found. Add one from the legacy P2P page for now."}):(0,t.jsx)("div",{className:"mt-2 grid gap-2",children:F.slice(0,6).map(e=>{let r=Y===e.id;return(0,t.jsxs)("button",{type:"button",onClick:()=>q(e.id),className:"flex w-full items-center justify-between gap-2 rounded-xl border px-3 py-2 text-left"+(r?" border-[color-mix(in_srgb,var(--v2-accent)_55%,transparent)] bg-[color-mix(in_srgb,var(--v2-accent)_12%,transparent)]":" border-[var(--v2-border)] bg-[var(--v2-surface-2)]"),children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"truncate text-[13px] font-semibold text-[var(--v2-text)]",children:String(e.name||e.identifier)}),(0,t.jsx)("div",{className:"truncate text-[11px] text-[var(--v2-muted)]",children:String(e.identifier)})]}),(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[var(--v2-muted)]",children:r?"Selected":"Select"})]},e.id)})}):(0,t.jsxs)("div",{className:"mt-3 grid gap-2",children:[(0,t.jsx)(o.V2Skeleton,{className:"h-10"}),(0,t.jsx)(o.V2Skeleton,{className:"h-10"})]})]}):null,M?(0,t.jsx)("div",{className:"text-sm text-[var(--down)]",children:M}):null,(0,t.jsx)(i.V2Button,{variant:"primary",fullWidth:!0,disabled:O,onClick:()=>void G(),children:O?"Creating…":"Create order"}),(0,t.jsx)(r.default,{href:"/p2p",className:"block text-center text-[12px] font-semibold text-[var(--v2-muted)]",children:"Need advanced options? Open legacy P2P."})]}):(0,t.jsx)("div",{className:"text-sm text-[var(--v2-muted)]",children:"No ad selected."})})]})}e.s(["P2PClient",()=>x])}]);